{"version":3,"file":"src_assets_player_peertube-player-manager_ts.chunk.js?v=93","mappings":"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","sources":["webpack://peertube-client/./src/assets/player/shared/videojs-helpers/fn.js","webpack://peertube-client/./src/assets/player/shared/videojs-helpers/guid.js","webpack://peertube-client/./src/assets/player/peertube-player-local-storage.ts","webpack://peertube-client/./src/assets/player/peertube-player-manager.ts","webpack://peertube-client/./src/assets/player/shared/bezels/bezels-plugin.ts","webpack://peertube-client/./src/assets/player/shared/bezels/pause-bezel.ts","webpack://peertube-client/./src/assets/player/shared/common/index.ts","webpack://peertube-client/./src/assets/player/shared/common/utils.ts","webpack://peertube-client/./src/assets/player/shared/control-bar/next-previous-video-button.ts","webpack://peertube-client/./src/assets/player/shared/control-bar/p2p-info-button.ts","webpack://peertube-client/./src/assets/player/shared/control-bar/peertube-load-progress-bar.ts","webpack://peertube-client/./src/assets/player/shared/control-bar/picture-in-picture-bastyon.ts","webpack://peertube-client/./src/assets/player/shared/control-bar/theater-button.ts","webpack://peertube-client/./src/assets/player/shared/hotkeys/peertube-hotkeys-plugin.ts","webpack://peertube-client/./src/assets/player/shared/manager-options/control-bar-options-builder.ts","webpack://peertube-client/./src/assets/player/shared/manager-options/hls-options-builder.ts","webpack://peertube-client/./src/assets/player/shared/manager-options/index.ts","webpack://peertube-client/./src/assets/player/shared/manager-options/manager-options-builder.ts","webpack://peertube-client/./src/assets/player/shared/manager-options/webtorrent-options-builder.ts","webpack://peertube-client/./src/assets/player/shared/mobile/peertube-mobile-buttons.ts","webpack://peertube-client/./src/assets/player/shared/mobile/peertube-mobile-plugin.ts","webpack://peertube-client/./src/assets/player/shared/p2p-media-loader/redundancy-url-manager.ts","webpack://peertube-client/./src/assets/player/shared/p2p-media-loader/segment-url-builder.ts","webpack://peertube-client/./src/assets/player/shared/p2p-media-loader/segment-validator.ts","webpack://peertube-client/./src/assets/player/shared/peertube/peertube-plugin.ts","webpack://peertube-client/./src/assets/player/shared/playlist/playlist-button.ts","webpack://peertube-client/./src/assets/player/shared/playlist/playlist-menu-item.ts","webpack://peertube-client/./src/assets/player/shared/playlist/playlist-menu.ts","webpack://peertube-client/./src/assets/player/shared/playlist/playlist-plugin.ts","webpack://peertube-client/./src/assets/player/shared/resolutions/peertube-resolutions-plugin.ts","webpack://peertube-client/./src/assets/player/shared/settings/resolution-menu-button.ts","webpack://peertube-client/./src/assets/player/shared/settings/resolution-menu-item.ts","webpack://peertube-client/./src/assets/player/shared/settings/settings-dialog.ts","webpack://peertube-client/./src/assets/player/shared/settings/settings-menu-button.ts","webpack://peertube-client/./src/assets/player/shared/settings/settings-menu-item.ts","webpack://peertube-client/./src/assets/player/shared/settings/settings-panel-child.ts","webpack://peertube-client/./src/assets/player/shared/settings/settings-panel.ts","webpack://peertube-client/./src/assets/player/shared/stats/stats-card.ts","webpack://peertube-client/./src/assets/player/shared/stats/stats-plugin.ts","webpack://peertube-client/./src/assets/player/shared/upnext/end-card.ts","webpack://peertube-client/./src/assets/player/shared/upnext/upnext-plugin.ts","webpack://peertube-client/./src/root-helpers/web-browser.ts","webpack://peertube-client/./src/shims/path.ts","webpack://peertube-client/../shared/core-utils/abuse/abuse-predefined-reasons.ts","webpack://peertube-client/../shared/core-utils/abuse/index.ts","webpack://peertube-client/../shared/core-utils/common/array.ts","webpack://peertube-client/../shared/core-utils/common/date.ts","webpack://peertube-client/../shared/core-utils/common/env.ts","webpack://peertube-client/../shared/core-utils/common/index.ts","webpack://peertube-client/../shared/core-utils/common/object.ts","webpack://peertube-client/../shared/core-utils/common/path.ts","webpack://peertube-client/../shared/core-utils/common/random.ts","webpack://peertube-client/../shared/core-utils/common/regexp.ts","webpack://peertube-client/../shared/core-utils/common/time.ts","webpack://peertube-client/../shared/core-utils/common/url.ts","webpack://peertube-client/../shared/core-utils/common/version.ts","webpack://peertube-client/../shared/core-utils/i18n/i18n.ts","webpack://peertube-client/../shared/core-utils/i18n/index.ts","webpack://peertube-client/../shared/core-utils/index.ts","webpack://peertube-client/../shared/core-utils/plugins/index.ts","webpack://peertube-client/../shared/core-utils/renderer/html.ts","webpack://peertube-client/../shared/core-utils/renderer/index.ts","webpack://peertube-client/../shared/core-utils/renderer/markdown.ts","webpack://peertube-client/../shared/core-utils/users/index.ts","webpack://peertube-client/../shared/core-utils/users/user-role.ts","webpack://peertube-client/../shared/core-utils/videos/bitrate.ts","webpack://peertube-client/../shared/core-utils/videos/index.ts","webpack://peertube-client/../shared/core-utils/videos/privacy.ts"],"sourcesContent":["\r\n/**\r\n * @file fn.js\r\n * @module fn\r\n */\r\n import { newGUID } from './guid.js';\r\n import window from 'global/window';\r\n \r\n export const UPDATE_REFRESH_INTERVAL = 30;\r\n \r\n /**\r\n  * Bind (a.k.a proxy or context). A simple method for changing the context of\r\n  * a function.\r\n  *\r\n  * It also stores a unique id on the function so it can be easily removed from\r\n  * events.\r\n  *\r\n  * @function\r\n  * @param    {Mixed} context\r\n  *           The object to bind as scope.\r\n  *\r\n  * @param    {Function} fn\r\n  *           The function to be bound to a scope.\r\n  *\r\n  * @param    {number} [uid]\r\n  *           An optional unique ID for the function to be set\r\n  *\r\n  * @return   {Function}\r\n  *           The new function that will be bound into the context given\r\n  */\r\n export const bind = function(context, fn, uid) {\r\n   // Make sure the function has a unique ID\r\n   if (!fn.guid) {\r\n     fn.guid = newGUID();\r\n   }\r\n \r\n   // Create the new function that changes the context\r\n   const bound = fn.bind(context);\r\n \r\n   // Allow for the ability to individualize this function\r\n   // Needed in the case where multiple objects might share the same prototype\r\n   // IF both items add an event listener with the same function, then you try to remove just one\r\n   // it will remove both because they both have the same guid.\r\n   // when using this, you need to use the bind method when you remove the listener as well.\r\n   // currently used in text tracks\r\n   bound.guid = (uid) ? uid + '_' + fn.guid : fn.guid;\r\n \r\n   return bound;\r\n };\r\n \r\n /**\r\n  * Wraps the given function, `fn`, with a new function that only invokes `fn`\r\n  * at most once per every `wait` milliseconds.\r\n  *\r\n  * @function\r\n  * @param    {Function} fn\r\n  *           The function to be throttled.\r\n  *\r\n  * @param    {number}   wait\r\n  *           The number of milliseconds by which to throttle.\r\n  *\r\n  * @return   {Function}\r\n  */\r\n export const throttle = function(fn, wait) {\r\n   let last = window.performance.now();\r\n \r\n   const throttled = function(...args) {\r\n     const now = window.performance.now();\r\n \r\n     if (now - last >= wait) {\r\n       fn(...args);\r\n       last = now;\r\n     }\r\n   };\r\n \r\n   return throttled;\r\n };\r\n \r\n /**\r\n  * Creates a debounced function that delays invoking `func` until after `wait`\r\n  * milliseconds have elapsed since the last time the debounced function was\r\n  * invoked.\r\n  *\r\n  * Inspired by lodash and underscore implementations.\r\n  *\r\n  * @function\r\n  * @param    {Function} func\r\n  *           The function to wrap with debounce behavior.\r\n  *\r\n  * @param    {number} wait\r\n  *           The number of milliseconds to wait after the last invocation.\r\n  *\r\n  * @param    {boolean} [immediate]\r\n  *           Whether or not to invoke the function immediately upon creation.\r\n  *\r\n  * @param    {Object} [context=window]\r\n  *           The \"context\" in which the debounced function should debounce. For\r\n  *           example, if this function should be tied to a Video.js player,\r\n  *           the player can be passed here. Alternatively, defaults to the\r\n  *           global `window` object.\r\n  *\r\n  * @return   {Function}\r\n  *           A debounced function.\r\n  */\r\n export const debounce = function(func, wait, immediate, context = window) {\r\n   let timeout;\r\n \r\n   const cancel = () => {\r\n     context.clearTimeout(timeout);\r\n     timeout = null;\r\n   };\r\n \r\n   /* eslint-disable consistent-this */\r\n   const debounced = function() {\r\n     const self = this;\r\n     const args = arguments;\r\n \r\n     let later = function() {\r\n       timeout = null;\r\n       later = null;\r\n       if (!immediate) {\r\n         func.apply(self, args);\r\n       }\r\n     };\r\n \r\n     if (!timeout && immediate) {\r\n       func.apply(self, args);\r\n     }\r\n \r\n     context.clearTimeout(timeout);\r\n     timeout = context.setTimeout(later, wait);\r\n   };\r\n   /* eslint-enable consistent-this */\r\n \r\n   debounced.cancel = cancel;\r\n \r\n   return debounced;\r\n };","/**\r\n * @file guid.js\r\n * @module guid\r\n */\r\n\r\n// Default value for GUIDs. This allows us to reset the GUID counter in tests.\r\n//\r\n// The initial GUID is 3 because some users have come to rely on the first\r\n// default player ID ending up as `vjs_video_3`.\r\n//\r\n// See: https://github.com/videojs/video.js/pull/6216\r\nconst _initialGuid = 3;\r\n\r\n/**\r\n * Unique ID for an element or function\r\n *\r\n * @type {Number}\r\n */\r\nlet _guid = _initialGuid;\r\n\r\n/**\r\n * Get a unique auto-incrementing ID by number that has not been returned before.\r\n *\r\n * @return {number}\r\n *         A new unique ID.\r\n */\r\nexport function newGUID() {\r\n  return _guid++;\r\n}\r\n\r\n/**\r\n * Reset the unique auto-incrementing ID for testing only.\r\n */\r\nexport function resetGuidInTestsOnly() {\r\n  _guid = _initialGuid;\r\n}","import { logger } from '@root-helpers/logger'\r\n\r\nfunction getStoredVolume () {\r\n  const value = getLocalStorage('volume')\r\n  if (value !== null && value !== undefined) {\r\n    const valueNumber = parseFloat(value)\r\n    if (isNaN(valueNumber)) return undefined\r\n\r\n    return valueNumber\r\n  }\r\n\r\n  return undefined\r\n}\r\n\r\nfunction getStoredMute () {\r\n  const value = getLocalStorage('mute')\r\n  if (value !== null && value !== undefined) return value === 'true'\r\n\r\n  return undefined\r\n}\r\n\r\nfunction getStoredTheater () {\r\n  const value = getLocalStorage('theater-enabled')\r\n  if (value !== null && value !== undefined) return value === 'true'\r\n\r\n  return false\r\n}\r\n\r\nfunction saveVolumeInStore (value: number) {\r\n  return setLocalStorage('volume', value.toString())\r\n}\r\n\r\nfunction saveMuteInStore (value: boolean) {\r\n  return setLocalStorage('mute', value.toString())\r\n}\r\n\r\nfunction saveTheaterInStore (enabled: boolean) {\r\n  return setLocalStorage('theater-enabled', enabled.toString())\r\n}\r\n\r\nfunction saveAverageBandwidth (value: number) {\r\n  /** used to choose the most fitting resolution */\r\n  return setLocalStorage('average-bandwidth', value.toString())\r\n}\r\n\r\nfunction getAverageBandwidthInStore () {\r\n  const value = getLocalStorage('average-bandwidth')\r\n  if (value !== null && value !== undefined) {\r\n    const valueNumber = parseInt(value, 10)\r\n    if (isNaN(valueNumber)) return undefined\r\n\r\n    return valueNumber\r\n  }\r\n\r\n  return undefined\r\n}\r\n\r\nfunction saveLastSubtitle (language: string) {\r\n  return setLocalStorage('last-subtitle', language)\r\n}\r\n\r\nfunction getStoredLastSubtitle () {\r\n  return getLocalStorage('last-subtitle')\r\n}\r\n\r\nfunction saveVideoWatchHistory (videoUUID: string, duration: number) {\r\n  return setLocalStorage(`video-watch-history`, JSON.stringify({\r\n    ...getStoredVideoWatchHistory(),\r\n\r\n    [videoUUID]: {\r\n      duration,\r\n      date: `${(new Date()).toISOString()}`\r\n    }\r\n  }))\r\n}\r\n\r\nfunction getStoredVideoWatchHistory (videoUUID?: string) {\r\n  let data\r\n\r\n  try {\r\n    const value = getLocalStorage('video-watch-history')\r\n    if (!value) return {}\r\n\r\n    data = JSON.parse(value)\r\n  } catch (error) {\r\n    logger.error('Cannot parse video watch history from local storage/', error)\r\n  }\r\n\r\n  data = data || {}\r\n\r\n  if (videoUUID) return data[videoUUID]\r\n\r\n  return data\r\n}\r\n\r\nfunction cleanupVideoWatch () {\r\n  const data = getStoredVideoWatchHistory()\r\n  if (!data) return\r\n\r\n  const newData = Object.keys(data).reduce((acc, videoUUID) => {\r\n    const date = Date.parse(data[videoUUID].date)\r\n\r\n    const diff = Math.ceil(((new Date()).getTime() - date) / (1000 * 3600 * 24))\r\n\r\n    if (diff > 30) return acc\r\n\r\n    return {\r\n      ...acc,\r\n      [videoUUID]: data[videoUUID]\r\n    }\r\n  }, {})\r\n\r\n  setLocalStorage('video-watch-history', JSON.stringify(newData))\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n\r\nexport {\r\n  getStoredVolume,\r\n  getStoredMute,\r\n  getStoredTheater,\r\n  saveVolumeInStore,\r\n  saveMuteInStore,\r\n  saveTheaterInStore,\r\n  saveAverageBandwidth,\r\n  getAverageBandwidthInStore,\r\n  saveLastSubtitle,\r\n  getStoredLastSubtitle,\r\n  saveVideoWatchHistory,\r\n  getStoredVideoWatchHistory,\r\n  cleanupVideoWatch\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n\r\nconst KEY_PREFIX = 'peertube-videojs-'\r\n\r\nfunction getLocalStorage (key: string) {\r\n  try {\r\n    return localStorage.getItem(KEY_PREFIX + key)\r\n  } catch {\r\n    return undefined\r\n  }\r\n}\r\n\r\nfunction setLocalStorage (key: string, value: string) {\r\n  try {\r\n    localStorage.setItem(KEY_PREFIX + key, value)\r\n  } catch { /* empty */\r\n  }\r\n}\r\n","import '@peertube/videojs-contextmenu'\r\nimport './shared/upnext/end-card'\r\nimport './shared/upnext/upnext-plugin'\r\nimport './shared/stats/stats-card'\r\nimport './shared/stats/stats-plugin'\r\nimport './shared/bezels/bezels-plugin'\r\nimport './shared/peertube/peertube-plugin'\r\nimport './shared/resolutions/peertube-resolutions-plugin'\r\nimport './shared/control-bar/next-previous-video-button'\r\nimport './shared/control-bar/p2p-info-button'\r\n//import './shared/control-bar/peertube-link-button'\r\nimport './shared/control-bar/picture-in-picture-bastyon'\r\nimport './shared/control-bar/peertube-load-progress-bar'\r\nimport './shared/control-bar/theater-button'\r\nimport './shared/settings/resolution-menu-button'\r\nimport './shared/settings/resolution-menu-item'\r\nimport './shared/settings/settings-dialog'\r\nimport './shared/settings/settings-menu-button'\r\nimport './shared/settings/settings-menu-item'\r\nimport './shared/settings/settings-panel'\r\nimport './shared/settings/settings-panel-child'\r\nimport './shared/playlist/playlist-plugin'\r\nimport './shared/mobile/peertube-mobile-plugin'\r\nimport './shared/mobile/peertube-mobile-buttons'\r\nimport './shared/hotkeys/peertube-hotkeys-plugin'\r\nimport videojs from 'video.js'\r\nimport { logger } from '@root-helpers/logger'\r\nimport { isMobile } from '@root-helpers/web-browser'\r\nimport { saveAverageBandwidth } from './peertube-player-local-storage'\r\nimport { ManagerOptionsBuilder } from './shared/manager-options'\r\nimport { TranslationsManager } from './translations-manager'\r\nimport { CommonOptions, PeertubePlayerManagerOptions, PlayerMode, PlayerNetworkInfo } from './types'\r\n\r\n\r\nconst Fn: any = require('./shared/videojs-helpers/fn.js');\r\n\r\n\r\nconst Slider = videojs.getComponent('Slider') as any\r\nconst SeekBar = videojs.getComponent('SeekBar') as any\r\n\r\nSlider.prototype.update = function(){\r\n\r\n    // In VolumeBar init we have a setTimeout for update that pops and update\r\n    // to the end of the execution stack. The player is destroyed before then\r\n    // update will cause an error\r\n    // If there's no bar...\r\n    if (!this.el_ || !this.bar) {\r\n      return;\r\n    }\r\n\r\n    // clamp progress between 0 and 1\r\n    // and only round to four decimal places, as we round to two below\r\n    const progress = this.getProgress();\r\n\r\n    if (progress === this.progress_) {\r\n      return progress;\r\n    }\r\n\r\n    this.progress_ = progress;\r\n\r\n    // Set the new bar width or height\r\n    var el = this.bar.el()\r\n\r\n    if(!this.vertical()){\r\n      //el.style['transform-origin'] = 'left'\r\n      el.style['transform'] = 'scaleX('+(progress).toFixed(2)+')'\r\n    }\r\n    else{\r\n      el.style['transform-origin'] = 'bottom'\r\n      el.style['transform'] = 'scaleY('+(progress).toFixed(2)+')'\r\n    }\r\n\r\n    return progress;\r\n}\r\n\r\nSeekBar.prototype.getPercent = function getPercent () {\r\n  const time = this.player_.currentTime()\r\n  const percent = time / this.player_.duration()\r\n  return percent >= 1 ? 1 : percent\r\n}\r\n\r\nSeekBar.prototype.setEventHandlers_ = function () {\r\n\r\n  this.update_ = Fn.bind(this, this.update);\r\n  this.update = Fn.throttle(this.update_, Fn.UPDATE_REFRESH_INTERVAL);\r\n\r\n  this.on(this.player_, ['ended', 'durationchange', 'timeupdate'], this.update);\r\n  if (this.player_.liveTracker) {\r\n    this.on(this.player_.liveTracker, 'liveedgechange', this.update);\r\n  }\r\n\r\n  // when playing, let's ensure we smoothly update the play progress bar\r\n  // via an interval\r\n  this.updateInterval = null;\r\n\r\n  this.enableIntervalHandler_ = (e :any) => this.enableInterval_(e);\r\n  this.disableIntervalHandler_ = (e :any) => this.disableInterval_(e);\r\n\r\n  this.on(this.player_, ['playing'], this.enableIntervalHandler_);\r\n\r\n  this.on(this.player_, ['ended', 'pause', 'waiting'], this.disableIntervalHandler_);\r\n\r\n  // we don't need to update the play progress if the document is hidden,\r\n  // also, this causes the CPU to spike and eventually crash the page on IE11.\r\n  if ('hidden' in document && 'visibilityState' in document) {\r\n    this.on(document, 'visibilitychange', this.toggleVisibility_);\r\n  }\r\n}\r\n\r\nSeekBar.prototype.enableInterval_ = function() {\r\n  if (this.updateInterval) {\r\n    return;\r\n\r\n  }\r\n  this.updateInterval = this.setInterval(this.update, Fn.UPDATE_REFRESH_INTERVAL);\r\n}\r\n\r\nSeekBar.prototype.update = function (event : any) {\r\n\r\n  // ignore updates while the tab is hidden\r\n  if (document.visibilityState === 'hidden') {\r\n    return;\r\n  }\r\n\r\n  const percent = this.getPercent();\r\n\r\n    \r\n    /*const currentTime = this.player_.ended() ?\r\n    \r\n    this.player_.duration() : this.getCurrentTime_();\r\n\r\n    const liveTracker = this.player_.liveTracker;\r\n\r\n    let duration = this.player_.duration();\r\n\r\n    if (liveTracker && liveTracker.isLive()) {\r\n      duration = this.player_.liveTracker.liveCurrentTime();\r\n    }\r\n\r\n    if (this.percent_ !== percent) {\r\n      // machine readable value of progress bar (percentage complete)\r\n      //this.el_.setAttribute('aria-valuenow', (percent * 100).toFixed(2));\r\n      this.percent_ = percent;\r\n    }\r\n\r\n    if (this.currentTime_ !== currentTime || this.duration_ !== duration) {\r\n      // human readable value of progress bar (time complete)\r\n\r\n      this.currentTime_ = currentTime;\r\n      this.duration_ = duration;\r\n    }*/\r\n\r\n    var el = this.bar.el()\r\n\r\n    el.style['transform-origin'] = 'left'\r\n    el.style['transform'] = 'scaleX('+(percent).toFixed(2)+')'\r\n\r\n\r\n  return percent;\r\n  \r\n}\r\n\r\nSeekBar.prototype.handleMouseMove = function handleMouseMove (event: any) {\r\n\r\n  let newTime = this.calculateDistance(event) * this.player_.duration()\r\n  if (newTime === this.player_.duration()) {\r\n    newTime = newTime - 0.1\r\n  }\r\n\r\n  this.player_.currentTime(newTime)\r\n  this.update()\r\n}\r\n\r\n// Change 'Playback Rate' to 'Speed' (smaller for our settings menu)\r\n//(videojs.getComponent('PlaybackRateMenuButton') as any).prototype.controlText_ = 'Speed'\r\n\r\nconst CaptionsButton = videojs.getComponent('CaptionsButton') as any\r\n// Change Captions to Subtitles/CC\r\nCaptionsButton.prototype.controlText_ = 'Subtitles/CC'\r\n// We just want to display 'Off' instead of 'captions off', keep a space so the variable == true (hacky I know)\r\nCaptionsButton.prototype.label_ = ' '\r\n\r\nexport class PeertubePlayerManager {\r\n  private static playerElementClassName: string\r\n  private static onPlayerChange: (player: videojs.Player) => void\r\n  private static alreadyPlayed = false\r\n  //private static pluginsManager: PluginsManager\r\n\r\n  private static videojsDecodeErrors = 0\r\n\r\n  private static p2pMediaLoaderModule: any\r\n\r\n  static initState () {\r\n    this.alreadyPlayed = false\r\n  }\r\n\r\n  static async initialize (mode: PlayerMode, options: PeertubePlayerManagerOptions, onPlayerChange: (player: videojs.Player) => void) {\r\n    //this.pluginsManager = options.pluginsManager\r\n\r\n    this.onPlayerChange = onPlayerChange\r\n    this.playerElementClassName = options.common.playerElement.className\r\n\r\n    if (mode === 'webtorrent') await import('./shared/webtorrent/webtorrent-plugin')\r\n    if (mode === 'p2p-media-loader') {\r\n      const [ p2pMediaLoaderModule ] = await Promise.all([\r\n        import('@peertube/p2p-media-loader-hlsjs'),\r\n        import('./shared/p2p-media-loader/p2p-media-loader-plugin')\r\n      ])\r\n\r\n      this.p2pMediaLoaderModule = p2pMediaLoaderModule\r\n    }\r\n\r\n    //await TranslationsManager.loadLocaleInVideoJS(options.common.serverUrl, options.common.language, videojs)\r\n\r\n\r\n    return this.buildPlayer(mode, options)\r\n  }\r\n\r\n  private static async buildPlayer (mode: PlayerMode, options: PeertubePlayerManagerOptions): Promise<videojs.Player> {\r\n    const videojsOptionsBuilder = new ManagerOptionsBuilder(mode, options, this.p2pMediaLoaderModule)\r\n    const videojsOptions = videojsOptionsBuilder.getVideojsOptions(this.alreadyPlayed)\r\n\r\n    /*const videojsOptions = await this.pluginsManager.runHook(\r\n      'filter:internal.player.videojs.options.result',\r\n      videojsOptionsBuilder.getVideojsOptions(this.alreadyPlayed)\r\n    )*/\r\n\r\n    const self = this\r\n    return new Promise(res => {\r\n      videojs(options.common.playerElement, videojsOptions, function (this: videojs.Player) {\r\n        const player = this\r\n\r\n        let alreadyFallback = false\r\n\r\n        const handleError = () => {\r\n          if (alreadyFallback) return\r\n          alreadyFallback = true\r\n\r\n          if (mode === 'p2p-media-loader') {\r\n            self.tryToRecoverHLSError(player.error(), player, options)\r\n          } else {\r\n            /// remove torrent /// self.maybeFallbackToWebTorrent(mode, player, options)\r\n          }\r\n        }\r\n\r\n        player.one('error', () => handleError())\r\n\r\n        player.one('play', () => {\r\n          self.alreadyPlayed = true\r\n        })\r\n\r\n        self.addContextMenu(videojsOptionsBuilder, player, options.common)\r\n\r\n        if (isMobile() || options.mobile) player.peertubeMobile()\r\n        if (options.common.enableHotkeys === true) player.peerTubeHotkeysPlugin()\r\n        if (options.common.controlBar === false) player.controlBar.addClass('control-bar-hidden')\r\n\r\n        player.bezels()\r\n\r\n        player.stats({\r\n          videoUUID: options.common.videoUUID,\r\n          videoIsLive: options.common.isLive,\r\n          mode,\r\n          p2pEnabled: options.common.p2pEnabled\r\n        })\r\n\r\n        player.on('p2pInfo', (_, data: PlayerNetworkInfo) => {\r\n          if (data.source !== 'p2p-media-loader' || isNaN(data.bandwidthEstimate)) return\r\n\r\n          saveAverageBandwidth(data.bandwidthEstimate)\r\n        })\r\n\r\n        return res(player)\r\n      })\r\n    })\r\n  }\r\n\r\n  private static async tryToRecoverHLSError (err: any, currentPlayer: videojs.Player, options: PeertubePlayerManagerOptions) {\r\n    if (err.code === 3) { // Decode error\r\n\r\n      // Display a notification to user\r\n      if (this.videojsDecodeErrors === 0) {\r\n        options.common.errorNotifier(currentPlayer.localize('The video failed to play, will try to fast forward.'))\r\n      }\r\n\r\n      if (this.videojsDecodeErrors === 20) {\r\n        this.maybeFallbackToWebTorrent('p2p-media-loader', currentPlayer, options)\r\n        return\r\n      }\r\n\r\n      logger.info('Fast forwarding HLS to recover from an error.')\r\n\r\n      this.videojsDecodeErrors++\r\n\r\n      options.common.startTime = currentPlayer.currentTime() + 2\r\n      options.common.autoplay = true\r\n      this.rebuildAndUpdateVideoElement(currentPlayer, options.common)\r\n\r\n      const newPlayer = await this.buildPlayer('p2p-media-loader', options)\r\n      this.onPlayerChange(newPlayer)\r\n    } else {\r\n      this.maybeFallbackToWebTorrent('p2p-media-loader', currentPlayer, options)\r\n    }\r\n  }\r\n\r\n  private static async maybeFallbackToWebTorrent (\r\n    currentMode: PlayerMode,\r\n    currentPlayer: videojs.Player,\r\n    options: PeertubePlayerManagerOptions\r\n  ) {\r\n    if (options.webtorrent.videoFiles.length === 0 || currentMode === 'webtorrent') {\r\n      currentPlayer.peertube().displayFatalError()\r\n      return\r\n    }\r\n\r\n    logger.info('Fallback to webtorrent.')\r\n\r\n    this.rebuildAndUpdateVideoElement(currentPlayer, options.common)\r\n\r\n    await import('./shared/webtorrent/webtorrent-plugin')\r\n\r\n    const newPlayer = await this.buildPlayer('webtorrent', options)\r\n    this.onPlayerChange(newPlayer)\r\n  }\r\n\r\n  private static rebuildAndUpdateVideoElement (player: videojs.Player, commonOptions: CommonOptions) {\r\n    const newVideoElement = document.createElement('video')\r\n    newVideoElement.className = this.playerElementClassName\r\n\r\n    // VideoJS wraps our video element inside a div\r\n    let currentParentPlayerElement = commonOptions.playerElement.parentNode\r\n    // Fix on IOS, don't ask me why\r\n    if (!currentParentPlayerElement) currentParentPlayerElement = document.getElementById(commonOptions.playerElement.id).parentNode\r\n\r\n    currentParentPlayerElement.parentNode.insertBefore(newVideoElement, currentParentPlayerElement)\r\n\r\n    commonOptions.playerElement = newVideoElement\r\n    commonOptions.onPlayerElementChange(newVideoElement)\r\n\r\n    player.dispose()\r\n\r\n    return newVideoElement\r\n  }\r\n\r\n  private static addContextMenu (optionsBuilder: ManagerOptionsBuilder, player: videojs.Player, commonOptions: CommonOptions) {\r\n    const options = optionsBuilder.getContextMenuOptions(player, commonOptions)\r\n\r\n    player.contextmenuUI(options)\r\n  }\r\n}\r\n\r\n// ############################################################################\r\n\r\nexport {\r\n  videojs\r\n}\r\n","import videojs from 'video.js'\r\nimport './pause-bezel'\r\n\r\nconst Plugin = videojs.getPlugin('plugin')\r\n\r\nclass BezelsPlugin extends Plugin {\r\n\r\n  constructor (player: videojs.Player, options?: videojs.ComponentOptions) {\r\n    super(player)\r\n\r\n    this.player.ready(() => {\r\n      player.addClass('vjs-bezels')\r\n    })\r\n\r\n    player.addChild('PauseBezel', options)\r\n  }\r\n}\r\n\r\nvideojs.registerPlugin('bezels', BezelsPlugin)\r\n\r\nexport { BezelsPlugin }\r\n","import videojs from 'video.js'\r\nimport { isMobile } from '@root-helpers/web-browser'\r\n\r\nfunction getPauseBezel () {\r\n  return `\r\n  <div class=\"vjs-bezels-pause\">\r\n    <div class=\"vjs-bezel\" role=\"status\" aria-label=\"Pause\">\r\n      <div class=\"vjs-bezel-icon\">\r\n        <svg height=\"100%\" version=\"1.1\" viewBox=\"0 0 36 36\" width=\"100%\">\r\n          <use class=\"vjs-svg-shadow\" xlink:href=\"#vjs-id-1\"></use>\r\n          <path class=\"vjs-svg-fill\" d=\"M 12,26 16,26 16,10 12,10 z M 21,26 25,26 25,10 21,10 z\" id=\"vjs-id-1\"></path>\r\n        </svg>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  `\r\n}\r\n\r\nfunction getPlayBezel () {\r\n  return `\r\n  <div class=\"vjs-bezels-play\">\r\n    <div class=\"vjs-bezel\" role=\"status\" aria-label=\"Play\">\r\n      <div class=\"vjs-bezel-icon\">\r\n        <svg height=\"100%\" version=\"1.1\" viewBox=\"0 0 36 36\" width=\"100%\">\r\n          <use class=\"vjs-svg-shadow\" xlink:href=\"#vjs-id-2\"></use>\r\n          <path class=\"vjs-svg-fill\" d=\"M 12,26 18.5,22 18.5,14 12,10 z M 18.5,22 25,18 25,18 18.5,14 z\" id=\"ytp-id-2\"></path>\r\n        </svg>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  `\r\n}\r\n\r\nconst Component = videojs.getComponent('Component')\r\nclass PauseBezel extends Component {\r\n  container: HTMLDivElement\r\n\r\n  constructor (player: videojs.Player, options?: videojs.ComponentOptions) {\r\n    super(player, options)\r\n\r\n    // Hide bezels on mobile since we already have our mobile overlay\r\n    if (isMobile()) return\r\n\r\n    player.on('pause', (_: any) => {\r\n      if (player.seeking() || player.ended()) return\r\n      this.container.innerHTML = getPauseBezel()\r\n      this.showBezel()\r\n    })\r\n\r\n    player.on('play', (_: any) => {\r\n      if (player.seeking()) return\r\n      this.container.innerHTML = getPlayBezel()\r\n      this.showBezel()\r\n    })\r\n  }\r\n\r\n  createEl () {\r\n    this.container = super.createEl('div', {\r\n      className: 'vjs-bezels-content'\r\n    }) as HTMLDivElement\r\n\r\n    this.container.style.display = 'none'\r\n\r\n    return this.container\r\n  }\r\n\r\n  showBezel () {\r\n    this.container.style.display = 'inherit'\r\n\r\n    setTimeout(() => {\r\n      this.container.style.display = 'none'\r\n    }, 500) // matching the animation duration\r\n  }\r\n}\r\n\r\nvideojs.registerComponent('PauseBezel', PauseBezel)\r\n","export * from './utils'\r\n","import { VideoFile } from '@shared/models'\r\n\r\nfunction toTitleCase (str: string) {\r\n  return str.charAt(0).toUpperCase() + str.slice(1)\r\n}\r\n\r\nconst dictionaryBytes = [\r\n  { max: 1024, type: 'B', decimals: 0 },\r\n  { max: 1048576, type: 'KB', decimals: 0 },\r\n  { max: 1073741824, type: 'MB', decimals: 0 },\r\n  { max: 1.0995116e12, type: 'GB', decimals: 1 }\r\n]\r\nfunction bytes (value: number) {\r\n  const format = dictionaryBytes.find(d => value < d.max) || dictionaryBytes[dictionaryBytes.length - 1]\r\n  const calc = (value / (format.max / 1024)).toFixed(format.decimals)\r\n\r\n  return [ calc, format.type ]\r\n}\r\n\r\nfunction videoFileMaxByResolution (files: VideoFile[]) {\r\n  let max = files[0]\r\n\r\n  for (let i = 1; i < files.length; i++) {\r\n    const file = files[i]\r\n    if (max.resolution.id < file.resolution.id) max = file\r\n  }\r\n\r\n  return max\r\n}\r\n\r\nfunction videoFileMinByResolution (files: VideoFile[]) {\r\n  let min = files[0]\r\n\r\n  for (let i = 1; i < files.length; i++) {\r\n    const file = files[i]\r\n    if (min.resolution.id > file.resolution.id) min = file\r\n  }\r\n\r\n  return min\r\n}\r\n\r\nfunction getRtcConfig () {\r\n  return {\r\n    iceServers: [\r\n      {\r\n        urls: 'stun:stun.stunprotocol.org'\r\n      },\r\n      {\r\n        urls: 'stun:stun.framasoft.org'\r\n      }\r\n    ]\r\n  }\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n\r\nexport {\r\n  getRtcConfig,\r\n  toTitleCase,\r\n\r\n  videoFileMaxByResolution,\r\n  videoFileMinByResolution,\r\n  bytes\r\n}\r\n","import videojs from 'video.js'\r\nimport { NextPreviousVideoButtonOptions } from '../../types'\r\n\r\nconst Button = videojs.getComponent('Button')\r\n\r\nclass NextPreviousVideoButton extends Button {\r\n  private readonly nextPreviousVideoButtonOptions: NextPreviousVideoButtonOptions\r\n\r\n  constructor (player: videojs.Player, options?: NextPreviousVideoButtonOptions) {\r\n    super(player, options as any)\r\n\r\n    this.nextPreviousVideoButtonOptions = options\r\n\r\n    this.update()\r\n  }\r\n\r\n  createEl () {\r\n    const type = (this.options_ as NextPreviousVideoButtonOptions).type\r\n\r\n    const button = videojs.dom.createEl('button', {\r\n      className: 'vjs-' + type + '-video'\r\n    }) as HTMLButtonElement\r\n    const nextIcon = videojs.dom.createEl('span', {\r\n      className: 'icon icon-' + type\r\n    })\r\n    button.appendChild(nextIcon)\r\n\r\n    if (type === 'next') {\r\n      button.title = this.player_.localize('Next video')\r\n    } else {\r\n      button.title = this.player_.localize('Previous video')\r\n    }\r\n\r\n    return button\r\n  }\r\n\r\n  handleClick () {\r\n    this.nextPreviousVideoButtonOptions.handler()\r\n  }\r\n\r\n  update () {\r\n    const disabled = this.nextPreviousVideoButtonOptions.isDisabled()\r\n\r\n    if (disabled) this.addClass('vjs-disabled')\r\n    else this.removeClass('vjs-disabled')\r\n  }\r\n}\r\n\r\nvideojs.registerComponent('NextVideoButton', NextPreviousVideoButton)\r\nvideojs.registerComponent('PreviousVideoButton', NextPreviousVideoButton)\r\n","import videojs from 'video.js'\r\nimport { PeerTubeP2PInfoButtonOptions, PlayerNetworkInfo } from '../../types'\r\nimport { bytes } from '../common'\r\n\r\nconst Button = videojs.getComponent('Button')\r\nclass P2pInfoButton extends Button {\r\n\r\n  constructor (player: videojs.Player, options?: PeerTubeP2PInfoButtonOptions) {\r\n    super(player, options as any)\r\n  }\r\n\r\n  createEl () {\r\n    const div = videojs.dom.createEl('div', {\r\n      className: 'vjs-peertube'\r\n    })\r\n    const subDivWebtorrent = videojs.dom.createEl('div', {\r\n      className: 'vjs-peertube-hidden' // Hide the stats before we get the info\r\n    }) as HTMLDivElement\r\n    div.appendChild(subDivWebtorrent)\r\n\r\n    // Stop here if P2P is not enabled\r\n    const p2pEnabled = (this.options_ as PeerTubeP2PInfoButtonOptions).p2pEnabled\r\n    if (!p2pEnabled) return div as HTMLButtonElement\r\n\r\n    const downloadIcon = videojs.dom.createEl('span', {\r\n      className: 'icon icon-download'\r\n    })\r\n    subDivWebtorrent.appendChild(downloadIcon)\r\n\r\n    const downloadSpeedText = videojs.dom.createEl('span', {\r\n      className: 'download-speed-text'\r\n    })\r\n    const downloadSpeedNumber = videojs.dom.createEl('span', {\r\n      className: 'download-speed-number'\r\n    })\r\n    const downloadSpeedUnit = videojs.dom.createEl('span')\r\n    downloadSpeedText.appendChild(downloadSpeedNumber)\r\n    downloadSpeedText.appendChild(downloadSpeedUnit)\r\n    subDivWebtorrent.appendChild(downloadSpeedText)\r\n\r\n    const uploadIcon = videojs.dom.createEl('span', {\r\n      className: 'icon icon-upload'\r\n    })\r\n    subDivWebtorrent.appendChild(uploadIcon)\r\n\r\n    const uploadSpeedText = videojs.dom.createEl('span', {\r\n      className: 'upload-speed-text'\r\n    })\r\n    const uploadSpeedNumber = videojs.dom.createEl('span', {\r\n      className: 'upload-speed-number'\r\n    })\r\n    const uploadSpeedUnit = videojs.dom.createEl('span')\r\n    uploadSpeedText.appendChild(uploadSpeedNumber)\r\n    uploadSpeedText.appendChild(uploadSpeedUnit)\r\n    subDivWebtorrent.appendChild(uploadSpeedText)\r\n\r\n    const peersText = videojs.dom.createEl('span', {\r\n      className: 'peers-text'\r\n    })\r\n    const peersNumber = videojs.dom.createEl('span', {\r\n      className: 'peers-number'\r\n    })\r\n    subDivWebtorrent.appendChild(peersNumber)\r\n    subDivWebtorrent.appendChild(peersText)\r\n\r\n    const subDivHttp = videojs.dom.createEl('div', {\r\n      className: 'vjs-peertube-hidden'\r\n    })\r\n    const subDivHttpText = videojs.dom.createEl('span', {\r\n      className: 'http-fallback',\r\n      textContent: 'HTTP'\r\n    })\r\n\r\n    subDivHttp.appendChild(subDivHttpText)\r\n    div.appendChild(subDivHttp)\r\n\r\n    this.player_.on('p2pInfo', (event: any, data: PlayerNetworkInfo) => {\r\n      // We are in HTTP fallback\r\n      if (!data) {\r\n        subDivHttp.className = 'vjs-peertube-displayed'\r\n        subDivWebtorrent.className = 'vjs-peertube-hidden'\r\n\r\n        return\r\n      }\r\n\r\n      const p2pStats = data.p2p\r\n      const httpStats = data.http\r\n\r\n      const downloadSpeed = bytes(p2pStats.downloadSpeed + httpStats.downloadSpeed)\r\n      const uploadSpeed = bytes(p2pStats.uploadSpeed + httpStats.uploadSpeed)\r\n      const totalDownloaded = bytes(p2pStats.downloaded + httpStats.downloaded)\r\n      const totalUploaded = bytes(p2pStats.uploaded + httpStats.uploaded)\r\n      const numPeers = p2pStats.numPeers\r\n\r\n      subDivWebtorrent.title = this.player().localize('Total downloaded: ') + totalDownloaded.join(' ') + '\\n'\r\n\r\n      if (data.source === 'p2p-media-loader') {\r\n        const downloadedFromServer = bytes(httpStats.downloaded).join(' ')\r\n        const downloadedFromPeers = bytes(p2pStats.downloaded).join(' ')\r\n\r\n        subDivWebtorrent.title +=\r\n          ' * ' + this.player().localize('From servers: ') + downloadedFromServer + '\\n' +\r\n          ' * ' + this.player().localize('From peers: ') + downloadedFromPeers + '\\n'\r\n      }\r\n      subDivWebtorrent.title += this.player().localize('Total uploaded: ') + totalUploaded.join(' ')\r\n\r\n      downloadSpeedNumber.textContent = downloadSpeed[0]\r\n      downloadSpeedUnit.textContent = ' ' + downloadSpeed[1]\r\n\r\n      uploadSpeedNumber.textContent = uploadSpeed[0]\r\n      uploadSpeedUnit.textContent = ' ' + uploadSpeed[1]\r\n\r\n      peersNumber.textContent = numPeers.toString()\r\n      peersText.textContent = ' ' + (numPeers > 1 ? this.player().localize('peers') : this.player_.localize('peer'))\r\n\r\n      subDivHttp.className = 'vjs-peertube-hidden'\r\n      subDivWebtorrent.className = 'vjs-peertube-displayed'\r\n    })\r\n\r\n    return div as HTMLButtonElement\r\n  }\r\n}\r\n\r\nvideojs.registerComponent('P2PInfoButton', P2pInfoButton)\r\n","import videojs from 'video.js'\r\n\r\nconst Component = videojs.getComponent('Component')\r\n\r\nclass PeerTubeLoadProgressBar extends Component {\r\n\r\n  constructor (player: videojs.Player, options?: videojs.ComponentOptions) {\r\n    super(player, options)\r\n\r\n    this.on(player, 'progress', this.update)\r\n  }\r\n\r\n  createEl () {\r\n    return super.createEl('div', {\r\n      className: 'vjs-load-progress',\r\n      innerHTML: `<span class=\"vjs-control-text\"><span>${this.localize('Loaded')}</span>: 0%</span>`\r\n    })\r\n  }\r\n\r\n  dispose () {\r\n    super.dispose()\r\n  }\r\n\r\n  update () {\r\n    const torrent = this.player().webtorrent().getTorrent()\r\n    if (!torrent) return\r\n\r\n    // @ts-ignore\r\n    (this.el() as HTMLElement).style['transform-origin'] = 'left'\r\n    (this.el() as HTMLElement).style['transform'] = 'scaleX('+(torrent.progress).toFixed(2)+')'\r\n\r\n    //(this.el() as HTMLElement).style.width = (torrent.progress * 100) + '%'\r\n  }\r\n\r\n}\r\n\r\nComponent.registerComponent('PeerTubeLoadProgressBar', PeerTubeLoadProgressBar)\r\n","/**\r\n * @file picture-in-picture-toggle.js\r\n */\r\n /*import Button from '../button.js';\r\n import Component from '../component.js';\r\n import document from 'global/document';*/\r\n\r\n import videojs from \"video.js\";\r\n\r\n const Button = videojs.getComponent(\"Button\");\r\n const MenuButton = videojs.getComponent(\"MenuButton\");\r\n  \r\n  /**\r\n   * Toggle Picture-in-Picture mode\r\n   *\r\n   * @extends Button\r\n   */\r\n  class PictureInPictureBastyon extends MenuButton {\r\n  \r\n \r\n    constructor(player, options) {\r\n      super(player, options);\r\n \r\n      this.controlText('Mini Player')\r\n    }\r\n \r\n    createEl(){\r\n     return this.buildElement();\r\n    }\r\n \r\n    handleClick(event) {\r\n      console.log(\"PICRE\")\r\n     this.player_.trigger('pictureInPictureRequest', event)\r\n    }\r\n \r\n    private buildElement() {\r\n \r\n     const el = super.createEl();\r\n     \r\n     el.classList.add(\"vjs-picture-in-picture-control\");\r\n \r\n     return el as HTMLButtonElement;\r\n   }\r\n  \r\n  }\r\n \r\n  videojs.registerComponent(\"PictureInPictureBastyon\", PictureInPictureBastyon);\r\n  ","import videojs from 'video.js'\r\nimport { getStoredTheater, saveTheaterInStore } from '../../peertube-player-local-storage'\r\n\r\nconst Button = videojs.getComponent('Button')\r\nclass TheaterButton extends Button {\r\n\r\n  private static readonly THEATER_MODE_CLASS = 'vjs-theater-enabled'\r\n\r\n  constructor (player: videojs.Player, options: videojs.ComponentOptions) {\r\n    super(player, options)\r\n\r\n    const enabled = getStoredTheater()\r\n    if (enabled === true) {\r\n      this.player().addClass(TheaterButton.THEATER_MODE_CLASS)\r\n\r\n      this.handleTheaterChange()\r\n    }\r\n\r\n    this.controlText('Theater mode')\r\n\r\n    this.player().theaterEnabled = enabled\r\n  }\r\n\r\n  buildCSSClass () {\r\n    return `vjs-theater-control ${super.buildCSSClass()}`\r\n  }\r\n\r\n  handleTheaterChange () {\r\n    const theaterEnabled = this.isTheaterEnabled()\r\n\r\n    if (theaterEnabled) {\r\n      this.controlText('Normal mode')\r\n    } else {\r\n      this.controlText('Theater mode')\r\n    }\r\n\r\n    saveTheaterInStore(theaterEnabled)\r\n\r\n    this.player_.trigger('theaterChange', theaterEnabled)\r\n  }\r\n\r\n  handleClick () {\r\n    this.player_.toggleClass(TheaterButton.THEATER_MODE_CLASS)\r\n\r\n    this.handleTheaterChange()\r\n  }\r\n\r\n  private isTheaterEnabled () {\r\n    return this.player_.hasClass(TheaterButton.THEATER_MODE_CLASS)\r\n  }\r\n}\r\n\r\nvideojs.registerComponent('TheaterButton', TheaterButton)\r\n","import videojs from 'video.js'\r\n\r\ntype KeyHandler = { accept: (event: KeyboardEvent) => boolean, cb: (e: KeyboardEvent) => void }\r\n\r\nconst Plugin = videojs.getPlugin('plugin')\r\n\r\nclass PeerTubeHotkeysPlugin extends Plugin {\r\n  private static readonly VOLUME_STEP = 0.1\r\n  private static readonly SEEK_STEP = 5\r\n\r\n  private readonly handleKeyFunction: (event: KeyboardEvent) => void\r\n\r\n  private readonly handlers: KeyHandler[]\r\n\r\n  constructor (player: videojs.Player, options: videojs.PlayerOptions) {\r\n    super(player, options)\r\n\r\n    this.handlers = this.buildHandlers()\r\n\r\n    this.handleKeyFunction = (event: KeyboardEvent) => this.onKeyDown(event)\r\n    document.addEventListener('keydown', this.handleKeyFunction)\r\n  }\r\n\r\n  dispose () {\r\n    document.removeEventListener('keydown', this.handleKeyFunction)\r\n  }\r\n\r\n  private onKeyDown (event: KeyboardEvent) {\r\n    if (!this.isValidKeyTarget(event.target as HTMLElement)) return\r\n\r\n    for (const handler of this.handlers) {\r\n      if (handler.accept(event)) {\r\n        handler.cb(event)\r\n        return\r\n      }\r\n    }\r\n  }\r\n\r\n  private buildHandlers () {\r\n    const handlers: KeyHandler[] = [\r\n      // Play\r\n      {\r\n        accept: e => (e.key === ' ' || e.key === 'MediaPlayPause'),\r\n        cb: e => {\r\n          e.preventDefault()\r\n          e.stopPropagation()\r\n\r\n          if (this.player.paused()) this.player.play()\r\n          else this.player.pause()\r\n        }\r\n      },\r\n\r\n      // Increase volume\r\n      {\r\n        accept: e => this.isNaked(e, 'ArrowUp'),\r\n        cb: e => {\r\n          e.preventDefault()\r\n          this.player.volume(this.player.volume() + PeerTubeHotkeysPlugin.VOLUME_STEP)\r\n        }\r\n      },\r\n\r\n      // Decrease volume\r\n      {\r\n        accept: e => this.isNaked(e, 'ArrowDown'),\r\n        cb: e => {\r\n          e.preventDefault()\r\n          this.player.volume(this.player.volume() - PeerTubeHotkeysPlugin.VOLUME_STEP)\r\n        }\r\n      },\r\n\r\n      // Rewind\r\n      {\r\n        accept: e => this.isNaked(e, 'ArrowLeft') || this.isNaked(e, 'MediaRewind'),\r\n        cb: e => {\r\n          e.preventDefault()\r\n\r\n          const target = Math.max(0, this.player.currentTime() - PeerTubeHotkeysPlugin.SEEK_STEP)\r\n          this.player.currentTime(target)\r\n        }\r\n      },\r\n\r\n      // Forward\r\n      {\r\n        accept: e => this.isNaked(e, 'ArrowRight') || this.isNaked(e, 'MediaForward'),\r\n        cb: e => {\r\n          e.preventDefault()\r\n\r\n          const target = Math.min(this.player.duration(), this.player.currentTime() + PeerTubeHotkeysPlugin.SEEK_STEP)\r\n          this.player.currentTime(target)\r\n        }\r\n      },\r\n\r\n      // Fullscreen\r\n      {\r\n        // f key or Ctrl + Enter\r\n        accept: e => this.isNaked(e, 'f') || (!e.altKey && e.ctrlKey && e.key === 'Enter'),\r\n        cb: e => {\r\n          e.preventDefault()\r\n\r\n          if (this.player.isFullscreen()) this.player.exitFullscreen()\r\n          else this.player.requestFullscreen()\r\n        }\r\n      },\r\n\r\n      // Mute\r\n      {\r\n        accept: e => this.isNaked(e, 'm'),\r\n        cb: e => {\r\n          e.preventDefault()\r\n\r\n          this.player.muted(!this.player.muted())\r\n        }\r\n      },\r\n\r\n      // Increase playback rate\r\n      {\r\n        accept: e => e.key === '>',\r\n        cb: () => {\r\n          const target = Math.min(this.player.playbackRate() + 0.1, 5)\r\n\r\n          this.player.playbackRate(parseFloat(target.toFixed(2)))\r\n        }\r\n      },\r\n\r\n      // Decrease playback rate\r\n      {\r\n        accept: e => e.key === '<',\r\n        cb: () => {\r\n          const target = Math.max(this.player.playbackRate() - 0.1, 0.10)\r\n\r\n          this.player.playbackRate(parseFloat(target.toFixed(2)))\r\n        }\r\n      },\r\n\r\n      // Previous frame\r\n      {\r\n        accept: e => e.key === ',',\r\n        cb: () => {\r\n          this.player.pause()\r\n\r\n          // Calculate movement distance (assuming 30 fps)\r\n          const dist = 1 / 30\r\n          this.player.currentTime(this.player.currentTime() - dist)\r\n        }\r\n      },\r\n\r\n      // Next frame\r\n      {\r\n        accept: e => e.key === '.',\r\n        cb: () => {\r\n          this.player.pause()\r\n\r\n          // Calculate movement distance (assuming 30 fps)\r\n          const dist = 1 / 30\r\n          this.player.currentTime(this.player.currentTime() + dist)\r\n        }\r\n      }\r\n    ]\r\n\r\n    // 0-9 key handlers\r\n    for (let i = 0; i < 10; i++) {\r\n      handlers.push({\r\n        accept: e => e.key === i + '' && !e.ctrlKey, // If using ctrl key, it's a web browser hotkey\r\n        cb: e => {\r\n          e.preventDefault()\r\n\r\n          this.player.currentTime(this.player.duration() * i * 0.1)\r\n        }\r\n      })\r\n    }\r\n\r\n    return handlers\r\n  }\r\n\r\n  private isValidKeyTarget (eventEl: HTMLElement) {\r\n    const playerEl = this.player.el()\r\n    const activeEl = document.activeElement\r\n    const currentElTagName = eventEl.tagName.toLowerCase()\r\n\r\n    return (\r\n      activeEl === playerEl ||\r\n      activeEl === playerEl.querySelector('.vjs-tech') ||\r\n      activeEl === playerEl.querySelector('.vjs-control-bar') ||\r\n      eventEl.id === 'content' ||\r\n      currentElTagName === 'body' ||\r\n      currentElTagName === 'video'\r\n    )\r\n  }\r\n\r\n  private isNaked (event: KeyboardEvent, key: string) {\r\n    return (!event.ctrlKey && !event.altKey && !event.metaKey && !event.shiftKey && event.key === key)\r\n  }\r\n}\r\n\r\nvideojs.registerPlugin('peerTubeHotkeysPlugin', PeerTubeHotkeysPlugin)\r\nexport { PeerTubeHotkeysPlugin }\r\n","import {\r\n  CommonOptions,\r\n  NextPreviousVideoButtonOptions,\r\n  PeerTubeLinkButtonOptions,\r\n  PeertubePlayerManagerOptions,\r\n  PlayerMode\r\n} from '../../types'\r\n\r\nexport class ControlBarOptionsBuilder {\r\n  private options: CommonOptions\r\n\r\n  constructor (\r\n    globalOptions: PeertubePlayerManagerOptions,\r\n    private mode: PlayerMode\r\n  ) {\r\n    this.options = globalOptions.common\r\n  }\r\n\r\n  getChildrenOptions () {\r\n    const children = {}\r\n\r\n    if (this.options.previousVideo) {\r\n      Object.assign(children, this.getPreviousVideo())\r\n    }\r\n\r\n    Object.assign(children, { playToggle: {} })\r\n\r\n    if (this.options.nextVideo) {\r\n      Object.assign(children, this.getNextVideo())\r\n    }\r\n\r\n    Object.assign(children, {\r\n      currentTimeDisplay: {},\r\n      timeDivider: {},\r\n      durationDisplay: {},\r\n      liveDisplay: {},\r\n\r\n      flexibleWidthSpacer: {},\r\n\r\n      ...this.getProgressControl(),\r\n\r\n      p2PInfoButton: {\r\n        p2pEnabled: this.options.p2pEnabled\r\n      },\r\n\r\n      muteToggle: {},\r\n      volumeControl: {},\r\n\r\n      ...this.getSettingsButton()\r\n    })\r\n\r\n    /*if (this.options.peertubeLink === true) {\r\n      Object.assign(children, {\r\n        peerTubeLinkButton: {\r\n          shortUUID: this.options.videoShortUUID,\r\n          //instanceName: this.options.instanceName\r\n        } as PeerTubeLinkButtonOptions\r\n      })\r\n    }*/\r\n\r\n    Object.assign(children, {\r\n      PictureInPictureBastyon: {}\r\n    })\r\n\r\n    if (this.options.theaterButton === true) {\r\n      Object.assign(children, {\r\n        theaterButton: {}\r\n      })\r\n    }\r\n\r\n    Object.assign(children, {\r\n      fullscreenToggle: {}\r\n    })\r\n\r\n    return children\r\n  }\r\n\r\n  private getSettingsButton () {\r\n    const settingEntries: string[] = []\r\n\r\n    settingEntries.push('playbackRateMenuButton')\r\n\r\n    //if (this.options.captions === true) settingEntries.push('captionsButton')\r\n\r\n    settingEntries.push('resolutionMenuButton')\r\n\r\n    return {\r\n      settingsButton: {\r\n        setup: {\r\n          maxHeightOffset: 40\r\n        },\r\n        entries: settingEntries\r\n      }\r\n    }\r\n  }\r\n\r\n  private getProgressControl () {\r\n    const loadProgressBar = this.mode === 'webtorrent'\r\n      ? 'peerTubeLoadProgressBar'\r\n      : 'loadProgressBar'\r\n\r\n    return {\r\n      progressControl: {\r\n        children: {\r\n          seekBar: {\r\n            children: {\r\n              [loadProgressBar]: {},\r\n              mouseTimeDisplay: {},\r\n              playProgressBar: {}\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private getPreviousVideo () {\r\n    const buttonOptions: NextPreviousVideoButtonOptions = {\r\n      type: 'previous',\r\n      handler: this.options.previousVideo,\r\n      isDisabled: () => {\r\n        if (!this.options.hasPreviousVideo) return false\r\n\r\n        return !this.options.hasPreviousVideo()\r\n      }\r\n    }\r\n\r\n    return { previousVideoButton: buttonOptions }\r\n  }\r\n\r\n  private getNextVideo () {\r\n    const buttonOptions: NextPreviousVideoButtonOptions = {\r\n      type: 'next',\r\n      handler: this.options.nextVideo,\r\n      isDisabled: () => {\r\n        if (!this.options.hasNextVideo) return false\r\n\r\n        return !this.options.hasNextVideo()\r\n      }\r\n    }\r\n\r\n    return { nextVideoButton: buttonOptions }\r\n  }\r\n}\r\n","import { HybridLoaderSettings } from '@peertube/p2p-media-loader-core'\r\nimport { HlsJsEngineSettings } from '@peertube/p2p-media-loader-hlsjs'\r\nimport { logger } from '@root-helpers/logger'\r\nimport { LiveVideoLatencyMode } from '@shared/models'\r\nimport { getAverageBandwidthInStore } from '../../peertube-player-local-storage'\r\nimport { P2PMediaLoader, P2PMediaLoaderPluginOptions } from '../../types'\r\nimport { PeertubePlayerManagerOptions } from '../../types/manager-options'\r\nimport { getRtcConfig } from '../common'\r\nimport { RedundancyUrlManager } from '../p2p-media-loader/redundancy-url-manager'\r\nimport { segmentUrlBuilderFactory } from '../p2p-media-loader/segment-url-builder'\r\nimport { segmentValidatorFactory } from '../p2p-media-loader/segment-validator'\r\n//import CapLevelController from './peertube-cap-level-controller'\r\n\r\nexport class HLSOptionsBuilder {\r\n\r\n  constructor (\r\n    private options: PeertubePlayerManagerOptions,\r\n    private p2pMediaLoaderModule?: any\r\n  ) {\r\n\r\n  }\r\n\r\n  getPluginOptions () {\r\n    const commonOptions = this.options.common\r\n\r\n    const redundancyUrlManager = new RedundancyUrlManager(this.options.p2pMediaLoader.redundancyBaseUrls)\r\n\r\n    const p2pMediaLoaderConfig = this.getP2PMediaLoaderOptions(redundancyUrlManager)\r\n    const loader = new this.p2pMediaLoaderModule.Engine(p2pMediaLoaderConfig).createLoaderClass() as P2PMediaLoader\r\n\r\n    console.log('p2pMediaLoaderConfig', p2pMediaLoaderConfig)\r\n\r\n    const p2pMediaLoader: P2PMediaLoaderPluginOptions = {\r\n      redundancyUrlManager,\r\n      type: 'application/x-mpegURL',\r\n      startTime: commonOptions.startTime,\r\n      src: this.options.p2pMediaLoader.playlistUrl,\r\n      loader\r\n    }\r\n\r\n    const hlsjs = {\r\n      levelLabelHandler: (level: { height: number, width: number }) => {\r\n        const resolution = Math.min(level.height || 0, level.width || 0)\r\n\r\n        const file = this.options.p2pMediaLoader.videoFiles.find(f => f.resolution.id === resolution)\r\n        // We don't have files for live videos\r\n        if (!file) return level.height\r\n\r\n        let label = file.resolution.label\r\n        if (file.fps >= 50) label += file.fps\r\n\r\n        return label\r\n      }\r\n    }\r\n\r\n    const html5 = {\r\n      hlsjsConfig: this.getHLSJSOptions(loader)\r\n    }\r\n\r\n    return { p2pMediaLoader, hlsjs, html5 }\r\n  }\r\n\r\n  // ---------------------------------------------------------------------------\r\n\r\n  private getP2PMediaLoaderOptions (redundancyUrlManager: RedundancyUrlManager): HlsJsEngineSettings {\r\n    let consumeOnly = false\r\n    if ((navigator as any)?.connection?.type === 'cellular') {\r\n      logger.info('We are on a cellular connection: disabling seeding.')\r\n      consumeOnly = true\r\n    }\r\n\r\n    const trackerAnnounce = this.options.p2pMediaLoader.trackerAnnounce\r\n                                                 .filter(t => t.startsWith('ws'))\r\n\r\n    const specificLiveOrVODOptions = this.options.common.isLive\r\n      ? this.getP2PMediaLoaderLiveOptions()\r\n      : this.getP2PMediaLoaderVODOptions()\r\n\r\n    return {\r\n      loader: {\r\n        trackerAnnounce,\r\n        rtcConfig: getRtcConfig(),\r\n\r\n        simultaneousHttpDownloads: 1,\r\n        httpFailedSegmentTimeout: 1000,\r\n\r\n        segmentValidator: segmentValidatorFactory(this.options.p2pMediaLoader.segmentsSha256Url, this.options.common.isLive),\r\n        segmentUrlBuilder: segmentUrlBuilderFactory(redundancyUrlManager),\r\n\r\n        useP2P: this.options.common.p2pEnabled,\r\n        consumeOnly,\r\n        segmentsStorage : this.options.segmentsStorage,\r\n\r\n        ...specificLiveOrVODOptions\r\n      },\r\n      segments: {\r\n        assetsStorage : this.options.assetsStorage,\r\n        swarmId: this.options.p2pMediaLoader.playlistUrl,\r\n        forwardSegmentCount: specificLiveOrVODOptions.p2pDownloadMaxPriority ?? 20\r\n      }\r\n    }\r\n  }\r\n\r\n  private getP2PMediaLoaderLiveOptions (): Partial<HybridLoaderSettings> {\r\n    const base = {\r\n      requiredSegmentsPriority: 1\r\n    }\r\n\r\n    const latencyMode = this.options.common.liveOptions.latencyMode\r\n\r\n    switch (latencyMode) {\r\n      case LiveVideoLatencyMode.SMALL_LATENCY:\r\n        return {\r\n          ...base,\r\n\r\n          useP2P: false,\r\n          httpDownloadProbability: 1\r\n        }\r\n\r\n      case LiveVideoLatencyMode.HIGH_LATENCY:\r\n        return base\r\n\r\n      default:\r\n        return base\r\n    }\r\n  }\r\n\r\n  private getP2PMediaLoaderVODOptions (): Partial<HybridLoaderSettings> {\r\n    return {\r\n      requiredSegmentsPriority: 3,\r\n      skipSegmentBuilderPriority: 1,\r\n\r\n      cachedSegmentExpiration: 86400000,\r\n      cachedSegmentsCount: 100,\r\n\r\n      httpDownloadMaxPriority: 9,\r\n      httpDownloadProbability: 0.06,\r\n      httpDownloadProbabilitySkipIfNoPeers: true,\r\n\r\n      p2pDownloadMaxPriority: 50\r\n    }\r\n  }\r\n\r\n  // ---------------------------------------------------------------------------\r\n\r\n  private getHLSJSOptions (loader: P2PMediaLoader) {\r\n    const specificLiveOrVODOptions = this.options.common.isLive\r\n      ? this.getHLSLiveOptions()\r\n      : this.getHLSVODOptions()\r\n\r\n    const base = {\r\n      capLevelToPlayerSize: true,\r\n      autoStartLoad: false,\r\n\r\n      loader,\r\n\r\n      ...specificLiveOrVODOptions\r\n    }\r\n\r\n    const averageBandwidth = getAverageBandwidthInStore()\r\n    if (!averageBandwidth) return base\r\n\r\n    return {\r\n      ...base,\r\n\r\n      abrEwmaDefaultEstimate: averageBandwidth * 8, // We want bit/s\r\n      backBufferLength: 90,\r\n      startLevel: -1,\r\n      testBandwidth: false,\r\n      debug: false,\r\n\r\n     // capLevelController : CapLevelController\r\n    }\r\n  }\r\n\r\n  private getHLSLiveOptions () {\r\n    const latencyMode = this.options.common.liveOptions.latencyMode\r\n\r\n    switch (latencyMode) {\r\n      case LiveVideoLatencyMode.SMALL_LATENCY:\r\n        return {\r\n          liveSyncDurationCount: 2\r\n        }\r\n\r\n      case LiveVideoLatencyMode.HIGH_LATENCY:\r\n        return {\r\n          liveSyncDurationCount: 10\r\n        }\r\n\r\n      default:\r\n        return {\r\n          liveSyncDurationCount: 5\r\n        }\r\n    }\r\n  }\r\n\r\n  private getHLSVODOptions () {\r\n    return {\r\n      liveSyncDurationCount: 5\r\n    }\r\n  }\r\n}\r\n","export * from './manager-options-builder'\r\n","import videojs from 'video.js'\r\nimport { copyToClipboard } from '@root-helpers/utils'\r\nimport { isIOS, isSafari } from '@root-helpers/web-browser'\r\nimport { buildVideoLink, decorateVideoLink, pick } from '@shared/core-utils'\r\nimport { isDefaultLocale } from '@shared/core-utils/i18n'\r\nimport { VideoJSPluginOptions } from '../../types'\r\nimport { CommonOptions, PeertubePlayerManagerOptions, PlayerMode } from '../../types/manager-options'\r\nimport { ControlBarOptionsBuilder } from './control-bar-options-builder'\r\nimport { HLSOptionsBuilder } from './hls-options-builder'\r\nimport { WebTorrentOptionsBuilder } from './webtorrent-options-builder'\r\n\r\nexport class ManagerOptionsBuilder {\r\n\r\n  constructor (\r\n    private mode: PlayerMode,\r\n    private options: PeertubePlayerManagerOptions,\r\n    private p2pMediaLoaderModule?: any\r\n  ) {\r\n\r\n  }\r\n\r\n  getVideojsOptions (alreadyPlayed: boolean): videojs.PlayerOptions {\r\n    const commonOptions = this.options.common\r\n\r\n    let autoplay = this.getAutoPlayValue(commonOptions.autoplay, alreadyPlayed)\r\n    const html5 = {\r\n      preloadTextTracks: false\r\n    }\r\n\r\n    const plugins: VideoJSPluginOptions = {\r\n      peertube: {\r\n        mode: this.mode,\r\n        autoplay, // Use peertube plugin autoplay because we could get the file by webtorrent\r\n\r\n        ...pick(commonOptions, [\r\n          'videoViewUrl',\r\n          'authorizationHeader',\r\n          'startTime',\r\n          'videoDuration',\r\n          'subtitle',\r\n        //  'videoCaptions',\r\n          'stopTime',\r\n          'isLive',\r\n          'videoUUID',\r\n        ])\r\n      }\r\n    }\r\n\r\n    /*if (commonOptions.playlist) {\r\n      plugins.playlist = commonOptions.playlist\r\n    }*/\r\n\r\n    if (this.mode === 'p2p-media-loader') {\r\n      const hlsOptionsBuilder = new HLSOptionsBuilder(this.options, this.p2pMediaLoaderModule)\r\n      const options = hlsOptionsBuilder.getPluginOptions()\r\n\r\n      Object.assign(plugins, pick(options, [ 'hlsjs', 'p2pMediaLoader' ]))\r\n      Object.assign(html5, options.html5)\r\n    } else if (this.mode === 'webtorrent') {\r\n      const webtorrentOptionsBuilder = new WebTorrentOptionsBuilder(this.options, this.getAutoPlayValue(autoplay, alreadyPlayed))\r\n\r\n      Object.assign(plugins, webtorrentOptionsBuilder.getPluginOptions())\r\n\r\n      // WebTorrent plugin handles autoplay, because we do some hackish stuff in there\r\n      autoplay = false\r\n    }\r\n\r\n    const controlBarOptionsBuilder = new ControlBarOptionsBuilder(this.options, this.mode)\r\n\r\n    const videojsOptions = {\r\n      html5,\r\n\r\n      // We don't use text track settings for now\r\n      textTrackSettings: false as any, // FIXME: typings\r\n      controls: commonOptions.controls !== undefined ? commonOptions.controls : true,\r\n      loop: commonOptions.loop !== undefined ? commonOptions.loop : false,\r\n\r\n      muted: commonOptions.muted !== undefined\r\n        ? commonOptions.muted\r\n        : undefined, // Undefined so the player knows it has to check the local storage\r\n\r\n      autoplay: this.getAutoPlayValue(autoplay, alreadyPlayed),\r\n\r\n      poster: commonOptions.poster,\r\n      inactivityTimeout: commonOptions.inactivityTimeout,\r\n      playbackRates: [ 0.5, 0.75, 1, 1.25, 1.5, 1.75, 2 ],\r\n\r\n      plugins,\r\n\r\n      sources : commonOptions.sources,\r\n\r\n      controlBar: {\r\n        children: controlBarOptionsBuilder.getChildrenOptions() as any // FIXME: typings\r\n      }\r\n    }\r\n\r\n    if (commonOptions.language && !isDefaultLocale(commonOptions.language)) {\r\n      Object.assign(videojsOptions, { language: commonOptions.language })\r\n    }\r\n\r\n    return videojsOptions\r\n  }\r\n\r\n  private getAutoPlayValue (autoplay: any, alreadyPlayed: boolean) {\r\n    if (autoplay !== true) return autoplay\r\n\r\n    // On first play, disable autoplay to avoid issues\r\n    // But if the player already played videos, we can safely autoplay next ones\r\n    if (isIOS() || isSafari()) {\r\n      return alreadyPlayed ? 'play' : false\r\n    }\r\n\r\n    return 'play'\r\n  }\r\n\r\n  getContextMenuOptions (player: videojs.Player, commonOptions: CommonOptions) {\r\n    const content = () => {\r\n      const isLoopEnabled = player.options_['loop']\r\n\r\n      const items = [\r\n        {\r\n          icon: 'repeat',\r\n          label: player.localize('Play in loop') + (isLoopEnabled ? '<span class=\"vjs-icon-tick-white\"></span>' : ''),\r\n          listener: function () {\r\n            player.options_['loop'] = !isLoopEnabled\r\n          }\r\n        },\r\n        {\r\n          label: player.localize('Copy the video URL'),\r\n          listener: function () {\r\n            copyToClipboard(buildVideoLink({ shortUUID: commonOptions.videoShortUUID }))\r\n          }\r\n        },\r\n        {\r\n          label: player.localize('Copy the video URL at the current time'),\r\n          listener: function (this: videojs.Player) {\r\n            const url = buildVideoLink({ shortUUID: commonOptions.videoShortUUID })\r\n\r\n            copyToClipboard(decorateVideoLink({ url, startTime: this.currentTime() }))\r\n          }\r\n        },\r\n        /*{\r\n          icon: 'code',\r\n          label: player.localize('Copy embed code'),\r\n          listener: () => {\r\n            copyToClipboard(buildVideoOrPlaylistEmbed(commonOptions.embedUrl, commonOptions.embedTitle))\r\n          }\r\n        }*/\r\n      ]\r\n\r\n      if (this.mode === 'webtorrent') {\r\n        items.push({\r\n          label: player.localize('Copy magnet URI'),\r\n          listener: function (this: videojs.Player) {\r\n            copyToClipboard(this.webtorrent().getCurrentVideoFile().magnetUri)\r\n          }\r\n        })\r\n      }\r\n\r\n      items.push({\r\n        icon: 'info',\r\n        label: player.localize('Stats for nerds'),\r\n        listener: () => {\r\n          player.stats().show()\r\n        }\r\n      })\r\n\r\n      return items.map(i => ({\r\n        ...i,\r\n        label: `<span class=\"vjs-icon-${i.icon || 'link-2'}\"></span>` + i.label\r\n      }))\r\n    }\r\n\r\n    return { content }\r\n  }\r\n}\r\n","import { PeertubePlayerManagerOptions } from '../../types'\r\n\r\nexport class WebTorrentOptionsBuilder {\r\n\r\n  constructor (\r\n    private options: PeertubePlayerManagerOptions,\r\n    private autoPlayValue: any\r\n  ) {\r\n\r\n  }\r\n\r\n  getPluginOptions () {\r\n    const commonOptions = this.options.common\r\n    const webtorrentOptions = this.options.webtorrent\r\n    const p2pMediaLoaderOptions = this.options.p2pMediaLoader\r\n\r\n    const autoplay = this.autoPlayValue === 'play'\r\n\r\n    const webtorrent = {\r\n      autoplay,\r\n\r\n      playerRefusedP2P: commonOptions.p2pEnabled === false,\r\n      videoDuration: commonOptions.videoDuration,\r\n      playerElement: commonOptions.playerElement,\r\n\r\n      videoFiles: webtorrentOptions.videoFiles.length !== 0\r\n        ? webtorrentOptions.videoFiles\r\n        // The WebTorrent plugin won't be able to play these files, but it will fallback to HTTP mode\r\n        : p2pMediaLoaderOptions?.videoFiles || [],\r\n\r\n      startTime: commonOptions.startTime\r\n    }\r\n\r\n    return { webtorrent }\r\n  }\r\n}\r\n","import videojs from 'video.js'\r\n\r\nconst Component = videojs.getComponent('Component')\r\nclass PeerTubeMobileButtons extends Component {\r\n\r\n  private rewind: Element\r\n  private forward: Element\r\n  private rewindText: Element\r\n  private forwardText: Element\r\n\r\n  createEl () {\r\n    const container = super.createEl('div', {\r\n      className: 'vjs-mobile-buttons-overlay'\r\n    }) as HTMLDivElement\r\n\r\n    const mainButton = super.createEl('div', {\r\n      className: 'main-button'\r\n    }) as HTMLDivElement\r\n\r\n    mainButton.addEventListener('touchstart', e => {\r\n      e.stopPropagation()\r\n\r\n      if (this.player_.paused() || this.player_.ended()) {\r\n        this.player_.play()\r\n        return\r\n      }\r\n\r\n      this.player_.pause()\r\n    })\r\n\r\n    this.rewind = super.createEl('div', { className: 'rewind-button vjs-hidden' })\r\n    this.forward = super.createEl('div', { className: 'forward-button vjs-hidden' })\r\n\r\n    for (let i = 0; i < 3; i++) {\r\n      this.rewind.appendChild(super.createEl('span', { className: 'icon' }))\r\n      this.forward.appendChild(super.createEl('span', { className: 'icon' }))\r\n    }\r\n\r\n    this.rewindText = this.rewind.appendChild(super.createEl('div', { className: 'text' }))\r\n    this.forwardText = this.forward.appendChild(super.createEl('div', { className: 'text' }))\r\n\r\n    container.appendChild(this.rewind)\r\n    container.appendChild(mainButton)\r\n    container.appendChild(this.forward)\r\n\r\n    return container\r\n  }\r\n\r\n  displayFastSeek (amount: number) {\r\n    if (amount === 0) {\r\n      this.hideRewind()\r\n      this.hideForward()\r\n      return\r\n    }\r\n\r\n    if (amount > 0) {\r\n      this.hideRewind()\r\n      this.displayForward(amount)\r\n      return\r\n    }\r\n\r\n    if (amount < 0) {\r\n      this.hideForward()\r\n      this.displayRewind(amount)\r\n      return\r\n    }\r\n  }\r\n\r\n  private hideRewind () {\r\n    this.rewind.classList.add('vjs-hidden')\r\n    this.rewindText.textContent = ''\r\n  }\r\n\r\n  private displayRewind (amount: number) {\r\n    this.rewind.classList.remove('vjs-hidden')\r\n    this.rewindText.textContent = this.player().localize('{1} seconds', [ amount + '' ])\r\n  }\r\n\r\n  private hideForward () {\r\n    this.forward.classList.add('vjs-hidden')\r\n    this.forwardText.textContent = ''\r\n  }\r\n\r\n  private displayForward (amount: number) {\r\n    this.forward.classList.remove('vjs-hidden')\r\n    this.forwardText.textContent = this.player().localize('{1} seconds', [ amount + '' ])\r\n  }\r\n}\r\n\r\nvideojs.registerComponent('PeerTubeMobileButtons', PeerTubeMobileButtons)\r\n\r\nexport {\r\n  PeerTubeMobileButtons\r\n}\r\n","import debug from 'debug'\r\nimport videojs from 'video.js'\r\nimport { logger } from '@root-helpers/logger'\r\nimport { PeerTubeMobileButtons } from './peertube-mobile-buttons'\r\n\r\nconst debugLogger = debug('peertube:player:mobile')\r\n\r\nconst Plugin = videojs.getPlugin('plugin')\r\n\r\nclass PeerTubeMobilePlugin extends Plugin {\r\n  private static readonly DOUBLE_TAP_DELAY_MS = 250\r\n  private static readonly SET_CURRENT_TIME_DELAY = 1000\r\n\r\n  private peerTubeMobileButtons: PeerTubeMobileButtons\r\n\r\n  private seekAmount = 0\r\n\r\n  private lastTapEvent: TouchEvent\r\n  private tapTimeout: ReturnType<typeof setTimeout>\r\n  private newActiveState: boolean\r\n\r\n  private setCurrentTimeTimeout: ReturnType<typeof setTimeout>\r\n\r\n  constructor (player: videojs.Player, options: videojs.PlayerOptions) {\r\n    super(player, options)\r\n\r\n    this.peerTubeMobileButtons = player.addChild('PeerTubeMobileButtons', { reportTouchActivity: false }) as PeerTubeMobileButtons\r\n\r\n    if (videojs.browser.IS_ANDROID && screen.orientation) {\r\n      this.handleFullscreenRotation()\r\n    }\r\n\r\n    if (!this.player.options_.userActions) this.player.options_.userActions = {};\r\n\r\n    // FIXME: typings\r\n    (this.player.options_.userActions as any).click = false\r\n    this.player.options_.userActions.doubleClick = false\r\n\r\n    this.player.one('play', () => {\r\n      this.initTouchStartEvents()\r\n    })\r\n  }\r\n\r\n  private handleFullscreenRotation () {\r\n    this.player.on('fullscreenchange', () => {\r\n      if (!this.player.isFullscreen() || this.isPortraitVideo()) return\r\n\r\n      screen.orientation.lock('landscape')\r\n        .catch(err => logger.error('Cannot lock screen to landscape.', err))\r\n    })\r\n  }\r\n\r\n  private isPortraitVideo () {\r\n    return this.player.videoWidth() < this.player.videoHeight()\r\n  }\r\n\r\n  private initTouchStartEvents () {\r\n    const handleTouchStart = (event: TouchEvent) => {\r\n      if (this.tapTimeout) {\r\n        clearTimeout(this.tapTimeout)\r\n        this.tapTimeout = undefined\r\n      }\r\n\r\n      if (this.lastTapEvent && event.timeStamp - this.lastTapEvent.timeStamp < PeerTubeMobilePlugin.DOUBLE_TAP_DELAY_MS) {\r\n        debugLogger('Detected double tap')\r\n\r\n        this.lastTapEvent = undefined\r\n        this.onDoubleTap(event)\r\n        return\r\n      }\r\n\r\n      this.newActiveState = !this.player.userActive()\r\n\r\n      this.tapTimeout = setTimeout(() => {\r\n        debugLogger('No double tap detected, set user active state to %s.', this.newActiveState)\r\n\r\n        this.player.userActive(this.newActiveState)\r\n      }, PeerTubeMobilePlugin.DOUBLE_TAP_DELAY_MS)\r\n\r\n      this.lastTapEvent = event\r\n    }\r\n\r\n    this.player.on('touchstart', (event: TouchEvent) => {\r\n      // Only enable user active on player touch, we listen event on peertube mobile buttons to disable it\r\n      if (this.player.userActive()) return\r\n\r\n      handleTouchStart(event)\r\n    })\r\n\r\n    this.peerTubeMobileButtons.el().addEventListener('touchstart', (event: TouchEvent) => {\r\n      // Prevent mousemove/click events firing on the player, that conflict with our user active logic\r\n      event.preventDefault()\r\n\r\n      handleTouchStart(event)\r\n    }, { passive: false })\r\n  }\r\n\r\n  private onDoubleTap (event: TouchEvent) {\r\n    const playerWidth = this.player.currentWidth()\r\n\r\n    const rect = this.findPlayerTarget((event.target as HTMLElement)).getBoundingClientRect()\r\n    const offsetX = event.targetTouches[0].pageX - rect.left\r\n\r\n    debugLogger('Calculating double tap zone (player width: %d, offset X: %d)', playerWidth, offsetX)\r\n\r\n    if (offsetX > 0.66 * playerWidth) {\r\n      if (this.seekAmount < 0) this.seekAmount = 0\r\n\r\n      this.seekAmount += 10\r\n\r\n      debugLogger('Will forward %d seconds', this.seekAmount)\r\n    } else if (offsetX < 0.33 * playerWidth) {\r\n      if (this.seekAmount > 0) this.seekAmount = 0\r\n\r\n      this.seekAmount -= 10\r\n      debugLogger('Will rewind %d seconds', this.seekAmount)\r\n    }\r\n\r\n    this.peerTubeMobileButtons.displayFastSeek(this.seekAmount)\r\n\r\n    this.scheduleSetCurrentTime()\r\n  }\r\n\r\n  private findPlayerTarget (target: HTMLElement): HTMLElement {\r\n    if (target.classList.contains('video-js')) return target\r\n\r\n    return this.findPlayerTarget(target.parentElement)\r\n  }\r\n\r\n  private scheduleSetCurrentTime () {\r\n    this.player.pause()\r\n    this.player.addClass('vjs-fast-seeking')\r\n\r\n    if (this.setCurrentTimeTimeout) clearTimeout(this.setCurrentTimeTimeout)\r\n\r\n    this.setCurrentTimeTimeout = setTimeout(() => {\r\n      let newTime = this.player.currentTime() + this.seekAmount\r\n      this.seekAmount = 0\r\n\r\n      newTime = Math.max(0, newTime)\r\n      newTime = Math.min(this.player.duration(), newTime)\r\n\r\n      this.player.currentTime(newTime)\r\n      this.seekAmount = 0\r\n      this.peerTubeMobileButtons.displayFastSeek(0)\r\n\r\n      this.player.removeClass('vjs-fast-seeking')\r\n      this.player.userActive(false)\r\n\r\n      this.player.play()\r\n    }, PeerTubeMobilePlugin.SET_CURRENT_TIME_DELAY)\r\n  }\r\n}\r\n\r\nvideojs.registerPlugin('peertubeMobile', PeerTubeMobilePlugin)\r\nexport { PeerTubeMobilePlugin }\r\n","import { basename, dirname } from 'path'\r\nimport { logger } from '@root-helpers/logger'\r\n\r\nclass RedundancyUrlManager {\r\n\r\n  constructor (private baseUrls: string[] = []) {\r\n    // empty\r\n  }\r\n\r\n  removeBySegmentUrl (segmentUrl: string) {\r\n    logger.info(`Removing redundancy of segment URL ${segmentUrl}.`)\r\n\r\n    const baseUrl = dirname(segmentUrl)\r\n\r\n    this.baseUrls = this.baseUrls.filter(u => u !== baseUrl && u !== baseUrl + '/')\r\n  }\r\n\r\n  buildUrl (url: string) {\r\n    const max = this.baseUrls.length + 1\r\n    const i = this.getRandomInt(max)\r\n\r\n    if (i === max - 1) return url\r\n\r\n    const newBaseUrl = this.baseUrls[i]\r\n    const slashPart = newBaseUrl.endsWith('/') ? '' : '/'\r\n\r\n    return newBaseUrl + slashPart + basename(url)\r\n  }\r\n\r\n  countBaseUrls () {\r\n    return this.baseUrls.length\r\n  }\r\n\r\n  private getRandomInt (max: number) {\r\n    return Math.floor(Math.random() * Math.floor(max))\r\n  }\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n\r\nexport {\r\n  RedundancyUrlManager\r\n}\r\n","import { Segment } from '@peertube/p2p-media-loader-core'\r\nimport { RedundancyUrlManager } from './redundancy-url-manager'\r\n\r\nfunction segmentUrlBuilderFactory (redundancyUrlManager: RedundancyUrlManager) {\r\n  return function segmentBuilder (segment: Segment) {\r\n    return redundancyUrlManager.buildUrl(segment.url)\r\n  }\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n\r\nexport {\r\n  segmentUrlBuilderFactory\r\n}\r\n","import { basename } from 'path'\r\nimport { Segment } from '@peertube/p2p-media-loader-core'\r\nimport { logger } from '@root-helpers/logger'\r\nimport { wait } from '@root-helpers/utils'\r\n\r\ntype SegmentsJSON = { [filename: string]: string | { [byterange: string]: string } }\r\n\r\nconst maxRetries = 3\r\n\r\nfunction segmentValidatorFactory (segmentsSha256Url: string, isLive: boolean) {\r\n  let segmentsJSON = fetchSha256Segments(segmentsSha256Url)\r\n  const regex = /bytes=(\\d+)-(\\d+)/\r\n\r\n  return async function segmentValidator (segment: Segment, _method: string, _peerId: string, retry = 1) {\r\n    // Wait for hash generation from the server\r\n    if (isLive) await wait(1000)\r\n\r\n    const filename = basename(segment.url)\r\n\r\n    const segmentValue = (await segmentsJSON)[filename]\r\n\r\n    if (!segmentValue && retry > maxRetries) {\r\n      throw new Error(`Unknown segment name ${filename} in segment validator`)\r\n    }\r\n\r\n    if (!segmentValue) {\r\n      logger.info(`Refetching sha segments for ${filename}`)\r\n\r\n      await wait(1000)\r\n\r\n      segmentsJSON = fetchSha256Segments(segmentsSha256Url)\r\n      await segmentValidator(segment, _method, _peerId, retry + 1)\r\n\r\n      return\r\n    }\r\n\r\n    let hashShouldBe: string\r\n    let range = ''\r\n\r\n    if (typeof segmentValue === 'string') {\r\n      hashShouldBe = segmentValue\r\n    } else {\r\n      const captured = regex.exec(segment.range)\r\n      range = captured[1] + '-' + captured[2]\r\n\r\n      hashShouldBe = segmentValue[range]\r\n    }\r\n\r\n    if (hashShouldBe === undefined) {\r\n      throw new Error(`Unknown segment name ${filename}/${range} in segment validator`)\r\n    }\r\n\r\n    const calculatedSha = await sha256Hex(segment.data)\r\n    if (calculatedSha !== hashShouldBe) {\r\n      throw new Error(\r\n        `Hashes does not correspond for segment ${filename}/${range}` +\r\n        `(expected: ${hashShouldBe} instead of ${calculatedSha})`\r\n      )\r\n    }\r\n  }\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n\r\nexport {\r\n  segmentValidatorFactory\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n\r\nfunction fetchSha256Segments (url: string) {\r\n  return fetch(url)\r\n    .then(res => res.json() as Promise<SegmentsJSON>)\r\n    .catch(err => {\r\n      logger.error('Cannot get sha256 segments', err)\r\n      return {}\r\n    })\r\n}\r\n\r\nasync function sha256Hex (data?: ArrayBuffer) {\r\n  if (!data) return undefined\r\n\r\n  if (window.crypto.subtle) {\r\n    return window.crypto.subtle.digest('SHA-256', data)\r\n      .then(data => bufferToHex(data))\r\n  }\r\n\r\n  // Fallback for non HTTPS context\r\n  const shaModule = (await import('sha.js') as any).default\r\n  // eslint-disable-next-line new-cap\r\n  return new shaModule.sha256().update(Buffer.from(data)).digest('hex')\r\n}\r\n\r\n// Thanks: https://stackoverflow.com/a/53307879\r\nfunction bufferToHex (buffer?: ArrayBuffer) {\r\n  if (!buffer) return ''\r\n\r\n  let s = ''\r\n  const h = '0123456789abcdef'\r\n  const o = new Uint8Array(buffer)\r\n\r\n  o.forEach((v: any) => {\r\n    s += h[v >> 4] + h[v & 15]\r\n  })\r\n\r\n  return s\r\n}\r\n","import debug from 'debug'\r\nimport videojs from 'video.js'\r\nimport { logger } from '@root-helpers/logger'\r\nimport { isMobile } from '@root-helpers/web-browser'\r\nimport { timeToInt } from '@shared/core-utils'\r\nimport { VideoView, VideoViewEvent } from '@shared/models/videos'\r\nimport {\r\n  getStoredLastSubtitle,\r\n  getStoredMute,\r\n  getStoredVolume,\r\n  saveLastSubtitle,\r\n  saveMuteInStore,\r\n  saveVideoWatchHistory,\r\n  saveVolumeInStore\r\n} from '../../peertube-player-local-storage'\r\nimport { PeerTubePluginOptions, VideoJSCaption } from '../../types'\r\nimport { SettingsButton } from '../settings/settings-menu-button'\r\n\r\nconst debugLogger = debug('peertube:player:peertube')\r\n\r\nconst Plugin = videojs.getPlugin('plugin')\r\n\r\nclass PeerTubePlugin extends Plugin {\r\n  private readonly videoViewUrl: string\r\n  private readonly authorizationHeader: string\r\n\r\n  private readonly videoUUID: string\r\n  private readonly startTime: number\r\n\r\n  private readonly CONSTANTS = {\r\n    USER_VIEW_VIDEO_INTERVAL: 5000 // Every 5 seconds, notify the user is watching the video\r\n  }\r\n\r\n  //private videoCaptions: VideoJSCaption[]\r\n  private defaultSubtitle: string\r\n\r\n  private videoViewInterval: any\r\n\r\n  private menuOpened = false\r\n  private mouseInControlBar = false\r\n  private mouseInSettings = false\r\n  private readonly initialInactivityTimeout: number\r\n\r\n  constructor (player: videojs.Player, options?: PeerTubePluginOptions) {\r\n    super(player)\r\n\r\n    this.videoViewUrl = options.videoViewUrl\r\n    this.authorizationHeader = options.authorizationHeader\r\n    this.videoUUID = options.videoUUID\r\n    this.startTime = timeToInt(options.startTime)\r\n\r\n    //this.videoCaptions = options.videoCaptions\r\n    this.initialInactivityTimeout = this.player.options_.inactivityTimeout\r\n\r\n    if (options.autoplay) this.player.addClass('vjs-has-autoplay')\r\n\r\n    this.player.on('autoplay-failure', () => {\r\n      this.player.removeClass('vjs-has-autoplay')\r\n    })\r\n\r\n    this.player.ready(() => {\r\n      const playerOptions = this.player.options_\r\n\r\n      const volume = getStoredVolume()\r\n      if (volume !== undefined) this.player.volume(volume)\r\n\r\n      const muted = playerOptions.muted !== undefined ? playerOptions.muted : getStoredMute()\r\n      if (muted !== undefined) this.player.muted(muted)\r\n\r\n      this.defaultSubtitle = options.subtitle || getStoredLastSubtitle()\r\n\r\n      this.player.on('volumechange', () => {\r\n        saveVolumeInStore(this.player.volume())\r\n        saveMuteInStore(this.player.muted())\r\n      })\r\n\r\n      if (options.stopTime) {\r\n        const stopTime = timeToInt(options.stopTime)\r\n        const self = this\r\n\r\n        this.player.on('timeupdate', function onTimeUpdate () {\r\n          if (self.player.currentTime() > stopTime) {\r\n            self.player.pause()\r\n            self.player.trigger('stopped')\r\n\r\n            self.player.off('timeupdate', onTimeUpdate)\r\n          }\r\n        })\r\n      }\r\n\r\n      this.player.textTracks().addEventListener('change', () => {\r\n        const showing = this.player.textTracks().tracks_.find(t => {\r\n          return t.kind === 'captions' && t.mode === 'showing'\r\n        })\r\n\r\n        if (!showing) {\r\n          saveLastSubtitle('off')\r\n          return\r\n        }\r\n\r\n        saveLastSubtitle(showing.language)\r\n      })\r\n\r\n      //this.player.on('sourcechange', () => this.initCaptions())\r\n\r\n      this.player.duration(options.videoDuration)\r\n\r\n      this.initializePlayer()\r\n      this.runUserViewing()\r\n    })\r\n  }\r\n\r\n  dispose () {\r\n    if (this.videoViewInterval) clearInterval(this.videoViewInterval)\r\n  }\r\n\r\n  onMenuOpened () {\r\n    this.menuOpened = true\r\n    this.alterInactivity()\r\n  }\r\n\r\n  onMenuClosed () {\r\n    this.menuOpened = false\r\n    this.alterInactivity()\r\n  }\r\n\r\n  displayFatalError () {\r\n    this.player.addClass('vjs-error-display-enabled')\r\n  }\r\n\r\n  hideFatalError () {\r\n    this.player.removeClass('vjs-error-display-enabled')\r\n  }\r\n\r\n  private initializePlayer () {\r\n    if (isMobile()) this.player.addClass('vjs-is-mobile')\r\n\r\n    this.initSmoothProgressBar()\r\n\r\n    //this.initCaptions()\r\n\r\n    this.listenControlBarMouse()\r\n\r\n    this.listenFullScreenChange()\r\n  }\r\n\r\n  private runUserViewing () {\r\n    let lastCurrentTime = this.startTime\r\n    let lastViewEvent: VideoViewEvent\r\n\r\n    this.player.one('play', () => {\r\n      this.notifyUserIsWatching(this.startTime, lastViewEvent)\r\n    })\r\n\r\n    this.player.on('seeked', () => {\r\n      // Don't take into account small seek events\r\n      if (Math.abs(this.player.currentTime() - lastCurrentTime) < 3) return\r\n\r\n      lastViewEvent = 'seek'\r\n    })\r\n\r\n    this.player.one('ended', () => {\r\n      const currentTime = Math.round(this.player.duration())\r\n      lastCurrentTime = currentTime\r\n\r\n      this.notifyUserIsWatching(currentTime, lastViewEvent)\r\n\r\n      lastViewEvent = undefined\r\n    })\r\n\r\n    this.videoViewInterval = setInterval(() => {\r\n      const currentTime = Math.round(this.player.currentTime())\r\n\r\n      // No need to update\r\n      if (currentTime === lastCurrentTime) return\r\n\r\n      lastCurrentTime = currentTime\r\n\r\n      this.notifyUserIsWatching(currentTime, lastViewEvent)\r\n        .catch(err => logger.error('Cannot notify user is watching.', err))\r\n\r\n      lastViewEvent = undefined\r\n\r\n      // Server won't save history, so save the video position in local storage\r\n      if (!this.authorizationHeader) {\r\n        saveVideoWatchHistory(this.videoUUID, currentTime)\r\n      }\r\n    }, this.CONSTANTS.USER_VIEW_VIDEO_INTERVAL)\r\n  }\r\n\r\n  private notifyUserIsWatching (currentTime: number, viewEvent: VideoViewEvent) {\r\n    if (!this.videoViewUrl) return Promise.resolve(undefined)\r\n\r\n    const body: VideoView = {\r\n      currentTime,\r\n      viewEvent\r\n    }\r\n\r\n    const headers = new Headers({\r\n      'Content-type': 'application/json; charset=UTF-8'\r\n    })\r\n\r\n    if (this.authorizationHeader) headers.set('Authorization', this.authorizationHeader)\r\n\r\n    return fetch(this.videoViewUrl, { method: 'POST', body: JSON.stringify(body), headers })\r\n  }\r\n\r\n  private listenFullScreenChange () {\r\n    this.player.on('fullscreenchange', () => {\r\n      if (this.player.isFullscreen()) this.player.focus()\r\n    })\r\n  }\r\n\r\n  private listenControlBarMouse () {\r\n    const controlBar = this.player.controlBar\r\n    const settingsButton: SettingsButton = (controlBar as any).settingsButton\r\n\r\n    controlBar.on('mouseenter', () => {\r\n      this.mouseInControlBar = true\r\n      this.alterInactivity()\r\n    })\r\n\r\n    controlBar.on('mouseleave', () => {\r\n      this.mouseInControlBar = false\r\n      this.alterInactivity()\r\n    })\r\n\r\n    settingsButton.dialog.on('mouseenter', () => {\r\n      this.mouseInSettings = true\r\n      this.alterInactivity()\r\n    })\r\n\r\n    settingsButton.dialog.on('mouseleave', () => {\r\n      this.mouseInSettings = false\r\n      this.alterInactivity()\r\n    })\r\n  }\r\n\r\n  private alterInactivity () {\r\n    if (this.menuOpened || this.mouseInSettings || this.mouseInControlBar) {\r\n      this.setInactivityTimeout(0)\r\n      return\r\n    }\r\n\r\n    this.setInactivityTimeout(this.initialInactivityTimeout)\r\n    this.player.reportUserActivity(true)\r\n  }\r\n\r\n  private setInactivityTimeout (timeout: number) {\r\n    (this.player as any).cache_.inactivityTimeout = timeout\r\n    this.player.options_.inactivityTimeout = timeout\r\n\r\n    debugLogger('Set player inactivity to ' + timeout)\r\n  }\r\n\r\n  /*private initCaptions () {\r\n    for (const caption of this.videoCaptions) {\r\n      this.player.addRemoteTextTrack({\r\n        kind: 'captions',\r\n        label: caption.label,\r\n        language: caption.language,\r\n        id: caption.language,\r\n        src: caption.src,\r\n        default: this.defaultSubtitle === caption.language\r\n      }, false)\r\n    }\r\n\r\n    this.player.trigger('captionsChanged')\r\n  }*/\r\n\r\n  // Thanks: https://github.com/videojs/video.js/issues/4460#issuecomment-312861657\r\n  private initSmoothProgressBar () {\r\n    const SeekBar = videojs.getComponent('SeekBar') as any\r\n    SeekBar.prototype.getPercent = function getPercent () {\r\n      // Allows for smooth scrubbing, when player can't keep up.\r\n      // const time = (this.player_.scrubbing()) ?\r\n      //   this.player_.getCache().currentTime :\r\n      //   this.player_.currentTime()\r\n      const time = this.player_.currentTime()\r\n      const percent = time / this.player_.duration()\r\n      return percent >= 1 ? 1 : percent\r\n    }\r\n    SeekBar.prototype.handleMouseMove = function handleMouseMove (event: any) {\r\n      let newTime = this.calculateDistance(event) * this.player_.duration()\r\n      if (newTime === this.player_.duration()) {\r\n        newTime = newTime - 0.1\r\n      }\r\n      this.player_.currentTime(newTime)\r\n      this.update()\r\n    }\r\n  }\r\n}\r\n\r\nvideojs.registerPlugin('peertube', PeerTubePlugin)\r\nexport { PeerTubePlugin }\r\n","import videojs from 'video.js'\r\nimport { PlaylistPluginOptions } from '../../types'\r\nimport { PlaylistMenu } from './playlist-menu'\r\n\r\nconst ClickableComponent = videojs.getComponent('ClickableComponent')\r\n\r\nclass PlaylistButton extends ClickableComponent {\r\n  private playlistInfoElement: HTMLElement\r\n  private wrapper: HTMLElement\r\n\r\n  constructor (player: videojs.Player, options?: PlaylistPluginOptions & { playlistMenu: PlaylistMenu }) {\r\n    super(player, options as any)\r\n  }\r\n\r\n  createEl () {\r\n    this.wrapper = super.createEl('div', {\r\n      className: 'vjs-playlist-button',\r\n      innerHTML: '',\r\n      tabIndex: -1\r\n    }) as HTMLElement\r\n\r\n    const icon = super.createEl('div', {\r\n      className: 'vjs-playlist-icon',\r\n      innerHTML: '',\r\n      tabIndex: -1\r\n    })\r\n\r\n    this.playlistInfoElement = super.createEl('div', {\r\n      className: 'vjs-playlist-info',\r\n      innerHTML: '',\r\n      tabIndex: -1\r\n    }) as HTMLElement\r\n\r\n    this.wrapper.appendChild(icon)\r\n    this.wrapper.appendChild(this.playlistInfoElement)\r\n\r\n    this.update()\r\n\r\n    return this.wrapper\r\n  }\r\n\r\n  update () {\r\n    const options = this.options_ as PlaylistPluginOptions\r\n\r\n    this.playlistInfoElement.innerHTML = options.getCurrentPosition() + '/' + options.playlist.videosLength\r\n    this.wrapper.title = this.player().localize('Playlist: {1}', [ options.playlist.displayName ])\r\n  }\r\n\r\n  handleClick () {\r\n    const playlistMenu = this.getPlaylistMenu()\r\n    playlistMenu.open()\r\n  }\r\n\r\n  private getPlaylistMenu () {\r\n    return (this.options_ as any).playlistMenu as PlaylistMenu\r\n  }\r\n}\r\n\r\nvideojs.registerComponent('PlaylistButton', PlaylistButton)\r\n\r\nexport { PlaylistButton }\r\n","import videojs from 'video.js'\r\nimport { secondsToTime } from '@shared/core-utils'\r\nimport { VideoPlaylistElement } from '@shared/models'\r\nimport { PlaylistItemOptions } from '../../types'\r\n\r\nconst Component = videojs.getComponent('Component')\r\n\r\nclass PlaylistMenuItem extends Component {\r\n  private element: VideoPlaylistElement\r\n\r\n  constructor (player: videojs.Player, options?: PlaylistItemOptions) {\r\n    super(player, options as any)\r\n\r\n    this.emitTapEvents()\r\n\r\n    this.element = options.element\r\n\r\n    this.on([ 'click', 'tap' ], () => this.switchPlaylistItem())\r\n    this.on('keydown', event => this.handleKeyDown(event))\r\n  }\r\n\r\n  createEl () {\r\n    const options = this.options_ as PlaylistItemOptions\r\n\r\n    const li = super.createEl('li', {\r\n      className: 'vjs-playlist-menu-item',\r\n      innerHTML: ''\r\n    }) as HTMLElement\r\n\r\n    if (!options.element.video) {\r\n      li.classList.add('vjs-disabled')\r\n    }\r\n\r\n    const positionBlock = super.createEl('div', {\r\n      className: 'item-position-block'\r\n    }) as HTMLElement\r\n\r\n    const position = super.createEl('div', {\r\n      className: 'item-position',\r\n      innerHTML: options.element.position\r\n    })\r\n\r\n    positionBlock.appendChild(position)\r\n    li.appendChild(positionBlock)\r\n\r\n    if (options.element.video) {\r\n      this.buildAvailableVideo(li, positionBlock, options)\r\n    } else {\r\n      this.buildUnavailableVideo(li)\r\n    }\r\n\r\n    return li\r\n  }\r\n\r\n  setSelected (selected: boolean) {\r\n    if (selected) this.addClass('vjs-selected')\r\n    else this.removeClass('vjs-selected')\r\n  }\r\n\r\n  getElement () {\r\n    return this.element\r\n  }\r\n\r\n  private buildAvailableVideo (li: HTMLElement, positionBlock: HTMLElement, options: PlaylistItemOptions) {\r\n    const videoElement = options.element\r\n\r\n    const player = super.createEl('div', {\r\n      className: 'item-player'\r\n    })\r\n\r\n    positionBlock.appendChild(player)\r\n\r\n    const thumbnail = super.createEl('img', {\r\n      src: window.location.origin + videoElement.video.thumbnailPath\r\n    })\r\n\r\n    const infoBlock = super.createEl('div', {\r\n      className: 'info-block'\r\n    })\r\n\r\n    const title = super.createEl('div', {\r\n      innerHTML: videoElement.video.name,\r\n      className: 'title'\r\n    })\r\n\r\n    const channel = super.createEl('div', {\r\n      innerHTML: videoElement.video.channel.displayName,\r\n      className: 'channel'\r\n    })\r\n\r\n    infoBlock.appendChild(title)\r\n    infoBlock.appendChild(channel)\r\n\r\n    if (videoElement.startTimestamp || videoElement.stopTimestamp) {\r\n      let html = ''\r\n\r\n      if (videoElement.startTimestamp) html += secondsToTime(videoElement.startTimestamp)\r\n      if (videoElement.stopTimestamp) html += ' - ' + secondsToTime(videoElement.stopTimestamp)\r\n\r\n      const timestamps = super.createEl('div', {\r\n        innerHTML: html,\r\n        className: 'timestamps'\r\n      })\r\n\r\n      infoBlock.append(timestamps)\r\n    }\r\n\r\n    li.append(thumbnail)\r\n    li.append(infoBlock)\r\n  }\r\n\r\n  private buildUnavailableVideo (li: HTMLElement) {\r\n    const block = super.createEl('div', {\r\n      className: 'item-unavailable',\r\n      innerHTML: this.player().localize('Unavailable video')\r\n    })\r\n\r\n    li.appendChild(block)\r\n  }\r\n\r\n  private handleKeyDown (event: KeyboardEvent) {\r\n    if (event.code === 'Space' || event.code === 'Enter') {\r\n      this.switchPlaylistItem()\r\n    }\r\n  }\r\n\r\n  private switchPlaylistItem () {\r\n    const options = this.options_ as PlaylistItemOptions\r\n\r\n    options.onClicked()\r\n  }\r\n}\r\n\r\nComponent.registerComponent('PlaylistMenuItem', PlaylistMenuItem)\r\n\r\nexport { PlaylistMenuItem }\r\n","import videojs from 'video.js'\r\nimport { VideoPlaylistElement } from '@shared/models'\r\nimport { PlaylistPluginOptions } from '../../types'\r\nimport { PlaylistMenuItem } from './playlist-menu-item'\r\n\r\nconst Component = videojs.getComponent('Component')\r\n\r\nclass PlaylistMenu extends Component {\r\n  private menuItems: PlaylistMenuItem[]\r\n\r\n  constructor (player: videojs.Player, options?: PlaylistPluginOptions) {\r\n    super(player, options as any)\r\n\r\n    const self = this\r\n\r\n    function userInactiveHandler () {\r\n      self.close()\r\n    }\r\n\r\n    this.el().addEventListener('mouseenter', () => {\r\n      this.player().off('userinactive', userInactiveHandler)\r\n    })\r\n\r\n    this.el().addEventListener('mouseleave', () => {\r\n      this.player().one('userinactive', userInactiveHandler)\r\n    })\r\n\r\n    this.player().on('click', event => {\r\n      let current = event.target as HTMLElement\r\n\r\n      do {\r\n        if (\r\n          current.classList.contains('vjs-playlist-menu') ||\r\n          current.classList.contains('vjs-playlist-button')\r\n        ) {\r\n          return\r\n        }\r\n\r\n        current = current.parentElement\r\n      } while (current)\r\n\r\n      this.close()\r\n    })\r\n  }\r\n\r\n  createEl () {\r\n    this.menuItems = []\r\n\r\n    const options = this.getOptions()\r\n\r\n    const menu = super.createEl('div', {\r\n      className: 'vjs-playlist-menu',\r\n      innerHTML: '',\r\n      tabIndex: -1\r\n    })\r\n\r\n    const header = super.createEl('div', {\r\n      className: 'header'\r\n    })\r\n\r\n    const headerLeft = super.createEl('div')\r\n\r\n    const leftTitle = super.createEl('div', {\r\n      innerHTML: options.playlist.displayName,\r\n      className: 'title'\r\n    })\r\n\r\n    const playlistChannel = options.playlist.videoChannel\r\n    const leftSubtitle = super.createEl('div', {\r\n      innerHTML: playlistChannel\r\n        ? this.player().localize('By {1}', [ playlistChannel.displayName ])\r\n        : '',\r\n      className: 'channel'\r\n    })\r\n\r\n    headerLeft.appendChild(leftTitle)\r\n    headerLeft.appendChild(leftSubtitle)\r\n\r\n    const tick = super.createEl('div', {\r\n      className: 'cross'\r\n    })\r\n    tick.addEventListener('click', () => this.close())\r\n\r\n    header.appendChild(headerLeft)\r\n    header.appendChild(tick)\r\n\r\n    const list = super.createEl('ol')\r\n\r\n    for (const playlistElement of options.elements) {\r\n      const item = new PlaylistMenuItem(this.player(), {\r\n        element: playlistElement,\r\n        onClicked: () => this.onItemClicked(playlistElement)\r\n      })\r\n\r\n      list.appendChild(item.el())\r\n\r\n      this.menuItems.push(item)\r\n    }\r\n\r\n    menu.appendChild(header)\r\n    menu.appendChild(list)\r\n\r\n    return menu\r\n  }\r\n\r\n  update () {\r\n    const options = this.getOptions()\r\n\r\n    this.updateSelected(options.getCurrentPosition())\r\n  }\r\n\r\n  open () {\r\n    this.player().addClass('playlist-menu-displayed')\r\n  }\r\n\r\n  close () {\r\n    this.player().removeClass('playlist-menu-displayed')\r\n  }\r\n\r\n  updateSelected (newPosition: number) {\r\n    for (const item of this.menuItems) {\r\n      item.setSelected(item.getElement().position === newPosition)\r\n    }\r\n  }\r\n\r\n  private getOptions () {\r\n    return this.options_ as PlaylistPluginOptions\r\n  }\r\n\r\n  private onItemClicked (element: VideoPlaylistElement) {\r\n    this.getOptions().onItemClicked(element)\r\n  }\r\n}\r\n\r\nComponent.registerComponent('PlaylistMenu', PlaylistMenu)\r\n\r\nexport { PlaylistMenu }\r\n","import videojs from 'video.js'\r\nimport { PlaylistPluginOptions } from '../../types'\r\nimport { PlaylistButton } from './playlist-button'\r\nimport { PlaylistMenu } from './playlist-menu'\r\n\r\nconst Plugin = videojs.getPlugin('plugin')\r\n\r\nclass PlaylistPlugin extends Plugin {\r\n  private playlistMenu: PlaylistMenu\r\n  private playlistButton: PlaylistButton\r\n  private options: PlaylistPluginOptions\r\n\r\n  constructor (player: videojs.Player, options?: PlaylistPluginOptions) {\r\n    super(player, options)\r\n\r\n    this.options = options\r\n\r\n    this.player.ready(() => {\r\n      player.addClass('vjs-playlist')\r\n    })\r\n\r\n    this.playlistMenu = new PlaylistMenu(player, options)\r\n    this.playlistButton = new PlaylistButton(player, { ...options, playlistMenu: this.playlistMenu })\r\n\r\n    player.addChild(this.playlistMenu, options)\r\n    player.addChild(this.playlistButton, options)\r\n  }\r\n\r\n  updateSelected () {\r\n    this.playlistMenu.updateSelected(this.options.getCurrentPosition())\r\n  }\r\n}\r\n\r\nvideojs.registerPlugin('playlist', PlaylistPlugin)\r\nexport { PlaylistPlugin }\r\n","import videojs from 'video.js'\r\nimport { PeerTubeResolution } from '../../types'\r\n\r\nconst Plugin = videojs.getPlugin('plugin')\r\n\r\nclass PeerTubeResolutionsPlugin extends Plugin {\r\n  private currentSelection: PeerTubeResolution\r\n  private resolutions: PeerTubeResolution[] = []\r\n\r\n  private autoResolutionChosenId: number\r\n  private autoResolutionEnabled = true\r\n\r\n  add (resolutions: PeerTubeResolution[]) {\r\n    for (const r of resolutions) {\r\n      this.resolutions.push(r)\r\n    }\r\n\r\n    this.currentSelection = this.getSelected()\r\n\r\n    this.sort()\r\n    this.trigger('resolutionsAdded')\r\n  }\r\n\r\n  getResolutions () {\r\n    return this.resolutions\r\n  }\r\n\r\n  getSelected () {\r\n    return this.resolutions.find(r => r.selected)\r\n  }\r\n\r\n  getAutoResolutionChosen () {\r\n    return this.resolutions.find(r => r.id === this.autoResolutionChosenId)\r\n  }\r\n\r\n  select (options: {\r\n    id: number\r\n    byEngine: boolean\r\n    autoResolutionChosenId?: number\r\n  }) {\r\n    const { id, autoResolutionChosenId, byEngine } = options\r\n\r\n    if (this.currentSelection?.id === id && this.autoResolutionChosenId === autoResolutionChosenId) return\r\n\r\n    this.autoResolutionChosenId = autoResolutionChosenId\r\n\r\n    for (const r of this.resolutions) {\r\n      r.selected = r.id === id\r\n\r\n      if (r.selected) {\r\n        this.currentSelection = r\r\n\r\n        if (!byEngine) r.selectCallback()\r\n      }\r\n    }\r\n\r\n    this.trigger('resolutionChanged')\r\n  }\r\n\r\n  disableAutoResolution () {\r\n    this.autoResolutionEnabled = false\r\n    this.trigger('autoResolutionEnabledChanged')\r\n  }\r\n\r\n  enabledAutoResolution () {\r\n    this.autoResolutionEnabled = true\r\n    this.trigger('autoResolutionEnabledChanged')\r\n  }\r\n\r\n  isAutoResolutionEnabeld () {\r\n    return this.autoResolutionEnabled\r\n  }\r\n\r\n  private sort () {\r\n    this.resolutions.sort((a, b) => {\r\n      if (a.id === -1) return 1\r\n      if (b.id === -1) return -1\r\n\r\n      if (a.height > b.height) return -1\r\n      if (a.height === b.height) return 0\r\n      return 1\r\n    })\r\n  }\r\n\r\n}\r\n\r\nvideojs.registerPlugin('peertubeResolutions', PeerTubeResolutionsPlugin)\r\nexport { PeerTubeResolutionsPlugin }\r\n","import videojs from 'video.js'\r\nimport { ResolutionMenuItem } from './resolution-menu-item'\r\n\r\nconst Menu = videojs.getComponent('Menu')\r\nconst MenuButton = videojs.getComponent('MenuButton')\r\nclass ResolutionMenuButton extends MenuButton {\r\n  labelEl_: HTMLElement\r\n\r\n  constructor (player: videojs.Player, options?: videojs.MenuButtonOptions) {\r\n    super(player, options)\r\n\r\n    this.controlText('Quality')\r\n\r\n    player.peertubeResolutions().on('resolutionsAdded', () => this.buildQualities())\r\n\r\n    // For parent\r\n    player.peertubeResolutions().on('resolutionChanged', () => {\r\n      setTimeout(() => this.trigger('labelUpdated'))\r\n    })\r\n  }\r\n\r\n  createEl () {\r\n    const el = super.createEl()\r\n\r\n    this.labelEl_ = videojs.dom.createEl('div', {\r\n      className: 'vjs-resolution-value'\r\n    }) as HTMLElement\r\n\r\n    el.appendChild(this.labelEl_)\r\n\r\n    return el\r\n  }\r\n\r\n  updateARIAAttributes () {\r\n    this.el().setAttribute('aria-label', 'Quality')\r\n  }\r\n\r\n  createMenu () {\r\n    return new Menu(this.player_)\r\n  }\r\n\r\n  buildCSSClass () {\r\n    return super.buildCSSClass() + ' vjs-resolution-button'\r\n  }\r\n\r\n  buildWrapperCSSClass () {\r\n    return 'vjs-resolution-control ' + super.buildWrapperCSSClass()\r\n  }\r\n\r\n  private addClickListener (component: any) {\r\n    component.on('click', () => {\r\n      const children = this.menu.children()\r\n\r\n      for (const child of children) {\r\n        if (component !== child) {\r\n          (child as videojs.MenuItem).selected(false)\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  private buildQualities () {\r\n    for (const d of this.player().peertubeResolutions().getResolutions()) {\r\n      const label = d.label === '0p'\r\n        ? this.player().localize('Audio-only')\r\n        : d.label\r\n\r\n      this.menu.addChild(new ResolutionMenuItem(\r\n        this.player_,\r\n        {\r\n          id: d.id + '',\r\n          resolutionId: d.id,\r\n          label,\r\n          selected: d.selected\r\n        })\r\n      )\r\n    }\r\n\r\n    for (const m of this.menu.children()) {\r\n      this.addClickListener(m)\r\n    }\r\n\r\n    this.trigger('menuChanged')\r\n  }\r\n}\r\n\r\nvideojs.registerComponent('ResolutionMenuButton', ResolutionMenuButton)\r\n","import videojs from 'video.js'\r\n\r\nconst MenuItem = videojs.getComponent('MenuItem')\r\n\r\nexport interface ResolutionMenuItemOptions extends videojs.MenuItemOptions {\r\n  resolutionId: number\r\n}\r\n\r\nclass ResolutionMenuItem extends MenuItem {\r\n  private readonly resolutionId: number\r\n  private readonly label: string\r\n\r\n  private autoResolutionEnabled: boolean\r\n  private autoResolutionChosen: string\r\n\r\n  constructor (player: videojs.Player, options?: ResolutionMenuItemOptions) {\r\n    options.selectable = true\r\n\r\n    super(player, options)\r\n\r\n    this.autoResolutionEnabled = true\r\n    this.autoResolutionChosen = ''\r\n\r\n    this.resolutionId = options.resolutionId\r\n    this.label = options.label\r\n\r\n    player.peertubeResolutions().on('resolutionChanged', () => this.updateSelection())\r\n\r\n    // We only want to disable the \"Auto\" item\r\n    if (this.resolutionId === -1) {\r\n      player.peertubeResolutions().on('autoResolutionEnabledChanged', () => this.updateAutoResolution())\r\n    }\r\n  }\r\n\r\n  handleClick (event: any) {\r\n    // Auto button disabled?\r\n    if (this.autoResolutionEnabled === false && this.resolutionId === -1) return\r\n\r\n    super.handleClick(event)\r\n\r\n    this.player().peertubeResolutions().select({ id: this.resolutionId, byEngine: false })\r\n  }\r\n\r\n  updateSelection () {\r\n    const selectedResolution = this.player().peertubeResolutions().getSelected()\r\n\r\n    if (this.resolutionId === -1) {\r\n      this.autoResolutionChosen = this.player().peertubeResolutions().getAutoResolutionChosen()?.label\r\n    }\r\n\r\n    this.selected(this.resolutionId === selectedResolution.id)\r\n  }\r\n\r\n  updateAutoResolution () {\r\n    const enabled = this.player().peertubeResolutions().isAutoResolutionEnabeld()\r\n\r\n    // Check if the auto resolution is enabled or not\r\n    if (enabled === false) {\r\n      this.addClass('disabled')\r\n    } else {\r\n      this.removeClass('disabled')\r\n    }\r\n\r\n    this.autoResolutionEnabled = enabled\r\n  }\r\n\r\n  getLabel () {\r\n    if (this.resolutionId === -1) {\r\n      return this.label + ' <small>' + this.autoResolutionChosen + '</small>'\r\n    }\r\n\r\n    return this.label\r\n  }\r\n}\r\nvideojs.registerComponent('ResolutionMenuItem', ResolutionMenuItem)\r\n\r\nexport { ResolutionMenuItem }\r\n","import videojs from 'video.js'\r\n\r\nconst Component = videojs.getComponent('Component')\r\n\r\nclass SettingsDialog extends Component {\r\n  constructor (player: videojs.Player) {\r\n    super(player)\r\n\r\n    this.hide()\r\n  }\r\n\r\n  /**\r\n   * Create the component's DOM element\r\n   *\r\n   */\r\n  createEl () {\r\n    const uniqueId = this.id()\r\n    const dialogLabelId = 'TTsettingsDialogLabel-' + uniqueId\r\n    const dialogDescriptionId = 'TTsettingsDialogDescription-' + uniqueId\r\n\r\n    return super.createEl('div', {\r\n      className: 'vjs-settings-dialog vjs-modal-overlay',\r\n      innerHTML: '',\r\n      tabIndex: -1\r\n    }, {\r\n      role: 'dialog',\r\n      'aria-labelledby': dialogLabelId,\r\n      'aria-describedby': dialogDescriptionId\r\n    })\r\n  }\r\n}\r\n\r\nComponent.registerComponent('SettingsDialog', SettingsDialog)\r\n\r\nexport { SettingsDialog }\r\n","import videojs from 'video.js'\r\nimport { toTitleCase } from '../common'\r\nimport { SettingsDialog } from './settings-dialog'\r\nimport { SettingsMenuItem } from './settings-menu-item'\r\nimport { SettingsPanel } from './settings-panel'\r\nimport { SettingsPanelChild } from './settings-panel-child'\r\n\r\nconst Button = videojs.getComponent('Button')\r\nconst Menu = videojs.getComponent('Menu')\r\nconst Component = videojs.getComponent('Component')\r\n\r\nexport interface SettingsButtonOptions extends videojs.ComponentOptions {\r\n  entries: any[]\r\n  setup?: {\r\n    maxHeightOffset: number\r\n  }\r\n}\r\n\r\nclass SettingsButton extends Button {\r\n  dialog: SettingsDialog\r\n  dialogEl: HTMLElement\r\n  menu: videojs.Menu\r\n  panel: SettingsPanel\r\n  panelChild: SettingsPanelChild\r\n\r\n  addSettingsItemHandler: typeof SettingsButton.prototype.onAddSettingsItem\r\n  disposeSettingsItemHandler: typeof SettingsButton.prototype.onDisposeSettingsItem\r\n  documentClickHandler: typeof SettingsButton.prototype.onDocumentClick\r\n  userInactiveHandler: typeof SettingsButton.prototype.onUserInactive\r\n\r\n  private settingsButtonOptions: SettingsButtonOptions\r\n\r\n  constructor (player: videojs.Player, options?: SettingsButtonOptions) {\r\n    super(player, options)\r\n\r\n    this.settingsButtonOptions = options\r\n\r\n    this.controlText('Settings')\r\n\r\n    this.dialog = this.player().addChild('settingsDialog')\r\n    this.dialogEl = this.dialog.el() as HTMLElement\r\n    this.menu = null\r\n    this.panel = this.dialog.addChild('settingsPanel')\r\n    this.panelChild = this.panel.addChild('settingsPanelChild')\r\n\r\n    this.addClass('vjs-settings')\r\n    this.el().setAttribute('aria-label', 'Settings Button')\r\n\r\n    // Event handlers\r\n    this.addSettingsItemHandler = this.onAddSettingsItem.bind(this)\r\n    this.disposeSettingsItemHandler = this.onDisposeSettingsItem.bind(this)\r\n    this.documentClickHandler = this.onDocumentClick.bind(this)\r\n    this.userInactiveHandler = this.onUserInactive.bind(this)\r\n\r\n    this.buildMenu()\r\n    this.bindEvents()\r\n\r\n    // Prepare the dialog\r\n    this.player().one('play', () => this.hideDialog())\r\n  }\r\n\r\n  onDocumentClick (event: MouseEvent) {\r\n    const element = event.target as HTMLElement\r\n\r\n    if (element?.classList?.contains('vjs-settings') || element?.parentElement?.classList?.contains('vjs-settings')) {\r\n      return\r\n    }\r\n\r\n    if (!this.dialog.hasClass('vjs-hidden')) {\r\n      this.hideDialog()\r\n    }\r\n  }\r\n\r\n  onDisposeSettingsItem (event: any, name: string) {\r\n    if (name === undefined) {\r\n      const children = this.menu.children()\r\n\r\n      while (children.length > 0) {\r\n        children[0].dispose()\r\n        this.menu.removeChild(children[0])\r\n      }\r\n\r\n      this.addClass('vjs-hidden')\r\n    } else {\r\n      const item = this.menu.getChild(name)\r\n\r\n      if (item) {\r\n        item.dispose()\r\n        this.menu.removeChild(item)\r\n      }\r\n    }\r\n\r\n    this.hideDialog()\r\n\r\n    if (this.settingsButtonOptions.entries.length === 0) {\r\n      this.addClass('vjs-hidden')\r\n    }\r\n  }\r\n\r\n  dispose () {\r\n    document.removeEventListener('click', this.documentClickHandler)\r\n\r\n    if (this.isInIframe()) {\r\n      window.removeEventListener('blur', this.documentClickHandler)\r\n    }\r\n  }\r\n\r\n  onAddSettingsItem (event: any, data: any) {\r\n    const [ entry, options ] = data\r\n\r\n    this.addMenuItem(entry, options)\r\n    this.removeClass('vjs-hidden')\r\n  }\r\n\r\n  onUserInactive () {\r\n    if (!this.dialog.hasClass('vjs-hidden')) {\r\n      this.hideDialog()\r\n    }\r\n  }\r\n\r\n  bindEvents () {\r\n    document.addEventListener('click', this.documentClickHandler)\r\n    if (this.isInIframe()) {\r\n      window.addEventListener('blur', this.documentClickHandler)\r\n    }\r\n\r\n    this.player().on('addsettingsitem', this.addSettingsItemHandler)\r\n    this.player().on('disposesettingsitem', this.disposeSettingsItemHandler)\r\n    this.player().on('userinactive', this.userInactiveHandler)\r\n  }\r\n\r\n  buildCSSClass () {\r\n    return `vjs-icon-settings ${super.buildCSSClass()}`\r\n  }\r\n\r\n  handleClick () {\r\n    if (this.dialog.hasClass('vjs-hidden')) {\r\n      this.showDialog()\r\n    } else {\r\n      this.hideDialog()\r\n    }\r\n  }\r\n\r\n  showDialog () {\r\n    this.player().peertube().onMenuOpened();\r\n\r\n    (this.menu.el() as HTMLElement).style.opacity = '1'\r\n\r\n    this.dialog.show()\r\n    this.el().setAttribute('aria-expanded', 'true')\r\n\r\n    this.setDialogSize(this.getComponentSize(this.menu))\r\n\r\n    const firstChild = this.menu.children()[0]\r\n    if (firstChild) firstChild.focus()\r\n  }\r\n\r\n  hideDialog () {\r\n    this.player_.peertube().onMenuClosed()\r\n\r\n    this.dialog.hide()\r\n    this.el().setAttribute('aria-expanded', 'false')\r\n\r\n    this.setDialogSize(this.getComponentSize(this.menu));\r\n    (this.menu.el() as HTMLElement).style.opacity = '1'\r\n    this.resetChildren()\r\n  }\r\n\r\n  getComponentSize (element: videojs.Component | HTMLElement) {\r\n    let width: number = null\r\n    let height: number = null\r\n\r\n    // Could be component or just DOM element\r\n    if (element instanceof Component) {\r\n      const el = element.el() as HTMLElement\r\n\r\n      width = el.offsetWidth\r\n      height = el.offsetHeight;\r\n\r\n      (element as any).width = width;\r\n      (element as any).height = height\r\n    } else {\r\n      width = element.offsetWidth\r\n      height = element.offsetHeight\r\n    }\r\n\r\n    return [ width, height ]\r\n  }\r\n\r\n  setDialogSize ([ width, height ]: number[]) {\r\n    if (typeof height !== 'number') {\r\n      return\r\n    }\r\n\r\n    const offset = this.settingsButtonOptions.setup.maxHeightOffset\r\n    const maxHeight = (this.player().el() as HTMLElement).offsetHeight - offset\r\n\r\n    const panelEl = this.panel.el() as HTMLElement\r\n\r\n    if (height > maxHeight) {\r\n      height = maxHeight\r\n      width += 17\r\n      panelEl.style.maxHeight = `${height}px`\r\n    } else if (panelEl.style.maxHeight !== '') {\r\n      panelEl.style.maxHeight = ''\r\n    }\r\n\r\n    this.dialogEl.style.width = `${width}px`\r\n    this.dialogEl.style.height = `${height}px`\r\n  }\r\n\r\n  buildMenu () {\r\n    this.menu = new Menu(this.player())\r\n    this.menu.addClass('vjs-main-menu')\r\n    const entries = this.settingsButtonOptions.entries\r\n\r\n    if (entries.length === 0) {\r\n      this.addClass('vjs-hidden')\r\n      this.panelChild.addChild(this.menu)\r\n      return\r\n    }\r\n\r\n    for (const entry of entries) {\r\n      this.addMenuItem(entry, this.settingsButtonOptions)\r\n    }\r\n\r\n    this.panelChild.addChild(this.menu)\r\n  }\r\n\r\n  addMenuItem (entry: any, options: any) {\r\n    const openSubMenu = function (this: any) {\r\n      if (videojs.dom.hasClass(this.el_, 'open')) {\r\n        videojs.dom.removeClass(this.el_, 'open')\r\n      } else {\r\n        videojs.dom.addClass(this.el_, 'open')\r\n      }\r\n    }\r\n\r\n    options.name = toTitleCase(entry)\r\n\r\n    const newOptions = Object.assign({}, options, { entry, menuButton: this })\r\n    const settingsMenuItem = new SettingsMenuItem(this.player(), newOptions)\r\n\r\n    this.menu.addChild(settingsMenuItem)\r\n\r\n    // Hide children to avoid sub menus stacking on top of each other\r\n    // or having multiple menus open\r\n    settingsMenuItem.on('click', videojs.bind(this, this.hideChildren))\r\n\r\n    // Whether to add or remove selected class on the settings sub menu element\r\n    settingsMenuItem.on('click', openSubMenu)\r\n  }\r\n\r\n  resetChildren () {\r\n    for (const menuChild of this.menu.children()) {\r\n      (menuChild as SettingsMenuItem).reset()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Hide all the sub menus\r\n   */\r\n  hideChildren () {\r\n    for (const menuChild of this.menu.children()) {\r\n      (menuChild as SettingsMenuItem).hideSubMenu()\r\n    }\r\n  }\r\n\r\n  isInIframe () {\r\n    return window.self !== window.top\r\n  }\r\n\r\n}\r\n\r\nComponent.registerComponent('SettingsButton', SettingsButton)\r\n\r\nexport { SettingsButton }\r\n","import videojs from 'video.js'\r\nimport { toTitleCase } from '../common'\r\nimport { SettingsDialog } from './settings-dialog'\r\nimport { SettingsButton } from './settings-menu-button'\r\nimport { SettingsPanel } from './settings-panel'\r\nimport { SettingsPanelChild } from './settings-panel-child'\r\n\r\nconst MenuItem = videojs.getComponent('MenuItem')\r\nconst component = videojs.getComponent('Component')\r\n\r\nexport interface SettingsMenuItemOptions extends videojs.MenuItemOptions {\r\n  entry: string\r\n  menuButton: SettingsButton\r\n}\r\n\r\nclass SettingsMenuItem extends MenuItem {\r\n  settingsButton: SettingsButton\r\n  dialog: SettingsDialog\r\n  mainMenu: videojs.Menu\r\n  panel: SettingsPanel\r\n  panelChild: SettingsPanelChild\r\n  panelChildEl: HTMLElement\r\n  size: number[]\r\n  menuToLoad: string\r\n  subMenu: SettingsButton\r\n\r\n  submenuClickHandler: typeof SettingsMenuItem.prototype.onSubmenuClick\r\n  transitionEndHandler: typeof SettingsMenuItem.prototype.onTransitionEnd\r\n\r\n  settingsSubMenuTitleEl_: HTMLElement\r\n  settingsSubMenuValueEl_: HTMLElement\r\n  settingsSubMenuEl_: HTMLElement\r\n\r\n  constructor (player: videojs.Player, options?: SettingsMenuItemOptions) {\r\n    super(player, options)\r\n\r\n    this.settingsButton = options.menuButton\r\n    this.dialog = this.settingsButton.dialog\r\n    this.mainMenu = this.settingsButton.menu\r\n    this.panel = this.dialog.getChild('settingsPanel')\r\n    this.panelChild = this.panel.getChild('settingsPanelChild')\r\n    this.panelChildEl = this.panelChild.el() as HTMLElement\r\n\r\n    this.size = null\r\n\r\n    // keep state of what menu type is loading next\r\n    this.menuToLoad = 'mainmenu'\r\n\r\n    const subMenuName = toTitleCase(options.entry)\r\n    const SubMenuComponent = videojs.getComponent(subMenuName)\r\n\r\n    if (!SubMenuComponent) {\r\n      throw new Error(`Component ${subMenuName} does not exist`)\r\n    }\r\n\r\n    const newOptions = Object.assign({}, options, { entry: options.menuButton, menuButton: this })\r\n\r\n    this.subMenu = new SubMenuComponent(this.player(), newOptions) as SettingsButton\r\n    const subMenuClass = this.subMenu.buildCSSClass().split(' ')[0]\r\n    this.settingsSubMenuEl_.className += ' ' + subMenuClass\r\n\r\n    this.eventHandlers()\r\n\r\n    player.ready(() => {\r\n      // Voodoo magic for IOS\r\n      setTimeout(() => {\r\n        // Player was destroyed\r\n        if (!this.player_) return\r\n\r\n        this.build()\r\n\r\n        // Update on rate change\r\n        player.on('ratechange', this.submenuClickHandler)\r\n\r\n        if (subMenuName === 'CaptionsButton') {\r\n          // Hack to regenerate captions on HTTP fallback\r\n          player.on('captionsChanged', () => {\r\n            setTimeout(() => {\r\n              this.settingsSubMenuEl_.innerHTML = ''\r\n              this.settingsSubMenuEl_.appendChild(this.subMenu.menu.el())\r\n              this.update()\r\n              this.bindClickEvents()\r\n            }, 0)\r\n          })\r\n        }\r\n\r\n        this.reset()\r\n      }, 0)\r\n    })\r\n  }\r\n\r\n  eventHandlers () {\r\n    this.submenuClickHandler = this.onSubmenuClick.bind(this)\r\n    this.transitionEndHandler = this.onTransitionEnd.bind(this)\r\n  }\r\n\r\n  onSubmenuClick (event: any) {\r\n    let target = null\r\n\r\n    if (event.type === 'tap') {\r\n      target = event.target\r\n    } else {\r\n      target = event.currentTarget || event.target\r\n    }\r\n\r\n    if (target?.classList.contains('vjs-back-button')) {\r\n      this.loadMainMenu()\r\n      return\r\n    }\r\n\r\n    // To update the sub menu value on click, setTimeout is needed because\r\n    // updating the value is not instant\r\n    setTimeout(() => this.update(event), 0)\r\n\r\n    // Seems like videojs adds a vjs-hidden class on the caption menu after a click\r\n    // We don't need it\r\n    this.subMenu.menu.removeClass('vjs-hidden')\r\n  }\r\n\r\n  /**\r\n   * Create the component's DOM element\r\n   *\r\n   */\r\n  createEl () {\r\n    const el = videojs.dom.createEl('li', {\r\n      className: 'vjs-menu-item',\r\n      tabIndex: -1\r\n    })\r\n\r\n    this.settingsSubMenuTitleEl_ = videojs.dom.createEl('div', {\r\n      className: 'vjs-settings-sub-menu-title'\r\n    }) as HTMLElement\r\n\r\n    el.appendChild(this.settingsSubMenuTitleEl_)\r\n\r\n    this.settingsSubMenuValueEl_ = videojs.dom.createEl('div', {\r\n      className: 'vjs-settings-sub-menu-value'\r\n    }) as HTMLElement\r\n\r\n    el.appendChild(this.settingsSubMenuValueEl_)\r\n\r\n    this.settingsSubMenuEl_ = videojs.dom.createEl('div', {\r\n      className: 'vjs-settings-sub-menu'\r\n    }) as HTMLElement\r\n\r\n    return el as HTMLLIElement\r\n  }\r\n\r\n  /**\r\n   * Handle click on menu item\r\n   *\r\n   * @method handleClick\r\n   */\r\n  handleClick (event: videojs.EventTarget.Event) {\r\n    this.menuToLoad = 'submenu'\r\n    // Remove open class to ensure only the open submenu gets this class\r\n    videojs.dom.removeClass(this.el(), 'open')\r\n\r\n    super.handleClick(event);\r\n\r\n    (this.mainMenu.el() as HTMLElement).style.opacity = '0'\r\n    // Whether to add or remove vjs-hidden class on the settingsSubMenuEl element\r\n    if (videojs.dom.hasClass(this.settingsSubMenuEl_, 'vjs-hidden')) {\r\n      videojs.dom.removeClass(this.settingsSubMenuEl_, 'vjs-hidden')\r\n\r\n      // animation not played without timeout\r\n      setTimeout(() => {\r\n        this.settingsSubMenuEl_.style.opacity = '1'\r\n        this.settingsSubMenuEl_.style.marginRight = '0px'\r\n      }, 0)\r\n\r\n      this.settingsButton.setDialogSize(this.size)\r\n\r\n      const firstChild = this.subMenu.menu.children()[0]\r\n      if (firstChild) firstChild.focus()\r\n    } else {\r\n      videojs.dom.addClass(this.settingsSubMenuEl_, 'vjs-hidden')\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create back button\r\n   *\r\n   * @method createBackButton\r\n   */\r\n  createBackButton () {\r\n    const button = this.subMenu.menu.addChild('MenuItem', {}, 0)\r\n\r\n    button.addClass('vjs-back-button');\r\n    (button.el() as HTMLElement).innerHTML = this.player().localize(this.subMenu.controlText())\r\n  }\r\n\r\n  /**\r\n   * Add/remove prefixed event listener for CSS Transition\r\n   *\r\n   * @method PrefixedEvent\r\n   */\r\n  PrefixedEvent (element: any, type: any, callback: any, action = 'addEvent') {\r\n    const prefix = [ 'webkit', 'moz', 'MS', 'o', '' ]\r\n\r\n    for (let p = 0; p < prefix.length; p++) {\r\n      if (!prefix[p]) {\r\n        type = type.toLowerCase()\r\n      }\r\n\r\n      if (action === 'addEvent') {\r\n        element.addEventListener(prefix[p] + type, callback, false)\r\n      } else if (action === 'removeEvent') {\r\n        element.removeEventListener(prefix[p] + type, callback, false)\r\n      }\r\n    }\r\n  }\r\n\r\n  onTransitionEnd (event: any) {\r\n    if (event.propertyName !== 'margin-right') {\r\n      return\r\n    }\r\n\r\n    if (this.menuToLoad === 'mainmenu') {\r\n      // hide submenu\r\n      videojs.dom.addClass(this.settingsSubMenuEl_, 'vjs-hidden')\r\n\r\n      // reset opacity to 0\r\n      this.settingsSubMenuEl_.style.opacity = '0'\r\n    }\r\n  }\r\n\r\n  reset () {\r\n    videojs.dom.addClass(this.settingsSubMenuEl_, 'vjs-hidden')\r\n    this.settingsSubMenuEl_.style.opacity = '0'\r\n    this.setMargin()\r\n  }\r\n\r\n  loadMainMenu () {\r\n    const mainMenuEl = this.mainMenu.el() as HTMLElement\r\n    this.menuToLoad = 'mainmenu'\r\n    this.mainMenu.show()\r\n    mainMenuEl.style.opacity = '0'\r\n\r\n    // back button will always take you to main menu, so set dialog sizes\r\n    const mainMenuAny = this.mainMenu as any\r\n    this.settingsButton.setDialogSize([ mainMenuAny.width, mainMenuAny.height ])\r\n\r\n    // animation not triggered without timeout (some async stuff ?!?)\r\n    setTimeout(() => {\r\n      // animate margin and opacity before hiding the submenu\r\n      // this triggers CSS Transition event\r\n      this.setMargin()\r\n      mainMenuEl.style.opacity = '1'\r\n\r\n      const firstChild = this.mainMenu.children()[0]\r\n      if (firstChild) firstChild.focus()\r\n    }, 0)\r\n  }\r\n\r\n  build () {\r\n    this.subMenu.on('labelUpdated', () => {\r\n      this.update()\r\n    })\r\n    this.subMenu.on('menuChanged', () => {\r\n      this.bindClickEvents()\r\n      this.setSize()\r\n      this.update()\r\n    })\r\n\r\n    this.settingsSubMenuTitleEl_.innerHTML = this.player().localize(this.subMenu.controlText())\r\n    this.settingsSubMenuEl_.appendChild(this.subMenu.menu.el())\r\n    this.panelChildEl.appendChild(this.settingsSubMenuEl_)\r\n    this.update()\r\n\r\n    this.createBackButton()\r\n    this.setSize()\r\n    this.bindClickEvents()\r\n\r\n    // prefixed event listeners for CSS TransitionEnd\r\n    this.PrefixedEvent(\r\n      this.settingsSubMenuEl_,\r\n      'TransitionEnd',\r\n      this.transitionEndHandler,\r\n      'addEvent'\r\n    )\r\n  }\r\n\r\n  update (event?: any) {\r\n    let target: HTMLElement = null\r\n    const subMenu = this.subMenu.name()\r\n\r\n    if (event && event.type === 'tap') {\r\n      target = event.target\r\n    } else if (event) {\r\n      target = event.currentTarget\r\n    }\r\n\r\n    // Playback rate menu button doesn't get a vjs-selected class\r\n    // or sets options_['selected'] on the selected playback rate.\r\n    // Thus we get the submenu value based on the labelEl of playbackRateMenuButton\r\n    if (subMenu === 'PlaybackRateMenuButton') {\r\n      const html = (this.subMenu as any).labelEl_.innerHTML\r\n\r\n      setTimeout(() => {\r\n        this.settingsSubMenuValueEl_.innerHTML = html\r\n      }, 250)\r\n    } else {\r\n      // Loop through the submenu items to find the selected child\r\n      for (const subMenuItem of this.subMenu.menu.children_) {\r\n        if (!(subMenuItem instanceof component)) {\r\n          continue\r\n        }\r\n\r\n        if (subMenuItem.hasClass('vjs-selected')) {\r\n          const subMenuItemUntyped = subMenuItem as any\r\n\r\n          // Prefer to use the function\r\n          if (typeof subMenuItemUntyped.getLabel === 'function') {\r\n            this.settingsSubMenuValueEl_.innerHTML = subMenuItemUntyped.getLabel()\r\n            break\r\n          }\r\n\r\n          this.settingsSubMenuValueEl_.innerHTML = this.player().localize(subMenuItemUntyped.options_.label)\r\n        }\r\n      }\r\n    }\r\n\r\n    if (target && !target.classList.contains('vjs-back-button')) {\r\n      this.settingsButton.hideDialog()\r\n    }\r\n  }\r\n\r\n  bindClickEvents () {\r\n    for (const item of this.subMenu.menu.children()) {\r\n      if (!(item instanceof component)) {\r\n        continue\r\n      }\r\n      item.on([ 'tap', 'click' ], this.submenuClickHandler)\r\n    }\r\n  }\r\n\r\n  // save size of submenus on first init\r\n  // if number of submenu items change dynamically more logic will be needed\r\n  setSize () {\r\n    this.dialog.removeClass('vjs-hidden')\r\n    videojs.dom.removeClass(this.settingsSubMenuEl_, 'vjs-hidden')\r\n    this.size = this.settingsButton.getComponentSize(this.settingsSubMenuEl_)\r\n    this.setMargin()\r\n    this.dialog.addClass('vjs-hidden')\r\n    videojs.dom.addClass(this.settingsSubMenuEl_, 'vjs-hidden')\r\n  }\r\n\r\n  setMargin () {\r\n    if (!this.size) return\r\n\r\n    const [ width ] = this.size\r\n\r\n    this.settingsSubMenuEl_.style.marginRight = `-${width}px`\r\n  }\r\n\r\n  /**\r\n   * Hide the sub menu\r\n   */\r\n  hideSubMenu () {\r\n    // after removing settings item this.el_ === null\r\n    if (!this.el()) {\r\n      return\r\n    }\r\n\r\n    if (videojs.dom.hasClass(this.el(), 'open')) {\r\n      videojs.dom.addClass(this.settingsSubMenuEl_, 'vjs-hidden')\r\n      videojs.dom.removeClass(this.el(), 'open')\r\n    }\r\n  }\r\n\r\n}\r\n\r\n(SettingsMenuItem as any).prototype.contentElType = 'button'\r\nvideojs.registerComponent('SettingsMenuItem', SettingsMenuItem)\r\n\r\nexport { SettingsMenuItem }\r\n","import videojs from 'video.js'\r\n\r\nconst Component = videojs.getComponent('Component')\r\n\r\nclass SettingsPanelChild extends Component {\r\n\r\n  createEl () {\r\n    return super.createEl('div', {\r\n      className: 'vjs-settings-panel-child',\r\n      innerHTML: '',\r\n      tabIndex: -1\r\n    })\r\n  }\r\n}\r\n\r\nComponent.registerComponent('SettingsPanelChild', SettingsPanelChild)\r\n\r\nexport { SettingsPanelChild }\r\n","import videojs from 'video.js'\r\n\r\nconst Component = videojs.getComponent('Component')\r\n\r\nclass SettingsPanel extends Component {\r\n\r\n  createEl () {\r\n    return super.createEl('div', {\r\n      className: 'vjs-settings-panel',\r\n      innerHTML: '',\r\n      tabIndex: -1\r\n    })\r\n  }\r\n}\r\n\r\nComponent.registerComponent('SettingsPanel', SettingsPanel)\r\n\r\nexport { SettingsPanel }\r\n","import videojs from 'video.js'\r\nimport { logger } from '@root-helpers/logger'\r\nimport { secondsToTime } from '@shared/core-utils'\r\nimport { PlayerNetworkInfo as EventPlayerNetworkInfo } from '../../types'\r\nimport { bytes } from '../common'\r\n\r\ninterface StatsCardOptions extends videojs.ComponentOptions {\r\n  videoUUID: string\r\n  videoIsLive: boolean\r\n  mode: 'webtorrent' | 'p2p-media-loader' | 'localvideo'\r\n  p2pEnabled: boolean\r\n}\r\n\r\ninterface PlayerNetworkInfo {\r\n  downloadSpeed?: string\r\n  uploadSpeed?: string\r\n  totalDownloaded?: string\r\n  totalUploaded?: string\r\n  numPeers?: number\r\n  averageBandwidth?: string\r\n\r\n  downloadedFromServer?: string\r\n  downloadedFromPeers?: string\r\n}\r\n\r\ninterface InfoElement {\r\n  root: HTMLElement\r\n  value: HTMLElement\r\n}\r\n\r\nconst Component = videojs.getComponent('Component')\r\nclass StatsCard extends Component {\r\n  options_: StatsCardOptions\r\n\r\n  updateInterval: any\r\n\r\n  mode: 'webtorrent' | 'p2p-media-loader'\r\n\r\n  metadataStore: any = {}\r\n\r\n  intervalMs = 300\r\n  playerNetworkInfo: PlayerNetworkInfo = {}\r\n\r\n  private containerEl: HTMLDivElement\r\n  private infoListEl: HTMLDivElement\r\n\r\n  private playerMode: InfoElement\r\n  private p2p: InfoElement\r\n  private uuid: InfoElement\r\n  private viewport: InfoElement\r\n  private resolution: InfoElement\r\n  private volume: InfoElement\r\n  private codecs: InfoElement\r\n  private color: InfoElement\r\n  private connection: InfoElement\r\n\r\n  private network: InfoElement\r\n  private transferred: InfoElement\r\n  private download: InfoElement\r\n\r\n  private bufferProgress: InfoElement\r\n  private bufferState: InfoElement\r\n\r\n  private liveLatency: InfoElement\r\n\r\n  createEl () {\r\n    this.containerEl = videojs.dom.createEl('div', {\r\n      className: 'vjs-stats-content'\r\n    }) as HTMLDivElement\r\n    this.containerEl.style.display = 'none'\r\n\r\n    this.infoListEl = videojs.dom.createEl('div', {\r\n      className: 'vjs-stats-list'\r\n    }) as HTMLDivElement\r\n\r\n    const closeButton = videojs.dom.createEl('button', {\r\n      className: 'vjs-stats-close',\r\n      tabindex: '0',\r\n      title: 'Close stats',\r\n      innerText: '[x]'\r\n    }, { 'aria-label': 'Close stats' }) as HTMLElement\r\n    closeButton.onclick = () => this.hide()\r\n\r\n    this.containerEl.appendChild(closeButton)\r\n    this.containerEl.appendChild(this.infoListEl)\r\n\r\n    this.populateInfoBlocks()\r\n\r\n    this.player_.on('p2pInfo', (event: any, data: EventPlayerNetworkInfo) => {\r\n      if (!data) return // HTTP fallback\r\n\r\n      this.mode = data.source\r\n\r\n      const p2pStats = data.p2p\r\n      const httpStats = data.http\r\n\r\n      this.playerNetworkInfo.downloadSpeed = bytes(p2pStats.downloadSpeed + httpStats.downloadSpeed).join(' ')\r\n      this.playerNetworkInfo.uploadSpeed = bytes(p2pStats.uploadSpeed + httpStats.uploadSpeed).join(' ')\r\n      this.playerNetworkInfo.totalDownloaded = bytes(p2pStats.downloaded + httpStats.downloaded).join(' ')\r\n      this.playerNetworkInfo.totalUploaded = bytes(p2pStats.uploaded + httpStats.uploaded).join(' ')\r\n      this.playerNetworkInfo.numPeers = p2pStats.numPeers\r\n      this.playerNetworkInfo.averageBandwidth = bytes(data.bandwidthEstimate).join(' ') + '/s'\r\n\r\n      if (data.source === 'p2p-media-loader') {\r\n        this.playerNetworkInfo.downloadedFromServer = bytes(httpStats.downloaded).join(' ')\r\n        this.playerNetworkInfo.downloadedFromPeers = bytes(p2pStats.downloaded).join(' ')\r\n      }\r\n    })\r\n\r\n    return this.containerEl\r\n  }\r\n\r\n  toggle () {\r\n    if (this.updateInterval) this.hide()\r\n    else this.show()\r\n  }\r\n\r\n  show () {\r\n    this.containerEl.style.display = 'block'\r\n\r\n    this.updateInterval = setInterval(async () => {\r\n      try {\r\n        const options = this.mode === 'p2p-media-loader'\r\n          ? this.buildHLSOptions()\r\n          : await this.buildWebTorrentOptions() // Default\r\n\r\n        this.populateInfoValues(options)\r\n      } catch (err) {\r\n        logger.error('Cannot update stats.', err)\r\n        clearInterval(this.updateInterval)\r\n      }\r\n    }, this.intervalMs)\r\n  }\r\n\r\n  hide () {\r\n    clearInterval(this.updateInterval)\r\n    this.containerEl.style.display = 'none'\r\n  }\r\n\r\n  private buildHLSOptions () {\r\n    const p2pMediaLoader = this.player_.p2pMediaLoader()\r\n    const level = p2pMediaLoader.getCurrentLevel()\r\n\r\n    const codecs = level?.videoCodec || level?.audioCodec\r\n      ? `${level?.videoCodec || ''} / ${level?.audioCodec || ''}`\r\n      : undefined\r\n\r\n    const resolution = `${level?.height}p${level?.attrs['FRAME-RATE'] || ''}`\r\n    const buffer = this.timeRangesToString(this.player().buffered())\r\n\r\n    let progress: number\r\n    let latency: string\r\n\r\n    if (this.options_.videoIsLive) {\r\n      latency = secondsToTime(p2pMediaLoader.getLiveLatency())\r\n    } else {\r\n      progress = this.player().bufferedPercent()\r\n    }\r\n\r\n    return {\r\n      playerNetworkInfo: this.playerNetworkInfo,\r\n      resolution,\r\n      codecs,\r\n      buffer,\r\n      latency,\r\n      progress\r\n    }\r\n  }\r\n\r\n  private async buildWebTorrentOptions () {\r\n    const videoFile = this.player_.webtorrent().getCurrentVideoFile()\r\n\r\n    if (!this.metadataStore[videoFile.fileUrl]) {\r\n      this.metadataStore[videoFile.fileUrl] = await fetch(videoFile.metadataUrl).then(res => res.json())\r\n    }\r\n\r\n    const metadata = this.metadataStore[videoFile.fileUrl]\r\n\r\n    let colorSpace = 'unknown'\r\n    let codecs = 'unknown'\r\n\r\n    if (metadata?.streams[0]) {\r\n      const stream = metadata.streams[0]\r\n\r\n      colorSpace = stream['color_space'] !== 'unknown'\r\n        ? stream['color_space']\r\n        : 'bt709'\r\n\r\n      codecs = stream['codec_name'] || 'avc1'\r\n    }\r\n\r\n    const resolution = videoFile?.resolution.label + videoFile?.fps\r\n    const buffer = this.timeRangesToString(this.player().buffered())\r\n    const progress = this.player_.webtorrent().getTorrent()?.progress\r\n\r\n    return {\r\n      playerNetworkInfo: this.playerNetworkInfo,\r\n      progress,\r\n      colorSpace,\r\n      codecs,\r\n      resolution,\r\n      buffer\r\n    }\r\n  }\r\n\r\n  private populateInfoBlocks () {\r\n    this.playerMode = this.buildInfoRow(this.player().localize('Player mode'))\r\n    this.p2p = this.buildInfoRow(this.player().localize('P2P'))\r\n    this.uuid = this.buildInfoRow(this.player().localize('Video UUID'))\r\n    this.viewport = this.buildInfoRow(this.player().localize('Viewport / Frames'))\r\n    this.resolution = this.buildInfoRow(this.player().localize('Resolution'))\r\n    this.volume = this.buildInfoRow(this.player().localize('Volume'))\r\n    this.codecs = this.buildInfoRow(this.player().localize('Codecs'))\r\n    this.color = this.buildInfoRow(this.player().localize('Color'))\r\n    this.connection = this.buildInfoRow(this.player().localize('Connection Speed'))\r\n\r\n    this.network = this.buildInfoRow(this.player().localize('Network Activity'))\r\n    this.transferred = this.buildInfoRow(this.player().localize('Total Transfered'))\r\n    this.download = this.buildInfoRow(this.player().localize('Download Breakdown'))\r\n\r\n    this.bufferProgress = this.buildInfoRow(this.player().localize('Buffer Progress'))\r\n    this.bufferState = this.buildInfoRow(this.player().localize('Buffer State'))\r\n\r\n    this.liveLatency = this.buildInfoRow(this.player().localize('Live Latency'))\r\n\r\n    this.infoListEl.appendChild(this.playerMode.root)\r\n    this.infoListEl.appendChild(this.p2p.root)\r\n    this.infoListEl.appendChild(this.uuid.root)\r\n    this.infoListEl.appendChild(this.viewport.root)\r\n    this.infoListEl.appendChild(this.resolution.root)\r\n    this.infoListEl.appendChild(this.volume.root)\r\n    this.infoListEl.appendChild(this.codecs.root)\r\n    this.infoListEl.appendChild(this.color.root)\r\n    this.infoListEl.appendChild(this.connection.root)\r\n    this.infoListEl.appendChild(this.network.root)\r\n    this.infoListEl.appendChild(this.transferred.root)\r\n    this.infoListEl.appendChild(this.download.root)\r\n    this.infoListEl.appendChild(this.bufferProgress.root)\r\n    this.infoListEl.appendChild(this.bufferState.root)\r\n    this.infoListEl.appendChild(this.liveLatency.root)\r\n  }\r\n\r\n  private populateInfoValues (options: {\r\n    playerNetworkInfo: PlayerNetworkInfo\r\n    progress: number\r\n    codecs: string\r\n    resolution: string\r\n    buffer: string\r\n\r\n    latency?: string\r\n    colorSpace?: string\r\n  }) {\r\n    const { playerNetworkInfo, progress, colorSpace, codecs, resolution, buffer, latency } = options\r\n    const player = this.player()\r\n\r\n    const videoQuality: VideoPlaybackQuality = player.getVideoPlaybackQuality()\r\n    const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0)\r\n    const vh = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0)\r\n    const pr = (window.devicePixelRatio || 1).toFixed(2)\r\n    const frames = `${vw}x${vh}*${pr} / ${videoQuality.droppedVideoFrames} dropped of ${videoQuality.totalVideoFrames}`\r\n\r\n    const duration = player.duration()\r\n\r\n    let volume = `${Math.round(player.volume() * 100)}`\r\n    if (player.muted()) volume += ' (muted)'\r\n\r\n    const networkActivity = playerNetworkInfo.downloadSpeed\r\n      ? `${playerNetworkInfo.downloadSpeed} &dArr; / ${playerNetworkInfo.uploadSpeed} &uArr;`\r\n      : undefined\r\n\r\n    const totalTransferred = playerNetworkInfo.totalDownloaded\r\n      ? `${playerNetworkInfo.totalDownloaded} &dArr; / ${playerNetworkInfo.totalUploaded} &uArr;`\r\n      : undefined\r\n    const downloadBreakdown = playerNetworkInfo.downloadedFromServer\r\n      ? `${playerNetworkInfo.downloadedFromServer} from servers · ${playerNetworkInfo.downloadedFromPeers} from peers`\r\n      : undefined\r\n\r\n    const bufferProgress = progress !== undefined\r\n      ? `${(progress * 100).toFixed(1)}% (${(progress * duration).toFixed(1)}s)`\r\n      : undefined\r\n\r\n    this.setInfoValue(this.playerMode, this.mode || 'HTTP')\r\n    this.setInfoValue(this.p2p, player.localize(this.options_.p2pEnabled ? 'enabled' : 'disabled'))\r\n    this.setInfoValue(this.uuid, this.options_.videoUUID)\r\n\r\n    this.setInfoValue(this.viewport, frames)\r\n    this.setInfoValue(this.resolution, resolution)\r\n    this.setInfoValue(this.volume, volume)\r\n    this.setInfoValue(this.codecs, codecs)\r\n    this.setInfoValue(this.color, colorSpace)\r\n    this.setInfoValue(this.connection, playerNetworkInfo.averageBandwidth)\r\n\r\n    this.setInfoValue(this.network, networkActivity)\r\n    this.setInfoValue(this.transferred, totalTransferred)\r\n    this.setInfoValue(this.download, downloadBreakdown)\r\n\r\n    this.setInfoValue(this.bufferProgress, bufferProgress)\r\n    this.setInfoValue(this.bufferState, buffer)\r\n\r\n    this.setInfoValue(this.liveLatency, latency)\r\n  }\r\n\r\n  private setInfoValue (el: InfoElement, value: string) {\r\n    if (!value) {\r\n      el.root.style.display = 'none'\r\n      return\r\n    }\r\n\r\n    el.root.style.display = 'block'\r\n\r\n    if (el.value.innerHTML === value) return\r\n    el.value.innerHTML = value\r\n  }\r\n\r\n  private buildInfoRow (labelText: string, valueHTML?: string) {\r\n    const root = videojs.dom.createEl('div') as HTMLElement\r\n    root.style.display = 'none'\r\n\r\n    const label = videojs.dom.createEl('div', { innerText: labelText }) as HTMLElement\r\n    const value = videojs.dom.createEl('span', { innerHTML: valueHTML }) as HTMLElement\r\n\r\n    root.appendChild(label)\r\n    root.appendChild(value)\r\n\r\n    return { root, value }\r\n  }\r\n\r\n  private timeRangesToString (r: videojs.TimeRange) {\r\n    let result = ''\r\n\r\n    for (let i = 0; i < r.length; i++) {\r\n      const start = Math.floor(r.start(i))\r\n      const end = Math.floor(r.end(i))\r\n\r\n      result += `[${secondsToTime(start)}, ${secondsToTime(end)}] `\r\n    }\r\n\r\n    return result\r\n  }\r\n}\r\n\r\nvideojs.registerComponent('StatsCard', StatsCard)\r\n\r\nexport {\r\n  StatsCard,\r\n  StatsCardOptions\r\n}\r\n","import videojs from 'video.js'\r\nimport { StatsCard, StatsCardOptions } from './stats-card'\r\n\r\nconst Plugin = videojs.getPlugin('plugin')\r\n\r\nclass StatsForNerdsPlugin extends Plugin {\r\n  private statsCard: StatsCard\r\n\r\n  constructor (player: videojs.Player, options: StatsCardOptions) {\r\n    const settings = {\r\n      ...options\r\n    }\r\n\r\n    super(player)\r\n\r\n    this.player.ready(() => {\r\n      player.addClass('vjs-stats-for-nerds')\r\n    })\r\n\r\n    this.statsCard = new StatsCard(player, options)\r\n\r\n    player.addChild(this.statsCard, settings)\r\n  }\r\n\r\n  show () {\r\n    this.statsCard.show()\r\n  }\r\n}\r\n\r\nvideojs.registerPlugin('stats', StatsForNerdsPlugin)\r\nexport { StatsForNerdsPlugin }\r\n","import videojs from 'video.js'\r\n\r\nfunction getMainTemplate (options: any) {\r\n  return `\r\n    <div class=\"vjs-upnext-top\">\r\n      <span class=\"vjs-upnext-headtext\">${options.headText}</span>\r\n      <div class=\"vjs-upnext-title\"></div>\r\n    </div>\r\n    <div class=\"vjs-upnext-autoplay-icon\">\r\n      <svg height=\"100%\" version=\"1.1\" viewbox=\"0 0 98 98\" width=\"100%\">\r\n        <circle class=\"vjs-upnext-svg-autoplay-circle\" cx=\"49\" cy=\"49\" fill=\"#000\" fill-opacity=\"0.8\" r=\"48\"></circle>\r\n        <circle class=\"vjs-upnext-svg-autoplay-ring\" cx=\"-49\" cy=\"49\" fill-opacity=\"0\" r=\"46.5\"\r\n                stroke=\"#FFFFFF\" stroke-width=\"4\" transform=\"rotate(-90)\"\r\n        ></circle>\r\n        <polygon class=\"vjs-upnext-svg-autoplay-triangle\" fill=\"#fff\" points=\"32,27 72,49 32,71\"></polygon></svg>\r\n    </div>\r\n    <span class=\"vjs-upnext-bottom\">\r\n      <span class=\"vjs-upnext-cancel\">\r\n        <button class=\"vjs-upnext-cancel-button\" tabindex=\"0\" aria-label=\"Cancel autoplay\">${options.cancelText}</button>\r\n      </span>\r\n      <span class=\"vjs-upnext-suspended\">${options.suspendedText}</span>\r\n    </span>\r\n  `\r\n}\r\n\r\nexport interface EndCardOptions extends videojs.ComponentOptions {\r\n  next: () => void\r\n  getTitle: () => string\r\n  timeout: number\r\n  cancelText: string\r\n  headText: string\r\n  suspendedText: string\r\n  condition: () => boolean\r\n  suspended: () => boolean\r\n}\r\n\r\nconst Component = videojs.getComponent('Component')\r\nclass EndCard extends Component {\r\n  options_: EndCardOptions\r\n\r\n  dashOffsetTotal = 586\r\n  dashOffsetStart = 293\r\n  interval = 50\r\n  upNextEvents = new videojs.EventTarget()\r\n  ticks = 0\r\n  totalTicks: number\r\n\r\n  container: HTMLDivElement\r\n  title: HTMLElement\r\n  autoplayRing: HTMLElement\r\n  cancelButton: HTMLElement\r\n  suspendedMessage: HTMLElement\r\n  nextButton: HTMLElement\r\n\r\n  constructor (player: videojs.Player, options: EndCardOptions) {\r\n    super(player, options)\r\n\r\n    this.totalTicks = this.options_.timeout / this.interval\r\n\r\n    player.on('ended', (_: any) => {\r\n      if (!this.options_.condition()) return\r\n\r\n      player.addClass('vjs-upnext--showing')\r\n      this.showCard((canceled: boolean) => {\r\n        player.removeClass('vjs-upnext--showing')\r\n        this.container.style.display = 'none'\r\n        if (!canceled) {\r\n          this.options_.next()\r\n        }\r\n      })\r\n    })\r\n\r\n    player.on('playing', () => {\r\n      this.upNextEvents.trigger('playing')\r\n    })\r\n  }\r\n\r\n  createEl () {\r\n    const container = super.createEl('div', {\r\n      className: 'vjs-upnext-content',\r\n      innerHTML: getMainTemplate(this.options_)\r\n    }) as HTMLDivElement\r\n\r\n    this.container = container\r\n    container.style.display = 'none'\r\n\r\n    this.autoplayRing = container.getElementsByClassName('vjs-upnext-svg-autoplay-ring')[0] as HTMLElement\r\n    this.title = container.getElementsByClassName('vjs-upnext-title')[0] as HTMLElement\r\n    this.cancelButton = container.getElementsByClassName('vjs-upnext-cancel-button')[0] as HTMLElement\r\n    this.suspendedMessage = container.getElementsByClassName('vjs-upnext-suspended')[0] as HTMLElement\r\n    this.nextButton = container.getElementsByClassName('vjs-upnext-autoplay-icon')[0] as HTMLElement\r\n\r\n    this.cancelButton.onclick = () => {\r\n      this.upNextEvents.trigger('cancel')\r\n    }\r\n\r\n    this.nextButton.onclick = () => {\r\n      this.upNextEvents.trigger('next')\r\n    }\r\n\r\n    return container\r\n  }\r\n\r\n  showCard (cb: (value: boolean) => void) {\r\n    let timeout: any\r\n\r\n    this.autoplayRing.setAttribute('stroke-dasharray', `${this.dashOffsetStart}`)\r\n    this.autoplayRing.setAttribute('stroke-dashoffset', `${-this.dashOffsetStart}`)\r\n\r\n    this.title.innerHTML = this.options_.getTitle()\r\n\r\n    this.upNextEvents.one('cancel', () => {\r\n      clearTimeout(timeout)\r\n      cb(true)\r\n    })\r\n\r\n    this.upNextEvents.one('playing', () => {\r\n      clearTimeout(timeout)\r\n      cb(true)\r\n    })\r\n\r\n    this.upNextEvents.one('next', () => {\r\n      clearTimeout(timeout)\r\n      cb(false)\r\n    })\r\n\r\n    const goToPercent = (percent: number) => {\r\n      const newOffset = Math.max(-this.dashOffsetTotal, -this.dashOffsetStart - percent * this.dashOffsetTotal / 2 / 100)\r\n      this.autoplayRing.setAttribute('stroke-dashoffset', '' + newOffset)\r\n    }\r\n\r\n    const tick = () => {\r\n      goToPercent((this.ticks++) * 100 / this.totalTicks)\r\n    }\r\n\r\n    const update = () => {\r\n      if (this.options_.suspended()) {\r\n        this.suspendedMessage.innerText = this.options_.suspendedText\r\n        goToPercent(0)\r\n        this.ticks = 0\r\n        timeout = setTimeout(update.bind(this), 300) // checks once supsended can be a bit longer\r\n      } else if (this.ticks >= this.totalTicks) {\r\n        clearTimeout(timeout)\r\n        cb(false)\r\n      } else {\r\n        this.suspendedMessage.innerText = ''\r\n        tick()\r\n        timeout = setTimeout(update.bind(this), this.interval)\r\n      }\r\n    }\r\n\r\n    this.container.style.display = 'block'\r\n    timeout = setTimeout(update.bind(this), this.interval)\r\n  }\r\n}\r\n\r\nvideojs.registerComponent('EndCard', EndCard)\r\n","import videojs from 'video.js'\r\nimport { EndCardOptions } from './end-card'\r\n\r\nconst Plugin = videojs.getPlugin('plugin')\r\n\r\nclass UpNextPlugin extends Plugin {\r\n\r\n  constructor (player: videojs.Player, options: Partial<EndCardOptions> = {}) {\r\n    const settings = {\r\n      next: options.next,\r\n      getTitle: options.getTitle,\r\n      timeout: options.timeout || 5000,\r\n      cancelText: options.cancelText || 'Cancel',\r\n      headText: options.headText || 'Up Next',\r\n      suspendedText: options.suspendedText || 'Autoplay is suspended',\r\n      condition: options.condition,\r\n      suspended: options.suspended\r\n    }\r\n\r\n    super(player)\r\n\r\n    this.player.ready(() => {\r\n      player.addClass('vjs-upnext')\r\n    })\r\n\r\n    player.addChild('EndCard', settings)\r\n  }\r\n}\r\n\r\nvideojs.registerPlugin('upnext', UpNextPlugin)\r\nexport { UpNextPlugin }\r\n","function isIOS () {\r\n  if (/iPad|iPhone|iPod/.test(navigator.platform)) {\r\n    return true\r\n  }\r\n\r\n  // Detect iPad Desktop mode\r\n  return !!(navigator.maxTouchPoints &&\r\n      navigator.maxTouchPoints > 2 &&\r\n      navigator.platform.includes('MacIntel'))\r\n}\r\n\r\nfunction isSafari () {\r\n  return /^((?!chrome|android).)*safari/i.test(navigator.userAgent)\r\n}\r\n\r\nfunction isMobile () {\r\n  return /iPhone|iPad|iPod|Android/i.test(navigator.userAgent)\r\n}\r\n\r\nexport {\r\n  isIOS,\r\n  isSafari,\r\n  isMobile\r\n}\r\n","module.exports = require('path-browserify')\r\n","import { AbusePredefinedReasons, AbusePredefinedReasonsString } from '../../models/moderation/abuse/abuse-reason.model'\r\n\r\nexport const abusePredefinedReasonsMap: {\r\n  [key in AbusePredefinedReasonsString]: AbusePredefinedReasons\r\n} = {\r\n  violentOrRepulsive: AbusePredefinedReasons.VIOLENT_OR_REPULSIVE,\r\n  hatefulOrAbusive: AbusePredefinedReasons.HATEFUL_OR_ABUSIVE,\r\n  spamOrMisleading: AbusePredefinedReasons.SPAM_OR_MISLEADING,\r\n  privacy: AbusePredefinedReasons.PRIVACY,\r\n  rights: AbusePredefinedReasons.RIGHTS,\r\n  serverRules: AbusePredefinedReasons.SERVER_RULES,\r\n  thumbnails: AbusePredefinedReasons.THUMBNAILS,\r\n  captions: AbusePredefinedReasons.CAPTIONS\r\n}\r\n","export * from './abuse-predefined-reasons'\r\n","function findCommonElement <T> (array1: T[], array2: T[]) {\r\n  for (const a of array1) {\r\n    for (const b of array2) {\r\n      if (a === b) return a\r\n    }\r\n  }\r\n\r\n  return null\r\n}\r\n\r\n// Avoid conflict with other toArray() functions\r\nfunction arrayify <T> (element: T | T[]) {\r\n  if (Array.isArray(element)) return element\r\n\r\n  return [ element ]\r\n}\r\n\r\nexport {\r\n  findCommonElement,\r\n  arrayify\r\n}\r\n","function isToday (d: Date) {\r\n  const today = new Date()\r\n\r\n  return areDatesEqual(d, today)\r\n}\r\n\r\nfunction isYesterday (d: Date) {\r\n  const yesterday = new Date()\r\n  yesterday.setDate(yesterday.getDate() - 1)\r\n\r\n  return areDatesEqual(d, yesterday)\r\n}\r\n\r\nfunction isThisWeek (d: Date) {\r\n  const minDateOfThisWeek = new Date()\r\n  minDateOfThisWeek.setHours(0, 0, 0)\r\n\r\n  // getDay() -> Sunday - Saturday : 0 - 6\r\n  // We want to start our week on Monday\r\n  let dayOfWeek = minDateOfThisWeek.getDay() - 1\r\n  if (dayOfWeek < 0) dayOfWeek = 6 // Sunday\r\n\r\n  minDateOfThisWeek.setDate(minDateOfThisWeek.getDate() - dayOfWeek)\r\n\r\n  return d >= minDateOfThisWeek\r\n}\r\n\r\nfunction isThisMonth (d: Date) {\r\n  const thisMonth = new Date().getMonth()\r\n\r\n  return d.getMonth() === thisMonth\r\n}\r\n\r\nfunction isLastMonth (d: Date) {\r\n  const now = new Date()\r\n\r\n  return getDaysDifferences(now, d) <= 30\r\n}\r\n\r\nfunction isLastWeek (d: Date) {\r\n  const now = new Date()\r\n\r\n  return getDaysDifferences(now, d) <= 7\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n\r\nfunction timeToInt (time: number | string) {\r\n  if (!time) return 0\r\n  if (typeof time === 'number') return time\r\n\r\n  const reg = /^((\\d+)[h:])?((\\d+)[m:])?((\\d+)s?)?$/\r\n  const matches = time.match(reg)\r\n\r\n  if (!matches) return 0\r\n\r\n  const hours = parseInt(matches[2] || '0', 10)\r\n  const minutes = parseInt(matches[4] || '0', 10)\r\n  const seconds = parseInt(matches[6] || '0', 10)\r\n\r\n  return hours * 3600 + minutes * 60 + seconds\r\n}\r\n\r\nfunction secondsToTime (seconds: number, full = false, symbol?: string) {\r\n  let time = ''\r\n\r\n  if (seconds === 0 && !full) return '0s'\r\n\r\n  const hourSymbol = (symbol || 'h')\r\n  const minuteSymbol = (symbol || 'm')\r\n  const secondsSymbol = full ? '' : 's'\r\n\r\n  const hours = Math.floor(seconds / 3600)\r\n  if (hours >= 1) time = hours + hourSymbol\r\n  else if (full) time = '0' + hourSymbol\r\n\r\n  seconds %= 3600\r\n  const minutes = Math.floor(seconds / 60)\r\n  if (minutes >= 1 && minutes < 10 && full) time += '0' + minutes + minuteSymbol\r\n  else if (minutes >= 1) time += minutes + minuteSymbol\r\n  else if (full) time += '00' + minuteSymbol\r\n\r\n  seconds %= 60\r\n  if (seconds >= 1 && seconds < 10 && full) time += '0' + seconds + secondsSymbol\r\n  else if (seconds >= 1) time += seconds + secondsSymbol\r\n  else if (full) time += '00'\r\n\r\n  return time\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n\r\nexport {\r\n  isYesterday,\r\n  isThisWeek,\r\n  isThisMonth,\r\n  isToday,\r\n  isLastMonth,\r\n  isLastWeek,\r\n  timeToInt,\r\n  secondsToTime\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n\r\nfunction areDatesEqual (d1: Date, d2: Date) {\r\n  return d1.getFullYear() === d2.getFullYear() &&\r\n    d1.getMonth() === d2.getMonth() &&\r\n    d1.getDate() === d2.getDate()\r\n}\r\n\r\nfunction getDaysDifferences (d1: Date, d2: Date) {\r\n  return (d1.getTime() - d2.getTime()) / (86400000)\r\n}\r\n","function parallelTests () {\r\n  return process.env.MOCHA_PARALLEL === 'true'\r\n}\r\n\r\nfunction isGithubCI () {\r\n  return !!process.env.GITHUB_WORKSPACE\r\n}\r\n\r\nfunction areHttpImportTestsDisabled () {\r\n  const disabled = process.env.DISABLE_HTTP_IMPORT_TESTS === 'true'\r\n\r\n  if (disabled) console.log('DISABLE_HTTP_IMPORT_TESTS env set to \"true\" so import tests are disabled')\r\n\r\n  return disabled\r\n}\r\n\r\nfunction areObjectStorageTestsDisabled () {\r\n  const disabled = process.env.ENABLE_OBJECT_STORAGE_TESTS !== 'true'\r\n\r\n  if (disabled) console.log('ENABLE_OBJECT_STORAGE_TESTS env is not set to \"true\" so object storage tests are disabled')\r\n\r\n  return disabled\r\n}\r\n\r\nexport {\r\n  parallelTests,\r\n  isGithubCI,\r\n  areHttpImportTestsDisabled,\r\n  areObjectStorageTestsDisabled\r\n}\r\n","export * from './array'\r\nexport * from './random'\r\nexport * from './date'\r\nexport * from './env'\r\nexport * from './object'\r\nexport * from './path'\r\nexport * from './regexp'\r\nexport * from './time'\r\nexport * from './promises'\r\nexport * from './url'\r\nexport * from './version'\r\n","function pick <O extends object, K extends keyof O> (object: O, keys: K[]): Pick<O, K> {\r\n  const result: any = {}\r\n\r\n  for (const key of keys) {\r\n    if (Object.prototype.hasOwnProperty.call(object, key)) {\r\n      result[key] = object[key]\r\n    }\r\n  }\r\n\r\n  return result\r\n}\r\n\r\nfunction getKeys <O extends object, K extends keyof O> (object: O, keys: K[]): K[] {\r\n  return (Object.keys(object) as K[]).filter(k => keys.includes(k))\r\n}\r\n\r\nfunction sortObjectComparator (key: string, order: 'asc' | 'desc') {\r\n  return (a: any, b: any) => {\r\n    if (a[key] < b[key]) {\r\n      return order === 'asc' ? -1 : 1\r\n    }\r\n\r\n    if (a[key] > b[key]) {\r\n      return order === 'asc' ? 1 : -1\r\n    }\r\n\r\n    return 0\r\n  }\r\n}\r\n\r\nexport {\r\n  pick,\r\n  getKeys,\r\n  sortObjectComparator\r\n}\r\n","import { basename, extname, isAbsolute, join, resolve } from 'path'\r\n\r\nlet rootPath: string\r\n\r\nfunction root () {\r\n  if (rootPath) return rootPath\r\n\r\n  rootPath = __dirname\r\n\r\n  if (basename(rootPath) === 'tools') rootPath = resolve(rootPath, '..')\r\n  if (basename(rootPath) === 'scripts') rootPath = resolve(rootPath, '..')\r\n  if (basename(rootPath) === 'common') rootPath = resolve(rootPath, '..')\r\n  if (basename(rootPath) === 'core-utils') rootPath = resolve(rootPath, '..')\r\n  if (basename(rootPath) === 'shared') rootPath = resolve(rootPath, '..')\r\n  if (basename(rootPath) === 'server') rootPath = resolve(rootPath, '..')\r\n  if (basename(rootPath) === 'dist') rootPath = resolve(rootPath, '..')\r\n\r\n  return rootPath\r\n}\r\n\r\nfunction buildPath (path: string) {\r\n  if (isAbsolute(path)) return path\r\n\r\n  return join(root(), path)\r\n}\r\n\r\nfunction getLowercaseExtension (filename: string) {\r\n  const ext = extname(filename) || ''\r\n\r\n  return ext.toLowerCase()\r\n}\r\n\r\nfunction buildAbsoluteFixturePath (path: string, customCIPath = false) {\r\n  if (isAbsolute(path)) return path\r\n\r\n  if (customCIPath && process.env.GITHUB_WORKSPACE) {\r\n    return join(process.env.GITHUB_WORKSPACE, 'fixtures', path)\r\n  }\r\n\r\n  return join(root(), 'server', 'tests', 'fixtures', path)\r\n}\r\n\r\nexport {\r\n  root,\r\n  buildPath,\r\n  buildAbsoluteFixturePath,\r\n  getLowercaseExtension\r\n}\r\n","// high excluded\r\nfunction randomInt (low: number, high: number) {\r\n  return Math.floor(Math.random() * (high - low) + low)\r\n}\r\n\r\nexport {\r\n  randomInt\r\n}\r\n","export const uuidRegex = '[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}'\r\n\r\nexport function removeFragmentedMP4Ext (path: string) {\r\n  return path.replace(/-fragmented.mp4$/i, '')\r\n}\r\n","function wait (milliseconds: number) {\r\n  return new Promise(resolve => setTimeout(resolve, milliseconds))\r\n}\r\n\r\nexport {\r\n  wait\r\n}\r\n","import { Video, VideoPlaylist } from '../../models'\r\nimport { secondsToTime } from './date'\r\n\r\nfunction buildPlaylistLink (playlist: Pick<VideoPlaylist, 'shortUUID'>, base?: string) {\r\n  return (base ?? window.location.origin) + buildPlaylistWatchPath(playlist)\r\n}\r\n\r\nfunction buildPlaylistWatchPath (playlist: Pick<VideoPlaylist, 'shortUUID'>) {\r\n  return '/w/p/' + playlist.shortUUID\r\n}\r\n\r\nfunction buildVideoWatchPath (video: Pick<Video, 'shortUUID'>) {\r\n  return '/w/' + video.shortUUID\r\n}\r\n\r\nfunction buildVideoLink (video: Pick<Video, 'shortUUID'>, base?: string) {\r\n  return (base ?? window.location.origin) + buildVideoWatchPath(video)\r\n}\r\n\r\nfunction buildPlaylistEmbedPath (playlist: Pick<VideoPlaylist, 'uuid'>) {\r\n  return '/video-playlists/embed/' + playlist.uuid\r\n}\r\n\r\nfunction buildPlaylistEmbedLink (playlist: Pick<VideoPlaylist, 'uuid'>, base?: string) {\r\n  return (base ?? window.location.origin) + buildPlaylistEmbedPath(playlist)\r\n}\r\n\r\nfunction buildVideoEmbedPath (video: Pick<Video, 'uuid'>) {\r\n  return '/videos/embed/' + video.uuid\r\n}\r\n\r\nfunction buildVideoEmbedLink (video: Pick<Video, 'uuid'>, base?: string) {\r\n  return (base ?? window.location.origin) + buildVideoEmbedPath(video)\r\n}\r\n\r\nfunction decorateVideoLink (options: {\r\n  url: string\r\n\r\n  startTime?: number\r\n  stopTime?: number\r\n\r\n  subtitle?: string\r\n\r\n  loop?: boolean\r\n  autoplay?: boolean\r\n  muted?: boolean\r\n\r\n  // Embed options\r\n  title?: boolean\r\n  warningTitle?: boolean\r\n\r\n  controls?: boolean\r\n  controlBar?: boolean\r\n\r\n  peertubeLink?: boolean\r\n  p2p?: boolean\r\n}) {\r\n  const { url } = options\r\n\r\n  const params = new URLSearchParams()\r\n\r\n  if (options.startTime !== undefined && options.startTime !== null) {\r\n    const startTimeInt = Math.floor(options.startTime)\r\n    params.set('start', secondsToTime(startTimeInt))\r\n  }\r\n\r\n  if (options.stopTime) {\r\n    const stopTimeInt = Math.floor(options.stopTime)\r\n    params.set('stop', secondsToTime(stopTimeInt))\r\n  }\r\n\r\n  if (options.subtitle) params.set('subtitle', options.subtitle)\r\n\r\n  if (options.loop === true) params.set('loop', '1')\r\n  if (options.autoplay === true) params.set('autoplay', '1')\r\n  if (options.muted === true) params.set('muted', '1')\r\n  if (options.title === false) params.set('title', '0')\r\n  if (options.warningTitle === false) params.set('warningTitle', '0')\r\n\r\n  if (options.controls === false) params.set('controls', '0')\r\n  if (options.controlBar === false) params.set('controlBar', '0')\r\n\r\n  if (options.peertubeLink === false) params.set('peertubeLink', '0')\r\n  if (options.p2p !== undefined) params.set('p2p', options.p2p ? '1' : '0')\r\n\r\n  return buildUrl(url, params)\r\n}\r\n\r\nfunction decoratePlaylistLink (options: {\r\n  url: string\r\n\r\n  playlistPosition?: number\r\n}) {\r\n  const { url } = options\r\n\r\n  const params = new URLSearchParams()\r\n\r\n  if (options.playlistPosition) params.set('playlistPosition', '' + options.playlistPosition)\r\n\r\n  return buildUrl(url, params)\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n\r\nexport {\r\n  buildPlaylistLink,\r\n  buildVideoLink,\r\n\r\n  buildVideoWatchPath,\r\n  buildPlaylistWatchPath,\r\n\r\n  buildPlaylistEmbedPath,\r\n  buildVideoEmbedPath,\r\n\r\n  buildPlaylistEmbedLink,\r\n  buildVideoEmbedLink,\r\n\r\n  decorateVideoLink,\r\n  decoratePlaylistLink\r\n}\r\n\r\nfunction buildUrl (url: string, params: URLSearchParams) {\r\n  let hasParams = false\r\n  params.forEach(() => { hasParams = true })\r\n\r\n  if (hasParams) return url + '?' + params.toString()\r\n\r\n  return url\r\n}\r\n","// Thanks https://stackoverflow.com/a/16187766\r\nfunction compareSemVer (a: string, b: string) {\r\n  const regExStrip0 = /(\\.0+)+$/\r\n  const segmentsA = a.replace(regExStrip0, '').split('.')\r\n  const segmentsB = b.replace(regExStrip0, '').split('.')\r\n\r\n  const l = Math.min(segmentsA.length, segmentsB.length)\r\n\r\n  for (let i = 0; i < l; i++) {\r\n    const diff = parseInt(segmentsA[i], 10) - parseInt(segmentsB[i], 10)\r\n\r\n    if (diff) return diff\r\n  }\r\n\r\n  return segmentsA.length - segmentsB.length\r\n}\r\n\r\nexport {\r\n  compareSemVer\r\n}\r\n","export const LOCALE_FILES = [ 'player', 'server' ]\r\n\r\nexport const I18N_LOCALES = {\r\n  // Always first to avoid issues when using express acceptLanguages function when no accept language header is set\r\n  'en-US': 'English',\r\n\r\n  'ar': 'العربية',\r\n  'ca-ES': 'Català',\r\n  'cs-CZ': 'Čeština',\r\n  'de-DE': 'Deutsch',\r\n  'el-GR': 'ελληνικά',\r\n  'eo': 'Esperanto',\r\n  'es-ES': 'Español',\r\n  'eu-ES': 'Euskara',\r\n  'fi-FI': 'suomi',\r\n  'fr-FR': 'Français',\r\n  'gd': 'Gàidhlig',\r\n  'gl-ES': 'galego',\r\n  'hr': 'hrvatski',\r\n  'hu-HU': 'magyar',\r\n  'fa-IR': 'فارسی',\r\n  'it-IT': 'Italiano',\r\n  'ja-JP': '日本語',\r\n  'kab': 'Taqbaylit',\r\n  'nl-NL': 'Nederlands',\r\n  'oc': 'Occitan',\r\n  'pl-PL': 'Polski',\r\n  'pt-BR': 'Português (Brasil)',\r\n  'pt-PT': 'Português (Portugal)',\r\n  'ru-RU': 'русский',\r\n  'sq': 'Shqip',\r\n  'sv-SE': 'Svenska',\r\n  'nn': 'norsk nynorsk',\r\n  'nb-NO': 'norsk bokmål',\r\n  'th-TH': 'ไทย',\r\n  'vi-VN': 'Tiếng Việt',\r\n  'tok': 'Toki Pona',\r\n  'zh-Hans-CN': '简体中文（中国）',\r\n  'zh-Hant-TW': '繁體中文（台灣）'\r\n}\r\n\r\nconst I18N_LOCALE_ALIAS = {\r\n  'ar-001': 'ar',\r\n  'ca': 'ca-ES',\r\n  'cs': 'cs-CZ',\r\n  'de': 'de-DE',\r\n  'el': 'el-GR',\r\n  'en': 'en-US',\r\n  'es': 'es-ES',\r\n  'eu': 'eu-ES',\r\n  'fi': 'fi-FI',\r\n  'gl': 'gl-ES',\r\n  'fa': 'fa-IR',\r\n  'fr': 'fr-FR',\r\n  'hu': 'hu-HU',\r\n  'it': 'it-IT',\r\n  'ja': 'ja-JP',\r\n  'nl': 'nl-NL',\r\n  'pl': 'pl-PL',\r\n  'pt': 'pt-BR',\r\n  'nb': 'nb-NO',\r\n  'ru': 'ru-RU',\r\n  'sv': 'sv-SE',\r\n  'th': 'th-TH',\r\n  'vi': 'vi-VN',\r\n  'zh-CN': 'zh-Hans-CN',\r\n  'zh-Hans': 'zh-Hans-CN',\r\n  'zh-Hant': 'zh-Hant-TW',\r\n  'zh-TW': 'zh-Hant-TW',\r\n  'zh': 'zh-Hans-CN'\r\n}\r\n\r\nexport const POSSIBLE_LOCALES = Object.keys(I18N_LOCALES)\r\n                                      .concat(Object.keys(I18N_LOCALE_ALIAS))\r\n\r\nexport function getDefaultLocale () {\r\n  return 'en-US'\r\n}\r\n\r\nexport function isDefaultLocale (locale: string) {\r\n  return getCompleteLocale(locale) === getCompleteLocale(getDefaultLocale())\r\n}\r\n\r\nexport function peertubeTranslate (str: string, translations?: { [ id: string ]: string }) {\r\n  if (!translations || !translations[str]) return str\r\n\r\n  return translations[str]\r\n}\r\n\r\nconst possiblePaths = POSSIBLE_LOCALES.map(l => '/' + l)\r\nexport function is18nPath (path: string) {\r\n  return possiblePaths.includes(path)\r\n}\r\n\r\nexport function is18nLocale (locale: string) {\r\n  return POSSIBLE_LOCALES.includes(locale)\r\n}\r\n\r\nexport function getCompleteLocale (locale: string) {\r\n  if (!locale) return locale\r\n\r\n  if (I18N_LOCALE_ALIAS[locale]) return I18N_LOCALE_ALIAS[locale]\r\n\r\n  return locale\r\n}\r\n\r\nexport function getShortLocale (locale: string) {\r\n  if (locale.includes('-') === false) return locale\r\n\r\n  return locale.split('-')[0]\r\n}\r\n\r\nexport function buildFileLocale (locale: string) {\r\n  return getCompleteLocale(locale)\r\n}\r\n","export * from './i18n'\r\n","export * from './abuse'\r\nexport * from './common'\r\nexport * from './i18n'\r\nexport * from './plugins'\r\nexport * from './renderer'\r\nexport * from './users'\r\nexport * from './videos'\r\n","export * from './hooks'\r\n","export function getDefaultSanitizeOptions () {\r\n  return {\r\n    allowedTags: [ 'a', 'p', 'span', 'br', 'strong', 'em', 'ul', 'ol', 'li' ],\r\n    allowedSchemes: [ 'http', 'https' ],\r\n    allowedAttributes: {\r\n      'a': [ 'href', 'class', 'target', 'rel' ],\r\n      '*': [ 'data-*' ]\r\n    },\r\n    transformTags: {\r\n      a: (tagName: string, attribs: any) => {\r\n        let rel = 'noopener noreferrer'\r\n        if (attribs.rel === 'me') rel += ' me'\r\n\r\n        return {\r\n          tagName,\r\n          attribs: Object.assign(attribs, {\r\n            target: '_blank',\r\n            rel\r\n          })\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport function getTextOnlySanitizeOptions () {\r\n  return {\r\n    allowedTags: [] as string[]\r\n  }\r\n}\r\n\r\nexport function getCustomMarkupSanitizeOptions (additionalAllowedTags: string[] = []) {\r\n  const base = getDefaultSanitizeOptions()\r\n\r\n  return {\r\n    allowedTags: [\r\n      ...base.allowedTags,\r\n      ...additionalAllowedTags,\r\n      'div', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'img'\r\n    ],\r\n    allowedSchemes: base.allowedSchemes,\r\n    allowedAttributes: {\r\n      ...base.allowedAttributes,\r\n\r\n      'img': [ 'src', 'alt' ],\r\n      '*': [ 'data-*', 'style' ]\r\n    }\r\n  }\r\n}\r\n\r\n// Thanks: https://stackoverflow.com/a/12034334\r\nexport function escapeHTML (stringParam: string) {\r\n  if (!stringParam) return ''\r\n\r\n  const entityMap = {\r\n    '&': '&amp;',\r\n    '<': '&lt;',\r\n    '>': '&gt;',\r\n    '\"': '&quot;',\r\n    '\\'': '&#39;',\r\n    '/': '&#x2F;',\r\n    '`': '&#x60;',\r\n    '=': '&#x3D;'\r\n  }\r\n\r\n  return String(stringParam).replace(/[&<>\"'`=/]/g, s => entityMap[s])\r\n}\r\n","export * from './markdown'\r\nexport * from './html'\r\n","export const TEXT_RULES = [\r\n  'linkify',\r\n  'autolink',\r\n  'emphasis',\r\n  'link',\r\n  'newline',\r\n  'entity',\r\n  'list'\r\n]\r\n\r\nexport const TEXT_WITH_HTML_RULES = TEXT_RULES.concat([\r\n  'html_inline',\r\n  'html_block'\r\n])\r\n\r\nexport const ENHANCED_RULES = TEXT_RULES.concat([ 'image' ])\r\nexport const ENHANCED_WITH_HTML_RULES = TEXT_WITH_HTML_RULES.concat([ 'image' ])\r\n\r\nexport const COMPLETE_RULES = ENHANCED_WITH_HTML_RULES.concat([\r\n  'block',\r\n  'inline',\r\n  'heading',\r\n  'paragraph'\r\n])\r\n","export * from './user-role'\r\n","import { UserRight, UserRole } from '../../models/users'\r\n\r\nexport const USER_ROLE_LABELS: { [ id in UserRole ]: string } = {\r\n  [UserRole.USER]: 'User',\r\n  [UserRole.MODERATOR]: 'Moderator',\r\n  [UserRole.ADMINISTRATOR]: 'Administrator'\r\n}\r\n\r\nconst userRoleRights: { [ id in UserRole ]: UserRight[] } = {\r\n  [UserRole.ADMINISTRATOR]: [\r\n    UserRight.ALL\r\n  ],\r\n\r\n  [UserRole.MODERATOR]: [\r\n    UserRight.MANAGE_VIDEO_BLACKLIST,\r\n    UserRight.MANAGE_ABUSES,\r\n    UserRight.MANAGE_ANY_VIDEO_CHANNEL,\r\n    UserRight.REMOVE_ANY_VIDEO,\r\n    UserRight.REMOVE_ANY_VIDEO_PLAYLIST,\r\n    UserRight.REMOVE_ANY_VIDEO_COMMENT,\r\n    UserRight.UPDATE_ANY_VIDEO,\r\n    UserRight.SEE_ALL_VIDEOS,\r\n    UserRight.MANAGE_ACCOUNTS_BLOCKLIST,\r\n    UserRight.MANAGE_SERVERS_BLOCKLIST,\r\n    UserRight.MANAGE_USERS,\r\n    UserRight.SEE_ALL_COMMENTS\r\n  ],\r\n\r\n  [UserRole.USER]: []\r\n}\r\n\r\nexport function hasUserRight (userRole: UserRole, userRight: UserRight) {\r\n  const userRights = userRoleRights[userRole]\r\n\r\n  return userRights.includes(UserRight.ALL) || userRights.includes(userRight)\r\n}\r\n","import { VideoResolution } from '@shared/models'\r\n\r\ntype BitPerPixel = { [ id in VideoResolution ]: number }\r\n\r\n// https://bitmovin.com/video-bitrate-streaming-hls-dash/\r\n\r\nconst minLimitBitPerPixel: BitPerPixel = {\r\n  [VideoResolution.H_NOVIDEO]: 0,\r\n  [VideoResolution.H_144P]: 0.02,\r\n  [VideoResolution.H_240P]: 0.02,\r\n  [VideoResolution.H_360P]: 0.02,\r\n  [VideoResolution.H_480P]: 0.02,\r\n  [VideoResolution.H_720P]: 0.02,\r\n  [VideoResolution.H_1080P]: 0.02,\r\n  [VideoResolution.H_1440P]: 0.02,\r\n  [VideoResolution.H_4K]: 0.02\r\n}\r\n\r\nconst averageBitPerPixel: BitPerPixel = {\r\n  [VideoResolution.H_NOVIDEO]: 0,\r\n  [VideoResolution.H_144P]: 0.19,\r\n  [VideoResolution.H_240P]: 0.17,\r\n  [VideoResolution.H_360P]: 0.15,\r\n  [VideoResolution.H_480P]: 0.12,\r\n  [VideoResolution.H_720P]: 0.11,\r\n  [VideoResolution.H_1080P]: 0.10,\r\n  [VideoResolution.H_1440P]: 0.09,\r\n  [VideoResolution.H_4K]: 0.08\r\n}\r\n\r\nconst maxBitPerPixel: BitPerPixel = {\r\n  [VideoResolution.H_NOVIDEO]: 0,\r\n  [VideoResolution.H_144P]: 0.32,\r\n  [VideoResolution.H_240P]: 0.29,\r\n  [VideoResolution.H_360P]: 0.26,\r\n  [VideoResolution.H_480P]: 0.22,\r\n  [VideoResolution.H_720P]: 0.19,\r\n  [VideoResolution.H_1080P]: 0.17,\r\n  [VideoResolution.H_1440P]: 0.16,\r\n  [VideoResolution.H_4K]: 0.14\r\n}\r\n\r\nfunction getAverageBitrate (options: {\r\n  resolution: VideoResolution\r\n  ratio: number\r\n  fps: number\r\n}) {\r\n  const targetBitrate = calculateBitrate({ ...options, bitPerPixel: averageBitPerPixel })\r\n  if (!targetBitrate) return 192 * 1000\r\n\r\n  return targetBitrate\r\n}\r\n\r\nfunction getMaxBitrate (options: {\r\n  resolution: VideoResolution\r\n  ratio: number\r\n  fps: number\r\n}) {\r\n  const targetBitrate = calculateBitrate({ ...options, bitPerPixel: maxBitPerPixel })\r\n  if (!targetBitrate) return 256 * 1000\r\n\r\n  return targetBitrate\r\n}\r\n\r\nfunction getMinLimitBitrate (options: {\r\n  resolution: VideoResolution\r\n  ratio: number\r\n  fps: number\r\n}) {\r\n  const minLimitBitrate = calculateBitrate({ ...options, bitPerPixel: minLimitBitPerPixel })\r\n  if (!minLimitBitrate) return 10 * 1000\r\n\r\n  return minLimitBitrate\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n\r\nexport {\r\n  getAverageBitrate,\r\n  getMaxBitrate,\r\n  getMinLimitBitrate\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n\r\nfunction calculateBitrate (options: {\r\n  bitPerPixel: BitPerPixel\r\n  resolution: VideoResolution\r\n  ratio: number\r\n  fps: number\r\n}) {\r\n  const { bitPerPixel, resolution, ratio, fps } = options\r\n\r\n  const resolutionsOrder = [\r\n    VideoResolution.H_4K,\r\n    VideoResolution.H_1440P,\r\n    VideoResolution.H_1080P,\r\n    VideoResolution.H_720P,\r\n    VideoResolution.H_480P,\r\n    VideoResolution.H_360P,\r\n    VideoResolution.H_240P,\r\n    VideoResolution.H_144P,\r\n    VideoResolution.H_NOVIDEO\r\n  ]\r\n\r\n  for (const toTestResolution of resolutionsOrder) {\r\n    if (toTestResolution <= resolution) {\r\n      return Math.floor(resolution * resolution * ratio * fps * bitPerPixel[toTestResolution])\r\n    }\r\n  }\r\n\r\n  throw new Error('Unknown resolution ' + resolution)\r\n}\r\n","export * from './bitrate'\r\nexport * from './privacy'\r\n","import { VideoPrivacy } from '../../models/videos/video-privacy.enum'\r\n\r\nfunction getAllPrivacies () {\r\n  return [ VideoPrivacy.PUBLIC, VideoPrivacy.INTERNAL, VideoPrivacy.PRIVATE, VideoPrivacy.UNLISTED ]\r\n}\r\n\r\nexport {\r\n  getAllPrivacies\r\n}\r\n"],"names":["newGUID","window","UPDATE_REFRESH_INTERVAL","bind","context","fn","uid","guid","bound","throttle","wait","last","performance","now","throttled","debounce","func","immediate","timeout","cancel","clearTimeout","debounced","self","args","arguments","later","apply","setTimeout","_initialGuid","_guid","resetGuidInTestsOnly"],"sourceRoot":""}