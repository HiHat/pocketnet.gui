{"version":3,"file":"vendors-node_modules_peertube_p2p-media-loader-hlsjs_dist_index_js.chunk.js?v=93","mappings":"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","sources":["webpack://peertube-client/./node_modules/@peertube/p2p-media-loader-core/dist/bandwidth-approximator.js","webpack://peertube-client/./node_modules/@peertube/p2p-media-loader-core/dist/http-media-manager.js","webpack://peertube-client/./node_modules/@peertube/p2p-media-loader-core/dist/hybrid-loader.js","webpack://peertube-client/./node_modules/@peertube/p2p-media-loader-core/dist/index.js","webpack://peertube-client/./node_modules/@peertube/p2p-media-loader-core/dist/loader-interface.js","webpack://peertube-client/./node_modules/@peertube/p2p-media-loader-core/dist/media-peer.js","webpack://peertube-client/./node_modules/@peertube/p2p-media-loader-core/dist/p2p-media-manager.js","webpack://peertube-client/./node_modules/@peertube/p2p-media-loader-core/dist/segments-memory-storage.js","webpack://peertube-client/./node_modules/@peertube/p2p-media-loader-core/dist/stringly-typed-event-emitter.js","webpack://peertube-client/./node_modules/@peertube/p2p-media-loader-hlsjs/dist/byte-range.js","webpack://peertube-client/./node_modules/@peertube/p2p-media-loader-hlsjs/dist/engine.js","webpack://peertube-client/./node_modules/@peertube/p2p-media-loader-hlsjs/dist/hlsjs-loader.js","webpack://peertube-client/./node_modules/@peertube/p2p-media-loader-hlsjs/dist/index.js","webpack://peertube-client/./node_modules/@peertube/p2p-media-loader-hlsjs/dist/segment-manager.js","webpack://peertube-client/./node_modules/@videojs/vhs-utils/es/decode-b64-to-uint8-array.js","webpack://peertube-client/./node_modules/@videojs/vhs-utils/es/stream.js","webpack://peertube-client/./node_modules/m3u8-parser/dist/m3u8-parser.es.js","webpack://peertube-client/./node_modules/sha.js/hash.js","webpack://peertube-client/./node_modules/sha.js/sha1.js","webpack://peertube-client/./node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js","webpack://peertube-client/./node_modules/@babel/runtime/helpers/esm/extends.js","webpack://peertube-client/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://peertube-client/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js"],"sourcesContent":["\"use strict\";\n/**\n * Copyright 2018 Novage LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.BandwidthApproximator = void 0;\nconst debug_1 = __importDefault(require(\"debug\"));\nconst debug = (0, debug_1.default)(\"p2pml:bandwidth-approximator\");\nconst SMOOTH_INTERVAL = 2 * 1000;\nconst MEASURE_INTERVAL = 40 * 1000;\nclass NumberWithTime {\n    constructor(value, timeStamp) {\n        this.value = value;\n        this.timeStamp = timeStamp;\n    }\n}\nclass BandwidthApproximator {\n    constructor() {\n        this.lastBytes = [];\n        this.currentBytesSum = 0;\n        this.lastBandwidth = [];\n        this.addBytes = (bytes, timeStamp) => {\n            debug(\"Add %d bytes.\", bytes);\n            this.lastBytes.push(new NumberWithTime(bytes, timeStamp));\n            this.currentBytesSum += bytes;\n            while (timeStamp - this.lastBytes[0].timeStamp > SMOOTH_INTERVAL) {\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                this.currentBytesSum -= this.lastBytes.shift().value;\n            }\n            const interval = Math.min(SMOOTH_INTERVAL, timeStamp);\n            this.lastBandwidth.push(new NumberWithTime(this.currentBytesSum / interval, timeStamp));\n        };\n        // in bytes per millisecond\n        this.getBandwidth = (timeStamp) => {\n            while (this.lastBandwidth.length !== 0 && timeStamp - this.lastBandwidth[0].timeStamp > MEASURE_INTERVAL) {\n                this.lastBandwidth.shift();\n            }\n            let maxBandwidth = 0;\n            for (const bandwidth of this.lastBandwidth) {\n                if (bandwidth.value > maxBandwidth) {\n                    maxBandwidth = bandwidth.value;\n                }\n            }\n            debug(\"Max bandwidth: %d.\", maxBandwidth);\n            return maxBandwidth;\n        };\n        this.getSmoothInterval = () => {\n            return SMOOTH_INTERVAL;\n        };\n        this.getMeasureInterval = () => {\n            return MEASURE_INTERVAL;\n        };\n    }\n}\nexports.BandwidthApproximator = BandwidthApproximator;\n","\"use strict\";\n/**\n * Copyright 2018 Novage LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.HttpMediaManager = void 0;\nconst debug_1 = __importDefault(require(\"debug\"));\nconst stringly_typed_event_emitter_1 = require(\"./stringly-typed-event-emitter\");\nclass FilteredEmitter extends stringly_typed_event_emitter_1.STEEmitter {\n}\nclass HttpMediaManager extends FilteredEmitter {\n    constructor(settings) {\n        super();\n        this.settings = settings;\n        this.xhrRequests = new Map();\n        this.failedSegments = new Map();\n        this.debug = (0, debug_1.default)(\"p2pml:http-media-manager\");\n        this.download = (segment, downloadedPieces) => {\n            if (this.isDownloading(segment)) {\n                return;\n            }\n            this.cleanTimedOutFailedSegments();\n            this.emit(\"segment-start-load\", segment);\n            const segmentUrl = segment.priority <= this.settings.skipSegmentBuilderPriority\n                ? segment.url\n                : this.buildSegmentUrl(segment);\n            this.debug(\"http segment download\", segmentUrl);\n            segment.requestUrl = segmentUrl;\n            const xhr = new XMLHttpRequest();\n            xhr.open(\"GET\", segmentUrl, true);\n            xhr.responseType = \"arraybuffer\";\n            if (segment.range) {\n                xhr.setRequestHeader(\"Range\", segment.range);\n                downloadedPieces = undefined; // TODO: process downloadedPieces for segments with range headers too\n            }\n            else if (downloadedPieces !== undefined && this.settings.httpUseRanges) {\n                let bytesDownloaded = 0;\n                for (const piece of downloadedPieces) {\n                    bytesDownloaded += piece.byteLength;\n                }\n                xhr.setRequestHeader(\"Range\", `bytes=${bytesDownloaded}-`);\n                this.debug(\"continue download from\", bytesDownloaded);\n            }\n            else {\n                downloadedPieces = undefined;\n            }\n            this.setupXhrEvents(xhr, segment, downloadedPieces);\n            if (this.settings.xhrSetup) {\n                this.settings.xhrSetup(xhr, segmentUrl);\n            }\n            this.xhrRequests.set(segment.id, { xhr, segment, initialPriority: segment.priority, segmentUrl });\n            xhr.send();\n        };\n        this.updatePriority = (segment) => {\n            const request = this.xhrRequests.get(segment.id);\n            if (!request) {\n                throw new Error(\"Cannot update priority of not downloaded segment \" + segment.id);\n            }\n            // Segment is now in high priority\n            // If the segment URL changed, retry the request with the new URL\n            if (segment.priority <= this.settings.skipSegmentBuilderPriority &&\n                request.initialPriority > this.settings.skipSegmentBuilderPriority &&\n                request.segmentUrl !== segment.url) {\n                this.debug(\"aborting http segment because the segment is now in a high priority\", segment.id);\n                this.abort(segment);\n                this.download(segment);\n            }\n        };\n        this.abort = (segment) => {\n            const request = this.xhrRequests.get(segment.id);\n            if (request) {\n                request.xhr.abort();\n                this.xhrRequests.delete(segment.id);\n                this.debug(\"http segment abort\", segment.id);\n            }\n        };\n        this.isDownloading = (segment) => {\n            return this.xhrRequests.has(segment.id);\n        };\n        this.isFailed = (segment) => {\n            const time = this.failedSegments.get(segment.id);\n            return time !== undefined && time > this.now();\n        };\n        this.getActiveDownloads = () => {\n            return this.xhrRequests;\n        };\n        this.getActiveDownloadsCount = () => {\n            return this.xhrRequests.size;\n        };\n        this.destroy = () => {\n            this.xhrRequests.forEach((request) => request.xhr.abort());\n            this.xhrRequests.clear();\n        };\n        this.setupXhrEvents = (xhr, segment, downloadedPieces) => {\n            let prevBytesLoaded = 0;\n            xhr.addEventListener(\"progress\", (event) => {\n                const bytesLoaded = event.loaded - prevBytesLoaded;\n                this.emit(\"bytes-downloaded\", segment, bytesLoaded);\n                prevBytesLoaded = event.loaded;\n                if (event.lengthComputable) {\n                    this.emit(\"segment-size\", segment, event.total);\n                }\n            });\n            xhr.addEventListener(\"load\", async (event) => {\n                if (xhr.status < 200 || xhr.status >= 300) {\n                    this.segmentFailure(segment, event, xhr);\n                    return;\n                }\n                let data = xhr.response;\n                if (downloadedPieces !== undefined && xhr.status === 206) {\n                    let bytesDownloaded = 0;\n                    for (const piece of downloadedPieces) {\n                        bytesDownloaded += piece.byteLength;\n                    }\n                    const segmentData = new Uint8Array(bytesDownloaded + data.byteLength);\n                    let offset = 0;\n                    for (const piece of downloadedPieces) {\n                        segmentData.set(new Uint8Array(piece), offset);\n                        offset += piece.byteLength;\n                    }\n                    segmentData.set(new Uint8Array(data), offset);\n                    data = segmentData.buffer;\n                }\n                await this.segmentDownloadFinished(segment, data, xhr);\n            });\n            xhr.addEventListener(\"error\", (event) => {\n                this.segmentFailure(segment, event, xhr);\n            });\n            xhr.addEventListener(\"timeout\", (event) => {\n                this.segmentFailure(segment, event, xhr);\n            });\n        };\n        this.segmentDownloadFinished = async (segment, data, xhr) => {\n            segment.responseUrl = xhr.responseURL === null ? undefined : xhr.responseURL;\n            if (this.settings.segmentValidator) {\n                try {\n                    await this.settings.segmentValidator(Object.assign(Object.assign({}, segment), { data: data }), \"http\");\n                }\n                catch (error) {\n                    this.debug(\"segment validator failed\", error);\n                    this.segmentFailure(segment, error, xhr);\n                    return;\n                }\n            }\n            this.xhrRequests.delete(segment.id);\n            this.emit(\"segment-loaded\", segment, data);\n        };\n        this.segmentFailure = (segment, error, xhr) => {\n            segment.responseUrl = xhr.responseURL === null ? undefined : xhr.responseURL;\n            this.xhrRequests.delete(segment.id);\n            this.failedSegments.set(segment.id, this.now() + this.settings.httpFailedSegmentTimeout);\n            this.emit(\"segment-error\", segment, error);\n        };\n        this.cleanTimedOutFailedSegments = () => {\n            const now = this.now();\n            const candidates = [];\n            this.failedSegments.forEach((time, id) => {\n                if (time < now) {\n                    candidates.push(id);\n                }\n            });\n            candidates.forEach((id) => this.failedSegments.delete(id));\n        };\n        this.now = () => performance.now();\n    }\n    buildSegmentUrl(segment) {\n        if (this.settings.segmentUrlBuilder) {\n            return this.settings.segmentUrlBuilder(segment);\n        }\n        return segment.url;\n    }\n}\nexports.HttpMediaManager = HttpMediaManager;\n","\"use strict\";\n/**\n * Copyright 2018 Novage LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.HybridLoader = void 0;\nconst debug_1 = __importDefault(require(\"debug\"));\nconst events_1 = require(\"events\");\nconst simple_peer_1 = __importDefault(require(\"simple-peer\"));\nconst loader_interface_1 = require(\"./loader-interface\");\nconst http_media_manager_1 = require(\"./http-media-manager\");\nconst p2p_media_manager_1 = require(\"./p2p-media-manager\");\nconst media_peer_1 = require(\"./media-peer\");\nconst bandwidth_approximator_1 = require(\"./bandwidth-approximator\");\nconst segments_memory_storage_1 = require(\"./segments-memory-storage\");\nconst defaultSettings = {\n    cachedSegmentExpiration: 5 * 60 * 1000,\n    cachedSegmentsCount: 30,\n    useP2P: true,\n    consumeOnly: false,\n    requiredSegmentsPriority: 1,\n    skipSegmentBuilderPriority: 1,\n    simultaneousHttpDownloads: 2,\n    httpDownloadProbability: 0.1,\n    httpDownloadProbabilityInterval: 1000,\n    httpDownloadProbabilitySkipIfNoPeers: false,\n    httpFailedSegmentTimeout: 10000,\n    httpDownloadMaxPriority: 20,\n    httpDownloadInitialTimeout: 0,\n    httpDownloadInitialTimeoutPerSegment: 4000,\n    httpUseRanges: false,\n    simultaneousP2PDownloads: 3,\n    p2pDownloadMaxPriority: 20,\n    p2pSegmentDownloadTimeout: 60000,\n    webRtcMaxMessageSize: 64 * 1024 - 1,\n    trackerAnnounce: [\"wss://tracker.novage.com.ua\", \"wss://tracker.openwebtorrent.com\"],\n    peerRequestsPerAnnounce: 10,\n    rtcConfig: simple_peer_1.default.config,\n};\nclass HybridLoader extends events_1.EventEmitter {\n    constructor(settings = {}) {\n        super();\n        this.debug = (0, debug_1.default)(\"p2pml:hybrid-loader\");\n        this.debugSegments = (0, debug_1.default)(\"p2pml:hybrid-loader-segments\");\n        this.segmentsQueue = [];\n        this.bandwidthApproximator = new bandwidth_approximator_1.BandwidthApproximator();\n        this.httpDownloadInitialTimeoutTimestamp = -Infinity;\n        this.createHttpManager = () => {\n            return new http_media_manager_1.HttpMediaManager(this.settings);\n        };\n        this.createP2PManager = () => {\n            return new p2p_media_manager_1.P2PMediaManager(this.segmentsStorage, this.settings);\n        };\n        this.load = async (segments, streamSwarmId) => {\n            this.initRandomDownloadIntervalIfNeeded();\n            if (segments.length > 0) {\n                this.masterSwarmId = segments[0].masterSwarmId;\n            }\n            if (this.masterSwarmId !== undefined) {\n                this.p2pManager.setStreamSwarmId(streamSwarmId, this.masterSwarmId);\n            }\n            this.debug(\"load segments\");\n            // stop all http requests and p2p downloads for segments that are not in the new load\n            let updateSegmentsMap = this.abortUnknownSegments(segments);\n            if (this.debug.enabled) {\n                for (const segment of segments) {\n                    if (!this.segmentsQueue.find((f) => f.id === segment.id)) {\n                        this.debug(\"add segment\", segment.id);\n                    }\n                }\n            }\n            this.segmentsQueue = segments;\n            if (this.masterSwarmId === undefined) {\n                return;\n            }\n            let storageSegments = await this.segmentsStorage.getSegmentsMap(this.masterSwarmId);\n            updateSegmentsMap = this.processSegmentsQueue(storageSegments) || updateSegmentsMap;\n            if (await this.cleanSegmentsStorage()) {\n                storageSegments = await this.segmentsStorage.getSegmentsMap(this.masterSwarmId);\n                updateSegmentsMap = true;\n            }\n            if (updateSegmentsMap && !this.settings.consumeOnly) {\n                this.p2pManager.sendSegmentsMapToAll(this.createSegmentsMap(storageSegments));\n            }\n        };\n        this.getSegment = async (id) => {\n            return this.masterSwarmId === undefined ? undefined : this.segmentsStorage.getSegment(id, this.masterSwarmId);\n        };\n        this.getSettings = () => {\n            return this.settings;\n        };\n        this.getDetails = () => {\n            return {\n                peerId: this.p2pManager.getPeerId(),\n            };\n        };\n        this.getBandwidthEstimate = () => {\n            return this.bandwidthApproximator.getBandwidth(this.now());\n        };\n        this.destroy = async () => {\n            if (this.httpRandomDownloadInterval !== undefined) {\n                clearInterval(this.httpRandomDownloadInterval);\n                this.httpRandomDownloadInterval = undefined;\n            }\n            this.httpDownloadInitialTimeoutTimestamp = -Infinity;\n            this.segmentsQueue = [];\n            this.httpManager.destroy();\n            this.p2pManager.destroy();\n            this.masterSwarmId = undefined;\n            await this.segmentsStorage.destroy();\n        };\n        this.processInitialSegmentTimeout = async () => {\n            if (this.httpRandomDownloadInterval === undefined) {\n                return; // Instance destroyed\n            }\n            if (this.masterSwarmId !== undefined) {\n                const storageSegments = await this.segmentsStorage.getSegmentsMap(this.masterSwarmId);\n                if (this.processSegmentsQueue(storageSegments) && !this.settings.consumeOnly) {\n                    this.p2pManager.sendSegmentsMapToAll(this.createSegmentsMap(storageSegments));\n                }\n            }\n            if (this.httpDownloadInitialTimeoutTimestamp !== -Infinity) {\n                // Set one more timeout for a next segment\n                setTimeout(this.processInitialSegmentTimeout, this.settings.httpDownloadInitialTimeoutPerSegment);\n            }\n        };\n        this.processSegmentsQueue = (storageSegments) => {\n            const currentPriority = this.segmentsQueue.length > 0 ? this.segmentsQueue[0].priority : 0;\n            this.debugSegments(`process segments queue. priority: ${currentPriority}, queue length: ${this.segmentsQueue.length}`);\n            if (this.masterSwarmId === undefined || this.segmentsQueue.length === 0) {\n                return false;\n            }\n            let updateSegmentsMap = false;\n            let segmentsMap;\n            let httpAllowed = true;\n            if (this.httpDownloadInitialTimeoutTimestamp !== -Infinity) {\n                let firstNotDownloadePriority;\n                for (const segment of this.segmentsQueue) {\n                    if (!storageSegments.has(segment.id)) {\n                        firstNotDownloadePriority = segment.priority;\n                        break;\n                    }\n                }\n                const httpTimeout = this.now() - this.httpDownloadInitialTimeoutTimestamp;\n                httpAllowed =\n                    httpTimeout >= this.settings.httpDownloadInitialTimeout ||\n                        (firstNotDownloadePriority !== undefined &&\n                            httpTimeout > this.settings.httpDownloadInitialTimeoutPerSegment &&\n                            firstNotDownloadePriority <= 0);\n                if (httpAllowed) {\n                    this.debugSegments(\"cancel initial HTTP download timeout - timed out\");\n                    this.httpDownloadInitialTimeoutTimestamp = -Infinity;\n                }\n            }\n            let scheduleNewProcessQueue = false;\n            for (let index = 0; index < this.segmentsQueue.length; index++) {\n                const segment = this.segmentsQueue[index];\n                if (storageSegments.has(segment.id)) {\n                    continue;\n                }\n                // Segment priority changed, notify http manager\n                if (this.httpManager.isDownloading(segment)) {\n                    this.httpManager.updatePriority(segment);\n                    continue;\n                }\n                const tryHTTP = httpAllowed && segment.priority <= this.settings.requiredSegmentsPriority;\n                if (tryHTTP && !this.httpManager.isFailed(segment)) {\n                    // Download required segments over HTTP\n                    if (this.httpManager.getActiveDownloadsCount() >= this.settings.simultaneousHttpDownloads) {\n                        // Not enough HTTP download resources. Abort one of the HTTP downloads.\n                        for (let i = this.segmentsQueue.length - 1; i > index; i--) {\n                            const segmentToAbort = this.segmentsQueue[i];\n                            if (this.httpManager.isDownloading(segmentToAbort)) {\n                                this.debugSegments(\"cancel HTTP download\", segmentToAbort.priority, segmentToAbort.id);\n                                this.httpManager.abort(segmentToAbort);\n                                break;\n                            }\n                        }\n                    }\n                    if (this.httpManager.getActiveDownloadsCount() < this.settings.simultaneousHttpDownloads) {\n                        // Abort P2P download of the required segment if any and force HTTP download\n                        const downloadedPieces = this.p2pManager.abort(segment);\n                        this.httpManager.download(segment, downloadedPieces);\n                        this.debugSegments(\"HTTP download (priority)\", segment.priority, segment.id);\n                        updateSegmentsMap = true;\n                        continue;\n                    }\n                }\n                // We wanted to download a failed segment through HTTP, but we could not because of the timeout.\n                // Then we need to schedule another processing queue task\n                if (tryHTTP && this.httpManager.isFailed(segment)) {\n                    scheduleNewProcessQueue = true;\n                }\n                if (this.p2pManager.isDownloading(segment)) {\n                    continue;\n                }\n                if (segment.priority <= this.settings.requiredSegmentsPriority) {\n                    // Download required segments over P2P\n                    segmentsMap = segmentsMap ? segmentsMap : this.p2pManager.getOverallSegmentsMap();\n                    if (segmentsMap.get(segment.id) !== media_peer_1.MediaPeerSegmentStatus.Loaded) {\n                        continue;\n                    }\n                    if (this.p2pManager.getActiveDownloadsCount() >= this.settings.simultaneousP2PDownloads) {\n                        // Not enough P2P download resources. Abort one of the P2P downloads.\n                        for (let i = this.segmentsQueue.length - 1; i > index; i--) {\n                            const segmentToAbort = this.segmentsQueue[i];\n                            if (this.p2pManager.isDownloading(segmentToAbort)) {\n                                this.debugSegments(\"cancel P2P download\", segmentToAbort.priority, segmentToAbort.id);\n                                this.p2pManager.abort(segmentToAbort);\n                                break;\n                            }\n                        }\n                    }\n                    if (this.p2pManager.getActiveDownloadsCount() < this.settings.simultaneousP2PDownloads) {\n                        if (this.p2pManager.download(segment)) {\n                            this.debugSegments(\"P2P download (priority)\", segment.priority, segment.id);\n                            continue;\n                        }\n                    }\n                    continue;\n                }\n                if (this.p2pManager.getActiveDownloadsCount() < this.settings.simultaneousP2PDownloads &&\n                    segment.priority <= this.settings.p2pDownloadMaxPriority) {\n                    if (this.p2pManager.download(segment)) {\n                        this.debugSegments(\"P2P download\", segment.priority, segment.id);\n                    }\n                }\n            }\n            if (scheduleNewProcessQueue) {\n                setTimeout(async () => {\n                    if (this.masterSwarmId === undefined)\n                        return;\n                    const storageSegments = await this.segmentsStorage.getSegmentsMap(this.masterSwarmId);\n                    this.processSegmentsQueue(storageSegments);\n                }, this.settings.httpFailedSegmentTimeout);\n            }\n            return updateSegmentsMap;\n        };\n        this.downloadRandomSegmentOverHttp = async () => {\n            if (this.masterSwarmId === undefined ||\n                this.httpRandomDownloadInterval === undefined ||\n                this.httpDownloadInitialTimeoutTimestamp !== -Infinity ||\n                this.httpManager.getActiveDownloadsCount() >= this.settings.simultaneousHttpDownloads ||\n                (this.settings.httpDownloadProbabilitySkipIfNoPeers && this.p2pManager.getPeers().size === 0) ||\n                this.settings.consumeOnly) {\n                return;\n            }\n            const storageSegments = await this.segmentsStorage.getSegmentsMap(this.masterSwarmId);\n            const segmentsMap = this.p2pManager.getOverallSegmentsMap();\n            const pendingQueue = this.segmentsQueue.filter((s) => !this.p2pManager.isDownloading(s) &&\n                !this.httpManager.isDownloading(s) &&\n                !segmentsMap.has(s.id) &&\n                !this.httpManager.isFailed(s) &&\n                s.priority <= this.settings.httpDownloadMaxPriority &&\n                !storageSegments.has(s.id));\n            if (pendingQueue.length === 0) {\n                return;\n            }\n            if (Math.random() > this.settings.httpDownloadProbability * pendingQueue.length) {\n                return;\n            }\n            const segment = pendingQueue[Math.floor(Math.random() * pendingQueue.length)];\n            this.debugSegments(\"HTTP download (random)\", segment.priority, segment.id);\n            this.httpManager.download(segment);\n            this.p2pManager.sendSegmentsMapToAll(this.createSegmentsMap(storageSegments));\n        };\n        this.onSegmentStartLoad = (method, segment) => {\n            this.emit(loader_interface_1.Events.SegmentStartLoad, method, segment);\n        };\n        this.onPieceBytesDownloaded = (method, segment, bytes, peerId) => {\n            this.bandwidthApproximator.addBytes(bytes, this.now());\n            this.emit(loader_interface_1.Events.PieceBytesDownloaded, method, segment, bytes, peerId);\n        };\n        this.onPieceBytesUploaded = (method, segment, bytes, peerId) => {\n            this.emit(loader_interface_1.Events.PieceBytesUploaded, method, segment, bytes, peerId);\n        };\n        this.onSegmentLoaded = async (segment, data, peerId) => {\n            this.debugSegments(\"segment loaded\", segment.id, segment.id);\n            if (this.masterSwarmId === undefined) {\n                return;\n            }\n            segment.data = data;\n            segment.downloadBandwidth = this.bandwidthApproximator.getBandwidth(this.now());\n            await this.segmentsStorage.storeSegment(segment);\n            this.emit(loader_interface_1.Events.SegmentLoaded, segment, peerId);\n            const storageSegments = await this.segmentsStorage.getSegmentsMap(this.masterSwarmId);\n            this.processSegmentsQueue(storageSegments);\n            if (!this.settings.consumeOnly) {\n                this.p2pManager.sendSegmentsMapToAll(this.createSegmentsMap(storageSegments));\n            }\n        };\n        this.onSegmentError = async (segment, details, peerId) => {\n            this.debugSegments(\"segment error\", segment.id, segment.id, peerId, details);\n            this.emit(loader_interface_1.Events.SegmentError, segment, details, peerId);\n            if (this.masterSwarmId !== undefined) {\n                const storageSegments = await this.segmentsStorage.getSegmentsMap(this.masterSwarmId);\n                if (this.processSegmentsQueue(storageSegments) && !this.settings.consumeOnly) {\n                    this.p2pManager.sendSegmentsMapToAll(this.createSegmentsMap(storageSegments));\n                }\n            }\n        };\n        this.onSegmentSize = async (segment, size) => {\n            this.debugSegments(\"segment size\", segment.id, size);\n            this.emit(loader_interface_1.Events.SegmentSize, segment, size);\n        };\n        this.getStreamSwarmId = (segment) => {\n            return segment.streamId === undefined ? segment.masterSwarmId : `${segment.masterSwarmId}+${segment.streamId}`;\n        };\n        this.createSegmentsMap = (storageSegments) => {\n            const segmentsMap = {};\n            const addSegmentToMap = (segment, status) => {\n                const streamSwarmId = this.getStreamSwarmId(segment);\n                const segmentId = segment.sequence;\n                let segmentsIdsAndStatuses = segmentsMap[streamSwarmId];\n                if (segmentsIdsAndStatuses === undefined) {\n                    segmentsIdsAndStatuses = [\"\", []];\n                    segmentsMap[streamSwarmId] = segmentsIdsAndStatuses;\n                }\n                const segmentsStatuses = segmentsIdsAndStatuses[1];\n                segmentsIdsAndStatuses[0] += segmentsStatuses.length === 0 ? segmentId : `|${segmentId}`;\n                segmentsStatuses.push(status);\n            };\n            for (const storageSegment of storageSegments.values()) {\n                addSegmentToMap(storageSegment.segment, media_peer_1.MediaPeerSegmentStatus.Loaded);\n            }\n            for (const download of this.httpManager.getActiveDownloads().values()) {\n                addSegmentToMap(download.segment, media_peer_1.MediaPeerSegmentStatus.LoadingByHttp);\n            }\n            return segmentsMap;\n        };\n        this.onPeerConnect = async (peer) => {\n            this.emit(loader_interface_1.Events.PeerConnect, peer);\n            if (!this.settings.consumeOnly && this.masterSwarmId !== undefined) {\n                this.p2pManager.sendSegmentsMap(peer.id, this.createSegmentsMap(await this.segmentsStorage.getSegmentsMap(this.masterSwarmId)));\n            }\n        };\n        this.onPeerClose = (peerId) => {\n            this.emit(loader_interface_1.Events.PeerClose, peerId);\n        };\n        this.onTrackerUpdate = async (data) => {\n            if (this.httpDownloadInitialTimeoutTimestamp !== -Infinity &&\n                data.incomplete !== undefined &&\n                data.incomplete <= 1) {\n                this.debugSegments(\"cancel initial HTTP download timeout - no peers\");\n                this.httpDownloadInitialTimeoutTimestamp = -Infinity;\n                if (this.masterSwarmId !== undefined) {\n                    const storageSegments = await this.segmentsStorage.getSegmentsMap(this.masterSwarmId);\n                    if (this.processSegmentsQueue(storageSegments) && !this.settings.consumeOnly) {\n                        this.p2pManager.sendSegmentsMapToAll(this.createSegmentsMap(storageSegments));\n                    }\n                }\n            }\n        };\n        this.cleanSegmentsStorage = async () => {\n            if (this.masterSwarmId === undefined) {\n                return false;\n            }\n            return this.segmentsStorage.clean(this.masterSwarmId, (id) => this.segmentsQueue.find((queueSegment) => queueSegment.id === id) !== undefined);\n        };\n        this.now = () => {\n            return performance.now();\n        };\n        this.initRandomDownloadIntervalIfNeeded = () => {\n            if (this.httpRandomDownloadInterval !== undefined)\n                return;\n            // Do once on first call\n            this.httpRandomDownloadInterval = setInterval(this.downloadRandomSegmentOverHttp, this.settings.httpDownloadProbabilityInterval);\n            if (this.settings.httpDownloadInitialTimeout > 0 &&\n                this.settings.httpDownloadInitialTimeoutPerSegment > 0) {\n                // Initialize initial HTTP download timeout (i.e. download initial segments over P2P)\n                this.debugSegments(\"enable initial HTTP download timeout\", this.settings.httpDownloadInitialTimeout, \"per segment\", this.settings.httpDownloadInitialTimeoutPerSegment);\n                this.httpDownloadInitialTimeoutTimestamp = this.now();\n                setTimeout(this.processInitialSegmentTimeout, this.settings.httpDownloadInitialTimeoutPerSegment + 100);\n            }\n        };\n        this.abortUnknownSegments = (segments) => {\n            let updateSegmentsMap = false;\n            for (const segment of this.segmentsQueue) {\n                if (!segments.find((f) => f.id === segment.id)) {\n                    this.debug(\"remove segment\", segment.id);\n                    if (this.httpManager.isDownloading(segment)) {\n                        updateSegmentsMap = true;\n                        this.httpManager.abort(segment);\n                    }\n                    else {\n                        this.p2pManager.abort(segment);\n                    }\n                    this.emit(loader_interface_1.Events.SegmentAbort, segment);\n                }\n            }\n            return updateSegmentsMap;\n        };\n        this.settings = Object.assign(Object.assign({}, defaultSettings), settings);\n        const { bufferedSegmentsCount } = settings;\n        if (typeof bufferedSegmentsCount === \"number\") {\n            if (settings.p2pDownloadMaxPriority === undefined) {\n                this.settings.p2pDownloadMaxPriority = bufferedSegmentsCount;\n            }\n            if (settings.httpDownloadMaxPriority === undefined) {\n                this.settings.p2pDownloadMaxPriority = bufferedSegmentsCount;\n            }\n        }\n        this.segmentsStorage =\n            this.settings.segmentsStorage === undefined\n                ? new segments_memory_storage_1.SegmentsMemoryStorage(this.settings)\n                : this.settings.segmentsStorage;\n        this.debug(\"loader settings\", this.settings);\n        this.httpManager = this.createHttpManager();\n        this.httpManager.on(\"segment-start-load\", (segment) => this.onSegmentStartLoad(\"http\", segment));\n        this.httpManager.on(\"segment-loaded\", this.onSegmentLoaded);\n        this.httpManager.on(\"segment-error\", this.onSegmentError);\n        this.httpManager.on(\"segment-size\", this.onSegmentSize);\n        this.httpManager.on(\"bytes-downloaded\", (segment, bytes) => {\n            this.onPieceBytesDownloaded(\"http\", segment, bytes);\n        });\n        this.p2pManager = this.createP2PManager();\n        this.p2pManager.on(\"segment-start-load\", (segment) => this.onSegmentStartLoad(\"p2p\", segment));\n        this.p2pManager.on(\"segment-loaded\", this.onSegmentLoaded);\n        this.p2pManager.on(\"segment-error\", this.onSegmentError);\n        this.p2pManager.on(\"segment-size\", this.onSegmentSize);\n        this.p2pManager.on(\"peer-data-updated\", async () => {\n            if (this.masterSwarmId === undefined) {\n                return;\n            }\n            const storageSegments = await this.segmentsStorage.getSegmentsMap(this.masterSwarmId);\n            if (this.processSegmentsQueue(storageSegments) && !this.settings.consumeOnly) {\n                this.p2pManager.sendSegmentsMapToAll(this.createSegmentsMap(storageSegments));\n            }\n        });\n        this.p2pManager.on(\"bytes-downloaded\", (segment, bytes, peerId) => this.onPieceBytesDownloaded(\"p2p\", segment, bytes, peerId));\n        this.p2pManager.on(\"bytes-uploaded\", (segment, bytes, peerId) => this.onPieceBytesUploaded(\"p2p\", segment, bytes, peerId));\n        this.p2pManager.on(\"peer-connected\", this.onPeerConnect);\n        this.p2pManager.on(\"peer-closed\", this.onPeerClose);\n        this.p2pManager.on(\"tracker-update\", this.onTrackerUpdate);\n    }\n}\nexports.HybridLoader = HybridLoader;\nHybridLoader.isSupported = () => {\n    return window.RTCPeerConnection.prototype.createDataChannel !== undefined;\n};\n","\"use strict\";\n/**\n * @license Apache-2.0\n * Copyright 2018 Novage LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.version = void 0;\nexports.version = \"0.6.2\";\n__exportStar(require(\"./loader-interface\"), exports);\n__exportStar(require(\"./hybrid-loader\"), exports);\n","\"use strict\";\n/**\n * Copyright 2018 Novage LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Events = void 0;\nvar Events;\n(function (Events) {\n    /**\n     * Emitted when segment has been downloaded.\n     * Args: segment\n     */\n    Events[\"SegmentLoaded\"] = \"segment_loaded\";\n    /**\n     * Emitted when an error occurred while loading the segment.\n     * Args: segment, error\n     */\n    Events[\"SegmentError\"] = \"segment_error\";\n    /**\n     * Emitter when we the segment size is known\n     * Args: segment, size\n     */\n    Events[\"SegmentSize\"] = \"segment_size\";\n    /**\n     * Emitted for each segment that does not hit into a new segments queue when the load() method is called.\n     * Args: segment\n     */\n    Events[\"SegmentAbort\"] = \"segment_abort\";\n    /**\n     * Emitted when the loader started to load a segment\n     * Args: method, segment\n     */\n    Events[\"SegmentStartLoad\"] = \"segment_start_load\";\n    /**\n     * Emitted when a peer is connected.\n     * Args: peer\n     */\n    Events[\"PeerConnect\"] = \"peer_connect\";\n    /**\n     * Emitted when a peer is disconnected.\n     * Args: peerId\n     */\n    Events[\"PeerClose\"] = \"peer_close\";\n    /**\n     * Emitted when a segment piece has been downloaded.\n     * Args: method (can be \"http\" or \"p2p\" only), bytes\n     */\n    Events[\"PieceBytesDownloaded\"] = \"piece_bytes_downloaded\";\n    /**\n     * Emitted when a segment piece has been uploaded.\n     * Args: method (can be \"p2p\" only), bytes\n     */\n    Events[\"PieceBytesUploaded\"] = \"piece_bytes_uploaded\";\n})(Events = exports.Events || (exports.Events = {}));\n","\"use strict\";\n/**\n * Copyright 2018 Novage LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.MediaPeer = exports.MediaPeerSegmentStatus = void 0;\n/* eslint-disable @typescript-eslint/no-unsafe-call */\n/* eslint-disable @typescript-eslint/no-unsafe-member-access */\n/* eslint-disable @typescript-eslint/no-unsafe-assignment */\nconst debug_1 = __importDefault(require(\"debug\"));\nconst buffer_1 = require(\"buffer\");\nconst stringly_typed_event_emitter_1 = require(\"./stringly-typed-event-emitter\");\nvar MediaPeerCommands;\n(function (MediaPeerCommands) {\n    MediaPeerCommands[MediaPeerCommands[\"SegmentData\"] = 0] = \"SegmentData\";\n    MediaPeerCommands[MediaPeerCommands[\"SegmentAbsent\"] = 1] = \"SegmentAbsent\";\n    MediaPeerCommands[MediaPeerCommands[\"SegmentsMap\"] = 2] = \"SegmentsMap\";\n    MediaPeerCommands[MediaPeerCommands[\"SegmentRequest\"] = 3] = \"SegmentRequest\";\n    MediaPeerCommands[MediaPeerCommands[\"CancelSegmentRequest\"] = 4] = \"CancelSegmentRequest\";\n})(MediaPeerCommands || (MediaPeerCommands = {}));\nvar MediaPeerSegmentStatus;\n(function (MediaPeerSegmentStatus) {\n    MediaPeerSegmentStatus[MediaPeerSegmentStatus[\"Loaded\"] = 0] = \"Loaded\";\n    MediaPeerSegmentStatus[MediaPeerSegmentStatus[\"LoadingByHttp\"] = 1] = \"LoadingByHttp\";\n})(MediaPeerSegmentStatus = exports.MediaPeerSegmentStatus || (exports.MediaPeerSegmentStatus = {}));\nclass DownloadingSegment {\n    constructor(id, size) {\n        this.id = id;\n        this.size = size;\n        this.bytesDownloaded = 0;\n        this.pieces = [];\n    }\n}\nclass MediaPeer extends stringly_typed_event_emitter_1.STEEmitter {\n    constructor(\n    // eslint-disable-next-line\n    peer, settings) {\n        super();\n        this.peer = peer;\n        this.settings = settings;\n        this.remoteAddress = \"\";\n        this.downloadingSegmentId = null;\n        this.downloadingSegment = null;\n        this.segmentsMap = new Map();\n        this.debug = (0, debug_1.default)(\"p2pml:media-peer\");\n        this.timer = null;\n        this.onPeerConnect = () => {\n            this.debug(\"peer connect\", this.id, this);\n            this.remoteAddress = this.peer.remoteAddress;\n            this.emit(\"connect\", this);\n        };\n        this.onPeerClose = () => {\n            this.debug(\"peer close\", this.id, this);\n            this.terminateSegmentRequest();\n            this.emit(\"close\", this);\n        };\n        this.onPeerError = (error) => {\n            this.debug(\"peer error\", this.id, error, this);\n        };\n        this.receiveSegmentPiece = (data) => {\n            if (!this.downloadingSegment) {\n                // The segment was not requested or canceled\n                this.debug(\"peer segment not requested\", this.id, this);\n                return;\n            }\n            this.downloadingSegment.bytesDownloaded += data.byteLength;\n            this.downloadingSegment.pieces.push(data);\n            const segmentId = this.downloadingSegment.id;\n            this.emit(\"bytes-downloaded\", this, segmentId, data.byteLength);\n            if (this.downloadingSegment.bytesDownloaded === this.downloadingSegment.size) {\n                const segmentData = new Uint8Array(this.downloadingSegment.size);\n                let offset = 0;\n                for (const piece of this.downloadingSegment.pieces) {\n                    segmentData.set(new Uint8Array(piece), offset);\n                    offset += piece.byteLength;\n                }\n                this.debug(\"peer segment download done\", this.id, segmentId, this);\n                this.terminateSegmentRequest();\n                this.emit(\"segment-loaded\", this, segmentId, segmentData.buffer);\n            }\n            else if (this.downloadingSegment.bytesDownloaded > this.downloadingSegment.size) {\n                this.debug(\"peer segment download bytes mismatch\", this.id, segmentId, this);\n                this.terminateSegmentRequest();\n                this.emit(\"segment-error\", this, segmentId, \"Too many bytes received for segment\");\n            }\n        };\n        this.getJsonCommand = (data) => {\n            const bytes = new Uint8Array(data);\n            // Serialized JSON string check by first, second and last characters: '{\" .... }'\n            if (bytes[0] === 123 && bytes[1] === 34 && bytes[data.byteLength - 1] === 125) {\n                try {\n                    return JSON.parse(new TextDecoder().decode(data));\n                }\n                catch (_a) {\n                    return null;\n                }\n            }\n            return null;\n        };\n        this.onPeerData = (data) => {\n            const command = this.getJsonCommand(data);\n            if (command === null) {\n                this.receiveSegmentPiece(data);\n                return;\n            }\n            if (this.downloadingSegment) {\n                this.debug(\"peer segment download is interrupted by a command\", this.id, this);\n                const segmentId = this.downloadingSegment.id;\n                this.terminateSegmentRequest();\n                this.emit(\"segment-error\", this, segmentId, \"Segment download is interrupted by a command\");\n                return;\n            }\n            this.debug(\"peer receive command\", this.id, command, this);\n            switch (command.c) {\n                case MediaPeerCommands.SegmentsMap:\n                    this.segmentsMap = this.createSegmentsMap(command.m);\n                    this.emit(\"data-updated\");\n                    break;\n                case MediaPeerCommands.SegmentRequest:\n                    this.emit(\"segment-request\", this, command.i);\n                    break;\n                case MediaPeerCommands.SegmentData:\n                    if (this.downloadingSegmentId &&\n                        this.downloadingSegmentId === command.i &&\n                        typeof command.s === \"number\" &&\n                        command.s >= 0) {\n                        this.downloadingSegment = new DownloadingSegment(command.i, command.s);\n                        this.emit(\"segment-start-load\", this.downloadingSegment.id);\n                        this.emit(\"segment-size\", this.downloadingSegment.id, this.downloadingSegment.size);\n                        this.cancelResponseTimeoutTimer();\n                    }\n                    break;\n                case MediaPeerCommands.SegmentAbsent:\n                    if (this.downloadingSegmentId && this.downloadingSegmentId === command.i) {\n                        this.terminateSegmentRequest();\n                        this.segmentsMap.delete(command.i);\n                        this.emit(\"segment-absent\", this, command.i);\n                    }\n                    break;\n                case MediaPeerCommands.CancelSegmentRequest:\n                    // TODO: peer stop sending buffer\n                    break;\n                default:\n                    break;\n            }\n        };\n        this.createSegmentsMap = (segments) => {\n            if (!(segments instanceof Object)) {\n                return new Map();\n            }\n            const segmentsMap = new Map();\n            for (const streamSwarmId of Object.keys(segments)) {\n                const swarmData = segments[streamSwarmId];\n                if (!(swarmData instanceof Array) ||\n                    swarmData.length !== 2 ||\n                    typeof swarmData[0] !== \"string\" ||\n                    !(swarmData[1] instanceof Array)) {\n                    return new Map();\n                }\n                const segmentsIds = swarmData[0].split(\"|\");\n                const segmentsStatuses = swarmData[1];\n                if (segmentsIds.length !== segmentsStatuses.length) {\n                    return new Map();\n                }\n                for (let i = 0; i < segmentsIds.length; i++) {\n                    const segmentStatus = segmentsStatuses[i];\n                    if (typeof segmentStatus !== \"number\" || MediaPeerSegmentStatus[segmentStatus] === undefined) {\n                        return new Map();\n                    }\n                    segmentsMap.set(`${streamSwarmId}+${segmentsIds[i]}`, segmentStatus);\n                }\n            }\n            return segmentsMap;\n        };\n        this.sendCommand = (command) => {\n            this.debug(\"peer send command\", this.id, command, this);\n            this.peer.write(JSON.stringify(command));\n        };\n        this.destroy = () => {\n            this.debug(\"peer destroy\", this.id, this);\n            this.terminateSegmentRequest();\n            this.peer.destroy();\n        };\n        this.getDownloadingSegmentId = () => {\n            return this.downloadingSegmentId;\n        };\n        this.getSegmentsMap = () => {\n            return this.segmentsMap;\n        };\n        this.sendSegmentsMap = (segmentsMap) => {\n            this.sendCommand({ c: MediaPeerCommands.SegmentsMap, m: segmentsMap });\n        };\n        this.sendSegmentData = (segmentId, data) => {\n            this.sendCommand({\n                c: MediaPeerCommands.SegmentData,\n                i: segmentId,\n                s: data.byteLength,\n            });\n            let bytesLeft = data.byteLength;\n            while (bytesLeft > 0) {\n                const bytesToSend = bytesLeft >= this.settings.webRtcMaxMessageSize ? this.settings.webRtcMaxMessageSize : bytesLeft;\n                const buffer = buffer_1.Buffer.from(data, data.byteLength - bytesLeft, bytesToSend);\n                this.peer.write(buffer);\n                bytesLeft -= bytesToSend;\n            }\n            this.emit(\"bytes-uploaded\", this, segmentId, data.byteLength);\n        };\n        this.sendSegmentAbsent = (segmentId) => {\n            this.sendCommand({ c: MediaPeerCommands.SegmentAbsent, i: segmentId });\n        };\n        this.requestSegment = (segmentId) => {\n            if (this.downloadingSegmentId) {\n                throw new Error(\"A segment is already downloading: \" + this.downloadingSegmentId);\n            }\n            this.sendCommand({ c: MediaPeerCommands.SegmentRequest, i: segmentId });\n            this.downloadingSegmentId = segmentId;\n            this.runResponseTimeoutTimer();\n        };\n        this.cancelSegmentRequest = () => {\n            let downloadingSegment;\n            if (this.downloadingSegmentId) {\n                const segmentId = this.downloadingSegmentId;\n                downloadingSegment = this.downloadingSegment ? this.downloadingSegment.pieces : undefined;\n                this.terminateSegmentRequest();\n                this.sendCommand({ c: MediaPeerCommands.CancelSegmentRequest, i: segmentId });\n            }\n            return downloadingSegment;\n        };\n        this.runResponseTimeoutTimer = () => {\n            this.timer = setTimeout(() => {\n                this.timer = null;\n                if (!this.downloadingSegmentId) {\n                    return;\n                }\n                const segmentId = this.downloadingSegmentId;\n                this.cancelSegmentRequest();\n                this.emit(\"segment-timeout\", this, segmentId); // TODO: send peer not responding event\n            }, this.settings.p2pSegmentDownloadTimeout);\n        };\n        this.cancelResponseTimeoutTimer = () => {\n            if (this.timer) {\n                clearTimeout(this.timer);\n                this.timer = null;\n            }\n        };\n        this.terminateSegmentRequest = () => {\n            this.downloadingSegmentId = null;\n            this.downloadingSegment = null;\n            this.cancelResponseTimeoutTimer();\n        };\n        this.peer.on(\"connect\", this.onPeerConnect);\n        this.peer.on(\"close\", this.onPeerClose);\n        this.peer.on(\"error\", this.onPeerError);\n        this.peer.on(\"data\", this.onPeerData);\n        this.id = peer.id;\n    }\n}\nexports.MediaPeer = MediaPeer;\n","\"use strict\";\n/**\n * Copyright 2018 Novage LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.P2PMediaManager = void 0;\n/* eslint-disable @typescript-eslint/no-unsafe-assignment */\n/* eslint-disable @typescript-eslint/no-unsafe-call */\n/* eslint-disable @typescript-eslint/no-unsafe-member-access */\nconst debug_1 = __importDefault(require(\"debug\"));\nconst client_1 = __importDefault(require(\"bittorrent-tracker/client\"));\nconst buffer_1 = require(\"buffer\");\nconst sha1_1 = __importDefault(require(\"sha.js/sha1\"));\nconst stringly_typed_event_emitter_1 = require(\"./stringly-typed-event-emitter\");\nconst media_peer_1 = require(\"./media-peer\");\nconst index_1 = require(\"./index\");\nconst PEER_PROTOCOL_VERSION = 2;\nconst PEER_ID_VERSION_STRING = index_1.version.replace(/\\d*./g, (v) => `0${parseInt(v, 10) % 100}`.slice(-2)).slice(0, 4);\nconst PEER_ID_VERSION_PREFIX = `-WW${PEER_ID_VERSION_STRING}-`; // Using WebTorrent client ID in order to not be banned by websocket trackers\nclass PeerSegmentRequest {\n    constructor(peerId, segment) {\n        this.peerId = peerId;\n        this.segment = segment;\n    }\n}\nfunction generatePeerId() {\n    const PEER_ID_SYMBOLS = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n    const PEER_ID_LENGTH = 20;\n    let peerId = PEER_ID_VERSION_PREFIX;\n    for (let i = 0; i < PEER_ID_LENGTH - PEER_ID_VERSION_PREFIX.length; i++) {\n        peerId += PEER_ID_SYMBOLS.charAt(Math.floor(Math.random() * PEER_ID_SYMBOLS.length));\n    }\n    return new TextEncoder().encode(peerId).buffer;\n}\nclass P2PMediaManager extends stringly_typed_event_emitter_1.STEEmitter {\n    constructor(segmentsStorage, settings) {\n        super();\n        this.segmentsStorage = segmentsStorage;\n        this.settings = settings;\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        this.trackerClient = null;\n        this.peers = new Map();\n        this.peerCandidates = new Map();\n        this.peerSegmentRequests = new Map();\n        this.streamSwarmId = null;\n        this.debug = (0, debug_1.default)(\"p2pml:p2p-media-manager\");\n        this.pendingTrackerClient = null;\n        this.getPeers = () => {\n            return this.peers;\n        };\n        this.getPeerId = () => {\n            return buffer_1.Buffer.from(this.peerId).toString(\"hex\");\n        };\n        this.setStreamSwarmId = (streamSwarmId, masterSwarmId) => {\n            if (this.streamSwarmId === streamSwarmId) {\n                return;\n            }\n            this.destroy(true);\n            this.streamSwarmId = streamSwarmId;\n            this.masterSwarmId = masterSwarmId;\n            this.debug(\"stream swarm ID\", this.streamSwarmId);\n            this.pendingTrackerClient = {\n                isDestroyed: false,\n            };\n            const pendingTrackerClient = this.pendingTrackerClient;\n            // TODO: native browser 'crypto.subtle' implementation doesn't work in Chrome in insecure pages\n            // TODO: Edge doesn't support SHA-1. Change to SHA-256 once Edge support is required.\n            // const infoHash = await crypto.subtle.digest(\"SHA-1\", new TextEncoder().encode(PEER_PROTOCOL_VERSION + this.streamSwarmId));\n            const infoHash = new sha1_1.default().update(`${PEER_PROTOCOL_VERSION}${this.streamSwarmId}`).digest();\n            // destroy may be called while waiting for the hash to be calculated\n            if (!pendingTrackerClient.isDestroyed) {\n                this.pendingTrackerClient = null;\n                this.createClient(infoHash);\n            }\n            else if (this.trackerClient !== null) {\n                this.trackerClient.destroy();\n                this.trackerClient = null;\n            }\n        };\n        this.createClient = (infoHash) => {\n            if (!this.settings.useP2P) {\n                return;\n            }\n            const clientOptions = {\n                infoHash: buffer_1.Buffer.from(infoHash, 0, 20),\n                peerId: buffer_1.Buffer.from(this.peerId, 0, 20),\n                announce: this.settings.trackerAnnounce,\n                rtcConfig: this.settings.rtcConfig,\n                port: 6881,\n                getAnnounceOpts: () => {\n                    return { numwant: this.settings.peerRequestsPerAnnounce };\n                },\n            };\n            let oldTrackerClient = this.trackerClient;\n            this.trackerClient = new client_1.default(clientOptions);\n            this.trackerClient.on(\"error\", this.onTrackerError);\n            this.trackerClient.on(\"warning\", this.onTrackerWarning);\n            this.trackerClient.on(\"update\", this.onTrackerUpdate);\n            this.trackerClient.on(\"peer\", this.onTrackerPeer);\n            this.trackerClient.start();\n            if (oldTrackerClient !== null) {\n                oldTrackerClient.destroy();\n                oldTrackerClient = null;\n            }\n        };\n        this.onTrackerError = (error) => {\n            this.debug(\"tracker error\", error);\n        };\n        this.onTrackerWarning = (warning) => {\n            this.debug(\"tracker warning\", warning);\n        };\n        this.onTrackerUpdate = (data) => {\n            this.debug(\"tracker update\", data);\n            this.emit(\"tracker-update\", data);\n        };\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        this.onTrackerPeer = (trackerPeer) => {\n            this.debug(\"tracker peer\", trackerPeer.id, trackerPeer);\n            // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n            if (this.peers.has(trackerPeer.id)) {\n                this.debug(\"tracker peer already connected\", trackerPeer.id, trackerPeer);\n                trackerPeer.destroy();\n                return;\n            }\n            const peer = new media_peer_1.MediaPeer(trackerPeer, this.settings);\n            peer.on(\"connect\", this.onPeerConnect);\n            peer.on(\"close\", this.onPeerClose);\n            peer.on(\"data-updated\", this.onPeerDataUpdated);\n            peer.on(\"segment-request\", this.onSegmentRequest);\n            peer.on(\"segment-loaded\", this.onSegmentLoaded);\n            peer.on(\"segment-absent\", this.onSegmentAbsent);\n            peer.on(\"segment-error\", this.onSegmentError);\n            peer.on(\"segment-size\", this.onSegmentSize);\n            peer.on(\"segment-start-load\", this.onSegmentStartLoad);\n            peer.on(\"segment-timeout\", this.onSegmentTimeout);\n            peer.on(\"bytes-downloaded\", this.onPieceBytesDownloaded);\n            peer.on(\"bytes-uploaded\", this.onPieceBytesUploaded);\n            let peerCandidatesById = this.peerCandidates.get(peer.id);\n            if (!peerCandidatesById) {\n                peerCandidatesById = [];\n                this.peerCandidates.set(peer.id, peerCandidatesById);\n            }\n            peerCandidatesById.push(peer);\n        };\n        this.download = (segment) => {\n            if (this.isDownloading(segment)) {\n                return false;\n            }\n            const candidates = [];\n            for (const peer of this.peers.values()) {\n                if (peer.getDownloadingSegmentId() === null &&\n                    peer.getSegmentsMap().get(segment.id) === media_peer_1.MediaPeerSegmentStatus.Loaded) {\n                    candidates.push(peer);\n                }\n            }\n            if (candidates.length === 0) {\n                return false;\n            }\n            const peer = candidates[Math.floor(Math.random() * candidates.length)];\n            peer.requestSegment(segment.id);\n            this.peerSegmentRequests.set(segment.id, new PeerSegmentRequest(peer.id, segment));\n            return true;\n        };\n        this.abort = (segment) => {\n            let downloadingSegment;\n            const peerSegmentRequest = this.peerSegmentRequests.get(segment.id);\n            if (peerSegmentRequest) {\n                const peer = this.peers.get(peerSegmentRequest.peerId);\n                if (peer) {\n                    downloadingSegment = peer.cancelSegmentRequest();\n                }\n                this.peerSegmentRequests.delete(segment.id);\n            }\n            return downloadingSegment;\n        };\n        this.isDownloading = (segment) => {\n            return this.peerSegmentRequests.has(segment.id);\n        };\n        this.getActiveDownloadsCount = () => {\n            return this.peerSegmentRequests.size;\n        };\n        this.destroy = (swarmChange = false) => {\n            this.streamSwarmId = null;\n            if (this.trackerClient) {\n                this.trackerClient.stop();\n                if (swarmChange) {\n                    // Don't destroy trackerClient to reuse its WebSocket connection to the tracker server\n                    this.trackerClient.removeAllListeners(\"error\");\n                    this.trackerClient.removeAllListeners(\"warning\");\n                    this.trackerClient.removeAllListeners(\"update\");\n                    this.trackerClient.removeAllListeners(\"peer\");\n                }\n                else {\n                    this.trackerClient.destroy();\n                    this.trackerClient = null;\n                }\n            }\n            if (this.pendingTrackerClient) {\n                this.pendingTrackerClient.isDestroyed = true;\n                this.pendingTrackerClient = null;\n            }\n            this.peers.forEach((peer) => peer.destroy());\n            this.peers.clear();\n            this.peerSegmentRequests.clear();\n            for (const peerCandidateById of this.peerCandidates.values()) {\n                for (const peerCandidate of peerCandidateById) {\n                    peerCandidate.destroy();\n                }\n            }\n            this.peerCandidates.clear();\n        };\n        this.sendSegmentsMapToAll = (segmentsMap) => {\n            this.peers.forEach((peer) => peer.sendSegmentsMap(segmentsMap));\n        };\n        this.sendSegmentsMap = (peerId, segmentsMap) => {\n            const peer = this.peers.get(peerId);\n            if (peer) {\n                peer.sendSegmentsMap(segmentsMap);\n            }\n        };\n        this.getOverallSegmentsMap = () => {\n            const overallSegmentsMap = new Map();\n            for (const peer of this.peers.values()) {\n                for (const [segmentId, segmentStatus] of peer.getSegmentsMap()) {\n                    if (segmentStatus === media_peer_1.MediaPeerSegmentStatus.Loaded) {\n                        overallSegmentsMap.set(segmentId, media_peer_1.MediaPeerSegmentStatus.Loaded);\n                    }\n                    else if (!overallSegmentsMap.get(segmentId)) {\n                        overallSegmentsMap.set(segmentId, media_peer_1.MediaPeerSegmentStatus.LoadingByHttp);\n                    }\n                }\n            }\n            return overallSegmentsMap;\n        };\n        this.onPieceBytesDownloaded = (peer, segmentId, bytes) => {\n            const peerSegmentRequest = this.peerSegmentRequests.get(segmentId);\n            if (peerSegmentRequest) {\n                this.emit(\"bytes-downloaded\", peerSegmentRequest.segment, bytes, peer.id);\n            }\n        };\n        this.onPieceBytesUploaded = async (peer, segmentId, bytes) => {\n            if (this.masterSwarmId === undefined) {\n                return;\n            }\n            const segment = await this.segmentsStorage.getSegment(segmentId, this.masterSwarmId);\n            if (segment) {\n                this.emit(\"bytes-uploaded\", segment, bytes, peer.id);\n            }\n        };\n        this.onPeerConnect = (peer) => {\n            const connectedPeer = this.peers.get(peer.id);\n            if (connectedPeer) {\n                this.debug(\"tracker peer already connected (in peer connect)\", peer.id, peer);\n                peer.destroy();\n                return;\n            }\n            // First peer with the ID connected\n            this.peers.set(peer.id, peer);\n            // Destroy all other peer candidates\n            const peerCandidatesById = this.peerCandidates.get(peer.id);\n            if (peerCandidatesById) {\n                for (const peerCandidate of peerCandidatesById) {\n                    if (peerCandidate !== peer) {\n                        peerCandidate.destroy();\n                    }\n                }\n                this.peerCandidates.delete(peer.id);\n            }\n            this.emit(\"peer-connected\", { id: peer.id, remoteAddress: peer.remoteAddress });\n        };\n        this.onPeerClose = (peer) => {\n            if (this.peers.get(peer.id) !== peer) {\n                // Try to delete the peer candidate\n                const peerCandidatesById = this.peerCandidates.get(peer.id);\n                if (!peerCandidatesById) {\n                    return;\n                }\n                const index = peerCandidatesById.indexOf(peer);\n                if (index !== -1) {\n                    peerCandidatesById.splice(index, 1);\n                }\n                if (peerCandidatesById.length === 0) {\n                    this.peerCandidates.delete(peer.id);\n                }\n                return;\n            }\n            for (const [key, value] of this.peerSegmentRequests) {\n                if (value.peerId === peer.id) {\n                    this.peerSegmentRequests.delete(key);\n                }\n            }\n            this.peers.delete(peer.id);\n            this.emit(\"peer-data-updated\");\n            this.emit(\"peer-closed\", peer.id);\n        };\n        this.onPeerDataUpdated = () => {\n            this.emit(\"peer-data-updated\");\n        };\n        this.onSegmentRequest = async (peer, segmentId) => {\n            if (this.masterSwarmId === undefined) {\n                return;\n            }\n            const segment = await this.segmentsStorage.getSegment(segmentId, this.masterSwarmId);\n            if (segment && segment.data) {\n                peer.sendSegmentData(segmentId, segment.data);\n            }\n            else {\n                peer.sendSegmentAbsent(segmentId);\n            }\n        };\n        this.onSegmentLoaded = async (peer, segmentId, data) => {\n            const peerSegmentRequest = this.peerSegmentRequests.get(segmentId);\n            if (!peerSegmentRequest) {\n                return;\n            }\n            const segment = peerSegmentRequest.segment;\n            if (this.settings.segmentValidator) {\n                try {\n                    await this.settings.segmentValidator(Object.assign(Object.assign({}, segment), { data: data }), \"p2p\", peer.id);\n                }\n                catch (error) {\n                    this.debug(\"segment validator failed\", error);\n                    this.peerSegmentRequests.delete(segmentId);\n                    this.emit(\"segment-error\", segment, error, peer.id);\n                    this.onPeerClose(peer);\n                    return;\n                }\n            }\n            this.peerSegmentRequests.delete(segmentId);\n            this.emit(\"segment-loaded\", segment, data, peer.id);\n        };\n        this.onSegmentAbsent = (peer, segmentId) => {\n            this.peerSegmentRequests.delete(segmentId);\n            this.emit(\"peer-data-updated\");\n        };\n        this.onSegmentError = (peer, segmentId, description) => {\n            const peerSegmentRequest = this.peerSegmentRequests.get(segmentId);\n            if (peerSegmentRequest) {\n                this.peerSegmentRequests.delete(segmentId);\n                this.emit(\"segment-error\", peerSegmentRequest.segment, description, peer.id);\n            }\n        };\n        this.onSegmentSize = (segmentId, size) => {\n            const peerSegmentRequest = this.peerSegmentRequests.get(segmentId);\n            if (peerSegmentRequest) {\n                this.emit(\"segment-size\", peerSegmentRequest.segment, size);\n            }\n        };\n        this.onSegmentStartLoad = (segmentId, size) => {\n            const peerSegmentRequest = this.peerSegmentRequests.get(segmentId);\n            if (peerSegmentRequest) {\n                this.emit(\"segment-start-load\", peerSegmentRequest.segment, size);\n            }\n        };\n        this.onSegmentTimeout = (peer, segmentId) => {\n            const peerSegmentRequest = this.peerSegmentRequests.get(segmentId);\n            if (peerSegmentRequest) {\n                this.peerSegmentRequests.delete(segmentId);\n                peer.destroy();\n                if (this.peers.delete(peerSegmentRequest.peerId)) {\n                    this.emit(\"peer-data-updated\");\n                }\n            }\n        };\n        this.peerId = settings.useP2P ? generatePeerId() : new ArrayBuffer(0);\n        if (this.debug.enabled) {\n            this.debug(\"peer ID\", this.getPeerId(), new TextDecoder().decode(this.peerId));\n        }\n    }\n}\nexports.P2PMediaManager = P2PMediaManager;\n","\"use strict\";\n/**\n * Copyright 2019 Novage LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.SegmentsMemoryStorage = void 0;\nclass SegmentsMemoryStorage {\n    constructor(settings) {\n        this.settings = settings;\n        this.cache = new Map();\n        this.storeSegment = async (segment) => {\n            this.cache.set(segment.id, { segment, lastAccessed: performance.now() });\n        };\n        this.getSegmentsMap = async () => {\n            return this.cache;\n        };\n        this.getSegment = async (id) => {\n            const cacheItem = this.cache.get(id);\n            if (cacheItem === undefined) {\n                return undefined;\n            }\n            cacheItem.lastAccessed = performance.now();\n            return cacheItem.segment;\n        };\n        this.hasSegment = async (id) => {\n            return this.cache.has(id);\n        };\n        this.clean = async (masterSwarmId, lockedSegmentsFilter) => {\n            const segmentsToDelete = [];\n            const remainingSegments = [];\n            // Delete old segments\n            const now = performance.now();\n            for (const cachedSegment of this.cache.values()) {\n                if (now - cachedSegment.lastAccessed > this.settings.cachedSegmentExpiration) {\n                    segmentsToDelete.push(cachedSegment.segment.id);\n                }\n                else {\n                    remainingSegments.push(cachedSegment);\n                }\n            }\n            // Delete segments over cached count\n            let countOverhead = remainingSegments.length - this.settings.cachedSegmentsCount;\n            if (countOverhead > 0) {\n                remainingSegments.sort((a, b) => a.lastAccessed - b.lastAccessed);\n                for (const cachedSegment of remainingSegments) {\n                    if (lockedSegmentsFilter === undefined || !lockedSegmentsFilter(cachedSegment.segment.id)) {\n                        segmentsToDelete.push(cachedSegment.segment.id);\n                        countOverhead--;\n                        if (countOverhead === 0) {\n                            break;\n                        }\n                    }\n                }\n            }\n            segmentsToDelete.forEach((id) => this.cache.delete(id));\n            return segmentsToDelete.length > 0;\n        };\n        this.destroy = async () => {\n            this.cache.clear();\n        };\n    }\n}\nexports.SegmentsMemoryStorage = SegmentsMemoryStorage;\n","\"use strict\";\n/**\n * Copyright 2018 Novage LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.STEEmitter = void 0;\n/* eslint-disable @typescript-eslint/no-explicit-any */\nconst events_1 = require(\"events\");\nclass STEEmitter extends events_1.EventEmitter {\n    constructor() {\n        super(...arguments);\n        this.on = (event, listener) => super.on(event, listener);\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n        this.emit = (event, ...args) => super.emit(event, ...args);\n    }\n}\nexports.STEEmitter = STEEmitter;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.byteRangeToString = exports.compareByteRanges = exports.getByteRange = void 0;\nfunction getByteRange(context) {\n    return context.rangeEnd && context.rangeStart !== undefined\n        ? { offset: context.rangeStart, length: context.rangeEnd - context.rangeStart }\n        : undefined;\n}\nexports.getByteRange = getByteRange;\nfunction compareByteRanges(b1, b2) {\n    return b1 === undefined ? b2 === undefined : b2 !== undefined && b1.length === b2.length && b1.offset === b2.offset;\n}\nexports.compareByteRanges = compareByteRanges;\nfunction byteRangeToString(byteRange) {\n    if (byteRange === undefined) {\n        return undefined;\n    }\n    const end = byteRange.offset + byteRange.length - 1;\n    return `bytes=${byteRange.offset}-${end}`;\n}\nexports.byteRangeToString = byteRangeToString;\n","\"use strict\";\n/**\n * Copyright 2018 Novage LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Engine = void 0;\nconst events_1 = require(\"events\");\nconst p2p_media_loader_core_1 = require(\"@peertube/p2p-media-loader-core\");\nconst segment_manager_1 = require(\"./segment-manager\");\nconst hlsjs_loader_1 = require(\"./hlsjs-loader\");\nclass Engine extends events_1.EventEmitter {\n    constructor(settings = {}) {\n        super();\n        this.loader = new p2p_media_loader_core_1.HybridLoader(settings.loader);\n        this.segmentManager = new segment_manager_1.SegmentManager(this.loader, settings.segments);\n        Object.keys(p2p_media_loader_core_1.Events)\n            .map((eventKey) => p2p_media_loader_core_1.Events[eventKey])\n            .forEach((event) => this.loader.on(event, (...args) => this.emit(event, ...args)));\n    }\n    static isSupported() {\n        return p2p_media_loader_core_1.HybridLoader.isSupported();\n    }\n    createLoaderClass() {\n        var _a;\n        const engine = this; // eslint-disable-line @typescript-eslint/no-this-alias\n        const loader = (_a = class {\n                constructor() {\n                    this.load = async (context, config, callbacks) => {\n                        this.context = context;\n                        this.callbacks = callbacks;\n                        await this.impl.load(context, config, callbacks);\n                    };\n                    this.abort = () => {\n                        if (this.context) {\n                            this.impl.abort(this.context, this.callbacks);\n                        }\n                    };\n                    this.destroy = () => {\n                        if (this.context) {\n                            this.impl.abort(this.context);\n                        }\n                    };\n                    this.getResponseHeader = () => undefined;\n                    this.impl = new hlsjs_loader_1.HlsJsLoader(engine.segmentManager);\n                    engine.setLatestLoaderImpl(this);\n                    this.stats = this.impl.stats;\n                }\n            },\n            _a.getEngine = () => {\n                return engine;\n            },\n            _a);\n        return loader;\n    }\n    async destroy() {\n        await this.segmentManager.destroy();\n    }\n    abortCurrentRequest() {\n        if (this.latestLoaderImpl) {\n            this.latestLoaderImpl.abort();\n            this.latestLoaderImpl = undefined;\n        }\n    }\n    getSettings() {\n        return {\n            segments: this.segmentManager.getSettings(),\n            loader: this.loader.getSettings(),\n        };\n    }\n    getDetails() {\n        return {\n            loader: this.loader.getDetails(),\n        };\n    }\n    setPlayingSegment(url, byteRange, start, duration) {\n        this.segmentManager.setPlayingSegment(url, byteRange, start, duration);\n    }\n    setPlayingSegmentByCurrentTime(playheadPosition) {\n        this.segmentManager.setPlayingSegmentByCurrentTime(playheadPosition);\n    }\n    setLatestLoaderImpl(loader) {\n        this.latestLoaderImpl = loader;\n    }\n}\nexports.Engine = Engine;\n","\"use strict\";\n/**\n * Copyright 2018 Novage LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.HlsJsLoader = void 0;\nconst debug_1 = __importDefault(require(\"debug\"));\nconst p2p_media_loader_core_1 = require(\"@peertube/p2p-media-loader-core\");\nconst byte_range_1 = require(\"./byte-range\");\nclass HlsJsLoader {\n    constructor(segmentManager) {\n        this.segmentManager = segmentManager;\n        this.debug = (0, debug_1.default)(\"p2pml:hlsjs-loader\");\n        this.stats = {\n            loaded: 0,\n            total: 0,\n            aborted: false,\n            retry: 0,\n            chunkCount: 0,\n            bwEstimate: 0,\n            loading: {\n                start: 0,\n                end: 0,\n                first: 0,\n            },\n            parsing: {\n                start: 0,\n                end: 0,\n            },\n            buffering: {\n                start: 0,\n                end: 0,\n                first: 0,\n            },\n        };\n        this.boundOnSegmentAbort = this.onSegmentAbort.bind(this);\n        this.boundOnUpdateSegmentSize = this.onUpdateSegmentSize.bind(this);\n        this.boundOnUpdateLoaded = this.onUpdateLoaded.bind(this);\n        this.boundOnSegmentStartLoad = this.onSegmentStartLoad.bind(this);\n        this.debugId = \"\";\n    }\n    async load(context, _config, callbacks) {\n        this.context = context;\n        this.callbacks = callbacks;\n        HlsJsLoader.updateStatsToStartLoading(this.stats);\n        if (this.context.type) {\n            this.debug(`Loading playlist ${this.context.url}.`);\n            try {\n                const result = await this.segmentManager.loadPlaylist(this.context.url);\n                this.debug(`Playlist ${this.context.url} loaded.`);\n                this.successPlaylist(result, this.context, this.callbacks);\n            }\n            catch (e) {\n                this.error(e, this.context, this.callbacks);\n            }\n        }\n        else if (this.context.frag) {\n            this.loader = this.segmentManager.loader;\n            this.byteRange = (0, byte_range_1.getByteRange)(this.context);\n            this.debugId = this.byteRange\n                ? `${this.context.url} / ${this.byteRange.offset}`\n                : this.context.url;\n            this.debug(`Loading fragment ${this.debugId}.`);\n            // We may be downloading the segment by P2P, so we don\"t care about the stats sent to HLS ABR\n            this.interval = setInterval(() => HlsJsLoader.updateStatsToStartLoading(this.stats), 200);\n            this.loader.on(p2p_media_loader_core_1.Events.SegmentAbort, this.boundOnSegmentAbort);\n            this.loader.on(p2p_media_loader_core_1.Events.SegmentSize, this.boundOnUpdateSegmentSize);\n            this.loader.on(p2p_media_loader_core_1.Events.SegmentStartLoad, this.boundOnSegmentStartLoad);\n            try {\n                const result = await this.segmentManager.loadSegment(this.context.url, this.byteRange);\n                const { content } = result;\n                if (content) {\n                    this.successSegment(content, this.context, this.callbacks);\n                    this.debug(`Loaded fragment ${this.debugId}.`);\n                }\n                else {\n                    this.cleanup();\n                    this.debug(`Loaded empty fragment ${this.debugId} (aborted?).`);\n                }\n            }\n            catch (e) {\n                setTimeout(() => this.error(e, this.context, this.callbacks), 0);\n                this.debug(`Error in fragment ${this.debugId} loading.`, e);\n            }\n        }\n        else {\n            console.warn(\"Unknown load request\", this.context);\n        }\n    }\n    abort(context, callbacks) {\n        if (this.stats.loaded || this.stats.aborted)\n            return;\n        this.debug(`Aborting by hls.js fragment ${this.debugId} loading.`);\n        this.cleanup();\n        this.segmentManager.abortSegment(context.url, (0, byte_range_1.getByteRange)(context));\n        this.stats.aborted = true;\n        const onAbort = callbacks === null || callbacks === void 0 ? void 0 : callbacks.onAbort;\n        if (onAbort) {\n            onAbort(this.stats, context, undefined);\n        }\n    }\n    successPlaylist(xhr, context, callbacks) {\n        this.cleanup();\n        const now = performance.now();\n        this.stats.loading.end = now;\n        this.stats.loaded = xhr.response.length;\n        this.stats.total = xhr.response.length;\n        callbacks.onSuccess({\n            url: xhr.responseURL,\n            data: xhr.response,\n        }, this.stats, context, undefined);\n    }\n    successSegment(content, context, callbacks) {\n        this.cleanup();\n        const now = performance.now();\n        this.stats.loading.end = now;\n        this.stats.loaded = content.byteLength;\n        this.stats.total = content.byteLength;\n        if (callbacks.onProgress) {\n            callbacks.onProgress(this.stats, context, content, undefined);\n        }\n        callbacks.onSuccess({\n            url: context.url,\n            data: content,\n        }, this.stats, context, undefined);\n    }\n    error(error, context, callbacks) {\n        this.cleanup();\n        callbacks.onError(error, context, undefined);\n    }\n    cleanup() {\n        if (this.interval) {\n            clearInterval(this.interval);\n            this.interval = undefined;\n        }\n        if (this.loader) {\n            this.loader.off(p2p_media_loader_core_1.Events.SegmentStartLoad, this.boundOnSegmentStartLoad);\n            this.loader.off(p2p_media_loader_core_1.Events.SegmentSize, this.boundOnUpdateSegmentSize);\n            this.loader.off(p2p_media_loader_core_1.Events.PieceBytesDownloaded, this.boundOnUpdateLoaded);\n            this.loader.off(p2p_media_loader_core_1.Events.SegmentAbort, this.boundOnSegmentAbort);\n        }\n    }\n    onSegmentAbort(segment) {\n        var _a;\n        if (!this.isSegment(segment))\n            return;\n        this.debug(`Aborting by p2p-media-loader fragment ${this.debugId || \"\"}.`);\n        this.stats.aborted = true;\n        const onAbort = (_a = this.callbacks) === null || _a === void 0 ? void 0 : _a.onAbort;\n        if (onAbort) {\n            onAbort(this.stats, this.context, undefined);\n        }\n        this.cleanup();\n    }\n    onUpdateSegmentSize(segment, size) {\n        if (!this.isSegment(segment))\n            return;\n        this.stats.total = size;\n    }\n    onUpdateLoaded(_type, segment, bytes) {\n        if (!this.isSegment(segment))\n            return;\n        this.stats.loaded += bytes;\n    }\n    onSegmentStartLoad(method, segment) {\n        if (!this.interval || method !== \"http\" || !this.isSegment(segment))\n            return;\n        clearInterval(this.interval);\n        this.interval = undefined;\n        HlsJsLoader.updateStatsToStartLoading(this.stats);\n        this.loader.on(p2p_media_loader_core_1.Events.PieceBytesDownloaded, this.boundOnUpdateLoaded);\n    }\n    ;\n    isSegment(segment) {\n        return segment.url === this.context.url && segment.range === (0, byte_range_1.byteRangeToString)(this.byteRange);\n    }\n    static updateStatsToStartLoading(stats) {\n        if (stats.aborted)\n            return;\n        const start = performance.now();\n        stats.loading.start = start;\n        stats.loading.first = start;\n    }\n}\nexports.HlsJsLoader = HlsJsLoader;\n","\"use strict\";\n/**\n * @license Apache-2.0\n * Copyright 2018 Novage LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.initJwPlayer = exports.initMediaElementJsPlayer = exports.initVideoJsHlsJsPlugin = exports.initVideoJsContribHlsJsPlayer = exports.initFlowplayerHlsJsPlayer = exports.initClapprPlayer = exports.initHlsJsPlayer = exports.version = void 0;\n/* eslint-disable */\nexports.version = \"0.6.2\";\n__exportStar(require(\"./engine\"), exports);\n__exportStar(require(\"./segment-manager\"), exports);\nconst debug_1 = __importDefault(require(\"debug\"));\nconst debug = (0, debug_1.default)(\"p2pml:hlsjs-init\");\nfunction initHlsJsPlayer(player) {\n    if (player && player.config && player.config.loader && typeof player.config.loader.getEngine === \"function\") {\n        initHlsJsEvents(player, player.config.loader.getEngine());\n    }\n}\nexports.initHlsJsPlayer = initHlsJsPlayer;\nfunction initClapprPlayer(player) {\n    player.on(\"play\", () => {\n        const playback = player.core.getCurrentPlayback();\n        if (playback._hls && !playback._hls._p2pm_linitialized) {\n            playback._hls._p2pm_linitialized = true;\n            initHlsJsPlayer(player.core.getCurrentPlayback()._hls);\n        }\n    });\n}\nexports.initClapprPlayer = initClapprPlayer;\nfunction initFlowplayerHlsJsPlayer(player) {\n    player.on(\"ready\", () => { var _a; return initHlsJsPlayer((_a = player.engine.hlsjs) !== null && _a !== void 0 ? _a : player.engine.hls); });\n}\nexports.initFlowplayerHlsJsPlayer = initFlowplayerHlsJsPlayer;\nfunction initVideoJsContribHlsJsPlayer(player) {\n    player.ready(() => {\n        const options = player.tech_.options_;\n        if (options &&\n            options.hlsjsConfig &&\n            options.hlsjsConfig.loader &&\n            typeof options.hlsjsConfig.loader.getEngine === \"function\") {\n            initHlsJsEvents(player.tech_, options.hlsjsConfig.loader.getEngine());\n        }\n    });\n}\nexports.initVideoJsContribHlsJsPlayer = initVideoJsContribHlsJsPlayer;\nfunction initVideoJsHlsJsPlugin() {\n    if (videojs == undefined || videojs.Html5Hlsjs == undefined) {\n        return;\n    }\n    videojs.Html5Hlsjs.addHook(\"beforeinitialize\", (videojsPlayer, hlsjs) => {\n        if (hlsjs.config && hlsjs.config.loader && typeof hlsjs.config.loader.getEngine === \"function\") {\n            initHlsJsEvents(hlsjs, hlsjs.config.loader.getEngine());\n        }\n    });\n}\nexports.initVideoJsHlsJsPlugin = initVideoJsHlsJsPlugin;\nfunction initMediaElementJsPlayer(mediaElement) {\n    mediaElement.addEventListener(\"hlsFragChanged\", (event) => {\n        const hls = mediaElement.hlsPlayer;\n        if (hls && hls.config && hls.config.loader && typeof hls.config.loader.getEngine === \"function\") {\n            const engine = hls.config.loader.getEngine();\n            if (event.data && event.data.length > 1) {\n                const frag = event.data[1].frag;\n                const byteRange = frag.byteRange.length !== 2\n                    ? undefined\n                    : { offset: frag.byteRange[0], length: frag.byteRange[1] - frag.byteRange[0] };\n                engine.setPlayingSegment(frag.url, byteRange, frag.start, frag.duration);\n            }\n        }\n    });\n    mediaElement.addEventListener(\"hlsDestroying\", async () => {\n        const hls = mediaElement.hlsPlayer;\n        if (hls && hls.config && hls.config.loader && typeof hls.config.loader.getEngine === \"function\") {\n            const engine = hls.config.loader.getEngine();\n            await engine.destroy();\n        }\n    });\n    mediaElement.addEventListener(\"hlsError\", (event) => {\n        const hls = mediaElement.hlsPlayer;\n        if (hls && hls.config && hls.config.loader && typeof hls.config.loader.getEngine === \"function\") {\n            if (event.data !== undefined && event.data.details === \"bufferStalledError\") {\n                const engine = hls.config.loader.getEngine();\n                engine.setPlayingSegmentByCurrentTime(hls.media.currentTime);\n            }\n        }\n    });\n}\nexports.initMediaElementJsPlayer = initMediaElementJsPlayer;\nfunction initJwPlayer(player, hlsjsConfig) {\n    const iid = setInterval(() => {\n        if (player.hls && player.hls.config) {\n            clearInterval(iid);\n            Object.assign(player.hls.config, hlsjsConfig);\n            initHlsJsPlayer(player.hls);\n        }\n    }, 200);\n}\nexports.initJwPlayer = initJwPlayer;\nfunction initHlsJsEvents(player, engine) {\n    player.on(\"hlsFragChanged\", (_event, data) => {\n        debug(\"HLS Frag changed.\", data);\n        const frag = data.frag;\n        const byteRange = frag.byteRange.length !== 2\n            ? undefined\n            : { offset: frag.byteRange[0], length: frag.byteRange[1] - frag.byteRange[0] };\n        engine.setPlayingSegment(frag.url, byteRange, frag.start, frag.duration);\n    });\n    player.on(\"hlsDestroying\", async () => {\n        await engine.destroy();\n    });\n    player.on(\"hlsError\", (_event, errorData) => {\n        if (errorData.details === \"bufferStalledError\") {\n            const htmlMediaElement = (player.media === undefined\n                ? player.el_ // videojs-contrib-hlsjs\n                : player.media); // all others\n            if (htmlMediaElement) {\n                engine.setPlayingSegmentByCurrentTime(htmlMediaElement.currentTime);\n            }\n        }\n    });\n    player.on('seeking', () => {\n        debug(\"Player seeking.\");\n        // Abort current HTTP/P2P request so HLS is not stuck with a P2P request when moving current video player time\n        // to a previously loaded fragment\n        engine.abortCurrentRequest();\n    });\n}\n","\"use strict\";\n/**\n * Copyright 2018 Novage LLC.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.SegmentManager = void 0;\nconst debug_1 = __importDefault(require(\"debug\"));\nconst p2p_media_loader_core_1 = require(\"@peertube/p2p-media-loader-core\");\nconst m3u8_parser_1 = require(\"m3u8-parser\");\nconst byte_range_1 = require(\"./byte-range\");\nconst defaultSettings = {\n    forwardSegmentCount: 20,\n    swarmId: undefined,\n    assetsStorage: undefined,\n};\nclass SegmentManager {\n    constructor(loader, settings = {}) {\n        this.debug = (0, debug_1.default)(\"p2pml:segment-manager\");\n        this.masterPlaylist = null;\n        this.variantPlaylists = new Map();\n        this.segmentRequest = null;\n        this.playQueue = [];\n        this.onSegmentLoaded = (segment) => {\n            if (this.segmentRequest &&\n                this.segmentRequest.segmentUrl === segment.url &&\n                (0, byte_range_1.byteRangeToString)(this.segmentRequest.segmentByteRange) === segment.range) {\n                // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n                this.segmentRequest.onSuccess(segment.data.slice(0), segment.downloadBandwidth);\n                this.segmentRequest = null;\n            }\n        };\n        this.onSegmentError = (segment, error) => {\n            if (this.segmentRequest &&\n                this.segmentRequest.segmentUrl === segment.url &&\n                (0, byte_range_1.byteRangeToString)(this.segmentRequest.segmentByteRange) === segment.range) {\n                this.segmentRequest.onError(error);\n                this.segmentRequest = null;\n            }\n        };\n        this.onSegmentAbort = (segment) => {\n            if (this.segmentRequest &&\n                this.segmentRequest.segmentUrl === segment.url &&\n                (0, byte_range_1.byteRangeToString)(this.segmentRequest.segmentByteRange) === segment.range) {\n                this.segmentRequest.onError(\"Loading aborted: internal abort\");\n                this.segmentRequest = null;\n            }\n        };\n        this.settings = Object.assign(Object.assign({}, defaultSettings), settings);\n        this.loader = loader;\n        this.loader.on(p2p_media_loader_core_1.Events.SegmentLoaded, this.onSegmentLoaded);\n        this.loader.on(p2p_media_loader_core_1.Events.SegmentError, this.onSegmentError);\n        this.loader.on(p2p_media_loader_core_1.Events.SegmentAbort, this.onSegmentAbort);\n    }\n    getSettings() {\n        return this.settings;\n    }\n    processPlaylist(requestUrl, content, responseUrl) {\n        const parser = new m3u8_parser_1.Parser();\n        parser.push(content);\n        parser.end();\n        const playlist = new Playlist(requestUrl, responseUrl, parser.manifest);\n        if (playlist.manifest.playlists) {\n            this.masterPlaylist = playlist;\n            for (const [key, variantPlaylist] of this.variantPlaylists) {\n                const { streamSwarmId, found, index } = this.getStreamSwarmId(variantPlaylist.requestUrl);\n                if (!found) {\n                    this.variantPlaylists.delete(key);\n                }\n                else {\n                    variantPlaylist.streamSwarmId = streamSwarmId;\n                    variantPlaylist.streamId = \"V\" + index.toString();\n                }\n            }\n        }\n        else {\n            const { streamSwarmId, found, index } = this.getStreamSwarmId(requestUrl);\n            if (found || this.masterPlaylist === null) {\n                // do not add audio and subtitles to variants\n                playlist.streamSwarmId = streamSwarmId;\n                playlist.streamId = this.masterPlaylist === null ? undefined : \"V\" + index.toString();\n                this.variantPlaylists.set(requestUrl, playlist);\n                this.updateSegments();\n            }\n        }\n    }\n    async loadPlaylist(url) {\n        const assetsStorage = this.settings.assetsStorage;\n        let xhr;\n        if (assetsStorage !== undefined) {\n            let masterSwarmId;\n            masterSwarmId = this.getMasterSwarmId();\n            if (masterSwarmId === undefined) {\n                masterSwarmId = url.split(\"?\")[0];\n            }\n            const asset = await assetsStorage.getAsset(url, undefined, masterSwarmId);\n            if (asset !== undefined) {\n                xhr = {\n                    responseURL: asset.responseUri,\n                    response: asset.data,\n                };\n            }\n            else {\n                xhr = await this.loadContent(url, \"text\");\n                void assetsStorage.storeAsset({\n                    masterManifestUri: this.masterPlaylist !== null ? this.masterPlaylist.requestUrl : url,\n                    masterSwarmId: masterSwarmId,\n                    requestUri: url,\n                    responseUri: xhr.responseURL,\n                    data: xhr.response,\n                });\n            }\n        }\n        else {\n            xhr = await this.loadContent(url, \"text\");\n        }\n        this.processPlaylist(url, xhr.response, xhr.responseURL);\n        return xhr;\n    }\n    async loadSegment(url, byteRange) {\n        var _a;\n        const segmentLocation = this.getSegmentLocation(url, byteRange);\n        const byteRangeString = (0, byte_range_1.byteRangeToString)(byteRange);\n        if (!segmentLocation) {\n            let content;\n            // Not a segment from variants; usually can be: init, audio or subtitles segment, encryption key etc.\n            const assetsStorage = this.settings.assetsStorage;\n            if (assetsStorage !== undefined) {\n                let masterManifestUri = (_a = this.masterPlaylist) === null || _a === void 0 ? void 0 : _a.requestUrl;\n                let masterSwarmId;\n                masterSwarmId = this.getMasterSwarmId();\n                if (masterSwarmId === undefined && this.variantPlaylists.size === 1) {\n                    const result = this.variantPlaylists.values().next();\n                    if (!result.done) {\n                        // always true\n                        masterSwarmId = result.value.requestUrl.split(\"?\")[0];\n                    }\n                }\n                if (masterManifestUri === undefined && this.variantPlaylists.size === 1) {\n                    const result = this.variantPlaylists.values().next();\n                    if (!result.done) {\n                        // always true\n                        masterManifestUri = result.value.requestUrl;\n                    }\n                }\n                if (masterSwarmId !== undefined && masterManifestUri !== undefined) {\n                    const asset = await assetsStorage.getAsset(url, byteRangeString, masterSwarmId);\n                    if (asset !== undefined) {\n                        content = asset.data;\n                    }\n                    else {\n                        const xhr = await this.loadContent(url, \"arraybuffer\", byteRangeString);\n                        content = xhr.response;\n                        void assetsStorage.storeAsset({\n                            masterManifestUri: masterManifestUri,\n                            masterSwarmId: masterSwarmId,\n                            requestUri: url,\n                            requestRange: byteRangeString,\n                            responseUri: xhr.responseURL,\n                            data: content,\n                        });\n                    }\n                }\n            }\n            if (content === undefined) {\n                const xhr = await this.loadContent(url, \"arraybuffer\", byteRangeString);\n                content = xhr.response;\n            }\n            return { content, downloadBandwidth: 0 };\n        }\n        const segmentSequence = (segmentLocation.playlist.manifest.mediaSequence ? segmentLocation.playlist.manifest.mediaSequence : 0) +\n            segmentLocation.segmentIndex;\n        if (this.playQueue.length > 0) {\n            const previousSegment = this.playQueue[this.playQueue.length - 1];\n            if (previousSegment.segmentSequence !== segmentSequence - 1) {\n                // Reset play queue in case of segment loading out of sequence\n                this.playQueue = [];\n            }\n        }\n        if (this.segmentRequest) {\n            this.segmentRequest.onError(\"Cancel segment request: simultaneous segment requests are not supported\");\n        }\n        const promise = new Promise((resolve, reject) => {\n            this.segmentRequest = new SegmentRequest(url, byteRange, segmentSequence, segmentLocation.playlist.requestUrl, (content, downloadBandwidth) => resolve({ content, downloadBandwidth }), (error) => reject(error));\n        });\n        this.playQueue.push({ segmentUrl: url, segmentByteRange: byteRange, segmentSequence: segmentSequence });\n        void this.loadSegments(segmentLocation.playlist, segmentLocation.segmentIndex, true);\n        return promise;\n    }\n    setPlayingSegment(url, byteRange, start, duration) {\n        const urlIndex = this.playQueue.findIndex((segment) => segment.segmentUrl === url && (0, byte_range_1.compareByteRanges)(segment.segmentByteRange, byteRange));\n        this.debug(\"Set playing segment to index %d\", urlIndex, this.playQueue);\n        if (urlIndex >= 0) {\n            this.playQueue = this.playQueue.slice(urlIndex);\n            this.playQueue[0].playPosition = { start, duration };\n            this.updateSegments();\n        }\n    }\n    setPlayingSegmentByCurrentTime(playheadPosition) {\n        if (this.playQueue.length === 0 || !this.playQueue[0].playPosition) {\n            return;\n        }\n        const currentSegmentPosition = this.playQueue[0].playPosition;\n        const segmentEndTime = currentSegmentPosition.start + currentSegmentPosition.duration;\n        if (segmentEndTime - playheadPosition < 0.2) {\n            // means that current segment is (almost) finished playing\n            // remove it from queue\n            this.playQueue = this.playQueue.slice(1);\n            this.updateSegments();\n        }\n    }\n    abortSegment(url, byteRange) {\n        if (this.segmentRequest &&\n            this.segmentRequest.segmentUrl === url &&\n            (0, byte_range_1.compareByteRanges)(this.segmentRequest.segmentByteRange, byteRange)) {\n            this.segmentRequest.onSuccess(undefined, 0);\n            this.segmentRequest = null;\n        }\n    }\n    abortCurrentSegment() {\n        if (!this.segmentRequest)\n            return;\n        this.segmentRequest.onSuccess(undefined, 0);\n        this.segmentRequest = null;\n    }\n    async destroy() {\n        if (this.segmentRequest) {\n            this.segmentRequest.onError(\"Loading aborted: object destroyed\");\n            this.segmentRequest = null;\n        }\n        this.masterPlaylist = null;\n        this.variantPlaylists.clear();\n        this.playQueue = [];\n        if (this.settings.assetsStorage !== undefined) {\n            await this.settings.assetsStorage.destroy();\n        }\n        await this.loader.destroy();\n    }\n    updateSegments() {\n        if (!this.segmentRequest) {\n            return;\n        }\n        const segmentLocation = this.getSegmentLocation(this.segmentRequest.segmentUrl, this.segmentRequest.segmentByteRange);\n        this.debug(\"update segments\", segmentLocation);\n        if (segmentLocation) {\n            void this.loadSegments(segmentLocation.playlist, segmentLocation.segmentIndex, false);\n        }\n    }\n    getSegmentLocation(url, byteRange) {\n        for (const playlist of this.variantPlaylists.values()) {\n            const segmentIndex = playlist.getSegmentIndex(url, byteRange);\n            if (segmentIndex >= 0) {\n                return { playlist: playlist, segmentIndex: segmentIndex };\n            }\n        }\n        return undefined;\n    }\n    async loadSegments(playlist, segmentIndex, requestFirstSegment) {\n        var _a;\n        const segments = [];\n        const playlistSegments = playlist.manifest.segments;\n        const initialSequence = (_a = playlist.manifest.mediaSequence) !== null && _a !== void 0 ? _a : 0;\n        let loadSegmentId = null;\n        let priority = Math.max(0, this.playQueue.length - 1);\n        const masterSwarmId = this.getMasterSwarmId();\n        this.debug(\"load segments\", priority, segmentIndex);\n        for (let i = segmentIndex; i < playlistSegments.length && segments.length < this.settings.forwardSegmentCount; ++i) {\n            const segment = playlist.manifest.segments[i];\n            const url = playlist.getSegmentAbsoluteUrl(segment.uri);\n            const byteRange = segment.byterange;\n            const id = this.getSegmentId(playlist, initialSequence + i);\n            segments.push({\n                id: id,\n                url: url,\n                masterSwarmId: masterSwarmId !== undefined ? masterSwarmId : playlist.streamSwarmId,\n                masterManifestUri: this.masterPlaylist !== null ? this.masterPlaylist.requestUrl : playlist.requestUrl,\n                streamId: playlist.streamId,\n                sequence: (initialSequence + i).toString(),\n                range: (0, byte_range_1.byteRangeToString)(byteRange),\n                priority: priority++,\n            });\n            if (requestFirstSegment && !loadSegmentId) {\n                loadSegmentId = id;\n            }\n        }\n        this.loader.load(segments, playlist.streamSwarmId);\n        if (loadSegmentId) {\n            const segment = await this.loader.getSegment(loadSegmentId);\n            if (segment) {\n                // Segment already loaded by loader\n                this.onSegmentLoaded(segment);\n            }\n        }\n    }\n    getSegmentId(playlist, segmentSequence) {\n        return `${playlist.streamSwarmId}+${segmentSequence}`;\n    }\n    getMasterSwarmId() {\n        const settingsSwarmId = this.settings.swarmId && this.settings.swarmId.length !== 0 ? this.settings.swarmId : undefined;\n        if (settingsSwarmId !== undefined) {\n            return settingsSwarmId;\n        }\n        return this.masterPlaylist !== null ? this.masterPlaylist.requestUrl.split(\"?\")[0] : undefined;\n    }\n    getStreamSwarmId(playlistUrl) {\n        const masterSwarmId = this.getMasterSwarmId();\n        if (this.masterPlaylist && this.masterPlaylist.manifest.playlists && masterSwarmId) {\n            for (let i = 0; i < this.masterPlaylist.manifest.playlists.length; ++i) {\n                const url = new URL(this.masterPlaylist.manifest.playlists[i].uri, this.masterPlaylist.responseUrl).toString();\n                if (url === playlistUrl) {\n                    return { streamSwarmId: `${masterSwarmId}+V${i}`, found: true, index: i };\n                }\n            }\n        }\n        return {\n            streamSwarmId: masterSwarmId !== null && masterSwarmId !== void 0 ? masterSwarmId : playlistUrl.split(\"?\")[0],\n            found: false,\n            index: -1,\n        };\n    }\n    async loadContent(url, responseType, range) {\n        return new Promise((resolve, reject) => {\n            const xhr = new XMLHttpRequest();\n            xhr.open(\"GET\", url, true);\n            xhr.responseType = responseType;\n            if (range) {\n                xhr.setRequestHeader(\"Range\", range);\n            }\n            xhr.addEventListener(\"readystatechange\", () => {\n                if (xhr.readyState !== 4)\n                    return;\n                if (xhr.status >= 200 && xhr.status < 300) {\n                    resolve(xhr);\n                }\n                else {\n                    reject(xhr.statusText);\n                }\n            });\n            const xhrSetup = this.loader.getSettings().xhrSetup;\n            if (xhrSetup) {\n                xhrSetup(xhr, url);\n            }\n            xhr.send();\n        });\n    }\n}\nexports.SegmentManager = SegmentManager;\nclass Playlist {\n    constructor(requestUrl, responseUrl, manifest) {\n        this.requestUrl = requestUrl;\n        this.responseUrl = responseUrl;\n        this.manifest = manifest;\n        this.streamSwarmId = \"\";\n    }\n    getSegmentIndex(url, byteRange) {\n        for (let i = 0; i < this.manifest.segments.length; ++i) {\n            const segment = this.manifest.segments[i];\n            const segmentUrl = this.getSegmentAbsoluteUrl(segment.uri);\n            if (url === segmentUrl && (0, byte_range_1.compareByteRanges)(segment.byterange, byteRange)) {\n                return i;\n            }\n        }\n        return -1;\n    }\n    getSegmentAbsoluteUrl(segmentUrl) {\n        return new URL(segmentUrl, this.responseUrl).toString();\n    }\n}\nclass SegmentRequest {\n    constructor(segmentUrl, segmentByteRange, segmentSequence, playlistRequestUrl, onSuccess, onError) {\n        this.segmentUrl = segmentUrl;\n        this.segmentByteRange = segmentByteRange;\n        this.segmentSequence = segmentSequence;\n        this.playlistRequestUrl = playlistRequestUrl;\n        this.onSuccess = onSuccess;\n        this.onError = onError;\n    }\n}\n","import window from 'global/window';\n\nvar atob = function atob(s) {\n  return window.atob ? window.atob(s) : Buffer.from(s, 'base64').toString('binary');\n};\n\nexport default function decodeB64ToUint8Array(b64Text) {\n  var decodedString = atob(b64Text);\n  var array = new Uint8Array(decodedString.length);\n\n  for (var i = 0; i < decodedString.length; i++) {\n    array[i] = decodedString.charCodeAt(i);\n  }\n\n  return array;\n}","/**\n * @file stream.js\n */\n\n/**\n * A lightweight readable stream implemention that handles event dispatching.\n *\n * @class Stream\n */\nvar Stream = /*#__PURE__*/function () {\n  function Stream() {\n    this.listeners = {};\n  }\n  /**\n   * Add a listener for a specified event type.\n   *\n   * @param {string} type the event name\n   * @param {Function} listener the callback to be invoked when an event of\n   * the specified type occurs\n   */\n\n\n  var _proto = Stream.prototype;\n\n  _proto.on = function on(type, listener) {\n    if (!this.listeners[type]) {\n      this.listeners[type] = [];\n    }\n\n    this.listeners[type].push(listener);\n  }\n  /**\n   * Remove a listener for a specified event type.\n   *\n   * @param {string} type the event name\n   * @param {Function} listener  a function previously registered for this\n   * type of event through `on`\n   * @return {boolean} if we could turn it off or not\n   */\n  ;\n\n  _proto.off = function off(type, listener) {\n    if (!this.listeners[type]) {\n      return false;\n    }\n\n    var index = this.listeners[type].indexOf(listener); // TODO: which is better?\n    // In Video.js we slice listener functions\n    // on trigger so that it does not mess up the order\n    // while we loop through.\n    //\n    // Here we slice on off so that the loop in trigger\n    // can continue using it's old reference to loop without\n    // messing up the order.\n\n    this.listeners[type] = this.listeners[type].slice(0);\n    this.listeners[type].splice(index, 1);\n    return index > -1;\n  }\n  /**\n   * Trigger an event of the specified type on this stream. Any additional\n   * arguments to this function are passed as parameters to event listeners.\n   *\n   * @param {string} type the event name\n   */\n  ;\n\n  _proto.trigger = function trigger(type) {\n    var callbacks = this.listeners[type];\n\n    if (!callbacks) {\n      return;\n    } // Slicing the arguments on every invocation of this method\n    // can add a significant amount of overhead. Avoid the\n    // intermediate object creation for the common case of a\n    // single callback argument\n\n\n    if (arguments.length === 2) {\n      var length = callbacks.length;\n\n      for (var i = 0; i < length; ++i) {\n        callbacks[i].call(this, arguments[1]);\n      }\n    } else {\n      var args = Array.prototype.slice.call(arguments, 1);\n      var _length = callbacks.length;\n\n      for (var _i = 0; _i < _length; ++_i) {\n        callbacks[_i].apply(this, args);\n      }\n    }\n  }\n  /**\n   * Destroys the stream and cleans up.\n   */\n  ;\n\n  _proto.dispose = function dispose() {\n    this.listeners = {};\n  }\n  /**\n   * Forwards all `data` events on this stream to the destination stream. The\n   * destination stream should provide a method `push` to receive the data\n   * events as they arrive.\n   *\n   * @param {Stream} destination the stream that will receive all `data` events\n   * @see http://nodejs.org/api/stream.html#stream_readable_pipe_destination_options\n   */\n  ;\n\n  _proto.pipe = function pipe(destination) {\n    this.on('data', function (data) {\n      destination.push(data);\n    });\n  };\n\n  return Stream;\n}();\n\nexport { Stream as default };","/*! @name m3u8-parser @version 4.7.1 @license Apache-2.0 */\nimport _inheritsLoose from '@babel/runtime/helpers/inheritsLoose';\nimport Stream from '@videojs/vhs-utils/es/stream.js';\nimport _extends from '@babel/runtime/helpers/extends';\nimport _assertThisInitialized from '@babel/runtime/helpers/assertThisInitialized';\nimport decodeB64ToUint8Array from '@videojs/vhs-utils/es/decode-b64-to-uint8-array.js';\n\n/**\n * A stream that buffers string input and generates a `data` event for each\n * line.\n *\n * @class LineStream\n * @extends Stream\n */\n\nvar LineStream = /*#__PURE__*/function (_Stream) {\n  _inheritsLoose(LineStream, _Stream);\n\n  function LineStream() {\n    var _this;\n\n    _this = _Stream.call(this) || this;\n    _this.buffer = '';\n    return _this;\n  }\n  /**\n   * Add new data to be parsed.\n   *\n   * @param {string} data the text to process\n   */\n\n\n  var _proto = LineStream.prototype;\n\n  _proto.push = function push(data) {\n    var nextNewline;\n    this.buffer += data;\n    nextNewline = this.buffer.indexOf('\\n');\n\n    for (; nextNewline > -1; nextNewline = this.buffer.indexOf('\\n')) {\n      this.trigger('data', this.buffer.substring(0, nextNewline));\n      this.buffer = this.buffer.substring(nextNewline + 1);\n    }\n  };\n\n  return LineStream;\n}(Stream);\n\nvar TAB = String.fromCharCode(0x09);\n\nvar parseByterange = function parseByterange(byterangeString) {\n  // optionally match and capture 0+ digits before `@`\n  // optionally match and capture 0+ digits after `@`\n  var match = /([0-9.]*)?@?([0-9.]*)?/.exec(byterangeString || '');\n  var result = {};\n\n  if (match[1]) {\n    result.length = parseInt(match[1], 10);\n  }\n\n  if (match[2]) {\n    result.offset = parseInt(match[2], 10);\n  }\n\n  return result;\n};\n/**\n * \"forgiving\" attribute list psuedo-grammar:\n * attributes -> keyvalue (',' keyvalue)*\n * keyvalue   -> key '=' value\n * key        -> [^=]*\n * value      -> '\"' [^\"]* '\"' | [^,]*\n */\n\n\nvar attributeSeparator = function attributeSeparator() {\n  var key = '[^=]*';\n  var value = '\"[^\"]*\"|[^,]*';\n  var keyvalue = '(?:' + key + ')=(?:' + value + ')';\n  return new RegExp('(?:^|,)(' + keyvalue + ')');\n};\n/**\n * Parse attributes from a line given the separator\n *\n * @param {string} attributes the attribute line to parse\n */\n\n\nvar parseAttributes = function parseAttributes(attributes) {\n  // split the string using attributes as the separator\n  var attrs = attributes.split(attributeSeparator());\n  var result = {};\n  var i = attrs.length;\n  var attr;\n\n  while (i--) {\n    // filter out unmatched portions of the string\n    if (attrs[i] === '') {\n      continue;\n    } // split the key and value\n\n\n    attr = /([^=]*)=(.*)/.exec(attrs[i]).slice(1); // trim whitespace and remove optional quotes around the value\n\n    attr[0] = attr[0].replace(/^\\s+|\\s+$/g, '');\n    attr[1] = attr[1].replace(/^\\s+|\\s+$/g, '');\n    attr[1] = attr[1].replace(/^['\"](.*)['\"]$/g, '$1');\n    result[attr[0]] = attr[1];\n  }\n\n  return result;\n};\n/**\n * A line-level M3U8 parser event stream. It expects to receive input one\n * line at a time and performs a context-free parse of its contents. A stream\n * interpretation of a manifest can be useful if the manifest is expected to\n * be too large to fit comfortably into memory or the entirety of the input\n * is not immediately available. Otherwise, it's probably much easier to work\n * with a regular `Parser` object.\n *\n * Produces `data` events with an object that captures the parser's\n * interpretation of the input. That object has a property `tag` that is one\n * of `uri`, `comment`, or `tag`. URIs only have a single additional\n * property, `line`, which captures the entirety of the input without\n * interpretation. Comments similarly have a single additional property\n * `text` which is the input without the leading `#`.\n *\n * Tags always have a property `tagType` which is the lower-cased version of\n * the M3U8 directive without the `#EXT` or `#EXT-X-` prefix. For instance,\n * `#EXT-X-MEDIA-SEQUENCE` becomes `media-sequence` when parsed. Unrecognized\n * tags are given the tag type `unknown` and a single additional property\n * `data` with the remainder of the input.\n *\n * @class ParseStream\n * @extends Stream\n */\n\n\nvar ParseStream = /*#__PURE__*/function (_Stream) {\n  _inheritsLoose(ParseStream, _Stream);\n\n  function ParseStream() {\n    var _this;\n\n    _this = _Stream.call(this) || this;\n    _this.customParsers = [];\n    _this.tagMappers = [];\n    return _this;\n  }\n  /**\n   * Parses an additional line of input.\n   *\n   * @param {string} line a single line of an M3U8 file to parse\n   */\n\n\n  var _proto = ParseStream.prototype;\n\n  _proto.push = function push(line) {\n    var _this2 = this;\n\n    var match;\n    var event; // strip whitespace\n\n    line = line.trim();\n\n    if (line.length === 0) {\n      // ignore empty lines\n      return;\n    } // URIs\n\n\n    if (line[0] !== '#') {\n      this.trigger('data', {\n        type: 'uri',\n        uri: line\n      });\n      return;\n    } // map tags\n\n\n    var newLines = this.tagMappers.reduce(function (acc, mapper) {\n      var mappedLine = mapper(line); // skip if unchanged\n\n      if (mappedLine === line) {\n        return acc;\n      }\n\n      return acc.concat([mappedLine]);\n    }, [line]);\n    newLines.forEach(function (newLine) {\n      for (var i = 0; i < _this2.customParsers.length; i++) {\n        if (_this2.customParsers[i].call(_this2, newLine)) {\n          return;\n        }\n      } // Comments\n\n\n      if (newLine.indexOf('#EXT') !== 0) {\n        _this2.trigger('data', {\n          type: 'comment',\n          text: newLine.slice(1)\n        });\n\n        return;\n      } // strip off any carriage returns here so the regex matching\n      // doesn't have to account for them.\n\n\n      newLine = newLine.replace('\\r', ''); // Tags\n\n      match = /^#EXTM3U/.exec(newLine);\n\n      if (match) {\n        _this2.trigger('data', {\n          type: 'tag',\n          tagType: 'm3u'\n        });\n\n        return;\n      }\n\n      match = /^#EXTINF:?([0-9\\.]*)?,?(.*)?$/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'inf'\n        };\n\n        if (match[1]) {\n          event.duration = parseFloat(match[1]);\n        }\n\n        if (match[2]) {\n          event.title = match[2];\n        }\n\n        _this2.trigger('data', event);\n\n        return;\n      }\n\n      match = /^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'targetduration'\n        };\n\n        if (match[1]) {\n          event.duration = parseInt(match[1], 10);\n        }\n\n        _this2.trigger('data', event);\n\n        return;\n      }\n\n      match = /^#EXT-X-VERSION:?([0-9.]*)?/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'version'\n        };\n\n        if (match[1]) {\n          event.version = parseInt(match[1], 10);\n        }\n\n        _this2.trigger('data', event);\n\n        return;\n      }\n\n      match = /^#EXT-X-MEDIA-SEQUENCE:?(\\-?[0-9.]*)?/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'media-sequence'\n        };\n\n        if (match[1]) {\n          event.number = parseInt(match[1], 10);\n        }\n\n        _this2.trigger('data', event);\n\n        return;\n      }\n\n      match = /^#EXT-X-DISCONTINUITY-SEQUENCE:?(\\-?[0-9.]*)?/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'discontinuity-sequence'\n        };\n\n        if (match[1]) {\n          event.number = parseInt(match[1], 10);\n        }\n\n        _this2.trigger('data', event);\n\n        return;\n      }\n\n      match = /^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'playlist-type'\n        };\n\n        if (match[1]) {\n          event.playlistType = match[1];\n        }\n\n        _this2.trigger('data', event);\n\n        return;\n      }\n\n      match = /^#EXT-X-BYTERANGE:?(.*)?$/.exec(newLine);\n\n      if (match) {\n        event = _extends(parseByterange(match[1]), {\n          type: 'tag',\n          tagType: 'byterange'\n        });\n\n        _this2.trigger('data', event);\n\n        return;\n      }\n\n      match = /^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'allow-cache'\n        };\n\n        if (match[1]) {\n          event.allowed = !/NO/.test(match[1]);\n        }\n\n        _this2.trigger('data', event);\n\n        return;\n      }\n\n      match = /^#EXT-X-MAP:?(.*)$/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'map'\n        };\n\n        if (match[1]) {\n          var attributes = parseAttributes(match[1]);\n\n          if (attributes.URI) {\n            event.uri = attributes.URI;\n          }\n\n          if (attributes.BYTERANGE) {\n            event.byterange = parseByterange(attributes.BYTERANGE);\n          }\n        }\n\n        _this2.trigger('data', event);\n\n        return;\n      }\n\n      match = /^#EXT-X-STREAM-INF:?(.*)$/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'stream-inf'\n        };\n\n        if (match[1]) {\n          event.attributes = parseAttributes(match[1]);\n\n          if (event.attributes.RESOLUTION) {\n            var split = event.attributes.RESOLUTION.split('x');\n            var resolution = {};\n\n            if (split[0]) {\n              resolution.width = parseInt(split[0], 10);\n            }\n\n            if (split[1]) {\n              resolution.height = parseInt(split[1], 10);\n            }\n\n            event.attributes.RESOLUTION = resolution;\n          }\n\n          if (event.attributes.BANDWIDTH) {\n            event.attributes.BANDWIDTH = parseInt(event.attributes.BANDWIDTH, 10);\n          }\n\n          if (event.attributes['PROGRAM-ID']) {\n            event.attributes['PROGRAM-ID'] = parseInt(event.attributes['PROGRAM-ID'], 10);\n          }\n        }\n\n        _this2.trigger('data', event);\n\n        return;\n      }\n\n      match = /^#EXT-X-MEDIA:?(.*)$/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'media'\n        };\n\n        if (match[1]) {\n          event.attributes = parseAttributes(match[1]);\n        }\n\n        _this2.trigger('data', event);\n\n        return;\n      }\n\n      match = /^#EXT-X-ENDLIST/.exec(newLine);\n\n      if (match) {\n        _this2.trigger('data', {\n          type: 'tag',\n          tagType: 'endlist'\n        });\n\n        return;\n      }\n\n      match = /^#EXT-X-DISCONTINUITY/.exec(newLine);\n\n      if (match) {\n        _this2.trigger('data', {\n          type: 'tag',\n          tagType: 'discontinuity'\n        });\n\n        return;\n      }\n\n      match = /^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'program-date-time'\n        };\n\n        if (match[1]) {\n          event.dateTimeString = match[1];\n          event.dateTimeObject = new Date(match[1]);\n        }\n\n        _this2.trigger('data', event);\n\n        return;\n      }\n\n      match = /^#EXT-X-KEY:?(.*)$/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'key'\n        };\n\n        if (match[1]) {\n          event.attributes = parseAttributes(match[1]); // parse the IV string into a Uint32Array\n\n          if (event.attributes.IV) {\n            if (event.attributes.IV.substring(0, 2).toLowerCase() === '0x') {\n              event.attributes.IV = event.attributes.IV.substring(2);\n            }\n\n            event.attributes.IV = event.attributes.IV.match(/.{8}/g);\n            event.attributes.IV[0] = parseInt(event.attributes.IV[0], 16);\n            event.attributes.IV[1] = parseInt(event.attributes.IV[1], 16);\n            event.attributes.IV[2] = parseInt(event.attributes.IV[2], 16);\n            event.attributes.IV[3] = parseInt(event.attributes.IV[3], 16);\n            event.attributes.IV = new Uint32Array(event.attributes.IV);\n          }\n        }\n\n        _this2.trigger('data', event);\n\n        return;\n      }\n\n      match = /^#EXT-X-START:?(.*)$/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'start'\n        };\n\n        if (match[1]) {\n          event.attributes = parseAttributes(match[1]);\n          event.attributes['TIME-OFFSET'] = parseFloat(event.attributes['TIME-OFFSET']);\n          event.attributes.PRECISE = /YES/.test(event.attributes.PRECISE);\n        }\n\n        _this2.trigger('data', event);\n\n        return;\n      }\n\n      match = /^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'cue-out-cont'\n        };\n\n        if (match[1]) {\n          event.data = match[1];\n        } else {\n          event.data = '';\n        }\n\n        _this2.trigger('data', event);\n\n        return;\n      }\n\n      match = /^#EXT-X-CUE-OUT:?(.*)?$/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'cue-out'\n        };\n\n        if (match[1]) {\n          event.data = match[1];\n        } else {\n          event.data = '';\n        }\n\n        _this2.trigger('data', event);\n\n        return;\n      }\n\n      match = /^#EXT-X-CUE-IN:?(.*)?$/.exec(newLine);\n\n      if (match) {\n        event = {\n          type: 'tag',\n          tagType: 'cue-in'\n        };\n\n        if (match[1]) {\n          event.data = match[1];\n        } else {\n          event.data = '';\n        }\n\n        _this2.trigger('data', event);\n\n        return;\n      }\n\n      match = /^#EXT-X-SKIP:(.*)$/.exec(newLine);\n\n      if (match && match[1]) {\n        event = {\n          type: 'tag',\n          tagType: 'skip'\n        };\n        event.attributes = parseAttributes(match[1]);\n\n        if (event.attributes.hasOwnProperty('SKIPPED-SEGMENTS')) {\n          event.attributes['SKIPPED-SEGMENTS'] = parseInt(event.attributes['SKIPPED-SEGMENTS'], 10);\n        }\n\n        if (event.attributes.hasOwnProperty('RECENTLY-REMOVED-DATERANGES')) {\n          event.attributes['RECENTLY-REMOVED-DATERANGES'] = event.attributes['RECENTLY-REMOVED-DATERANGES'].split(TAB);\n        }\n\n        _this2.trigger('data', event);\n\n        return;\n      }\n\n      match = /^#EXT-X-PART:(.*)$/.exec(newLine);\n\n      if (match && match[1]) {\n        event = {\n          type: 'tag',\n          tagType: 'part'\n        };\n        event.attributes = parseAttributes(match[1]);\n        ['DURATION'].forEach(function (key) {\n          if (event.attributes.hasOwnProperty(key)) {\n            event.attributes[key] = parseFloat(event.attributes[key]);\n          }\n        });\n        ['INDEPENDENT', 'GAP'].forEach(function (key) {\n          if (event.attributes.hasOwnProperty(key)) {\n            event.attributes[key] = /YES/.test(event.attributes[key]);\n          }\n        });\n\n        if (event.attributes.hasOwnProperty('BYTERANGE')) {\n          event.attributes.byterange = parseByterange(event.attributes.BYTERANGE);\n        }\n\n        _this2.trigger('data', event);\n\n        return;\n      }\n\n      match = /^#EXT-X-SERVER-CONTROL:(.*)$/.exec(newLine);\n\n      if (match && match[1]) {\n        event = {\n          type: 'tag',\n          tagType: 'server-control'\n        };\n        event.attributes = parseAttributes(match[1]);\n        ['CAN-SKIP-UNTIL', 'PART-HOLD-BACK', 'HOLD-BACK'].forEach(function (key) {\n          if (event.attributes.hasOwnProperty(key)) {\n            event.attributes[key] = parseFloat(event.attributes[key]);\n          }\n        });\n        ['CAN-SKIP-DATERANGES', 'CAN-BLOCK-RELOAD'].forEach(function (key) {\n          if (event.attributes.hasOwnProperty(key)) {\n            event.attributes[key] = /YES/.test(event.attributes[key]);\n          }\n        });\n\n        _this2.trigger('data', event);\n\n        return;\n      }\n\n      match = /^#EXT-X-PART-INF:(.*)$/.exec(newLine);\n\n      if (match && match[1]) {\n        event = {\n          type: 'tag',\n          tagType: 'part-inf'\n        };\n        event.attributes = parseAttributes(match[1]);\n        ['PART-TARGET'].forEach(function (key) {\n          if (event.attributes.hasOwnProperty(key)) {\n            event.attributes[key] = parseFloat(event.attributes[key]);\n          }\n        });\n\n        _this2.trigger('data', event);\n\n        return;\n      }\n\n      match = /^#EXT-X-PRELOAD-HINT:(.*)$/.exec(newLine);\n\n      if (match && match[1]) {\n        event = {\n          type: 'tag',\n          tagType: 'preload-hint'\n        };\n        event.attributes = parseAttributes(match[1]);\n        ['BYTERANGE-START', 'BYTERANGE-LENGTH'].forEach(function (key) {\n          if (event.attributes.hasOwnProperty(key)) {\n            event.attributes[key] = parseInt(event.attributes[key], 10);\n            var subkey = key === 'BYTERANGE-LENGTH' ? 'length' : 'offset';\n            event.attributes.byterange = event.attributes.byterange || {};\n            event.attributes.byterange[subkey] = event.attributes[key]; // only keep the parsed byterange object.\n\n            delete event.attributes[key];\n          }\n        });\n\n        _this2.trigger('data', event);\n\n        return;\n      }\n\n      match = /^#EXT-X-RENDITION-REPORT:(.*)$/.exec(newLine);\n\n      if (match && match[1]) {\n        event = {\n          type: 'tag',\n          tagType: 'rendition-report'\n        };\n        event.attributes = parseAttributes(match[1]);\n        ['LAST-MSN', 'LAST-PART'].forEach(function (key) {\n          if (event.attributes.hasOwnProperty(key)) {\n            event.attributes[key] = parseInt(event.attributes[key], 10);\n          }\n        });\n\n        _this2.trigger('data', event);\n\n        return;\n      } // unknown tag type\n\n\n      _this2.trigger('data', {\n        type: 'tag',\n        data: newLine.slice(4)\n      });\n    });\n  }\n  /**\n   * Add a parser for custom headers\n   *\n   * @param {Object}   options              a map of options for the added parser\n   * @param {RegExp}   options.expression   a regular expression to match the custom header\n   * @param {string}   options.customType   the custom type to register to the output\n   * @param {Function} [options.dataParser] function to parse the line into an object\n   * @param {boolean}  [options.segment]    should tag data be attached to the segment object\n   */\n  ;\n\n  _proto.addParser = function addParser(_ref) {\n    var _this3 = this;\n\n    var expression = _ref.expression,\n        customType = _ref.customType,\n        dataParser = _ref.dataParser,\n        segment = _ref.segment;\n\n    if (typeof dataParser !== 'function') {\n      dataParser = function dataParser(line) {\n        return line;\n      };\n    }\n\n    this.customParsers.push(function (line) {\n      var match = expression.exec(line);\n\n      if (match) {\n        _this3.trigger('data', {\n          type: 'custom',\n          data: dataParser(line),\n          customType: customType,\n          segment: segment\n        });\n\n        return true;\n      }\n    });\n  }\n  /**\n   * Add a custom header mapper\n   *\n   * @param {Object}   options\n   * @param {RegExp}   options.expression   a regular expression to match the custom header\n   * @param {Function} options.map          function to translate tag into a different tag\n   */\n  ;\n\n  _proto.addTagMapper = function addTagMapper(_ref2) {\n    var expression = _ref2.expression,\n        map = _ref2.map;\n\n    var mapFn = function mapFn(line) {\n      if (expression.test(line)) {\n        return map(line);\n      }\n\n      return line;\n    };\n\n    this.tagMappers.push(mapFn);\n  };\n\n  return ParseStream;\n}(Stream);\n\nvar camelCase = function camelCase(str) {\n  return str.toLowerCase().replace(/-(\\w)/g, function (a) {\n    return a[1].toUpperCase();\n  });\n};\n\nvar camelCaseKeys = function camelCaseKeys(attributes) {\n  var result = {};\n  Object.keys(attributes).forEach(function (key) {\n    result[camelCase(key)] = attributes[key];\n  });\n  return result;\n}; // set SERVER-CONTROL hold back based upon targetDuration and partTargetDuration\n// we need this helper because defaults are based upon targetDuration and\n// partTargetDuration being set, but they may not be if SERVER-CONTROL appears before\n// target durations are set.\n\n\nvar setHoldBack = function setHoldBack(manifest) {\n  var serverControl = manifest.serverControl,\n      targetDuration = manifest.targetDuration,\n      partTargetDuration = manifest.partTargetDuration;\n\n  if (!serverControl) {\n    return;\n  }\n\n  var tag = '#EXT-X-SERVER-CONTROL';\n  var hb = 'holdBack';\n  var phb = 'partHoldBack';\n  var minTargetDuration = targetDuration && targetDuration * 3;\n  var minPartDuration = partTargetDuration && partTargetDuration * 2;\n\n  if (targetDuration && !serverControl.hasOwnProperty(hb)) {\n    serverControl[hb] = minTargetDuration;\n    this.trigger('info', {\n      message: tag + \" defaulting HOLD-BACK to targetDuration * 3 (\" + minTargetDuration + \").\"\n    });\n  }\n\n  if (minTargetDuration && serverControl[hb] < minTargetDuration) {\n    this.trigger('warn', {\n      message: tag + \" clamping HOLD-BACK (\" + serverControl[hb] + \") to targetDuration * 3 (\" + minTargetDuration + \")\"\n    });\n    serverControl[hb] = minTargetDuration;\n  } // default no part hold back to part target duration * 3\n\n\n  if (partTargetDuration && !serverControl.hasOwnProperty(phb)) {\n    serverControl[phb] = partTargetDuration * 3;\n    this.trigger('info', {\n      message: tag + \" defaulting PART-HOLD-BACK to partTargetDuration * 3 (\" + serverControl[phb] + \").\"\n    });\n  } // if part hold back is too small default it to part target duration * 2\n\n\n  if (partTargetDuration && serverControl[phb] < minPartDuration) {\n    this.trigger('warn', {\n      message: tag + \" clamping PART-HOLD-BACK (\" + serverControl[phb] + \") to partTargetDuration * 2 (\" + minPartDuration + \").\"\n    });\n    serverControl[phb] = minPartDuration;\n  }\n};\n/**\n * A parser for M3U8 files. The current interpretation of the input is\n * exposed as a property `manifest` on parser objects. It's just two lines to\n * create and parse a manifest once you have the contents available as a string:\n *\n * ```js\n * var parser = new m3u8.Parser();\n * parser.push(xhr.responseText);\n * ```\n *\n * New input can later be applied to update the manifest object by calling\n * `push` again.\n *\n * The parser attempts to create a usable manifest object even if the\n * underlying input is somewhat nonsensical. It emits `info` and `warning`\n * events during the parse if it encounters input that seems invalid or\n * requires some property of the manifest object to be defaulted.\n *\n * @class Parser\n * @extends Stream\n */\n\n\nvar Parser = /*#__PURE__*/function (_Stream) {\n  _inheritsLoose(Parser, _Stream);\n\n  function Parser() {\n    var _this;\n\n    _this = _Stream.call(this) || this;\n    _this.lineStream = new LineStream();\n    _this.parseStream = new ParseStream();\n\n    _this.lineStream.pipe(_this.parseStream);\n    /* eslint-disable consistent-this */\n\n\n    var self = _assertThisInitialized(_this);\n    /* eslint-enable consistent-this */\n\n\n    var uris = [];\n    var currentUri = {}; // if specified, the active EXT-X-MAP definition\n\n    var currentMap; // if specified, the active decryption key\n\n    var _key;\n\n    var hasParts = false;\n\n    var noop = function noop() {};\n\n    var defaultMediaGroups = {\n      'AUDIO': {},\n      'VIDEO': {},\n      'CLOSED-CAPTIONS': {},\n      'SUBTITLES': {}\n    }; // This is the Widevine UUID from DASH IF IOP. The same exact string is\n    // used in MPDs with Widevine encrypted streams.\n\n    var widevineUuid = 'urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed'; // group segments into numbered timelines delineated by discontinuities\n\n    var currentTimeline = 0; // the manifest is empty until the parse stream begins delivering data\n\n    _this.manifest = {\n      allowCache: true,\n      discontinuityStarts: [],\n      segments: []\n    }; // keep track of the last seen segment's byte range end, as segments are not required\n    // to provide the offset, in which case it defaults to the next byte after the\n    // previous segment\n\n    var lastByterangeEnd = 0; // keep track of the last seen part's byte range end.\n\n    var lastPartByterangeEnd = 0;\n\n    _this.on('end', function () {\n      // only add preloadSegment if we don't yet have a uri for it.\n      // and we actually have parts/preloadHints\n      if (currentUri.uri || !currentUri.parts && !currentUri.preloadHints) {\n        return;\n      }\n\n      if (!currentUri.map && currentMap) {\n        currentUri.map = currentMap;\n      }\n\n      if (!currentUri.key && _key) {\n        currentUri.key = _key;\n      }\n\n      if (!currentUri.timeline && typeof currentTimeline === 'number') {\n        currentUri.timeline = currentTimeline;\n      }\n\n      _this.manifest.preloadSegment = currentUri;\n    }); // update the manifest with the m3u8 entry from the parse stream\n\n\n    _this.parseStream.on('data', function (entry) {\n      var mediaGroup;\n      var rendition;\n      ({\n        tag: function tag() {\n          // switch based on the tag type\n          (({\n            version: function version() {\n              if (entry.version) {\n                this.manifest.version = entry.version;\n              }\n            },\n            'allow-cache': function allowCache() {\n              this.manifest.allowCache = entry.allowed;\n\n              if (!('allowed' in entry)) {\n                this.trigger('info', {\n                  message: 'defaulting allowCache to YES'\n                });\n                this.manifest.allowCache = true;\n              }\n            },\n            byterange: function byterange() {\n              var byterange = {};\n\n              if ('length' in entry) {\n                currentUri.byterange = byterange;\n                byterange.length = entry.length;\n\n                if (!('offset' in entry)) {\n                  /*\n                   * From the latest spec (as of this writing):\n                   * https://tools.ietf.org/html/draft-pantos-http-live-streaming-23#section-4.3.2.2\n                   *\n                   * Same text since EXT-X-BYTERANGE's introduction in draft 7:\n                   * https://tools.ietf.org/html/draft-pantos-http-live-streaming-07#section-3.3.1)\n                   *\n                   * \"If o [offset] is not present, the sub-range begins at the next byte\n                   * following the sub-range of the previous media segment.\"\n                   */\n                  entry.offset = lastByterangeEnd;\n                }\n              }\n\n              if ('offset' in entry) {\n                currentUri.byterange = byterange;\n                byterange.offset = entry.offset;\n              }\n\n              lastByterangeEnd = byterange.offset + byterange.length;\n            },\n            endlist: function endlist() {\n              this.manifest.endList = true;\n            },\n            inf: function inf() {\n              if (!('mediaSequence' in this.manifest)) {\n                this.manifest.mediaSequence = 0;\n                this.trigger('info', {\n                  message: 'defaulting media sequence to zero'\n                });\n              }\n\n              if (!('discontinuitySequence' in this.manifest)) {\n                this.manifest.discontinuitySequence = 0;\n                this.trigger('info', {\n                  message: 'defaulting discontinuity sequence to zero'\n                });\n              }\n\n              if (entry.duration > 0) {\n                currentUri.duration = entry.duration;\n              }\n\n              if (entry.duration === 0) {\n                currentUri.duration = 0.01;\n                this.trigger('info', {\n                  message: 'updating zero segment duration to a small value'\n                });\n              }\n\n              this.manifest.segments = uris;\n            },\n            key: function key() {\n              if (!entry.attributes) {\n                this.trigger('warn', {\n                  message: 'ignoring key declaration without attribute list'\n                });\n                return;\n              } // clear the active encryption key\n\n\n              if (entry.attributes.METHOD === 'NONE') {\n                _key = null;\n                return;\n              }\n\n              if (!entry.attributes.URI) {\n                this.trigger('warn', {\n                  message: 'ignoring key declaration without URI'\n                });\n                return;\n              }\n\n              if (entry.attributes.KEYFORMAT === 'com.apple.streamingkeydelivery') {\n                this.manifest.contentProtection = this.manifest.contentProtection || {}; // TODO: add full support for this.\n\n                this.manifest.contentProtection['com.apple.fps.1_0'] = {\n                  attributes: entry.attributes\n                };\n                return;\n              }\n\n              if (entry.attributes.KEYFORMAT === 'com.microsoft.playready') {\n                this.manifest.contentProtection = this.manifest.contentProtection || {}; // TODO: add full support for this.\n\n                this.manifest.contentProtection['com.microsoft.playready'] = {\n                  uri: entry.attributes.URI\n                };\n                return;\n              } // check if the content is encrypted for Widevine\n              // Widevine/HLS spec: https://storage.googleapis.com/wvdocs/Widevine_DRM_HLS.pdf\n\n\n              if (entry.attributes.KEYFORMAT === widevineUuid) {\n                var VALID_METHODS = ['SAMPLE-AES', 'SAMPLE-AES-CTR', 'SAMPLE-AES-CENC'];\n\n                if (VALID_METHODS.indexOf(entry.attributes.METHOD) === -1) {\n                  this.trigger('warn', {\n                    message: 'invalid key method provided for Widevine'\n                  });\n                  return;\n                }\n\n                if (entry.attributes.METHOD === 'SAMPLE-AES-CENC') {\n                  this.trigger('warn', {\n                    message: 'SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead'\n                  });\n                }\n\n                if (entry.attributes.URI.substring(0, 23) !== 'data:text/plain;base64,') {\n                  this.trigger('warn', {\n                    message: 'invalid key URI provided for Widevine'\n                  });\n                  return;\n                }\n\n                if (!(entry.attributes.KEYID && entry.attributes.KEYID.substring(0, 2) === '0x')) {\n                  this.trigger('warn', {\n                    message: 'invalid key ID provided for Widevine'\n                  });\n                  return;\n                } // if Widevine key attributes are valid, store them as `contentProtection`\n                // on the manifest to emulate Widevine tag structure in a DASH mpd\n\n\n                this.manifest.contentProtection = this.manifest.contentProtection || {};\n                this.manifest.contentProtection['com.widevine.alpha'] = {\n                  attributes: {\n                    schemeIdUri: entry.attributes.KEYFORMAT,\n                    // remove '0x' from the key id string\n                    keyId: entry.attributes.KEYID.substring(2)\n                  },\n                  // decode the base64-encoded PSSH box\n                  pssh: decodeB64ToUint8Array(entry.attributes.URI.split(',')[1])\n                };\n                return;\n              }\n\n              if (!entry.attributes.METHOD) {\n                this.trigger('warn', {\n                  message: 'defaulting key method to AES-128'\n                });\n              } // setup an encryption key for upcoming segments\n\n\n              _key = {\n                method: entry.attributes.METHOD || 'AES-128',\n                uri: entry.attributes.URI\n              };\n\n              if (typeof entry.attributes.IV !== 'undefined') {\n                _key.iv = entry.attributes.IV;\n              }\n            },\n            'media-sequence': function mediaSequence() {\n              if (!isFinite(entry.number)) {\n                this.trigger('warn', {\n                  message: 'ignoring invalid media sequence: ' + entry.number\n                });\n                return;\n              }\n\n              this.manifest.mediaSequence = entry.number;\n            },\n            'discontinuity-sequence': function discontinuitySequence() {\n              if (!isFinite(entry.number)) {\n                this.trigger('warn', {\n                  message: 'ignoring invalid discontinuity sequence: ' + entry.number\n                });\n                return;\n              }\n\n              this.manifest.discontinuitySequence = entry.number;\n              currentTimeline = entry.number;\n            },\n            'playlist-type': function playlistType() {\n              if (!/VOD|EVENT/.test(entry.playlistType)) {\n                this.trigger('warn', {\n                  message: 'ignoring unknown playlist type: ' + entry.playlist\n                });\n                return;\n              }\n\n              this.manifest.playlistType = entry.playlistType;\n            },\n            map: function map() {\n              currentMap = {};\n\n              if (entry.uri) {\n                currentMap.uri = entry.uri;\n              }\n\n              if (entry.byterange) {\n                currentMap.byterange = entry.byterange;\n              }\n\n              if (_key) {\n                currentMap.key = _key;\n              }\n            },\n            'stream-inf': function streamInf() {\n              this.manifest.playlists = uris;\n              this.manifest.mediaGroups = this.manifest.mediaGroups || defaultMediaGroups;\n\n              if (!entry.attributes) {\n                this.trigger('warn', {\n                  message: 'ignoring empty stream-inf attributes'\n                });\n                return;\n              }\n\n              if (!currentUri.attributes) {\n                currentUri.attributes = {};\n              }\n\n              _extends(currentUri.attributes, entry.attributes);\n            },\n            media: function media() {\n              this.manifest.mediaGroups = this.manifest.mediaGroups || defaultMediaGroups;\n\n              if (!(entry.attributes && entry.attributes.TYPE && entry.attributes['GROUP-ID'] && entry.attributes.NAME)) {\n                this.trigger('warn', {\n                  message: 'ignoring incomplete or missing media group'\n                });\n                return;\n              } // find the media group, creating defaults as necessary\n\n\n              var mediaGroupType = this.manifest.mediaGroups[entry.attributes.TYPE];\n              mediaGroupType[entry.attributes['GROUP-ID']] = mediaGroupType[entry.attributes['GROUP-ID']] || {};\n              mediaGroup = mediaGroupType[entry.attributes['GROUP-ID']]; // collect the rendition metadata\n\n              rendition = {\n                default: /yes/i.test(entry.attributes.DEFAULT)\n              };\n\n              if (rendition.default) {\n                rendition.autoselect = true;\n              } else {\n                rendition.autoselect = /yes/i.test(entry.attributes.AUTOSELECT);\n              }\n\n              if (entry.attributes.LANGUAGE) {\n                rendition.language = entry.attributes.LANGUAGE;\n              }\n\n              if (entry.attributes.URI) {\n                rendition.uri = entry.attributes.URI;\n              }\n\n              if (entry.attributes['INSTREAM-ID']) {\n                rendition.instreamId = entry.attributes['INSTREAM-ID'];\n              }\n\n              if (entry.attributes.CHARACTERISTICS) {\n                rendition.characteristics = entry.attributes.CHARACTERISTICS;\n              }\n\n              if (entry.attributes.FORCED) {\n                rendition.forced = /yes/i.test(entry.attributes.FORCED);\n              } // insert the new rendition\n\n\n              mediaGroup[entry.attributes.NAME] = rendition;\n            },\n            discontinuity: function discontinuity() {\n              currentTimeline += 1;\n              currentUri.discontinuity = true;\n              this.manifest.discontinuityStarts.push(uris.length);\n            },\n            'program-date-time': function programDateTime() {\n              if (typeof this.manifest.dateTimeString === 'undefined') {\n                // PROGRAM-DATE-TIME is a media-segment tag, but for backwards\n                // compatibility, we add the first occurence of the PROGRAM-DATE-TIME tag\n                // to the manifest object\n                // TODO: Consider removing this in future major version\n                this.manifest.dateTimeString = entry.dateTimeString;\n                this.manifest.dateTimeObject = entry.dateTimeObject;\n              }\n\n              currentUri.dateTimeString = entry.dateTimeString;\n              currentUri.dateTimeObject = entry.dateTimeObject;\n            },\n            targetduration: function targetduration() {\n              if (!isFinite(entry.duration) || entry.duration < 0) {\n                this.trigger('warn', {\n                  message: 'ignoring invalid target duration: ' + entry.duration\n                });\n                return;\n              }\n\n              this.manifest.targetDuration = entry.duration;\n              setHoldBack.call(this, this.manifest);\n            },\n            start: function start() {\n              if (!entry.attributes || isNaN(entry.attributes['TIME-OFFSET'])) {\n                this.trigger('warn', {\n                  message: 'ignoring start declaration without appropriate attribute list'\n                });\n                return;\n              }\n\n              this.manifest.start = {\n                timeOffset: entry.attributes['TIME-OFFSET'],\n                precise: entry.attributes.PRECISE\n              };\n            },\n            'cue-out': function cueOut() {\n              currentUri.cueOut = entry.data;\n            },\n            'cue-out-cont': function cueOutCont() {\n              currentUri.cueOutCont = entry.data;\n            },\n            'cue-in': function cueIn() {\n              currentUri.cueIn = entry.data;\n            },\n            'skip': function skip() {\n              this.manifest.skip = camelCaseKeys(entry.attributes);\n              this.warnOnMissingAttributes_('#EXT-X-SKIP', entry.attributes, ['SKIPPED-SEGMENTS']);\n            },\n            'part': function part() {\n              var _this2 = this;\n\n              hasParts = true; // parts are always specifed before a segment\n\n              var segmentIndex = this.manifest.segments.length;\n              var part = camelCaseKeys(entry.attributes);\n              currentUri.parts = currentUri.parts || [];\n              currentUri.parts.push(part);\n\n              if (part.byterange) {\n                if (!part.byterange.hasOwnProperty('offset')) {\n                  part.byterange.offset = lastPartByterangeEnd;\n                }\n\n                lastPartByterangeEnd = part.byterange.offset + part.byterange.length;\n              }\n\n              var partIndex = currentUri.parts.length - 1;\n              this.warnOnMissingAttributes_(\"#EXT-X-PART #\" + partIndex + \" for segment #\" + segmentIndex, entry.attributes, ['URI', 'DURATION']);\n\n              if (this.manifest.renditionReports) {\n                this.manifest.renditionReports.forEach(function (r, i) {\n                  if (!r.hasOwnProperty('lastPart')) {\n                    _this2.trigger('warn', {\n                      message: \"#EXT-X-RENDITION-REPORT #\" + i + \" lacks required attribute(s): LAST-PART\"\n                    });\n                  }\n                });\n              }\n            },\n            'server-control': function serverControl() {\n              var attrs = this.manifest.serverControl = camelCaseKeys(entry.attributes);\n\n              if (!attrs.hasOwnProperty('canBlockReload')) {\n                attrs.canBlockReload = false;\n                this.trigger('info', {\n                  message: '#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false'\n                });\n              }\n\n              setHoldBack.call(this, this.manifest);\n\n              if (attrs.canSkipDateranges && !attrs.hasOwnProperty('canSkipUntil')) {\n                this.trigger('warn', {\n                  message: '#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set'\n                });\n              }\n            },\n            'preload-hint': function preloadHint() {\n              // parts are always specifed before a segment\n              var segmentIndex = this.manifest.segments.length;\n              var hint = camelCaseKeys(entry.attributes);\n              var isPart = hint.type && hint.type === 'PART';\n              currentUri.preloadHints = currentUri.preloadHints || [];\n              currentUri.preloadHints.push(hint);\n\n              if (hint.byterange) {\n                if (!hint.byterange.hasOwnProperty('offset')) {\n                  // use last part byterange end or zero if not a part.\n                  hint.byterange.offset = isPart ? lastPartByterangeEnd : 0;\n\n                  if (isPart) {\n                    lastPartByterangeEnd = hint.byterange.offset + hint.byterange.length;\n                  }\n                }\n              }\n\n              var index = currentUri.preloadHints.length - 1;\n              this.warnOnMissingAttributes_(\"#EXT-X-PRELOAD-HINT #\" + index + \" for segment #\" + segmentIndex, entry.attributes, ['TYPE', 'URI']);\n\n              if (!hint.type) {\n                return;\n              } // search through all preload hints except for the current one for\n              // a duplicate type.\n\n\n              for (var i = 0; i < currentUri.preloadHints.length - 1; i++) {\n                var otherHint = currentUri.preloadHints[i];\n\n                if (!otherHint.type) {\n                  continue;\n                }\n\n                if (otherHint.type === hint.type) {\n                  this.trigger('warn', {\n                    message: \"#EXT-X-PRELOAD-HINT #\" + index + \" for segment #\" + segmentIndex + \" has the same TYPE \" + hint.type + \" as preload hint #\" + i\n                  });\n                }\n              }\n            },\n            'rendition-report': function renditionReport() {\n              var report = camelCaseKeys(entry.attributes);\n              this.manifest.renditionReports = this.manifest.renditionReports || [];\n              this.manifest.renditionReports.push(report);\n              var index = this.manifest.renditionReports.length - 1;\n              var required = ['LAST-MSN', 'URI'];\n\n              if (hasParts) {\n                required.push('LAST-PART');\n              }\n\n              this.warnOnMissingAttributes_(\"#EXT-X-RENDITION-REPORT #\" + index, entry.attributes, required);\n            },\n            'part-inf': function partInf() {\n              this.manifest.partInf = camelCaseKeys(entry.attributes);\n              this.warnOnMissingAttributes_('#EXT-X-PART-INF', entry.attributes, ['PART-TARGET']);\n\n              if (this.manifest.partInf.partTarget) {\n                this.manifest.partTargetDuration = this.manifest.partInf.partTarget;\n              }\n\n              setHoldBack.call(this, this.manifest);\n            }\n          })[entry.tagType] || noop).call(self);\n        },\n        uri: function uri() {\n          currentUri.uri = entry.uri;\n          uris.push(currentUri); // if no explicit duration was declared, use the target duration\n\n          if (this.manifest.targetDuration && !('duration' in currentUri)) {\n            this.trigger('warn', {\n              message: 'defaulting segment duration to the target duration'\n            });\n            currentUri.duration = this.manifest.targetDuration;\n          } // annotate with encryption information, if necessary\n\n\n          if (_key) {\n            currentUri.key = _key;\n          }\n\n          currentUri.timeline = currentTimeline; // annotate with initialization segment information, if necessary\n\n          if (currentMap) {\n            currentUri.map = currentMap;\n          } // reset the last byterange end as it needs to be 0 between parts\n\n\n          lastPartByterangeEnd = 0; // prepare for the next URI\n\n          currentUri = {};\n        },\n        comment: function comment() {// comments are not important for playback\n        },\n        custom: function custom() {\n          // if this is segment-level data attach the output to the segment\n          if (entry.segment) {\n            currentUri.custom = currentUri.custom || {};\n            currentUri.custom[entry.customType] = entry.data; // if this is manifest-level data attach to the top level manifest object\n          } else {\n            this.manifest.custom = this.manifest.custom || {};\n            this.manifest.custom[entry.customType] = entry.data;\n          }\n        }\n      })[entry.type].call(self);\n    });\n\n    return _this;\n  }\n\n  var _proto = Parser.prototype;\n\n  _proto.warnOnMissingAttributes_ = function warnOnMissingAttributes_(identifier, attributes, required) {\n    var missing = [];\n    required.forEach(function (key) {\n      if (!attributes.hasOwnProperty(key)) {\n        missing.push(key);\n      }\n    });\n\n    if (missing.length) {\n      this.trigger('warn', {\n        message: identifier + \" lacks required attribute(s): \" + missing.join(', ')\n      });\n    }\n  }\n  /**\n   * Parse the input string and update the manifest object.\n   *\n   * @param {string} chunk a potentially incomplete portion of the manifest\n   */\n  ;\n\n  _proto.push = function push(chunk) {\n    this.lineStream.push(chunk);\n  }\n  /**\n   * Flush any remaining input. This can be handy if the last line of an M3U8\n   * manifest did not contain a trailing newline but the file has been\n   * completely received.\n   */\n  ;\n\n  _proto.end = function end() {\n    // flush any buffered input\n    this.lineStream.push('\\n');\n    this.trigger('end');\n  }\n  /**\n   * Add an additional parser for non-standard tags\n   *\n   * @param {Object}   options              a map of options for the added parser\n   * @param {RegExp}   options.expression   a regular expression to match the custom header\n   * @param {string}   options.type         the type to register to the output\n   * @param {Function} [options.dataParser] function to parse the line into an object\n   * @param {boolean}  [options.segment]    should tag data be attached to the segment object\n   */\n  ;\n\n  _proto.addParser = function addParser(options) {\n    this.parseStream.addParser(options);\n  }\n  /**\n   * Add a custom header mapper\n   *\n   * @param {Object}   options\n   * @param {RegExp}   options.expression   a regular expression to match the custom header\n   * @param {Function} options.map          function to translate tag into a different tag\n   */\n  ;\n\n  _proto.addTagMapper = function addTagMapper(options) {\n    this.parseStream.addTagMapper(options);\n  };\n\n  return Parser;\n}(Stream);\n\nexport { LineStream, ParseStream, Parser };\n","var Buffer = require('safe-buffer').Buffer\n\n// prototype class for hash functions\nfunction Hash (blockSize, finalSize) {\n  this._block = Buffer.alloc(blockSize)\n  this._finalSize = finalSize\n  this._blockSize = blockSize\n  this._len = 0\n}\n\nHash.prototype.update = function (data, enc) {\n  if (typeof data === 'string') {\n    enc = enc || 'utf8'\n    data = Buffer.from(data, enc)\n  }\n\n  var block = this._block\n  var blockSize = this._blockSize\n  var length = data.length\n  var accum = this._len\n\n  for (var offset = 0; offset < length;) {\n    var assigned = accum % blockSize\n    var remainder = Math.min(length - offset, blockSize - assigned)\n\n    for (var i = 0; i < remainder; i++) {\n      block[assigned + i] = data[offset + i]\n    }\n\n    accum += remainder\n    offset += remainder\n\n    if ((accum % blockSize) === 0) {\n      this._update(block)\n    }\n  }\n\n  this._len += length\n  return this\n}\n\nHash.prototype.digest = function (enc) {\n  var rem = this._len % this._blockSize\n\n  this._block[rem] = 0x80\n\n  // zero (rem + 1) trailing bits, where (rem + 1) is the smallest\n  // non-negative solution to the equation (length + 1 + (rem + 1)) === finalSize mod blockSize\n  this._block.fill(0, rem + 1)\n\n  if (rem >= this._finalSize) {\n    this._update(this._block)\n    this._block.fill(0)\n  }\n\n  var bits = this._len * 8\n\n  // uint32\n  if (bits <= 0xffffffff) {\n    this._block.writeUInt32BE(bits, this._blockSize - 4)\n\n  // uint64\n  } else {\n    var lowBits = (bits & 0xffffffff) >>> 0\n    var highBits = (bits - lowBits) / 0x100000000\n\n    this._block.writeUInt32BE(highBits, this._blockSize - 8)\n    this._block.writeUInt32BE(lowBits, this._blockSize - 4)\n  }\n\n  this._update(this._block)\n  var hash = this._hash()\n\n  return enc ? hash.toString(enc) : hash\n}\n\nHash.prototype._update = function () {\n  throw new Error('_update must be implemented by subclass')\n}\n\nmodule.exports = Hash\n","/*\n * A JavaScript implementation of the Secure Hash Algorithm, SHA-1, as defined\n * in FIPS PUB 180-1\n * Version 2.1a Copyright Paul Johnston 2000 - 2002.\n * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet\n * Distributed under the BSD License\n * See http://pajhome.org.uk/crypt/md5 for details.\n */\n\nvar inherits = require('inherits')\nvar Hash = require('./hash')\nvar Buffer = require('safe-buffer').Buffer\n\nvar K = [\n  0x5a827999, 0x6ed9eba1, 0x8f1bbcdc | 0, 0xca62c1d6 | 0\n]\n\nvar W = new Array(80)\n\nfunction Sha1 () {\n  this.init()\n  this._w = W\n\n  Hash.call(this, 64, 56)\n}\n\ninherits(Sha1, Hash)\n\nSha1.prototype.init = function () {\n  this._a = 0x67452301\n  this._b = 0xefcdab89\n  this._c = 0x98badcfe\n  this._d = 0x10325476\n  this._e = 0xc3d2e1f0\n\n  return this\n}\n\nfunction rotl1 (num) {\n  return (num << 1) | (num >>> 31)\n}\n\nfunction rotl5 (num) {\n  return (num << 5) | (num >>> 27)\n}\n\nfunction rotl30 (num) {\n  return (num << 30) | (num >>> 2)\n}\n\nfunction ft (s, b, c, d) {\n  if (s === 0) return (b & c) | ((~b) & d)\n  if (s === 2) return (b & c) | (b & d) | (c & d)\n  return b ^ c ^ d\n}\n\nSha1.prototype._update = function (M) {\n  var W = this._w\n\n  var a = this._a | 0\n  var b = this._b | 0\n  var c = this._c | 0\n  var d = this._d | 0\n  var e = this._e | 0\n\n  for (var i = 0; i < 16; ++i) W[i] = M.readInt32BE(i * 4)\n  for (; i < 80; ++i) W[i] = rotl1(W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16])\n\n  for (var j = 0; j < 80; ++j) {\n    var s = ~~(j / 20)\n    var t = (rotl5(a) + ft(s, b, c, d) + e + W[j] + K[s]) | 0\n\n    e = d\n    d = c\n    c = rotl30(b)\n    b = a\n    a = t\n  }\n\n  this._a = (a + this._a) | 0\n  this._b = (b + this._b) | 0\n  this._c = (c + this._c) | 0\n  this._d = (d + this._d) | 0\n  this._e = (e + this._e) | 0\n}\n\nSha1.prototype._hash = function () {\n  var H = Buffer.allocUnsafe(20)\n\n  H.writeInt32BE(this._a | 0, 0)\n  H.writeInt32BE(this._b | 0, 4)\n  H.writeInt32BE(this._c | 0, 8)\n  H.writeInt32BE(this._d | 0, 12)\n  H.writeInt32BE(this._e | 0, 16)\n\n  return H\n}\n\nmodule.exports = Sha1\n","export default function _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}","export default function _extends() {\n  _extends = Object.assign ? Object.assign.bind() : function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}"],"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","BandwidthApproximator","debug_1","require","debug","default","SMOOTH_INTERVAL","MEASURE_INTERVAL","NumberWithTime","timeStamp","lastBytes","currentBytesSum","lastBandwidth","addBytes","bytes","push","shift","interval","Math","min","getBandwidth","length","maxBandwidth","bandwidth","getSmoothInterval","getMeasureInterval","HttpMediaManager","stringly_typed_event_emitter_1","FilteredEmitter","STEEmitter","settings","xhrRequests","Map","failedSegments","download","segment","downloadedPieces","isDownloading","cleanTimedOutFailedSegments","emit","segmentUrl","priority","skipSegmentBuilderPriority","url","buildSegmentUrl","requestUrl","xhr","XMLHttpRequest","open","responseType","range","setRequestHeader","undefined","httpUseRanges","bytesDownloaded","piece","byteLength","setupXhrEvents","xhrSetup","set","id","initialPriority","send","updatePriority","request","get","Error","abort","delete","has","isFailed","time","now","getActiveDownloads","getActiveDownloadsCount","size","destroy","forEach","clear","prevBytesLoaded","addEventListener","event","bytesLoaded","loaded","lengthComputable","total","status","segmentFailure","data","response","segmentData","Uint8Array","offset","buffer","segmentDownloadFinished","responseUrl","responseURL","segmentValidator","assign","error","httpFailedSegmentTimeout","candidates","performance","segmentUrlBuilder","HybridLoader","events_1","simple_peer_1","loader_interface_1","http_media_manager_1","p2p_media_manager_1","media_peer_1","bandwidth_approximator_1","segments_memory_storage_1","defaultSettings","cachedSegmentExpiration","cachedSegmentsCount","useP2P","consumeOnly","requiredSegmentsPriority","simultaneousHttpDownloads","httpDownloadProbability","httpDownloadProbabilityInterval","httpDownloadProbabilitySkipIfNoPeers","httpDownloadMaxPriority","httpDownloadInitialTimeout","httpDownloadInitialTimeoutPerSegment","simultaneousP2PDownloads","p2pDownloadMaxPriority","p2pSegmentDownloadTimeout","webRtcMaxMessageSize","trackerAnnounce","peerRequestsPerAnnounce","rtcConfig","config","debugSegments","segmentsQueue","bandwidthApproximator","httpDownloadInitialTimeoutTimestamp","Infinity","createHttpManager","createP2PManager","P2PMediaManager","segmentsStorage","load","segments","streamSwarmId","initRandomDownloadIntervalIfNeeded","masterSwarmId","p2pManager","setStreamSwarmId","updateSegmentsMap","abortUnknownSegments","enabled","find","f","storageSegments","getSegmentsMap","processSegmentsQueue","cleanSegmentsStorage","sendSegmentsMapToAll","createSegmentsMap","getSegment","getSettings","getDetails","peerId","getPeerId","getBandwidthEstimate","httpRandomDownloadInterval","clearInterval","httpManager","processInitialSegmentTimeout","setTimeout","currentPriority","segmentsMap","httpAllowed","firstNotDownloadePriority","httpTimeout","scheduleNewProcessQueue","index","tryHTTP","i","segmentToAbort","getOverallSegmentsMap","MediaPeerSegmentStatus","Loaded","downloadRandomSegmentOverHttp","getPeers","pendingQueue","filter","s","random","floor","onSegmentStartLoad","method","Events","SegmentStartLoad","onPieceBytesDownloaded","PieceBytesDownloaded","onPieceBytesUploaded","PieceBytesUploaded","onSegmentLoaded","downloadBandwidth","storeSegment","SegmentLoaded","onSegmentError","details","SegmentError","onSegmentSize","SegmentSize","getStreamSwarmId","streamId","addSegmentToMap","segmentId","sequence","segmentsIdsAndStatuses","segmentsStatuses","storageSegment","values","LoadingByHttp","onPeerConnect","peer","PeerConnect","sendSegmentsMap","onPeerClose","PeerClose","onTrackerUpdate","incomplete","clean","queueSegment","setInterval","SegmentAbort","bufferedSegmentsCount","SegmentsMemoryStorage","on","EventEmitter","isSupported","window","RTCPeerConnection","prototype","createDataChannel","__createBinding","create","o","m","k","k2","desc","getOwnPropertyDescriptor","writable","configurable","enumerable","__exportStar","p","hasOwnProperty","call","version","MediaPeer","buffer_1","MediaPeerCommands","DownloadingSegment","pieces","remoteAddress","downloadingSegmentId","downloadingSegment","timer","terminateSegmentRequest","onPeerError","receiveSegmentPiece","getJsonCommand","JSON","parse","TextDecoder","decode","_a","onPeerData","command","c","SegmentsMap","SegmentRequest","SegmentData","cancelResponseTimeoutTimer","SegmentAbsent","CancelSegmentRequest","keys","swarmData","Array","segmentsIds","split","segmentStatus","sendCommand","write","stringify","getDownloadingSegmentId","sendSegmentData","bytesLeft","bytesToSend","Buffer","from","sendSegmentAbsent","requestSegment","runResponseTimeoutTimer","cancelSegmentRequest","clearTimeout","client_1","sha1_1","index_1","PEER_PROTOCOL_VERSION","PEER_ID_VERSION_STRING","replace","v","parseInt","slice","PEER_ID_VERSION_PREFIX","PeerSegmentRequest","generatePeerId","PEER_ID_SYMBOLS","PEER_ID_LENGTH","charAt","TextEncoder","encode","trackerClient","peers","peerCandidates","peerSegmentRequests","pendingTrackerClient","toString","isDestroyed","infoHash","update","digest","createClient","clientOptions","announce","port","getAnnounceOpts","numwant","oldTrackerClient","onTrackerError","onTrackerWarning","onTrackerPeer","start","warning","trackerPeer","onPeerDataUpdated","onSegmentRequest","onSegmentAbsent","onSegmentTimeout","peerCandidatesById","peerSegmentRequest","swarmChange","stop","removeAllListeners","peerCandidateById","peerCandidate","overallSegmentsMap","connectedPeer","indexOf","splice","key","description","ArrayBuffer","cache","lastAccessed","cacheItem","hasSegment","lockedSegmentsFilter","segmentsToDelete","remainingSegments","cachedSegment","countOverhead","sort","a","b","arguments","listener","args","byteRangeToString","compareByteRanges","getByteRange","context","rangeEnd","rangeStart","b1","b2","byteRange","end","Engine","p2p_media_loader_core_1","segment_manager_1","hlsjs_loader_1","loader","segmentManager","SegmentManager","map","eventKey","engine","callbacks","impl","getResponseHeader","HlsJsLoader","setLatestLoaderImpl","stats","getEngine","latestLoaderImpl","duration","setPlayingSegment","playheadPosition","setPlayingSegmentByCurrentTime","byte_range_1","aborted","retry","chunkCount","bwEstimate","loading","first","parsing","buffering","boundOnSegmentAbort","onSegmentAbort","bind","boundOnUpdateSegmentSize","onUpdateSegmentSize","boundOnUpdateLoaded","onUpdateLoaded","boundOnSegmentStartLoad","debugId","_config","updateStatsToStartLoading","type","result","loadPlaylist","successPlaylist","e","frag","loadSegment","content","successSegment","cleanup","console","warn","abortSegment","onAbort","onSuccess","onProgress","onError","off","isSegment","_type","initJwPlayer","initMediaElementJsPlayer","initVideoJsHlsJsPlugin","initVideoJsContribHlsJsPlayer","initFlowplayerHlsJsPlayer","initClapprPlayer","initHlsJsPlayer","player","initHlsJsEvents","playback","core","getCurrentPlayback","_hls","_p2pm_linitialized","hlsjs","hls","ready","options","tech_","options_","hlsjsConfig","videojs","Html5Hlsjs","addHook","videojsPlayer","mediaElement","hlsPlayer","media","currentTime","iid","_event","errorData","htmlMediaElement","el_","abortCurrentRequest","m3u8_parser_1","forwardSegmentCount","swarmId","assetsStorage","masterPlaylist","variantPlaylists","segmentRequest","playQueue","segmentByteRange","parser","Parser","playlist","Playlist","manifest","playlists","variantPlaylist","found","updateSegments","getMasterSwarmId","asset","getAsset","responseUri","loadContent","storeAsset","masterManifestUri","requestUri","processPlaylist","segmentLocation","getSegmentLocation","byteRangeString","next","done","requestRange","segmentSequence","mediaSequence","segmentIndex","previousSegment","promise","Promise","resolve","reject","loadSegments","urlIndex","findIndex","playPosition","currentSegmentPosition","segmentEndTime","getSegmentIndex","requestFirstSegment","playlistSegments","initialSequence","loadSegmentId","max","getSegmentAbsoluteUrl","uri","byterange","getSegmentId","settingsSwarmId","playlistUrl","URL","readyState","statusText","playlistRequestUrl","atob","decodeB64ToUint8Array","b64Text","decodedString","array","charCodeAt","Stream","listeners","_proto","trigger","_length","_i","apply","dispose","pipe","destination","_inheritsLoose","_extends","_assertThisInitialized","LineStream","_Stream","_this","nextNewline","substring","TAB","String","fromCharCode","parseByterange","byterangeString","match","exec","attributeSeparator","keyvalue","RegExp","parseAttributes","attributes","attrs","attr","ParseStream","customParsers","tagMappers","line","_this2","trim","newLines","reduce","acc","mapper","mappedLine","concat","newLine","text","tagType","parseFloat","title","number","playlistType","allowed","test","URI","BYTERANGE","RESOLUTION","resolution","width","height","BANDWIDTH","dateTimeString","dateTimeObject","Date","IV","toLowerCase","Uint32Array","PRECISE","subkey","addParser","_ref","_this3","expression","customType","dataParser","addTagMapper","_ref2","mapFn","camelCase","str","toUpperCase","camelCaseKeys","setHoldBack","serverControl","targetDuration","partTargetDuration","tag","hb","phb","minTargetDuration","minPartDuration","message","lineStream","parseStream","self","uris","currentUri","currentMap","_key","hasParts","noop","defaultMediaGroups","widevineUuid","currentTimeline","allowCache","discontinuityStarts","lastByterangeEnd","lastPartByterangeEnd","parts","preloadHints","timeline","preloadSegment","entry","mediaGroup","rendition","endlist","endList","inf","discontinuitySequence","METHOD","KEYFORMAT","contentProtection","VALID_METHODS","KEYID","schemeIdUri","keyId","pssh","iv","isFinite","streamInf","mediaGroups","TYPE","NAME","mediaGroupType","DEFAULT","autoselect","AUTOSELECT","LANGUAGE","language","instreamId","CHARACTERISTICS","characteristics","FORCED","forced","discontinuity","programDateTime","targetduration","isNaN","timeOffset","precise","cueOut","cueOutCont","cueIn","skip","warnOnMissingAttributes_","part","partIndex","renditionReports","r","canBlockReload","canSkipDateranges","preloadHint","hint","isPart","otherHint","renditionReport","report","required","partInf","partTarget","comment","custom","identifier","missing","join","chunk","Hash","blockSize","finalSize","_block","alloc","_finalSize","_blockSize","_len","enc","block","accum","assigned","remainder","_update","rem","fill","bits","writeUInt32BE","lowBits","highBits","hash","_hash","module","inherits","K","W","Sha1","init","_w","_b","_c","_d","_e","rotl1","num","rotl5","rotl30","ft","d","M","readInt32BE","j","t","H","allocUnsafe","writeInt32BE","ReferenceError","target","source","setPrototypeOf","subClass","superClass","constructor","_setPrototypeOf","__proto__"],"sourceRoot":""}