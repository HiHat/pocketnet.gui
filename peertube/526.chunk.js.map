{"version":3,"file":"526.chunk.js?v=8518","mappings":"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","sources":["webpack://peertube-client/./src/assets/player/shared/videojs-helpers/guid.js","webpack://peertube-client/./src/assets/player/shared/videojs-helpers/fn.js","webpack://peertube-client/./src/assets/player/shared/videojs-helpers/hotkeys.js","webpack://peertube-client/./src/assets/player/peertube-player-local-storage.ts","webpack://peertube-client/./src/assets/player/shared/upnext/end-card.ts","webpack://peertube-client/./src/assets/player/shared/upnext/upnext-plugin.ts","webpack://peertube-client/./src/assets/player/shared/stats/stats-card.ts","webpack://peertube-client/./src/assets/player/shared/stats/stats-plugin.ts","webpack://peertube-client/./src/assets/player/shared/bezels/pause-bezel.ts","webpack://peertube-client/./src/assets/player/shared/bezels/bezels-plugin.ts","webpack://peertube-client/./src/assets/player/shared/peertube/peertube-plugin.ts","webpack://peertube-client/./src/assets/player/shared/resolutions/peertube-resolutions-plugin.ts","webpack://peertube-client/./src/assets/player/shared/control-bar/next-previous-video-button.ts","webpack://peertube-client/./src/assets/player/shared/control-bar/p2p-info-button.ts","webpack://peertube-client/./src/assets/player/shared/control-bar/picture-in-picture-bastyon.ts","webpack://peertube-client/./src/assets/player/shared/control-bar/peertube-load-progress-bar.ts","webpack://peertube-client/./src/assets/player/shared/control-bar/theater-button.ts","webpack://peertube-client/./src/assets/player/shared/settings/resolution-menu-item.ts","webpack://peertube-client/./src/assets/player/shared/settings/resolution-menu-button.ts","webpack://peertube-client/./src/assets/player/shared/settings/settings-dialog.ts","webpack://peertube-client/./src/assets/player/shared/settings/settings-menu-item.ts","webpack://peertube-client/./src/assets/player/shared/settings/settings-menu-button.ts","webpack://peertube-client/./src/assets/player/shared/settings/settings-panel.ts","webpack://peertube-client/./src/assets/player/shared/settings/settings-panel-child.ts","webpack://peertube-client/./src/assets/player/shared/playlist/playlist-button.ts","webpack://peertube-client/./src/assets/player/shared/playlist/playlist-menu-item.ts","webpack://peertube-client/./src/assets/player/shared/playlist/playlist-menu.ts","webpack://peertube-client/./src/assets/player/shared/playlist/playlist-plugin.ts","webpack://peertube-client/./src/assets/player/shared/mobile/peertube-mobile-plugin.ts","webpack://peertube-client/./src/assets/player/shared/mobile/peertube-mobile-buttons.ts","webpack://peertube-client/./src/assets/player/shared/hotkeys/peertube-hotkeys-plugin.ts","webpack://peertube-client/./src/root-helpers/utils.ts","webpack://peertube-client/./src/assets/player/shared/manager-options/control-bar-options-builder.ts","webpack://peertube-client/./src/assets/player/shared/p2p-media-loader/redundancy-url-manager.ts","webpack://peertube-client/./src/assets/player/shared/p2p-media-loader/segment-url-builder.ts","webpack://peertube-client/./src/assets/player/shared/p2p-media-loader/segment-validator.ts","webpack://peertube-client/./src/assets/player/shared/manager-options/hls-options-builder.ts","webpack://peertube-client/./src/assets/player/shared/manager-options/webtorrent-options-builder.ts","webpack://peertube-client/./src/assets/player/shared/manager-options/manager-options-builder.ts","webpack://peertube-client/./src/assets/player/peertube-player-manager.ts","webpack://peertube-client/./src/assets/player/shared/common/utils.ts","webpack://peertube-client/./src/root-helpers/web-browser.ts","webpack://peertube-client/./src/shims/path.ts","webpack://peertube-client/../shared/core-utils/i18n/i18n.ts","webpack://peertube-client/../shared/core-utils/common/date.ts","webpack://peertube-client/../shared/core-utils/common/object.ts","webpack://peertube-client/../shared/core-utils/common/url.ts","webpack://peertube-client/../shared/core-utils/renderer/markdown.ts"],"sourcesContent":["/**\r\n * @file guid.js\r\n * @module guid\r\n */\r\n\r\n// Default value for GUIDs. This allows us to reset the GUID counter in tests.\r\n//\r\n// The initial GUID is 3 because some users have come to rely on the first\r\n// default player ID ending up as `vjs_video_3`.\r\n//\r\n// See: https://github.com/videojs/video.js/pull/6216\r\nconst _initialGuid = 3;\r\n\r\n/**\r\n * Unique ID for an element or function\r\n *\r\n * @type {Number}\r\n */\r\nlet _guid = _initialGuid;\r\n\r\n/**\r\n * Get a unique auto-incrementing ID by number that has not been returned before.\r\n *\r\n * @return {number}\r\n *         A new unique ID.\r\n */\r\nexport function newGUID() {\r\n  return _guid++;\r\n}\r\n\r\n/**\r\n * Reset the unique auto-incrementing ID for testing only.\r\n */\r\nexport function resetGuidInTestsOnly() {\r\n  _guid = _initialGuid;\r\n}","\r\n/**\r\n * @file fn.js\r\n * @module fn\r\n */\r\n import { newGUID } from './guid.js';\r\n import window from 'global/window';\r\n \r\n export const UPDATE_REFRESH_INTERVAL = 30;\r\n \r\n /**\r\n  * Bind (a.k.a proxy or context). A simple method for changing the context of\r\n  * a function.\r\n  *\r\n  * It also stores a unique id on the function so it can be easily removed from\r\n  * events.\r\n  *\r\n  * @function\r\n  * @param    {Mixed} context\r\n  *           The object to bind as scope.\r\n  *\r\n  * @param    {Function} fn\r\n  *           The function to be bound to a scope.\r\n  *\r\n  * @param    {number} [uid]\r\n  *           An optional unique ID for the function to be set\r\n  *\r\n  * @return   {Function}\r\n  *           The new function that will be bound into the context given\r\n  */\r\n export const bind = function(context, fn, uid) {\r\n   // Make sure the function has a unique ID\r\n   if (!fn.guid) {\r\n     fn.guid = newGUID();\r\n   }\r\n \r\n   // Create the new function that changes the context\r\n   const bound = fn.bind(context);\r\n \r\n   // Allow for the ability to individualize this function\r\n   // Needed in the case where multiple objects might share the same prototype\r\n   // IF both items add an event listener with the same function, then you try to remove just one\r\n   // it will remove both because they both have the same guid.\r\n   // when using this, you need to use the bind method when you remove the listener as well.\r\n   // currently used in text tracks\r\n   bound.guid = (uid) ? uid + '_' + fn.guid : fn.guid;\r\n \r\n   return bound;\r\n };\r\n \r\n /**\r\n  * Wraps the given function, `fn`, with a new function that only invokes `fn`\r\n  * at most once per every `wait` milliseconds.\r\n  *\r\n  * @function\r\n  * @param    {Function} fn\r\n  *           The function to be throttled.\r\n  *\r\n  * @param    {number}   wait\r\n  *           The number of milliseconds by which to throttle.\r\n  *\r\n  * @return   {Function}\r\n  */\r\n export const throttle = function(fn, wait) {\r\n   let last = window.performance.now();\r\n \r\n   const throttled = function(...args) {\r\n     const now = window.performance.now();\r\n \r\n     if (now - last >= wait) {\r\n       fn(...args);\r\n       last = now;\r\n     }\r\n   };\r\n \r\n   return throttled;\r\n };\r\n \r\n /**\r\n  * Creates a debounced function that delays invoking `func` until after `wait`\r\n  * milliseconds have elapsed since the last time the debounced function was\r\n  * invoked.\r\n  *\r\n  * Inspired by lodash and underscore implementations.\r\n  *\r\n  * @function\r\n  * @param    {Function} func\r\n  *           The function to wrap with debounce behavior.\r\n  *\r\n  * @param    {number} wait\r\n  *           The number of milliseconds to wait after the last invocation.\r\n  *\r\n  * @param    {boolean} [immediate]\r\n  *           Whether or not to invoke the function immediately upon creation.\r\n  *\r\n  * @param    {Object} [context=window]\r\n  *           The \"context\" in which the debounced function should debounce. For\r\n  *           example, if this function should be tied to a Video.js player,\r\n  *           the player can be passed here. Alternatively, defaults to the\r\n  *           global `window` object.\r\n  *\r\n  * @return   {Function}\r\n  *           A debounced function.\r\n  */\r\n export const debounce = function(func, wait, immediate, context = window) {\r\n   let timeout;\r\n \r\n   const cancel = () => {\r\n     context.clearTimeout(timeout);\r\n     timeout = null;\r\n   };\r\n \r\n   /* eslint-disable consistent-this */\r\n   const debounced = function() {\r\n     const self = this;\r\n     const args = arguments;\r\n \r\n     let later = function() {\r\n       timeout = null;\r\n       later = null;\r\n       if (!immediate) {\r\n         func.apply(self, args);\r\n       }\r\n     };\r\n \r\n     if (!timeout && immediate) {\r\n       func.apply(self, args);\r\n     }\r\n \r\n     context.clearTimeout(timeout);\r\n     timeout = context.setTimeout(later, wait);\r\n   };\r\n   /* eslint-enable consistent-this */\r\n \r\n   debounced.cancel = cancel;\r\n \r\n   return debounced;\r\n };","/*\r\n * Video.js Hotkeys\r\n * https://github.com/ctd1500/videojs-hotkeys\r\n *\r\n * Copyright (c) 2015 Chris Dougherty\r\n * Licensed under the Apache-2.0 license.\r\n */\r\n\r\n;(function(root, factory) {\r\n    if (typeof window !== 'undefined' && window.videojs) {\r\n      factory(window.videojs);\r\n    } else if (typeof define === 'function' && define.amd) {\r\n      define('videojs-hotkeys', ['video.js'], function (module) {\r\n        return factory(module.default || module);\r\n      });\r\n    } else if (typeof module !== 'undefined' && module.exports) {\r\n      module.exports = factory(require('video.js'));\r\n    }\r\n  }(this, function (videojs) {\r\n    \"use strict\";\r\n    if (typeof window !== 'undefined') {\r\n      window['videojs_hotkeys'] = { version: \"0.2.27\" };\r\n    }\r\n\r\n  \r\n    var hotkeys = function(options) {\r\n      var player = this;\r\n      var pEl = player.el();\r\n      var doc = document;\r\n      var def_options = {\r\n        volumeStep: 0.1,\r\n        seekStep: 5,\r\n        enableMute: true,\r\n        enableVolumeScroll: true,\r\n        enableHoverScroll: false,\r\n        enableFullscreen: true,\r\n        enableNumbers: true,\r\n        enableJogStyle: false,\r\n        alwaysCaptureHotkeys: false,\r\n        captureDocumentHotkeys: false,\r\n        documentHotkeysFocusElementFilter: function () { return false },\r\n        enableModifiersForNumbers: true,\r\n        enableInactiveFocus: true,\r\n        skipInitialFocus: false,\r\n        playPauseKey: playPauseKey,\r\n        rewindKey: rewindKey,\r\n        forwardKey: forwardKey,\r\n        volumeUpKey: volumeUpKey,\r\n        volumeDownKey: volumeDownKey,\r\n        muteKey: muteKey,\r\n        fullscreenKey: fullscreenKey,\r\n        customKeys: {}\r\n      };\r\n  \r\n      var cPlay = 1,\r\n        cRewind = 2,\r\n        cForward = 3,\r\n        cVolumeUp = 4,\r\n        cVolumeDown = 5,\r\n        cMute = 6,\r\n        cFullscreen = 7;\r\n  \r\n      // Use built-in merge function from Video.js v5.0+ or v4.4.0+\r\n      var mergeOptions = videojs.mergeOptions || videojs.util.mergeOptions;\r\n      options = mergeOptions(def_options, options || {});\r\n  \r\n      var volumeStep = options.volumeStep,\r\n        seekStep = options.seekStep,\r\n        enableMute = options.enableMute,\r\n        enableVolumeScroll = options.enableVolumeScroll,\r\n        enableHoverScroll = options.enableHoverScroll,\r\n        enableFull = options.enableFullscreen,\r\n        enableNumbers = options.enableNumbers,\r\n        enableJogStyle = options.enableJogStyle,\r\n        alwaysCaptureHotkeys = options.alwaysCaptureHotkeys,\r\n        captureDocumentHotkeys = options.captureDocumentHotkeys,\r\n        documentHotkeysFocusElementFilter = options.documentHotkeysFocusElementFilter,\r\n        enableModifiersForNumbers = options.enableModifiersForNumbers,\r\n        enableInactiveFocus = options.enableInactiveFocus,\r\n        skipInitialFocus = options.skipInitialFocus;\r\n  \r\n      var videojsVer = videojs.VERSION;\r\n  \r\n      // Set default player tabindex to handle keydown and doubleclick events\r\n      if (!pEl.hasAttribute('tabIndex')) {\r\n        pEl.setAttribute('tabIndex', '-1');\r\n      }\r\n  \r\n      // Remove player outline to fix video performance issue\r\n      pEl.style.outline = \"none\";\r\n  \r\n      if (alwaysCaptureHotkeys || !player.autoplay()) {\r\n        if (!skipInitialFocus) {\r\n          player.one('play', function() {\r\n            pEl.focus(); // Fixes the .vjs-big-play-button handing focus back to body instead of the player\r\n          });\r\n        }\r\n      }\r\n  \r\n      if (enableInactiveFocus) {\r\n        player.on('userinactive', function() {\r\n          // When the control bar fades, re-apply focus to the player if last focus was a control button\r\n          var cancelFocusingPlayer = function() {\r\n            clearTimeout(focusingPlayerTimeout);\r\n          };\r\n          var focusingPlayerTimeout = setTimeout(function() {\r\n            player.off('useractive', cancelFocusingPlayer);\r\n            var activeElement = doc.activeElement;\r\n            var controlBar = pEl.querySelector('.vjs-control-bar');\r\n            if (activeElement && activeElement.parentElement == controlBar) {\r\n              pEl.focus();\r\n            }\r\n          }, 10);\r\n  \r\n          player.one('useractive', cancelFocusingPlayer);\r\n        });\r\n      }\r\n  \r\n      player.on('play', function() {\r\n        // Fix allowing the YouTube plugin to have hotkey support.\r\n        var ifblocker = pEl.querySelector('.iframeblocker');\r\n        if (ifblocker && ifblocker.style.display === '') {\r\n          ifblocker.style.display = \"block\";\r\n          ifblocker.style.bottom = \"39px\";\r\n        }\r\n      });\r\n  \r\n      var keyDown = function keyDown(event) {\r\n        var ewhich = event.which, wasPlaying, seekTime;\r\n        var ePreventDefault = event.preventDefault.bind(event);\r\n        var duration = player.duration();\r\n        // When controls are disabled, hotkeys will be disabled as well\r\n        if (player.controls()) {\r\n  \r\n          // Don't catch keys if any control buttons are focused, unless alwaysCaptureHotkeys is true\r\n          var activeEl = doc.activeElement;\r\n          if (\r\n            alwaysCaptureHotkeys ||\r\n            (captureDocumentHotkeys && documentHotkeysFocusElementFilter(activeEl)) ||\r\n  \r\n            activeEl == pEl ||\r\n            activeEl == pEl.querySelector('.vjs-tech') ||\r\n            activeEl == pEl.querySelector('.vjs-control-bar') ||\r\n            activeEl == pEl.querySelector('.iframeblocker')\r\n          ) {\r\n  \r\n            switch (checkKeys(event, player)) {\r\n              // Spacebar toggles play/pause\r\n              case cPlay:\r\n                ePreventDefault();\r\n                if (alwaysCaptureHotkeys || captureDocumentHotkeys) {\r\n                  // Prevent control activation with space\r\n                  event.stopPropagation();\r\n                }\r\n  \r\n                if (player.paused()) {\r\n                  silencePromise(player.play());\r\n                } else {\r\n                  player.pause();\r\n                }\r\n                break;\r\n  \r\n              // Seeking with the left/right arrow keys\r\n              case cRewind: // Seek Backward\r\n                wasPlaying = !player.paused();\r\n                ePreventDefault();\r\n                /*if (wasPlaying) {\r\n                  player.pause();\r\n                }*/\r\n                seekTime = player.currentTime() - seekStepD(event);\r\n                // The flash player tech will allow you to seek into negative\r\n                // numbers and break the seekbar, so try to prevent that.\r\n                if (seekTime <= 0) {\r\n                  seekTime = 0;\r\n                }\r\n\r\n                player.currentTime(seekTime);\r\n               /* if (wasPlaying) {\r\n                  silencePromise(player.play());\r\n                }*/\r\n                break;\r\n              case cForward: // Seek Forward\r\n                wasPlaying = !player.paused();\r\n                ePreventDefault();\r\n                /*if (wasPlaying) {\r\n                  player.pause();\r\n                }*/\r\n                seekTime = player.currentTime() + seekStepD(event);\r\n                // Fixes the player not sending the end event if you\r\n                // try to seek past the duration on the seekbar.\r\n                if (seekTime >= duration) {\r\n                  seekTime = wasPlaying ? duration - .001 : duration;\r\n                }\r\n                player.currentTime(seekTime);\r\n                /*if (wasPlaying) {\r\n                  silencePromise(player.play());\r\n                }*/\r\n                break;\r\n  \r\n              // Volume control with the up/down arrow keys\r\n              case cVolumeDown:\r\n                ePreventDefault();\r\n                if (!enableJogStyle) {\r\n                  player.volume(player.volume() - volumeStep);\r\n                } else {\r\n                  seekTime = player.currentTime() - 1;\r\n                  if (player.currentTime() <= 1) {\r\n                    seekTime = 0;\r\n                  }\r\n                  player.currentTime(seekTime);\r\n                }\r\n                break;\r\n              case cVolumeUp:\r\n                ePreventDefault();\r\n                if (!enableJogStyle) {\r\n                  player.volume(player.volume() + volumeStep);\r\n                } else {\r\n                  seekTime = player.currentTime() + 1;\r\n                  if (seekTime >= duration) {\r\n                    seekTime = duration;\r\n                  }\r\n                  player.currentTime(seekTime);\r\n                }\r\n                break;\r\n  \r\n              // Toggle Mute with the M key\r\n              case cMute:\r\n                if (enableMute) {\r\n                  player.muted(!player.muted());\r\n                }\r\n                break;\r\n  \r\n              // Toggle Fullscreen with the F key\r\n              case  cFullscreen:\r\n                if (enableFull) {\r\n                  if (player.isFullscreen()) {\r\n                    player.exitFullscreen();\r\n                  } else {\r\n                    player.requestFullscreen();\r\n                  }\r\n                }\r\n                break;\r\n  \r\n              default:\r\n                // Number keys from 0-9 skip to a percentage of the video. 0 is 0% and 9 is 90%\r\n                if ((ewhich > 47 && ewhich < 59) || (ewhich > 95 && ewhich < 106)) {\r\n                  // Do not handle if enableModifiersForNumbers set to false and keys are Ctrl, Cmd or Alt\r\n                  if (enableModifiersForNumbers || !(event.metaKey || event.ctrlKey || event.altKey)) {\r\n                    if (enableNumbers) {\r\n                      var sub = 48;\r\n                      if (ewhich > 95) {\r\n                        sub = 96;\r\n                      }\r\n                      var number = ewhich - sub;\r\n                      ePreventDefault();\r\n                      player.currentTime(player.duration() * number * 0.1);\r\n                    }\r\n                  }\r\n                }\r\n  \r\n                // Handle any custom hotkeys\r\n                for (var customKey in options.customKeys) {\r\n                  var customHotkey = options.customKeys[customKey];\r\n                  // Check for well formed custom keys\r\n                  if (customHotkey && customHotkey.key && customHotkey.handler) {\r\n                    // Check if the custom key's condition matches\r\n                    if (customHotkey.key(event)) {\r\n                      ePreventDefault();\r\n                      customHotkey.handler(player, options, event);\r\n                    }\r\n                  }\r\n                }\r\n            }\r\n          }\r\n        }\r\n      };\r\n  \r\n      var doubleClick = function doubleClick(event) {\r\n        // Video.js added double-click fullscreen in 7.1.0\r\n        if (videojsVer != null && videojsVer <= \"7.1.0\") {\r\n          // When controls are disabled, hotkeys will be disabled as well\r\n          if (player.controls()) {\r\n  \r\n            // Don't catch clicks if any control buttons are focused\r\n            var activeEl = event.relatedTarget || event.toElement || doc.activeElement;\r\n            if (activeEl == pEl ||\r\n                activeEl == pEl.querySelector('.vjs-tech') ||\r\n                activeEl == pEl.querySelector('.iframeblocker')) {\r\n  \r\n              if (enableFull) {\r\n                if (player.isFullscreen()) {\r\n                  player.exitFullscreen();\r\n                } else {\r\n                  player.requestFullscreen();\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      };\r\n  \r\n      var volumeHover = false;\r\n      var volumeSelector = pEl.querySelector('.vjs-volume-menu-button') || pEl.querySelector('.vjs-volume-panel');\r\n      if (volumeSelector != null) {\r\n        volumeSelector.onmouseover = function() { volumeHover = true; };\r\n        volumeSelector.onmouseout = function() { volumeHover = false; };\r\n      }\r\n  \r\n      var mouseScroll = function mouseScroll(event) {\r\n        if (enableHoverScroll) {\r\n          // If we leave this undefined then it can match non-existent elements below\r\n          var activeEl = 0;\r\n        } else {\r\n          var activeEl = doc.activeElement;\r\n        }\r\n  \r\n        // When controls are disabled, hotkeys will be disabled as well\r\n        if (player.controls()) {\r\n          if (alwaysCaptureHotkeys ||\r\n              activeEl == pEl ||\r\n              activeEl == pEl.querySelector('.vjs-tech') ||\r\n              activeEl == pEl.querySelector('.iframeblocker') ||\r\n              activeEl == pEl.querySelector('.vjs-control-bar') ||\r\n              volumeHover) {\r\n  \r\n            if (enableVolumeScroll) {\r\n              event = window.event || event;\r\n              var delta = Math.max(-1, Math.min(1, (event.wheelDelta || -event.detail)));\r\n              event.preventDefault();\r\n  \r\n              if (delta == 1) {\r\n                player.volume(player.volume() + volumeStep);\r\n              } else if (delta == -1) {\r\n                player.volume(player.volume() - volumeStep);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      };\r\n  \r\n      var checkKeys = function checkKeys(e, player) {\r\n        // Allow some modularity in defining custom hotkeys\r\n  \r\n        // Play/Pause check\r\n        if (options.playPauseKey(e, player)) {\r\n          return cPlay;\r\n        }\r\n  \r\n        // Seek Backward check\r\n        if (options.rewindKey(e, player)) {\r\n          return cRewind;\r\n        }\r\n  \r\n        // Seek Forward check\r\n        if (options.forwardKey(e, player)) {\r\n          return cForward;\r\n        }\r\n  \r\n        // Volume Up check\r\n        if (options.volumeUpKey(e, player)) {\r\n          return cVolumeUp;\r\n        }\r\n  \r\n        // Volume Down check\r\n        if (options.volumeDownKey(e, player)) {\r\n          return cVolumeDown;\r\n        }\r\n  \r\n        // Mute check\r\n        if (options.muteKey(e, player)) {\r\n          return cMute;\r\n        }\r\n  \r\n        // Fullscreen check\r\n        if (options.fullscreenKey(e, player)) {\r\n          return cFullscreen;\r\n        }\r\n      };\r\n  \r\n      function playPauseKey(e) {\r\n        // Space bar or MediaPlayPause\r\n        return (e.which === 32 || e.which === 179);\r\n      }\r\n  \r\n      function rewindKey(e) {\r\n        // Left Arrow or MediaRewind\r\n        return (e.which === 37 || e.which === 177);\r\n      }\r\n  \r\n      function forwardKey(e) {\r\n        // Right Arrow or MediaForward\r\n        return (e.which === 39 || e.which === 176);\r\n      }\r\n  \r\n      function volumeUpKey(e) {\r\n        // Up Arrow\r\n        return (e.which === 38);\r\n      }\r\n  \r\n      function volumeDownKey(e) {\r\n        // Down Arrow\r\n        return (e.which === 40);\r\n      }\r\n  \r\n      function muteKey(e) {\r\n        // M key\r\n        return (e.which === 77);\r\n      }\r\n  \r\n      function fullscreenKey(e) {\r\n        // F key\r\n        return (e.which === 70);\r\n      }\r\n  \r\n      function seekStepD(e) {\r\n        // SeekStep caller, returns an int, or a function returning an int\r\n        return (typeof seekStep === \"function\" ? seekStep(e) : seekStep);\r\n      }\r\n  \r\n      function silencePromise(value) {\r\n        if (value != null && typeof value.then === 'function') {\r\n          value.then(null, function(e) {console.log(\"E\", e)});\r\n        }\r\n      }\r\n\r\n\r\n      var active = false\r\n\r\n\r\n      player.on('enablehotkeys', function(){\r\n\r\n\r\n        player.on('keydown', keyDown);\r\n        player.on('dblclick', doubleClick);\r\n        player.on('mousewheel', mouseScroll);\r\n        player.on(\"DOMMouseScroll\", mouseScroll);\r\n    \r\n        if (captureDocumentHotkeys) {\r\n          document.addEventListener('keydown', keyDown);\r\n        }\r\n\r\n        active = true\r\n      })\r\n\r\n      var off = function(){\r\n\r\n        if(active){\r\n          player.off('keydown', keyDown);\r\n          player.off('dblclick', doubleClick);\r\n          player.off('mousewheel', mouseScroll);\r\n          player.off(\"DOMMouseScroll\", mouseScroll);\r\n      \r\n          if (captureDocumentHotkeys) {\r\n            document.removeEventListener('keydown', keyDown);\r\n          }\r\n        }\r\n\r\n        active = false\r\n       \r\n      }\r\n  \r\n      player.on('disablehotkeys', off)\r\n      player.on('dispose', function(){\r\n\r\n        off()\r\n\r\n        player = null\r\n        pEl = null\r\n      })\r\n  \r\n      return this;\r\n    };\r\n  \r\n    var registerPlugin = videojs.registerPlugin || videojs.plugin;\r\n    registerPlugin('hotkeys', hotkeys);\r\n  }));","import { logger } from '@root-helpers/logger'\r\n\r\nfunction getStoredVolume () {\r\n  const value = getLocalStorage('volume')\r\n  if (value !== null && value !== undefined) {\r\n    const valueNumber = parseFloat(value)\r\n    if (isNaN(valueNumber)) return undefined\r\n\r\n    return valueNumber\r\n  }\r\n\r\n  return undefined\r\n}\r\n\r\nfunction getStoredMute () {\r\n  const value = getLocalStorage('mute')\r\n  if (value !== null && value !== undefined) return value === 'true'\r\n\r\n  return undefined\r\n}\r\n\r\nfunction getStoredTheater () {\r\n  const value = getLocalStorage('theater-enabled')\r\n  if (value !== null && value !== undefined) return value === 'true'\r\n\r\n  return false\r\n}\r\n\r\nfunction saveVolumeInStore (value: number) {\r\n  return setLocalStorage('volume', value.toString())\r\n}\r\n\r\nfunction saveMuteInStore (value: boolean) {\r\n  return setLocalStorage('mute', value.toString())\r\n}\r\n\r\nfunction saveTheaterInStore (enabled: boolean) {\r\n  return setLocalStorage('theater-enabled', enabled.toString())\r\n}\r\n\r\nfunction saveAverageBandwidth (value: number) {\r\n  /** used to choose the most fitting resolution */\r\n  return setLocalStorage('average-bandwidth', value.toString())\r\n}\r\n\r\nfunction getAverageBandwidthInStore () {\r\n  const value = getLocalStorage('average-bandwidth')\r\n  if (value !== null && value !== undefined) {\r\n    const valueNumber = parseInt(value, 10)\r\n    if (isNaN(valueNumber)) return undefined\r\n\r\n    return valueNumber\r\n  }\r\n\r\n  return undefined\r\n}\r\n\r\nfunction saveLastSubtitle (language: string) {\r\n  return setLocalStorage('last-subtitle', language)\r\n}\r\n\r\nfunction getStoredLastSubtitle () {\r\n  return getLocalStorage('last-subtitle')\r\n}\r\n\r\nfunction saveVideoWatchHistory (videoUUID: string, duration: number) {\r\n  return setLocalStorage(`video-watch-history`, JSON.stringify({\r\n    ...getStoredVideoWatchHistory(),\r\n\r\n    [videoUUID]: {\r\n      duration,\r\n      date: `${(new Date()).toISOString()}`\r\n    }\r\n  }))\r\n}\r\n\r\nfunction getStoredVideoWatchHistory (videoUUID?: string) {\r\n  let data\r\n\r\n  try {\r\n    const value = getLocalStorage('video-watch-history')\r\n    if (!value) return {}\r\n\r\n    data = JSON.parse(value)\r\n  } catch (error) {\r\n    logger.error('Cannot parse video watch history from local storage/', error)\r\n  }\r\n\r\n  data = data || {}\r\n\r\n  if (videoUUID) return data[videoUUID]\r\n\r\n  return data\r\n}\r\n\r\nfunction cleanupVideoWatch () {\r\n  const data = getStoredVideoWatchHistory()\r\n  if (!data) return\r\n\r\n  const newData = Object.keys(data).reduce((acc, videoUUID) => {\r\n    const date = Date.parse(data[videoUUID].date)\r\n\r\n    const diff = Math.ceil(((new Date()).getTime() - date) / (1000 * 3600 * 24))\r\n\r\n    if (diff > 30) return acc\r\n\r\n    return {\r\n      ...acc,\r\n      [videoUUID]: data[videoUUID]\r\n    }\r\n  }, {})\r\n\r\n  setLocalStorage('video-watch-history', JSON.stringify(newData))\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n\r\nexport {\r\n  getStoredVolume,\r\n  getStoredMute,\r\n  getStoredTheater,\r\n  saveVolumeInStore,\r\n  saveMuteInStore,\r\n  saveTheaterInStore,\r\n  saveAverageBandwidth,\r\n  getAverageBandwidthInStore,\r\n  saveLastSubtitle,\r\n  getStoredLastSubtitle,\r\n  saveVideoWatchHistory,\r\n  getStoredVideoWatchHistory,\r\n  cleanupVideoWatch\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n\r\nconst KEY_PREFIX = 'peertube-videojs-'\r\n\r\nfunction getLocalStorage (key: string) {\r\n  try {\r\n    return localStorage.getItem(KEY_PREFIX + key)\r\n  } catch {\r\n    return undefined\r\n  }\r\n}\r\n\r\nfunction setLocalStorage (key: string, value: string) {\r\n  try {\r\n    localStorage.setItem(KEY_PREFIX + key, value)\r\n  } catch { /* empty */\r\n  }\r\n}\r\n","import videojs from 'video.js'\r\n\r\nfunction getMainTemplate (options: any) {\r\n  return `\r\n    <div class=\"vjs-upnext-top\">\r\n      <span class=\"vjs-upnext-headtext\">${options.headText}</span>\r\n      <div class=\"vjs-upnext-title\"></div>\r\n    </div>\r\n    <div class=\"vjs-upnext-autoplay-icon\">\r\n      <svg height=\"100%\" version=\"1.1\" viewbox=\"0 0 98 98\" width=\"100%\">\r\n        <circle class=\"vjs-upnext-svg-autoplay-circle\" cx=\"49\" cy=\"49\" fill=\"#000\" fill-opacity=\"0.8\" r=\"48\"></circle>\r\n        <circle class=\"vjs-upnext-svg-autoplay-ring\" cx=\"-49\" cy=\"49\" fill-opacity=\"0\" r=\"46.5\"\r\n                stroke=\"#FFFFFF\" stroke-width=\"4\" transform=\"rotate(-90)\"\r\n        ></circle>\r\n        <polygon class=\"vjs-upnext-svg-autoplay-triangle\" fill=\"#fff\" points=\"32,27 72,49 32,71\"></polygon></svg>\r\n    </div>\r\n    <span class=\"vjs-upnext-bottom\">\r\n      <span class=\"vjs-upnext-cancel\">\r\n        <button class=\"vjs-upnext-cancel-button\" tabindex=\"0\" aria-label=\"Cancel autoplay\">${options.cancelText}</button>\r\n      </span>\r\n      <span class=\"vjs-upnext-suspended\">${options.suspendedText}</span>\r\n    </span>\r\n  `\r\n}\r\n\r\nexport interface EndCardOptions extends videojs.ComponentOptions {\r\n  next: () => void\r\n  getTitle: () => string\r\n  timeout: number\r\n  cancelText: string\r\n  headText: string\r\n  suspendedText: string\r\n  condition: () => boolean\r\n  suspended: () => boolean\r\n}\r\n\r\nconst Component = videojs.getComponent('Component')\r\nclass EndCard extends Component {\r\n  options_: EndCardOptions\r\n\r\n  dashOffsetTotal = 586\r\n  dashOffsetStart = 293\r\n  interval = 50\r\n  upNextEvents = new videojs.EventTarget()\r\n  ticks = 0\r\n  totalTicks: number\r\n\r\n  container: HTMLDivElement\r\n  title: HTMLElement\r\n  autoplayRing: HTMLElement\r\n  cancelButton: HTMLElement\r\n  suspendedMessage: HTMLElement\r\n  nextButton: HTMLElement\r\n\r\n  constructor (player: videojs.Player, options: EndCardOptions) {\r\n    super(player, options)\r\n\r\n    this.totalTicks = this.options_.timeout / this.interval\r\n\r\n    player.on('ended', (_: any) => {\r\n      if (!this.options_.condition()) return\r\n\r\n      player.addClass('vjs-upnext--showing')\r\n      this.showCard((canceled: boolean) => {\r\n        player.removeClass('vjs-upnext--showing')\r\n        this.container.style.display = 'none'\r\n        if (!canceled) {\r\n          this.options_.next()\r\n        }\r\n      })\r\n    })\r\n\r\n    player.on('playing', () => {\r\n      this.upNextEvents.trigger('playing')\r\n    })\r\n  }\r\n\r\n  createEl () {\r\n    const container = super.createEl('div', {\r\n      className: 'vjs-upnext-content',\r\n      innerHTML: getMainTemplate(this.options_)\r\n    }) as HTMLDivElement\r\n\r\n    this.container = container\r\n    container.style.display = 'none'\r\n\r\n    this.autoplayRing = container.getElementsByClassName('vjs-upnext-svg-autoplay-ring')[0] as HTMLElement\r\n    this.title = container.getElementsByClassName('vjs-upnext-title')[0] as HTMLElement\r\n    this.cancelButton = container.getElementsByClassName('vjs-upnext-cancel-button')[0] as HTMLElement\r\n    this.suspendedMessage = container.getElementsByClassName('vjs-upnext-suspended')[0] as HTMLElement\r\n    this.nextButton = container.getElementsByClassName('vjs-upnext-autoplay-icon')[0] as HTMLElement\r\n\r\n    this.cancelButton.onclick = () => {\r\n      this.upNextEvents.trigger('cancel')\r\n    }\r\n\r\n    this.nextButton.onclick = () => {\r\n      this.upNextEvents.trigger('next')\r\n    }\r\n\r\n    return container\r\n  }\r\n\r\n  showCard (cb: (value: boolean) => void) {\r\n    let timeout: any\r\n\r\n    this.autoplayRing.setAttribute('stroke-dasharray', `${this.dashOffsetStart}`)\r\n    this.autoplayRing.setAttribute('stroke-dashoffset', `${-this.dashOffsetStart}`)\r\n\r\n    this.title.innerHTML = this.options_.getTitle()\r\n\r\n    this.upNextEvents.one('cancel', () => {\r\n      clearTimeout(timeout)\r\n      cb(true)\r\n    })\r\n\r\n    this.upNextEvents.one('playing', () => {\r\n      clearTimeout(timeout)\r\n      cb(true)\r\n    })\r\n\r\n    this.upNextEvents.one('next', () => {\r\n      clearTimeout(timeout)\r\n      cb(false)\r\n    })\r\n\r\n    const goToPercent = (percent: number) => {\r\n      const newOffset = Math.max(-this.dashOffsetTotal, -this.dashOffsetStart - percent * this.dashOffsetTotal / 2 / 100)\r\n      this.autoplayRing.setAttribute('stroke-dashoffset', '' + newOffset)\r\n    }\r\n\r\n    const tick = () => {\r\n      goToPercent((this.ticks++) * 100 / this.totalTicks)\r\n    }\r\n\r\n    const update = () => {\r\n      if (this.options_.suspended()) {\r\n        this.suspendedMessage.innerText = this.options_.suspendedText\r\n        goToPercent(0)\r\n        this.ticks = 0\r\n        timeout = setTimeout(update.bind(this), 300) // checks once supsended can be a bit longer\r\n      } else if (this.ticks >= this.totalTicks) {\r\n        clearTimeout(timeout)\r\n        cb(false)\r\n      } else {\r\n        this.suspendedMessage.innerText = ''\r\n        tick()\r\n        timeout = setTimeout(update.bind(this), this.interval)\r\n      }\r\n    }\r\n\r\n    this.container.style.display = 'block'\r\n    timeout = setTimeout(update.bind(this), this.interval)\r\n  }\r\n}\r\n\r\nvideojs.registerComponent('EndCard', EndCard)\r\n","import videojs from 'video.js'\r\nimport { EndCardOptions } from './end-card'\r\n\r\nconst Plugin = videojs.getPlugin('plugin')\r\n\r\nclass UpNextPlugin extends Plugin {\r\n\r\n  constructor (player: videojs.Player, options: Partial<EndCardOptions> = {}) {\r\n    const settings = {\r\n      next: options.next,\r\n      getTitle: options.getTitle,\r\n      timeout: options.timeout || 5000,\r\n      cancelText: options.cancelText || 'Cancel',\r\n      headText: options.headText || 'Up Next',\r\n      suspendedText: options.suspendedText || 'Autoplay is suspended',\r\n      condition: options.condition,\r\n      suspended: options.suspended\r\n    }\r\n\r\n    super(player)\r\n\r\n    this.player.ready(() => {\r\n      player.addClass('vjs-upnext')\r\n    })\r\n\r\n    player.addChild('EndCard', settings)\r\n  }\r\n}\r\n\r\nvideojs.registerPlugin('upnext', UpNextPlugin)\r\nexport { UpNextPlugin }\r\n","import videojs from 'video.js'\r\nimport { logger } from '@root-helpers/logger'\r\nimport { secondsToTime } from '@shared/core-utils'\r\nimport { PlayerNetworkInfo as EventPlayerNetworkInfo } from '../../types'\r\nimport { bytes } from '../common'\r\n\r\ninterface StatsCardOptions extends videojs.ComponentOptions {\r\n  videoUUID: string\r\n  videoIsLive: boolean\r\n  mode: 'webtorrent' | 'p2p-media-loader' | 'localvideo'\r\n  p2pEnabled: boolean\r\n}\r\n\r\ninterface PlayerNetworkInfo {\r\n  downloadSpeed?: string\r\n  uploadSpeed?: string\r\n  totalDownloaded?: string\r\n  totalUploaded?: string\r\n  numPeers?: number\r\n  averageBandwidth?: string\r\n\r\n  downloadedFromServer?: string\r\n  downloadedFromPeers?: string\r\n}\r\n\r\ninterface InfoElement {\r\n  root: HTMLElement\r\n  value: HTMLElement\r\n}\r\n\r\nconst Component = videojs.getComponent('Component')\r\nclass StatsCard extends Component {\r\n  options_: StatsCardOptions\r\n\r\n  updateInterval: any\r\n\r\n  mode: 'webtorrent' | 'p2p-media-loader'\r\n\r\n  metadataStore: any = {}\r\n\r\n  intervalMs = 300\r\n  playerNetworkInfo: PlayerNetworkInfo = {}\r\n\r\n  private containerEl: HTMLDivElement\r\n  private infoListEl: HTMLDivElement\r\n\r\n  private playerMode: InfoElement\r\n  private p2p: InfoElement\r\n  private uuid: InfoElement\r\n  private viewport: InfoElement\r\n  private resolution: InfoElement\r\n  private volume: InfoElement\r\n  private codecs: InfoElement\r\n  private color: InfoElement\r\n  private connection: InfoElement\r\n\r\n  private network: InfoElement\r\n  private transferred: InfoElement\r\n  private download: InfoElement\r\n\r\n  private bufferProgress: InfoElement\r\n  private bufferState: InfoElement\r\n\r\n  private liveLatency: InfoElement\r\n\r\n  createEl () {\r\n    this.containerEl = videojs.dom.createEl('div', {\r\n      className: 'vjs-stats-content'\r\n    }) as HTMLDivElement\r\n    this.containerEl.style.display = 'none'\r\n\r\n    this.infoListEl = videojs.dom.createEl('div', {\r\n      className: 'vjs-stats-list'\r\n    }) as HTMLDivElement\r\n\r\n    const closeButton = videojs.dom.createEl('button', {\r\n      className: 'vjs-stats-close',\r\n      tabindex: '0',\r\n      title: 'Close stats',\r\n      innerText: '[x]'\r\n    }, { 'aria-label': 'Close stats' }) as HTMLElement\r\n    closeButton.onclick = () => this.hide()\r\n\r\n    this.containerEl.appendChild(closeButton)\r\n    this.containerEl.appendChild(this.infoListEl)\r\n\r\n    this.populateInfoBlocks()\r\n\r\n    this.player_.on('p2pInfo', (event: any, data: EventPlayerNetworkInfo) => {\r\n      if (!data) return // HTTP fallback\r\n\r\n      this.mode = data.source\r\n\r\n      const p2pStats = data.p2p\r\n      const httpStats = data.http\r\n\r\n      this.playerNetworkInfo.downloadSpeed = bytes(p2pStats.downloadSpeed + httpStats.downloadSpeed).join(' ')\r\n      this.playerNetworkInfo.uploadSpeed = bytes(p2pStats.uploadSpeed + httpStats.uploadSpeed).join(' ')\r\n      this.playerNetworkInfo.totalDownloaded = bytes(p2pStats.downloaded + httpStats.downloaded).join(' ')\r\n      this.playerNetworkInfo.totalUploaded = bytes(p2pStats.uploaded + httpStats.uploaded).join(' ')\r\n      this.playerNetworkInfo.numPeers = p2pStats.numPeers\r\n      this.playerNetworkInfo.averageBandwidth = bytes(data.bandwidthEstimate).join(' ') + '/s'\r\n\r\n      if (data.source === 'p2p-media-loader') {\r\n        this.playerNetworkInfo.downloadedFromServer = bytes(httpStats.downloaded).join(' ')\r\n        this.playerNetworkInfo.downloadedFromPeers = bytes(p2pStats.downloaded).join(' ')\r\n      }\r\n    })\r\n\r\n    return this.containerEl\r\n  }\r\n\r\n  toggle () {\r\n    if (this.updateInterval) this.hide()\r\n    else this.show()\r\n  }\r\n\r\n  show () {\r\n    this.containerEl.style.display = 'block'\r\n\r\n    this.updateInterval = setInterval(() => {\r\n      try {\r\n        const options = this.mode === 'p2p-media-loader'\r\n          ? this.buildHLSOptions() : null;\r\n          //: this.buildWebTorrentOptions() // Default\r\n\r\n        if(options)\r\n          this.populateInfoValues(options)\r\n      } catch (err) {\r\n        logger.error('Cannot update stats.', err)\r\n        clearInterval(this.updateInterval)\r\n      }\r\n    }, this.intervalMs)\r\n  }\r\n\r\n  hide () {\r\n    clearInterval(this.updateInterval)\r\n    this.containerEl.style.display = 'none'\r\n  }\r\n\r\n  private buildHLSOptions () {\r\n    const p2pMediaLoader = this.player_.p2pMediaLoader()\r\n    const level = p2pMediaLoader.getCurrentLevel()\r\n\r\n    const codecs = level?.videoCodec || level?.audioCodec\r\n      ? `${level?.videoCodec || ''} / ${level?.audioCodec || ''}`\r\n      : undefined\r\n\r\n    const resolution = `${level?.height}p${level?.attrs['FRAME-RATE'] || ''}`\r\n    const buffer = this.timeRangesToString(this.player().buffered())\r\n\r\n    let progress: number\r\n    let latency: string\r\n\r\n    if (this.options_.videoIsLive) {\r\n      latency = secondsToTime(p2pMediaLoader.getLiveLatency())\r\n    } else {\r\n      progress = this.player().bufferedPercent()\r\n    }\r\n\r\n    return {\r\n      playerNetworkInfo: this.playerNetworkInfo,\r\n      resolution,\r\n      codecs,\r\n      buffer,\r\n      latency,\r\n      progress\r\n    }\r\n  }\r\n\r\n  private async buildWebTorrentOptions () {\r\n    const videoFile = this.player_.webtorrent().getCurrentVideoFile()\r\n\r\n    if (!this.metadataStore[videoFile.fileUrl]) {\r\n      this.metadataStore[videoFile.fileUrl] = await fetch(videoFile.metadataUrl).then(res => res.json())\r\n    }\r\n\r\n    const metadata = this.metadataStore[videoFile.fileUrl]\r\n\r\n    let colorSpace = 'unknown'\r\n    let codecs = 'unknown'\r\n\r\n    if (metadata?.streams[0]) {\r\n      const stream = metadata.streams[0]\r\n\r\n      colorSpace = stream['color_space'] !== 'unknown'\r\n        ? stream['color_space']\r\n        : 'bt709'\r\n\r\n      codecs = stream['codec_name'] || 'avc1'\r\n    }\r\n\r\n    const resolution = videoFile?.resolution.label + videoFile?.fps\r\n    const buffer = this.timeRangesToString(this.player().buffered())\r\n    const progress = this.player_.webtorrent().getTorrent()?.progress\r\n\r\n    return {\r\n      playerNetworkInfo: this.playerNetworkInfo,\r\n      progress,\r\n      colorSpace,\r\n      codecs,\r\n      resolution,\r\n      buffer\r\n    }\r\n  }\r\n\r\n  private populateInfoBlocks () {\r\n    this.playerMode = this.buildInfoRow(this.player().localize('Player mode'))\r\n    this.p2p = this.buildInfoRow(this.player().localize('P2P'))\r\n    this.uuid = this.buildInfoRow(this.player().localize('Video UUID'))\r\n    this.viewport = this.buildInfoRow(this.player().localize('Viewport / Frames'))\r\n    this.resolution = this.buildInfoRow(this.player().localize('Resolution'))\r\n    this.volume = this.buildInfoRow(this.player().localize('Volume'))\r\n    this.codecs = this.buildInfoRow(this.player().localize('Codecs'))\r\n    this.color = this.buildInfoRow(this.player().localize('Color'))\r\n    this.connection = this.buildInfoRow(this.player().localize('Connection Speed'))\r\n\r\n    this.network = this.buildInfoRow(this.player().localize('Network Activity'))\r\n    this.transferred = this.buildInfoRow(this.player().localize('Total Transfered'))\r\n    this.download = this.buildInfoRow(this.player().localize('Download Breakdown'))\r\n\r\n    this.bufferProgress = this.buildInfoRow(this.player().localize('Buffer Progress'))\r\n    this.bufferState = this.buildInfoRow(this.player().localize('Buffer State'))\r\n\r\n    this.liveLatency = this.buildInfoRow(this.player().localize('Live Latency'))\r\n\r\n    this.infoListEl.appendChild(this.playerMode.root)\r\n    this.infoListEl.appendChild(this.p2p.root)\r\n    this.infoListEl.appendChild(this.uuid.root)\r\n    this.infoListEl.appendChild(this.viewport.root)\r\n    this.infoListEl.appendChild(this.resolution.root)\r\n    this.infoListEl.appendChild(this.volume.root)\r\n    this.infoListEl.appendChild(this.codecs.root)\r\n    this.infoListEl.appendChild(this.color.root)\r\n    this.infoListEl.appendChild(this.connection.root)\r\n    this.infoListEl.appendChild(this.network.root)\r\n    this.infoListEl.appendChild(this.transferred.root)\r\n    this.infoListEl.appendChild(this.download.root)\r\n    this.infoListEl.appendChild(this.bufferProgress.root)\r\n    this.infoListEl.appendChild(this.bufferState.root)\r\n    this.infoListEl.appendChild(this.liveLatency.root)\r\n  }\r\n\r\n  private populateInfoValues (options: {\r\n    playerNetworkInfo: PlayerNetworkInfo\r\n    progress: number\r\n    codecs: string\r\n    resolution: string\r\n    buffer: string\r\n\r\n    latency?: string\r\n    colorSpace?: string\r\n  }) {\r\n    const { playerNetworkInfo, progress, colorSpace, codecs, resolution, buffer, latency } = options\r\n    const player = this.player()\r\n\r\n    const videoQuality: VideoPlaybackQuality = player.getVideoPlaybackQuality()\r\n    const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0)\r\n    const vh = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0)\r\n    const pr = (window.devicePixelRatio || 1).toFixed(2)\r\n    const frames = `${vw}x${vh}*${pr} / ${videoQuality.droppedVideoFrames} dropped of ${videoQuality.totalVideoFrames}`\r\n\r\n    const duration = player.duration()\r\n\r\n    let volume = `${Math.round(player.volume() * 100)}`\r\n    if (player.muted()) volume += ' (muted)'\r\n\r\n    const networkActivity = playerNetworkInfo.downloadSpeed\r\n      ? `${playerNetworkInfo.downloadSpeed} &dArr; / ${playerNetworkInfo.uploadSpeed} &uArr;`\r\n      : undefined\r\n\r\n    const totalTransferred = playerNetworkInfo.totalDownloaded\r\n      ? `${playerNetworkInfo.totalDownloaded} &dArr; / ${playerNetworkInfo.totalUploaded} &uArr;`\r\n      : undefined\r\n    const downloadBreakdown = playerNetworkInfo.downloadedFromServer\r\n      ? `${playerNetworkInfo.downloadedFromServer} from servers · ${playerNetworkInfo.downloadedFromPeers} from peers`\r\n      : undefined\r\n\r\n    const bufferProgress = progress !== undefined\r\n      ? `${(progress * 100).toFixed(1)}% (${(progress * duration).toFixed(1)}s)`\r\n      : undefined\r\n\r\n    this.setInfoValue(this.playerMode, this.mode || 'HTTP')\r\n    this.setInfoValue(this.p2p, player.localize(this.options_.p2pEnabled ? 'enabled' : 'disabled'))\r\n    this.setInfoValue(this.uuid, this.options_.videoUUID)\r\n\r\n    this.setInfoValue(this.viewport, frames)\r\n    this.setInfoValue(this.resolution, resolution)\r\n    this.setInfoValue(this.volume, volume)\r\n    this.setInfoValue(this.codecs, codecs)\r\n    this.setInfoValue(this.color, colorSpace)\r\n    this.setInfoValue(this.connection, playerNetworkInfo.averageBandwidth)\r\n\r\n    this.setInfoValue(this.network, networkActivity)\r\n    this.setInfoValue(this.transferred, totalTransferred)\r\n    this.setInfoValue(this.download, downloadBreakdown)\r\n\r\n    this.setInfoValue(this.bufferProgress, bufferProgress)\r\n    this.setInfoValue(this.bufferState, buffer)\r\n\r\n    this.setInfoValue(this.liveLatency, latency)\r\n  }\r\n\r\n  private setInfoValue (el: InfoElement, value: string) {\r\n    if (!value) {\r\n      el.root.style.display = 'none'\r\n      return\r\n    }\r\n\r\n    el.root.style.display = 'block'\r\n\r\n    if (el.value.innerHTML === value) return\r\n    el.value.innerHTML = value\r\n  }\r\n\r\n  private buildInfoRow (labelText: string, valueHTML?: string) {\r\n    const root = videojs.dom.createEl('div') as HTMLElement\r\n    root.style.display = 'none'\r\n\r\n    const label = videojs.dom.createEl('div', { innerText: labelText }) as HTMLElement\r\n    const value = videojs.dom.createEl('span', { innerHTML: valueHTML }) as HTMLElement\r\n\r\n    root.appendChild(label)\r\n    root.appendChild(value)\r\n\r\n    return { root, value }\r\n  }\r\n\r\n  private timeRangesToString (r: videojs.TimeRange) {\r\n    let result = ''\r\n\r\n    for (let i = 0; i < r.length; i++) {\r\n      const start = Math.floor(r.start(i))\r\n      const end = Math.floor(r.end(i))\r\n\r\n      result += `[${secondsToTime(start)}, ${secondsToTime(end)}] `\r\n    }\r\n\r\n    return result\r\n  }\r\n}\r\n\r\nvideojs.registerComponent('StatsCard', StatsCard)\r\n\r\nexport {\r\n  StatsCard,\r\n  StatsCardOptions\r\n}\r\n","import videojs from 'video.js'\r\nimport { StatsCard, StatsCardOptions } from './stats-card'\r\n\r\nconst Plugin = videojs.getPlugin('plugin')\r\n\r\nclass StatsForNerdsPlugin extends Plugin {\r\n  private statsCard: StatsCard\r\n\r\n  constructor (player: videojs.Player, options: StatsCardOptions) {\r\n    const settings = {\r\n      ...options\r\n    }\r\n\r\n    super(player)\r\n\r\n    this.player.ready(() => {\r\n      player.addClass('vjs-stats-for-nerds')\r\n    })\r\n\r\n    this.statsCard = new StatsCard(player, options)\r\n\r\n    player.addChild(this.statsCard, settings)\r\n  }\r\n\r\n  show () {\r\n    this.statsCard.show()\r\n  }\r\n}\r\n\r\nvideojs.registerPlugin('stats', StatsForNerdsPlugin)\r\nexport { StatsForNerdsPlugin }\r\n","import videojs from 'video.js'\r\nimport { isMobile } from '@root-helpers/web-browser'\r\n\r\nfunction getPauseBezel () {\r\n  return `\r\n  <div class=\"vjs-bezels-pause\">\r\n    <div class=\"vjs-bezel\" role=\"status\" aria-label=\"Pause\">\r\n      <div class=\"vjs-bezel-icon\">\r\n        <svg height=\"100%\" version=\"1.1\" viewBox=\"0 0 36 36\" width=\"100%\">\r\n          <use class=\"vjs-svg-shadow\" xlink:href=\"#vjs-id-1\"></use>\r\n          <path class=\"vjs-svg-fill\" d=\"M 12,26 16,26 16,10 12,10 z M 21,26 25,26 25,10 21,10 z\" id=\"vjs-id-1\"></path>\r\n        </svg>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  `\r\n}\r\n\r\nfunction getPlayBezel () {\r\n  return `\r\n  <div class=\"vjs-bezels-play\">\r\n    <div class=\"vjs-bezel\" role=\"status\" aria-label=\"Play\">\r\n      <div class=\"vjs-bezel-icon\">\r\n        <svg height=\"100%\" version=\"1.1\" viewBox=\"0 0 36 36\" width=\"100%\">\r\n          <use class=\"vjs-svg-shadow\" xlink:href=\"#vjs-id-2\"></use>\r\n          <path class=\"vjs-svg-fill\" d=\"M 12,26 18.5,22 18.5,14 12,10 z M 18.5,22 25,18 25,18 18.5,14 z\" id=\"ytp-id-2\"></path>\r\n        </svg>\r\n      </div>\r\n    </div>\r\n  </div>\r\n  `\r\n}\r\n\r\nconst Component = videojs.getComponent('Component')\r\nclass PauseBezel extends Component {\r\n  container: HTMLDivElement\r\n\r\n  constructor (player: videojs.Player, options?: videojs.ComponentOptions) {\r\n    super(player, options)\r\n\r\n    // Hide bezels on mobile since we already have our mobile overlay\r\n    if (isMobile()) return\r\n\r\n    player.on('pause', (_: any) => {\r\n      if (player.seeking() || player.ended()) return\r\n      this.container.innerHTML = getPauseBezel()\r\n      this.showBezel()\r\n    })\r\n\r\n    player.on('play', (_: any) => {\r\n      if (player.seeking()) return\r\n      this.container.innerHTML = getPlayBezel()\r\n      this.showBezel()\r\n    })\r\n  }\r\n\r\n  createEl () {\r\n    this.container = super.createEl('div', {\r\n      className: 'vjs-bezels-content'\r\n    }) as HTMLDivElement\r\n\r\n    this.container.style.display = 'none'\r\n\r\n    return this.container\r\n  }\r\n\r\n  showBezel () {\r\n    this.container.style.display = 'inherit'\r\n\r\n    setTimeout(() => {\r\n      this.container.style.display = 'none'\r\n    }, 500) // matching the animation duration\r\n  }\r\n}\r\n\r\nvideojs.registerComponent('PauseBezel', PauseBezel)\r\n","import videojs from 'video.js'\r\nimport './pause-bezel'\r\n\r\nconst Plugin = videojs.getPlugin('plugin')\r\n\r\nclass BezelsPlugin extends Plugin {\r\n\r\n  constructor (player: videojs.Player, options?: videojs.ComponentOptions) {\r\n    super(player)\r\n\r\n    this.player.ready(() => {\r\n      player.addClass('vjs-bezels')\r\n    })\r\n\r\n    player.addChild('PauseBezel', options)\r\n  }\r\n}\r\n\r\nvideojs.registerPlugin('bezels', BezelsPlugin)\r\n\r\nexport { BezelsPlugin }\r\n","import debug from 'debug'\r\nimport videojs from 'video.js'\r\nimport { logger } from '@root-helpers/logger'\r\nimport { isMobile } from '@root-helpers/web-browser'\r\nimport { timeToInt } from '@shared/core-utils'\r\nimport { VideoView, VideoViewEvent } from '@shared/models/videos'\r\nimport {\r\n  getStoredLastSubtitle,\r\n  getStoredMute,\r\n  getStoredVolume,\r\n  saveLastSubtitle,\r\n  saveMuteInStore,\r\n  saveVideoWatchHistory,\r\n  saveVolumeInStore\r\n} from '../../peertube-player-local-storage'\r\nimport { PeerTubePluginOptions, VideoJSCaption } from '../../types'\r\nimport { SettingsButton } from '../settings/settings-menu-button'\r\n\r\nconst debugLogger = debug('peertube:player:peertube')\r\n\r\nconst Plugin = videojs.getPlugin('plugin')\r\n\r\nclass PeerTubePlugin extends Plugin {\r\n  private readonly videoViewUrl: string\r\n  private readonly authorizationHeader: string\r\n\r\n  private readonly videoUUID: string\r\n  private readonly startTime: number\r\n\r\n  private readonly CONSTANTS = {\r\n    USER_VIEW_VIDEO_INTERVAL: 5000 // Every 5 seconds, notify the user is watching the video\r\n  }\r\n\r\n  //private videoCaptions: VideoJSCaption[]\r\n  private defaultSubtitle: string\r\n\r\n  private videoViewInterval: any\r\n\r\n  private menuOpened = false\r\n  private mouseInControlBar = false\r\n  private mouseInSettings = false\r\n  private readonly initialInactivityTimeout: number\r\n\r\n  constructor (player: videojs.Player, options?: PeerTubePluginOptions) {\r\n    super(player)\r\n\r\n    this.videoViewUrl = options.videoViewUrl\r\n    this.authorizationHeader = options.authorizationHeader\r\n    this.videoUUID = options.videoUUID\r\n    this.startTime = timeToInt(options.startTime)\r\n\r\n    //this.videoCaptions = options.videoCaptions\r\n    this.initialInactivityTimeout = this.player.options_.inactivityTimeout\r\n\r\n    if (options.autoplay) this.player.addClass('vjs-has-autoplay')\r\n\r\n    this.player.on('autoplay-failure', () => {\r\n      this.player.removeClass('vjs-has-autoplay')\r\n    })\r\n\r\n    this.player.ready(() => {\r\n      const playerOptions = this.player.options_\r\n\r\n      const volume = getStoredVolume()\r\n      if (volume !== undefined) this.player.volume(volume)\r\n\r\n      const muted = playerOptions.muted !== undefined ? playerOptions.muted : getStoredMute()\r\n      if (muted !== undefined) this.player.muted(muted)\r\n\r\n      this.defaultSubtitle = options.subtitle || getStoredLastSubtitle()\r\n\r\n      this.player.on('volumechange', () => {\r\n        saveVolumeInStore(this.player.volume())\r\n        saveMuteInStore(this.player.muted())\r\n      })\r\n\r\n      if (options.stopTime) {\r\n        const stopTime = timeToInt(options.stopTime)\r\n        const self = this\r\n\r\n        this.player.on('timeupdate', function onTimeUpdate () {\r\n          if (self.player.currentTime() > stopTime) {\r\n            self.player.pause()\r\n            self.player.trigger('stopped')\r\n\r\n            self.player.off('timeupdate', onTimeUpdate)\r\n          }\r\n        })\r\n      }\r\n\r\n      this.player.textTracks().addEventListener('change', () => {\r\n        const showing = this.player.textTracks().tracks_.find(t => {\r\n          return t.kind === 'captions' && t.mode === 'showing'\r\n        })\r\n\r\n        if (!showing) {\r\n          saveLastSubtitle('off')\r\n          return\r\n        }\r\n\r\n        saveLastSubtitle(showing.language)\r\n      })\r\n\r\n      //this.player.on('sourcechange', () => this.initCaptions())\r\n\r\n      this.player.duration(options.videoDuration)\r\n\r\n      this.initializePlayer()\r\n      this.runUserViewing()\r\n    })\r\n  }\r\n\r\n  dispose () {\r\n    if (this.videoViewInterval) clearInterval(this.videoViewInterval)\r\n  }\r\n\r\n  onMenuOpened () {\r\n    this.menuOpened = true\r\n    this.alterInactivity()\r\n  }\r\n\r\n  onMenuClosed () {\r\n    this.menuOpened = false\r\n    this.alterInactivity()\r\n  }\r\n\r\n  displayFatalError () {\r\n    this.player.addClass('vjs-error-display-enabled')\r\n  }\r\n\r\n  hideFatalError () {\r\n    this.player.removeClass('vjs-error-display-enabled')\r\n  }\r\n\r\n  private initializePlayer () {\r\n    if (isMobile()) this.player.addClass('vjs-is-mobile')\r\n\r\n    this.initSmoothProgressBar()\r\n\r\n    //this.initCaptions()\r\n\r\n    this.listenControlBarMouse()\r\n\r\n    this.listenFullScreenChange()\r\n  }\r\n\r\n  private runUserViewing () {\r\n    let lastCurrentTime = this.startTime\r\n    let lastViewEvent: VideoViewEvent\r\n\r\n    this.player.one('play', () => {\r\n      this.notifyUserIsWatching(this.startTime, lastViewEvent)\r\n    })\r\n\r\n    this.player.on('seeked', () => {\r\n      // Don't take into account small seek events\r\n      if (Math.abs(this.player.currentTime() - lastCurrentTime) < 3) return\r\n\r\n      lastViewEvent = 'seek'\r\n    })\r\n\r\n    this.player.one('ended', () => {\r\n      const currentTime = Math.round(this.player.duration())\r\n      lastCurrentTime = currentTime\r\n\r\n      this.notifyUserIsWatching(currentTime, lastViewEvent)\r\n\r\n      lastViewEvent = undefined\r\n    })\r\n\r\n    this.videoViewInterval = setInterval(() => {\r\n      const currentTime = Math.round(this.player.currentTime())\r\n\r\n      // No need to update\r\n      if (currentTime === lastCurrentTime) return\r\n\r\n      lastCurrentTime = currentTime\r\n\r\n      this.notifyUserIsWatching(currentTime, lastViewEvent)\r\n        .catch(err => logger.error('Cannot notify user is watching.', err))\r\n\r\n      lastViewEvent = undefined\r\n\r\n      // Server won't save history, so save the video position in local storage\r\n      if (!this.authorizationHeader) {\r\n        saveVideoWatchHistory(this.videoUUID, currentTime)\r\n      }\r\n    }, this.CONSTANTS.USER_VIEW_VIDEO_INTERVAL)\r\n  }\r\n\r\n  private notifyUserIsWatching (currentTime: number, viewEvent: VideoViewEvent) {\r\n    if (!this.videoViewUrl) return Promise.resolve(undefined)\r\n\r\n    const body: VideoView = {\r\n      currentTime,\r\n      viewEvent\r\n    }\r\n\r\n    const headers = new Headers({\r\n      'Content-type': 'application/json; charset=UTF-8'\r\n    })\r\n\r\n    if (this.authorizationHeader) headers.set('Authorization', this.authorizationHeader)\r\n\r\n    return fetch(this.videoViewUrl, { method: 'POST', body: JSON.stringify(body), headers }).catch(e => {\r\n      return Promise.resolve()\r\n    })\r\n  }\r\n\r\n  private listenFullScreenChange () {\r\n    this.player.on('fullscreenchange', () => {\r\n      if (this.player.isFullscreen()) this.player.focus()\r\n    })\r\n  }\r\n\r\n  private listenControlBarMouse () {\r\n    const controlBar = this.player.controlBar\r\n    const settingsButton: SettingsButton = (controlBar as any).settingsButton\r\n\r\n    controlBar.on('mouseenter', () => {\r\n      this.mouseInControlBar = true\r\n      this.alterInactivity()\r\n    })\r\n\r\n    controlBar.on('mouseleave', () => {\r\n      this.mouseInControlBar = false\r\n      this.alterInactivity()\r\n    })\r\n\r\n    settingsButton.dialog.on('mouseenter', () => {\r\n      this.mouseInSettings = true\r\n      this.alterInactivity()\r\n    })\r\n\r\n    settingsButton.dialog.on('mouseleave', () => {\r\n      this.mouseInSettings = false\r\n      this.alterInactivity()\r\n    })\r\n  }\r\n\r\n  private alterInactivity () {\r\n    if (this.menuOpened || this.mouseInSettings || this.mouseInControlBar) {\r\n      this.setInactivityTimeout(0)\r\n      return\r\n    }\r\n\r\n    this.setInactivityTimeout(this.initialInactivityTimeout)\r\n    this.player.reportUserActivity(true)\r\n  }\r\n\r\n  private setInactivityTimeout (timeout: number) {\r\n    (this.player as any).cache_.inactivityTimeout = timeout\r\n    this.player.options_.inactivityTimeout = timeout\r\n\r\n    debugLogger('Set player inactivity to ' + timeout)\r\n  }\r\n\r\n  /*private initCaptions () {\r\n    for (const caption of this.videoCaptions) {\r\n      this.player.addRemoteTextTrack({\r\n        kind: 'captions',\r\n        label: caption.label,\r\n        language: caption.language,\r\n        id: caption.language,\r\n        src: caption.src,\r\n        default: this.defaultSubtitle === caption.language\r\n      }, false)\r\n    }\r\n\r\n    this.player.trigger('captionsChanged')\r\n  }*/\r\n\r\n  // Thanks: https://github.com/videojs/video.js/issues/4460#issuecomment-312861657\r\n  private initSmoothProgressBar () {\r\n    const SeekBar = videojs.getComponent('SeekBar') as any\r\n    SeekBar.prototype.getPercent = function getPercent () {\r\n      // Allows for smooth scrubbing, when player can't keep up.\r\n      // const time = (this.player_.scrubbing()) ?\r\n      //   this.player_.getCache().currentTime :\r\n      //   this.player_.currentTime()\r\n      const time = this.player_.currentTime()\r\n      const percent = time / this.player_.duration()\r\n      return percent >= 1 ? 1 : percent\r\n    }\r\n    SeekBar.prototype.handleMouseMove = function handleMouseMove (event: any) {\r\n      let newTime = this.calculateDistance(event) * this.player_.duration()\r\n      if (newTime === this.player_.duration()) {\r\n        newTime = newTime - 0.1\r\n      }\r\n      this.player_.currentTime(newTime)\r\n      this.update()\r\n    }\r\n  }\r\n}\r\n\r\nvideojs.registerPlugin('peertube', PeerTubePlugin)\r\nexport { PeerTubePlugin }\r\n","import videojs from 'video.js'\r\nimport { PeerTubeResolution } from '../../types'\r\n\r\nconst Plugin = videojs.getPlugin('plugin')\r\n\r\nclass PeerTubeResolutionsPlugin extends Plugin {\r\n  private currentSelection: PeerTubeResolution\r\n  private resolutions: PeerTubeResolution[] = []\r\n\r\n  private autoResolutionChosenId: number\r\n  private autoResolutionEnabled = true\r\n\r\n  add (resolutions: PeerTubeResolution[]) {\r\n    for (const r of resolutions) {\r\n      this.resolutions.push(r)\r\n    }\r\n\r\n    this.currentSelection = this.getSelected()\r\n\r\n    this.sort()\r\n    this.trigger('resolutionsAdded')\r\n  }\r\n\r\n  getResolutions () {\r\n    return this.resolutions\r\n  }\r\n\r\n  getSelected () {\r\n    return this.resolutions.find(r => r.selected)\r\n  }\r\n\r\n  getAutoResolutionChosen () {\r\n    return this.resolutions.find(r => r.id === this.autoResolutionChosenId)\r\n  }\r\n\r\n  select (options: {\r\n    id: number\r\n    byEngine: boolean\r\n    autoResolutionChosenId?: number\r\n  }) {\r\n    const { id, autoResolutionChosenId, byEngine } = options\r\n\r\n    if (this.currentSelection?.id === id && this.autoResolutionChosenId === autoResolutionChosenId) return\r\n\r\n    this.autoResolutionChosenId = autoResolutionChosenId\r\n\r\n    for (const r of this.resolutions) {\r\n      r.selected = r.id === id\r\n\r\n      if (r.selected) {\r\n        this.currentSelection = r\r\n\r\n        if (!byEngine) r.selectCallback()\r\n      }\r\n    }\r\n\r\n    this.trigger('resolutionChanged')\r\n  }\r\n\r\n  disableAutoResolution () {\r\n    this.autoResolutionEnabled = false\r\n    this.trigger('autoResolutionEnabledChanged')\r\n  }\r\n\r\n  enabledAutoResolution () {\r\n    this.autoResolutionEnabled = true\r\n    this.trigger('autoResolutionEnabledChanged')\r\n  }\r\n\r\n  isAutoResolutionEnabeld () {\r\n    return this.autoResolutionEnabled\r\n  }\r\n\r\n  private sort () {\r\n    this.resolutions.sort((a, b) => {\r\n      if (a.id === -1) return 1\r\n      if (b.id === -1) return -1\r\n\r\n      if (a.height > b.height) return -1\r\n      if (a.height === b.height) return 0\r\n      return 1\r\n    })\r\n  }\r\n\r\n}\r\n\r\nvideojs.registerPlugin('peertubeResolutions', PeerTubeResolutionsPlugin)\r\nexport { PeerTubeResolutionsPlugin }\r\n","import videojs from 'video.js'\r\nimport { NextPreviousVideoButtonOptions } from '../../types'\r\n\r\nconst Button = videojs.getComponent('Button')\r\n\r\nclass NextPreviousVideoButton extends Button {\r\n  private readonly nextPreviousVideoButtonOptions: NextPreviousVideoButtonOptions\r\n\r\n  constructor (player: videojs.Player, options?: NextPreviousVideoButtonOptions) {\r\n    super(player, options as any)\r\n\r\n    this.nextPreviousVideoButtonOptions = options\r\n\r\n    this.update()\r\n  }\r\n\r\n  createEl () {\r\n    const type = (this.options_ as NextPreviousVideoButtonOptions).type\r\n\r\n    const button = videojs.dom.createEl('button', {\r\n      className: 'vjs-' + type + '-video'\r\n    }) as HTMLButtonElement\r\n    const nextIcon = videojs.dom.createEl('span', {\r\n      className: 'icon icon-' + type\r\n    })\r\n    button.appendChild(nextIcon)\r\n\r\n    if (type === 'next') {\r\n      button.title = this.player_.localize('Next video')\r\n    } else {\r\n      button.title = this.player_.localize('Previous video')\r\n    }\r\n\r\n    return button\r\n  }\r\n\r\n  handleClick () {\r\n    this.nextPreviousVideoButtonOptions.handler()\r\n  }\r\n\r\n  update () {\r\n    const disabled = this.nextPreviousVideoButtonOptions.isDisabled()\r\n\r\n    if (disabled) this.addClass('vjs-disabled')\r\n    else this.removeClass('vjs-disabled')\r\n  }\r\n}\r\n\r\nvideojs.registerComponent('NextVideoButton', NextPreviousVideoButton)\r\nvideojs.registerComponent('PreviousVideoButton', NextPreviousVideoButton)\r\n","import videojs from 'video.js'\r\nimport { PeerTubeP2PInfoButtonOptions, PlayerNetworkInfo } from '../../types'\r\nimport { bytes } from '../common'\r\n\r\nconst Button = videojs.getComponent('Button')\r\nclass P2pInfoButton extends Button {\r\n\r\n  constructor (player: videojs.Player, options?: PeerTubeP2PInfoButtonOptions) {\r\n    super(player, options as any)\r\n  }\r\n\r\n  createEl () {\r\n    const div = videojs.dom.createEl('div', {\r\n      className: 'vjs-peertube'\r\n    })\r\n    const subDivWebtorrent = videojs.dom.createEl('div', {\r\n      className: 'vjs-peertube-hidden' // Hide the stats before we get the info\r\n    }) as HTMLDivElement\r\n    div.appendChild(subDivWebtorrent)\r\n\r\n    // Stop here if P2P is not enabled\r\n    const p2pEnabled = (this.options_ as PeerTubeP2PInfoButtonOptions).p2pEnabled\r\n    if (!p2pEnabled) return div as HTMLButtonElement\r\n\r\n    const downloadIcon = videojs.dom.createEl('span', {\r\n      className: 'icon icon-download'\r\n    })\r\n    subDivWebtorrent.appendChild(downloadIcon)\r\n\r\n    const downloadSpeedText = videojs.dom.createEl('span', {\r\n      className: 'download-speed-text'\r\n    })\r\n    const downloadSpeedNumber = videojs.dom.createEl('span', {\r\n      className: 'download-speed-number'\r\n    })\r\n    const downloadSpeedUnit = videojs.dom.createEl('span')\r\n    downloadSpeedText.appendChild(downloadSpeedNumber)\r\n    downloadSpeedText.appendChild(downloadSpeedUnit)\r\n    subDivWebtorrent.appendChild(downloadSpeedText)\r\n\r\n    const uploadIcon = videojs.dom.createEl('span', {\r\n      className: 'icon icon-upload'\r\n    })\r\n    subDivWebtorrent.appendChild(uploadIcon)\r\n\r\n    const uploadSpeedText = videojs.dom.createEl('span', {\r\n      className: 'upload-speed-text'\r\n    })\r\n    const uploadSpeedNumber = videojs.dom.createEl('span', {\r\n      className: 'upload-speed-number'\r\n    })\r\n    const uploadSpeedUnit = videojs.dom.createEl('span')\r\n    uploadSpeedText.appendChild(uploadSpeedNumber)\r\n    uploadSpeedText.appendChild(uploadSpeedUnit)\r\n    subDivWebtorrent.appendChild(uploadSpeedText)\r\n\r\n    const peersText = videojs.dom.createEl('span', {\r\n      className: 'peers-text'\r\n    })\r\n    const peersNumber = videojs.dom.createEl('span', {\r\n      className: 'peers-number'\r\n    })\r\n    subDivWebtorrent.appendChild(peersNumber)\r\n    subDivWebtorrent.appendChild(peersText)\r\n\r\n    const subDivHttp = videojs.dom.createEl('div', {\r\n      className: 'vjs-peertube-hidden'\r\n    })\r\n    const subDivHttpText = videojs.dom.createEl('span', {\r\n      className: 'http-fallback',\r\n      textContent: 'HTTP'\r\n    })\r\n\r\n    subDivHttp.appendChild(subDivHttpText)\r\n    div.appendChild(subDivHttp)\r\n\r\n    this.player_.on('p2pInfo', (event: any, data: PlayerNetworkInfo) => {\r\n      // We are in HTTP fallback\r\n      if (!data) {\r\n        subDivHttp.className = 'vjs-peertube-displayed'\r\n        subDivWebtorrent.className = 'vjs-peertube-hidden'\r\n\r\n        return\r\n      }\r\n\r\n      const p2pStats = data.p2p\r\n      const httpStats = data.http\r\n\r\n      const downloadSpeed = bytes(p2pStats.downloadSpeed + httpStats.downloadSpeed)\r\n      const uploadSpeed = bytes(p2pStats.uploadSpeed + httpStats.uploadSpeed)\r\n      const totalDownloaded = bytes(p2pStats.downloaded + httpStats.downloaded)\r\n      const totalUploaded = bytes(p2pStats.uploaded + httpStats.uploaded)\r\n      const numPeers = p2pStats.numPeers\r\n\r\n      subDivWebtorrent.title = this.player().localize('Total downloaded: ') + totalDownloaded.join(' ') + '\\n'\r\n\r\n      if (data.source === 'p2p-media-loader') {\r\n        const downloadedFromServer = bytes(httpStats.downloaded).join(' ')\r\n        const downloadedFromPeers = bytes(p2pStats.downloaded).join(' ')\r\n\r\n        subDivWebtorrent.title +=\r\n          ' * ' + this.player().localize('From servers: ') + downloadedFromServer + '\\n' +\r\n          ' * ' + this.player().localize('From peers: ') + downloadedFromPeers + '\\n'\r\n      }\r\n      subDivWebtorrent.title += this.player().localize('Total uploaded: ') + totalUploaded.join(' ')\r\n\r\n      downloadSpeedNumber.textContent = downloadSpeed[0]\r\n      downloadSpeedUnit.textContent = ' ' + downloadSpeed[1]\r\n\r\n      uploadSpeedNumber.textContent = uploadSpeed[0]\r\n      uploadSpeedUnit.textContent = ' ' + uploadSpeed[1]\r\n\r\n      peersNumber.textContent = numPeers.toString()\r\n      peersText.textContent = ' ' + (numPeers > 1 ? this.player().localize('peers') : this.player_.localize('peer'))\r\n\r\n      subDivHttp.className = 'vjs-peertube-hidden'\r\n      subDivWebtorrent.className = 'vjs-peertube-displayed'\r\n    })\r\n\r\n    return div as HTMLButtonElement\r\n  }\r\n}\r\n\r\nvideojs.registerComponent('P2PInfoButton', P2pInfoButton)\r\n","/**\r\n * @file picture-in-picture-toggle.js\r\n */\r\n /*import Button from '../button.js';\r\n import Component from '../component.js';\r\n import document from 'global/document';*/\r\n\r\n import videojs from \"video.js\";\r\n\r\n const Button = videojs.getComponent(\"Button\");\r\n const MenuButton = videojs.getComponent(\"MenuButton\");\r\n  \r\n  /**\r\n   * Toggle Picture-in-Picture mode\r\n   *\r\n   * @extends Button\r\n   */\r\n  class PictureInPictureBastyon extends MenuButton {\r\n  \r\n \r\n    constructor(player : any, options : any) {\r\n      super(player, options);\r\n \r\n      this.controlText('Mini Player')\r\n    }\r\n \r\n    createEl(){\r\n     return this.buildElement();\r\n    }\r\n \r\n    handleClick(event : any) {\r\n     this.player_.trigger('pictureInPictureRequest', event)\r\n    }\r\n \r\n    private buildElement() {\r\n \r\n     const el = super.createEl();\r\n     \r\n     el.classList.add(\"vjs-picture-in-picture-control\");\r\n \r\n     return el as HTMLButtonElement;\r\n   }\r\n  \r\n  }\r\n \r\n  videojs.registerComponent(\"PictureInPictureBastyon\", PictureInPictureBastyon);\r\n  ","import videojs from 'video.js'\r\n\r\nconst Component = videojs.getComponent('Component')\r\n\r\nclass PeerTubeLoadProgressBar extends Component {\r\n\r\n  constructor (player: videojs.Player, options?: videojs.ComponentOptions) {\r\n    super(player, options)\r\n\r\n    this.on(player, 'progress', this.update)\r\n  }\r\n\r\n  createEl () {\r\n    return super.createEl('div', {\r\n      className: 'vjs-load-progress',\r\n      innerHTML: `<span class=\"vjs-control-text\"><span>${this.localize('Loaded')}</span>: 0%</span>`\r\n    })\r\n  }\r\n\r\n  dispose () {\r\n    super.dispose()\r\n  }\r\n\r\n  update () {\r\n    const torrent = this.player().webtorrent().getTorrent()\r\n    if (!torrent) return\r\n\r\n    // @ts-ignore\r\n    (this.el() as HTMLElement).style['transform-origin'] = 'left'\r\n    (this.el() as HTMLElement).style['transform'] = 'scaleX('+(torrent.progress).toFixed(2)+')'\r\n\r\n    //(this.el() as HTMLElement).style.width = (torrent.progress * 100) + '%'\r\n  }\r\n\r\n}\r\n\r\nComponent.registerComponent('PeerTubeLoadProgressBar', PeerTubeLoadProgressBar)\r\n","import videojs from 'video.js'\r\nimport { getStoredTheater, saveTheaterInStore } from '../../peertube-player-local-storage'\r\n\r\nconst Button = videojs.getComponent('Button')\r\nclass TheaterButton extends Button {\r\n\r\n  private static readonly THEATER_MODE_CLASS = 'vjs-theater-enabled'\r\n\r\n  constructor (player: videojs.Player, options: videojs.ComponentOptions) {\r\n    super(player, options)\r\n\r\n    const enabled = getStoredTheater()\r\n    if (enabled === true) {\r\n      this.player().addClass(TheaterButton.THEATER_MODE_CLASS)\r\n\r\n      this.handleTheaterChange()\r\n    }\r\n\r\n    this.controlText('Theater mode')\r\n\r\n    this.player().theaterEnabled = enabled\r\n  }\r\n\r\n  buildCSSClass () {\r\n    return `vjs-theater-control ${super.buildCSSClass()}`\r\n  }\r\n\r\n  handleTheaterChange () {\r\n    const theaterEnabled = this.isTheaterEnabled()\r\n\r\n    if (theaterEnabled) {\r\n      this.controlText('Normal mode')\r\n    } else {\r\n      this.controlText('Theater mode')\r\n    }\r\n\r\n    saveTheaterInStore(theaterEnabled)\r\n\r\n    this.player_.trigger('theaterChange', theaterEnabled)\r\n  }\r\n\r\n  handleClick () {\r\n    this.player_.toggleClass(TheaterButton.THEATER_MODE_CLASS)\r\n\r\n    this.handleTheaterChange()\r\n  }\r\n\r\n  private isTheaterEnabled () {\r\n    return this.player_.hasClass(TheaterButton.THEATER_MODE_CLASS)\r\n  }\r\n}\r\n\r\nvideojs.registerComponent('TheaterButton', TheaterButton)\r\n","import videojs from 'video.js'\r\n\r\nconst MenuItem = videojs.getComponent('MenuItem')\r\n\r\nexport interface ResolutionMenuItemOptions extends videojs.MenuItemOptions {\r\n  resolutionId: number\r\n}\r\n\r\nclass ResolutionMenuItem extends MenuItem {\r\n  private readonly resolutionId: number\r\n  private readonly label: string\r\n\r\n  private autoResolutionEnabled: boolean\r\n  private autoResolutionChosen: string\r\n\r\n  constructor (player: videojs.Player, options?: ResolutionMenuItemOptions) {\r\n    options.selectable = true\r\n\r\n    super(player, options)\r\n\r\n    this.autoResolutionEnabled = true\r\n    this.autoResolutionChosen = ''\r\n\r\n    this.resolutionId = options.resolutionId\r\n    this.label = options.label\r\n\r\n    player.peertubeResolutions().on('resolutionChanged', () => this.updateSelection())\r\n\r\n    // We only want to disable the \"Auto\" item\r\n    if (this.resolutionId === -1) {\r\n      player.peertubeResolutions().on('autoResolutionEnabledChanged', () => this.updateAutoResolution())\r\n    }\r\n  }\r\n\r\n  handleClick (event: any) {\r\n    // Auto button disabled?\r\n    if (this.autoResolutionEnabled === false && this.resolutionId === -1) return\r\n\r\n    super.handleClick(event)\r\n\r\n    this.player().peertubeResolutions().select({ id: this.resolutionId, byEngine: false })\r\n  }\r\n\r\n  updateSelection () {\r\n    const selectedResolution = this.player().peertubeResolutions().getSelected()\r\n\r\n    if (this.resolutionId === -1) {\r\n      this.autoResolutionChosen = this.player().peertubeResolutions().getAutoResolutionChosen()?.label\r\n    }\r\n\r\n    this.selected(this.resolutionId === selectedResolution.id)\r\n  }\r\n\r\n  updateAutoResolution () {\r\n    const enabled = this.player().peertubeResolutions().isAutoResolutionEnabeld()\r\n\r\n    // Check if the auto resolution is enabled or not\r\n    if (enabled === false) {\r\n      this.addClass('disabled')\r\n    } else {\r\n      this.removeClass('disabled')\r\n    }\r\n\r\n    this.autoResolutionEnabled = enabled\r\n  }\r\n\r\n  getLabel () {\r\n    if (this.resolutionId === -1) {\r\n      return this.label + ' <small>' + this.autoResolutionChosen + '</small>'\r\n    }\r\n\r\n    return this.label\r\n  }\r\n}\r\nvideojs.registerComponent('ResolutionMenuItem', ResolutionMenuItem)\r\n\r\nexport { ResolutionMenuItem }\r\n","import videojs from 'video.js'\r\nimport { ResolutionMenuItem } from './resolution-menu-item'\r\n\r\nconst Menu = videojs.getComponent('Menu')\r\nconst MenuButton = videojs.getComponent('MenuButton')\r\nclass ResolutionMenuButton extends MenuButton {\r\n  labelEl_: HTMLElement\r\n\r\n  constructor (player: videojs.Player, options?: videojs.MenuButtonOptions) {\r\n    super(player, options)\r\n\r\n    this.controlText('Quality')\r\n\r\n    player.peertubeResolutions().on('resolutionsAdded', () => this.buildQualities())\r\n\r\n    // For parent\r\n    player.peertubeResolutions().on('resolutionChanged', () => {\r\n      setTimeout(() => this.trigger('labelUpdated'))\r\n    })\r\n  }\r\n\r\n  createEl () {\r\n    const el = super.createEl()\r\n\r\n    this.labelEl_ = videojs.dom.createEl('div', {\r\n      className: 'vjs-resolution-value'\r\n    }) as HTMLElement\r\n\r\n    el.appendChild(this.labelEl_)\r\n\r\n    return el\r\n  }\r\n\r\n  updateARIAAttributes () {\r\n    this.el().setAttribute('aria-label', 'Quality')\r\n  }\r\n\r\n  createMenu () {\r\n    return new Menu(this.player_)\r\n  }\r\n\r\n  buildCSSClass () {\r\n    return super.buildCSSClass() + ' vjs-resolution-button'\r\n  }\r\n\r\n  buildWrapperCSSClass () {\r\n    return 'vjs-resolution-control ' + super.buildWrapperCSSClass()\r\n  }\r\n\r\n  private addClickListener (component: any) {\r\n    component.on('click', () => {\r\n      const children = this.menu.children()\r\n\r\n      for (const child of children) {\r\n        if (component !== child) {\r\n          (child as videojs.MenuItem).selected(false)\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  private buildQualities () {\r\n    for (const d of this.player().peertubeResolutions().getResolutions()) {\r\n      const label = d.label === '0p'\r\n        ? this.player().localize('Audio-only')\r\n        : d.label\r\n\r\n      this.menu.addChild(new ResolutionMenuItem(\r\n        this.player_,\r\n        {\r\n          id: d.id + '',\r\n          resolutionId: d.id,\r\n          label,\r\n          selected: d.selected\r\n        })\r\n      )\r\n    }\r\n\r\n    for (const m of this.menu.children()) {\r\n      this.addClickListener(m)\r\n    }\r\n\r\n    this.trigger('menuChanged')\r\n  }\r\n}\r\n\r\nvideojs.registerComponent('ResolutionMenuButton', ResolutionMenuButton)\r\n","import videojs from 'video.js'\r\n\r\nconst Component = videojs.getComponent('Component')\r\n\r\nclass SettingsDialog extends Component {\r\n  constructor (player: videojs.Player) {\r\n    super(player)\r\n\r\n    this.hide()\r\n  }\r\n\r\n  /**\r\n   * Create the component's DOM element\r\n   *\r\n   */\r\n  createEl () {\r\n    const uniqueId = this.id()\r\n    const dialogLabelId = 'TTsettingsDialogLabel-' + uniqueId\r\n    const dialogDescriptionId = 'TTsettingsDialogDescription-' + uniqueId\r\n\r\n    return super.createEl('div', {\r\n      className: 'vjs-settings-dialog vjs-modal-overlay',\r\n      innerHTML: '',\r\n      tabIndex: -1\r\n    }, {\r\n      role: 'dialog',\r\n      'aria-labelledby': dialogLabelId,\r\n      'aria-describedby': dialogDescriptionId\r\n    })\r\n  }\r\n}\r\n\r\nComponent.registerComponent('SettingsDialog', SettingsDialog)\r\n\r\nexport { SettingsDialog }\r\n","import videojs from 'video.js'\r\nimport { toTitleCase } from '../common'\r\nimport { SettingsDialog } from './settings-dialog'\r\nimport { SettingsButton } from './settings-menu-button'\r\nimport { SettingsPanel } from './settings-panel'\r\nimport { SettingsPanelChild } from './settings-panel-child'\r\n\r\nconst MenuItem = videojs.getComponent('MenuItem')\r\nconst component = videojs.getComponent('Component')\r\n\r\nexport interface SettingsMenuItemOptions extends videojs.MenuItemOptions {\r\n  entry: string\r\n  menuButton: SettingsButton\r\n}\r\n\r\nclass SettingsMenuItem extends MenuItem {\r\n  settingsButton: SettingsButton\r\n  dialog: SettingsDialog\r\n  mainMenu: videojs.Menu\r\n  panel: SettingsPanel\r\n  panelChild: SettingsPanelChild\r\n  panelChildEl: HTMLElement\r\n  size: number[]\r\n  menuToLoad: string\r\n  subMenu: SettingsButton\r\n\r\n  submenuClickHandler: typeof SettingsMenuItem.prototype.onSubmenuClick\r\n  transitionEndHandler: typeof SettingsMenuItem.prototype.onTransitionEnd\r\n\r\n  settingsSubMenuTitleEl_: HTMLElement\r\n  settingsSubMenuValueEl_: HTMLElement\r\n  settingsSubMenuEl_: HTMLElement\r\n\r\n  constructor (player: videojs.Player, options?: SettingsMenuItemOptions) {\r\n    super(player, options)\r\n\r\n    this.settingsButton = options.menuButton\r\n    this.dialog = this.settingsButton.dialog\r\n    this.mainMenu = this.settingsButton.menu\r\n    this.panel = this.dialog.getChild('settingsPanel')\r\n    this.panelChild = this.panel.getChild('settingsPanelChild')\r\n    this.panelChildEl = this.panelChild.el() as HTMLElement\r\n\r\n    this.size = null\r\n\r\n    // keep state of what menu type is loading next\r\n    this.menuToLoad = 'mainmenu'\r\n\r\n    const subMenuName = toTitleCase(options.entry)\r\n    const SubMenuComponent = videojs.getComponent(subMenuName)\r\n\r\n    if (!SubMenuComponent) {\r\n      throw new Error(`Component ${subMenuName} does not exist`)\r\n    }\r\n\r\n    const newOptions = Object.assign({}, options, { entry: options.menuButton, menuButton: this })\r\n\r\n    this.subMenu = new SubMenuComponent(this.player(), newOptions) as SettingsButton\r\n    const subMenuClass = this.subMenu.buildCSSClass().split(' ')[0]\r\n    this.settingsSubMenuEl_.className += ' ' + subMenuClass\r\n\r\n    this.eventHandlers()\r\n\r\n    player.ready(() => {\r\n      // Voodoo magic for IOS\r\n      setTimeout(() => {\r\n        // Player was destroyed\r\n        if (!this.player_) return\r\n\r\n        this.build()\r\n\r\n        // Update on rate change\r\n        player.on('ratechange', this.submenuClickHandler)\r\n\r\n        if (subMenuName === 'CaptionsButton') {\r\n          // Hack to regenerate captions on HTTP fallback\r\n          player.on('captionsChanged', () => {\r\n            setTimeout(() => {\r\n              this.settingsSubMenuEl_.innerHTML = ''\r\n              this.settingsSubMenuEl_.appendChild(this.subMenu.menu.el())\r\n              this.update()\r\n              this.bindClickEvents()\r\n            }, 0)\r\n          })\r\n        }\r\n\r\n        this.reset()\r\n      }, 0)\r\n    })\r\n  }\r\n\r\n  eventHandlers () {\r\n    this.submenuClickHandler = this.onSubmenuClick.bind(this)\r\n    this.transitionEndHandler = this.onTransitionEnd.bind(this)\r\n  }\r\n\r\n  onSubmenuClick (event: any) {\r\n    let target = null\r\n\r\n    if (event.type === 'tap') {\r\n      target = event.target\r\n    } else {\r\n      target = event.currentTarget || event.target\r\n    }\r\n\r\n    if (target?.classList.contains('vjs-back-button')) {\r\n      this.loadMainMenu()\r\n      return\r\n    }\r\n\r\n    // To update the sub menu value on click, setTimeout is needed because\r\n    // updating the value is not instant\r\n    setTimeout(() => this.update(event), 0)\r\n\r\n    // Seems like videojs adds a vjs-hidden class on the caption menu after a click\r\n    // We don't need it\r\n    this.subMenu.menu.removeClass('vjs-hidden')\r\n  }\r\n\r\n  /**\r\n   * Create the component's DOM element\r\n   *\r\n   */\r\n  createEl () {\r\n    const el = videojs.dom.createEl('li', {\r\n      className: 'vjs-menu-item',\r\n      tabIndex: -1\r\n    })\r\n\r\n    this.settingsSubMenuTitleEl_ = videojs.dom.createEl('div', {\r\n      className: 'vjs-settings-sub-menu-title'\r\n    }) as HTMLElement\r\n\r\n    el.appendChild(this.settingsSubMenuTitleEl_)\r\n\r\n    this.settingsSubMenuValueEl_ = videojs.dom.createEl('div', {\r\n      className: 'vjs-settings-sub-menu-value'\r\n    }) as HTMLElement\r\n\r\n    el.appendChild(this.settingsSubMenuValueEl_)\r\n\r\n    this.settingsSubMenuEl_ = videojs.dom.createEl('div', {\r\n      className: 'vjs-settings-sub-menu'\r\n    }) as HTMLElement\r\n\r\n    return el as HTMLLIElement\r\n  }\r\n\r\n  /**\r\n   * Handle click on menu item\r\n   *\r\n   * @method handleClick\r\n   */\r\n  handleClick (event: videojs.EventTarget.Event) {\r\n    this.menuToLoad = 'submenu'\r\n    // Remove open class to ensure only the open submenu gets this class\r\n    videojs.dom.removeClass(this.el(), 'open')\r\n\r\n    super.handleClick(event);\r\n\r\n    (this.mainMenu.el() as HTMLElement).style.opacity = '0'\r\n    // Whether to add or remove vjs-hidden class on the settingsSubMenuEl element\r\n    if (videojs.dom.hasClass(this.settingsSubMenuEl_, 'vjs-hidden')) {\r\n      videojs.dom.removeClass(this.settingsSubMenuEl_, 'vjs-hidden')\r\n\r\n      // animation not played without timeout\r\n      setTimeout(() => {\r\n        this.settingsSubMenuEl_.style.opacity = '1'\r\n        this.settingsSubMenuEl_.style.marginRight = '0px'\r\n      }, 0)\r\n\r\n      this.settingsButton.setDialogSize(this.size)\r\n\r\n      const firstChild = this.subMenu.menu.children()[0]\r\n      if (firstChild) firstChild.focus()\r\n    } else {\r\n      videojs.dom.addClass(this.settingsSubMenuEl_, 'vjs-hidden')\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create back button\r\n   *\r\n   * @method createBackButton\r\n   */\r\n  createBackButton () {\r\n    const button = this.subMenu.menu.addChild('MenuItem', {}, 0)\r\n\r\n    button.addClass('vjs-back-button');\r\n    (button.el() as HTMLElement).innerHTML = this.player().localize(this.subMenu.controlText())\r\n  }\r\n\r\n  /**\r\n   * Add/remove prefixed event listener for CSS Transition\r\n   *\r\n   * @method PrefixedEvent\r\n   */\r\n  PrefixedEvent (element: any, type: any, callback: any, action = 'addEvent') {\r\n    const prefix = [ 'webkit', 'moz', 'MS', 'o', '' ]\r\n\r\n    for (let p = 0; p < prefix.length; p++) {\r\n      if (!prefix[p]) {\r\n        type = type.toLowerCase()\r\n      }\r\n\r\n      if (action === 'addEvent') {\r\n        element.addEventListener(prefix[p] + type, callback, false)\r\n      } else if (action === 'removeEvent') {\r\n        element.removeEventListener(prefix[p] + type, callback, false)\r\n      }\r\n    }\r\n  }\r\n\r\n  onTransitionEnd (event: any) {\r\n    if (event.propertyName !== 'margin-right') {\r\n      return\r\n    }\r\n\r\n    if (this.menuToLoad === 'mainmenu') {\r\n      // hide submenu\r\n      videojs.dom.addClass(this.settingsSubMenuEl_, 'vjs-hidden')\r\n\r\n      // reset opacity to 0\r\n      this.settingsSubMenuEl_.style.opacity = '0'\r\n    }\r\n  }\r\n\r\n  reset () {\r\n    videojs.dom.addClass(this.settingsSubMenuEl_, 'vjs-hidden')\r\n    this.settingsSubMenuEl_.style.opacity = '0'\r\n    this.setMargin()\r\n  }\r\n\r\n  loadMainMenu () {\r\n    const mainMenuEl = this.mainMenu.el() as HTMLElement\r\n    this.menuToLoad = 'mainmenu'\r\n    this.mainMenu.show()\r\n    mainMenuEl.style.opacity = '0'\r\n\r\n    // back button will always take you to main menu, so set dialog sizes\r\n    const mainMenuAny = this.mainMenu as any\r\n    this.settingsButton.setDialogSize([ mainMenuAny.width, mainMenuAny.height ])\r\n\r\n    // animation not triggered without timeout (some async stuff ?!?)\r\n    setTimeout(() => {\r\n      // animate margin and opacity before hiding the submenu\r\n      // this triggers CSS Transition event\r\n      this.setMargin()\r\n      mainMenuEl.style.opacity = '1'\r\n\r\n      const firstChild = this.mainMenu.children()[0]\r\n      if (firstChild) firstChild.focus()\r\n    }, 0)\r\n  }\r\n\r\n  build () {\r\n    this.subMenu.on('labelUpdated', () => {\r\n      this.update()\r\n    })\r\n    this.subMenu.on('menuChanged', () => {\r\n      this.bindClickEvents()\r\n      this.setSize()\r\n      this.update()\r\n    })\r\n\r\n    this.settingsSubMenuTitleEl_.innerHTML = this.player().localize(this.subMenu.controlText())\r\n    this.settingsSubMenuEl_.appendChild(this.subMenu.menu.el())\r\n    this.panelChildEl.appendChild(this.settingsSubMenuEl_)\r\n    this.update()\r\n\r\n    this.createBackButton()\r\n    this.setSize()\r\n    this.bindClickEvents()\r\n\r\n    // prefixed event listeners for CSS TransitionEnd\r\n    this.PrefixedEvent(\r\n      this.settingsSubMenuEl_,\r\n      'TransitionEnd',\r\n      this.transitionEndHandler,\r\n      'addEvent'\r\n    )\r\n  }\r\n\r\n  update (event?: any) {\r\n    let target: HTMLElement = null\r\n    const subMenu = this.subMenu.name()\r\n\r\n    if (event && event.type === 'tap') {\r\n      target = event.target\r\n    } else if (event) {\r\n      target = event.currentTarget\r\n    }\r\n\r\n    // Playback rate menu button doesn't get a vjs-selected class\r\n    // or sets options_['selected'] on the selected playback rate.\r\n    // Thus we get the submenu value based on the labelEl of playbackRateMenuButton\r\n    if (subMenu === 'PlaybackRateMenuButton') {\r\n      const html = (this.subMenu as any).labelEl_.innerHTML\r\n\r\n      setTimeout(() => {\r\n        this.settingsSubMenuValueEl_.innerHTML = html\r\n      }, 250)\r\n    } else {\r\n      // Loop through the submenu items to find the selected child\r\n      for (const subMenuItem of this.subMenu.menu.children_) {\r\n        if (!(subMenuItem instanceof component)) {\r\n          continue\r\n        }\r\n\r\n        if (subMenuItem.hasClass('vjs-selected')) {\r\n          const subMenuItemUntyped = subMenuItem as any\r\n\r\n          // Prefer to use the function\r\n          if (typeof subMenuItemUntyped.getLabel === 'function') {\r\n            this.settingsSubMenuValueEl_.innerHTML = subMenuItemUntyped.getLabel()\r\n            break\r\n          }\r\n\r\n          this.settingsSubMenuValueEl_.innerHTML = this.player().localize(subMenuItemUntyped.options_.label)\r\n        }\r\n      }\r\n    }\r\n\r\n    if (target && !target.classList.contains('vjs-back-button')) {\r\n      this.settingsButton.hideDialog()\r\n    }\r\n  }\r\n\r\n  bindClickEvents () {\r\n    for (const item of this.subMenu.menu.children()) {\r\n      if (!(item instanceof component)) {\r\n        continue\r\n      }\r\n      item.on([ 'tap', 'click' ], this.submenuClickHandler)\r\n    }\r\n  }\r\n\r\n  // save size of submenus on first init\r\n  // if number of submenu items change dynamically more logic will be needed\r\n  setSize () {\r\n    this.dialog.removeClass('vjs-hidden')\r\n    videojs.dom.removeClass(this.settingsSubMenuEl_, 'vjs-hidden')\r\n    this.size = this.settingsButton.getComponentSize(this.settingsSubMenuEl_)\r\n    this.setMargin()\r\n    this.dialog.addClass('vjs-hidden')\r\n    videojs.dom.addClass(this.settingsSubMenuEl_, 'vjs-hidden')\r\n  }\r\n\r\n  setMargin () {\r\n    if (!this.size) return\r\n\r\n    const [ width ] = this.size\r\n\r\n    this.settingsSubMenuEl_.style.marginRight = `-${width}px`\r\n  }\r\n\r\n  /**\r\n   * Hide the sub menu\r\n   */\r\n  hideSubMenu () {\r\n    // after removing settings item this.el_ === null\r\n    if (!this.el()) {\r\n      return\r\n    }\r\n\r\n    if (videojs.dom.hasClass(this.el(), 'open')) {\r\n      videojs.dom.addClass(this.settingsSubMenuEl_, 'vjs-hidden')\r\n      videojs.dom.removeClass(this.el(), 'open')\r\n    }\r\n  }\r\n\r\n}\r\n\r\n(SettingsMenuItem as any).prototype.contentElType = 'button'\r\nvideojs.registerComponent('SettingsMenuItem', SettingsMenuItem)\r\n\r\nexport { SettingsMenuItem }\r\n","import videojs from 'video.js'\r\nimport { toTitleCase } from '../common'\r\nimport { SettingsDialog } from './settings-dialog'\r\nimport { SettingsMenuItem } from './settings-menu-item'\r\nimport { SettingsPanel } from './settings-panel'\r\nimport { SettingsPanelChild } from './settings-panel-child'\r\n\r\nconst Button = videojs.getComponent('Button')\r\nconst Menu = videojs.getComponent('Menu')\r\nconst Component = videojs.getComponent('Component')\r\n\r\nexport interface SettingsButtonOptions extends videojs.ComponentOptions {\r\n  entries: any[]\r\n  setup?: {\r\n    maxHeightOffset: number\r\n  }\r\n}\r\n\r\nclass SettingsButton extends Button {\r\n  dialog: SettingsDialog\r\n  dialogEl: HTMLElement\r\n  menu: videojs.Menu\r\n  panel: SettingsPanel\r\n  panelChild: SettingsPanelChild\r\n\r\n  addSettingsItemHandler: typeof SettingsButton.prototype.onAddSettingsItem\r\n  disposeSettingsItemHandler: typeof SettingsButton.prototype.onDisposeSettingsItem\r\n  documentClickHandler: typeof SettingsButton.prototype.onDocumentClick\r\n  userInactiveHandler: typeof SettingsButton.prototype.onUserInactive\r\n\r\n  private settingsButtonOptions: SettingsButtonOptions\r\n\r\n  constructor (player: videojs.Player, options?: SettingsButtonOptions) {\r\n    super(player, options)\r\n\r\n    this.settingsButtonOptions = options\r\n\r\n    this.controlText('Settings')\r\n\r\n    this.dialog = this.player().addChild('settingsDialog')\r\n    this.dialogEl = this.dialog.el() as HTMLElement\r\n    this.menu = null\r\n    this.panel = this.dialog.addChild('settingsPanel')\r\n    this.panelChild = this.panel.addChild('settingsPanelChild')\r\n\r\n    this.addClass('vjs-settings')\r\n    this.el().setAttribute('aria-label', 'Settings Button')\r\n\r\n    // Event handlers\r\n    this.addSettingsItemHandler = this.onAddSettingsItem.bind(this)\r\n    this.disposeSettingsItemHandler = this.onDisposeSettingsItem.bind(this)\r\n    this.documentClickHandler = this.onDocumentClick.bind(this)\r\n    this.userInactiveHandler = this.onUserInactive.bind(this)\r\n\r\n    this.buildMenu()\r\n    this.bindEvents()\r\n\r\n    // Prepare the dialog\r\n    this.player().one('play', () => this.hideDialog())\r\n  }\r\n\r\n  onDocumentClick (event: MouseEvent) {\r\n    const element = event.target as HTMLElement\r\n\r\n    if (element?.classList?.contains('vjs-settings') || element?.parentElement?.classList?.contains('vjs-settings')) {\r\n      return\r\n    }\r\n\r\n    if (!this.dialog.hasClass('vjs-hidden')) {\r\n      this.hideDialog()\r\n    }\r\n  }\r\n\r\n  onDisposeSettingsItem (event: any, name: string) {\r\n    if (name === undefined) {\r\n      const children = this.menu.children()\r\n\r\n      while (children.length > 0) {\r\n        children[0].dispose()\r\n        this.menu.removeChild(children[0])\r\n      }\r\n\r\n      this.addClass('vjs-hidden')\r\n    } else {\r\n      const item = this.menu.getChild(name)\r\n\r\n      if (item) {\r\n        item.dispose()\r\n        this.menu.removeChild(item)\r\n      }\r\n    }\r\n\r\n    this.hideDialog()\r\n\r\n    if (this.settingsButtonOptions.entries.length === 0) {\r\n      this.addClass('vjs-hidden')\r\n    }\r\n  }\r\n\r\n  dispose () {\r\n    document.removeEventListener('click', this.documentClickHandler)\r\n\r\n    if (this.isInIframe()) {\r\n      window.removeEventListener('blur', this.documentClickHandler)\r\n    }\r\n  }\r\n\r\n  onAddSettingsItem (event: any, data: any) {\r\n    const [ entry, options ] = data\r\n\r\n    this.addMenuItem(entry, options)\r\n    this.removeClass('vjs-hidden')\r\n  }\r\n\r\n  onUserInactive () {\r\n    if (!this.dialog.hasClass('vjs-hidden')) {\r\n      this.hideDialog()\r\n    }\r\n  }\r\n\r\n  bindEvents () {\r\n    document.addEventListener('click', this.documentClickHandler)\r\n    if (this.isInIframe()) {\r\n      window.addEventListener('blur', this.documentClickHandler)\r\n    }\r\n\r\n    this.player().on('addsettingsitem', this.addSettingsItemHandler)\r\n    this.player().on('disposesettingsitem', this.disposeSettingsItemHandler)\r\n    this.player().on('userinactive', this.userInactiveHandler)\r\n  }\r\n\r\n  buildCSSClass () {\r\n    return `vjs-icon-settings ${super.buildCSSClass()}`\r\n  }\r\n\r\n  handleClick () {\r\n    if (this.dialog.hasClass('vjs-hidden')) {\r\n      this.showDialog()\r\n    } else {\r\n      this.hideDialog()\r\n    }\r\n  }\r\n\r\n  showDialog () {\r\n    this.player().peertube().onMenuOpened();\r\n\r\n    (this.menu.el() as HTMLElement).style.opacity = '1'\r\n\r\n    this.dialog.show()\r\n    this.el().setAttribute('aria-expanded', 'true')\r\n\r\n    this.setDialogSize(this.getComponentSize(this.menu))\r\n\r\n    const firstChild = this.menu.children()[0]\r\n    if (firstChild) firstChild.focus()\r\n  }\r\n\r\n  hideDialog () {\r\n    this.player_.peertube().onMenuClosed()\r\n\r\n    this.dialog.hide()\r\n    this.el().setAttribute('aria-expanded', 'false')\r\n\r\n    this.setDialogSize(this.getComponentSize(this.menu));\r\n    (this.menu.el() as HTMLElement).style.opacity = '1'\r\n    this.resetChildren()\r\n  }\r\n\r\n  getComponentSize (element: videojs.Component | HTMLElement) {\r\n    let width: number = null\r\n    let height: number = null\r\n\r\n    // Could be component or just DOM element\r\n    if (element instanceof Component) {\r\n      const el = element.el() as HTMLElement\r\n\r\n      width = el.offsetWidth\r\n      height = el.offsetHeight;\r\n\r\n      (element as any).width = width;\r\n      (element as any).height = height\r\n    } else {\r\n      width = element.offsetWidth\r\n      height = element.offsetHeight\r\n    }\r\n\r\n    return [ width, height ]\r\n  }\r\n\r\n  setDialogSize ([ width, height ]: number[]) {\r\n    if (typeof height !== 'number') {\r\n      return\r\n    }\r\n\r\n    const offset = this.settingsButtonOptions.setup.maxHeightOffset\r\n    const maxHeight = (this.player().el() as HTMLElement).offsetHeight - offset\r\n\r\n    const panelEl = this.panel.el() as HTMLElement\r\n\r\n    if (height > maxHeight) {\r\n      height = maxHeight\r\n      width += 17\r\n      panelEl.style.maxHeight = `${height}px`\r\n    } else if (panelEl.style.maxHeight !== '') {\r\n      panelEl.style.maxHeight = ''\r\n    }\r\n\r\n    this.dialogEl.style.width = `${width}px`\r\n    this.dialogEl.style.height = `${height}px`\r\n  }\r\n\r\n  buildMenu () {\r\n    this.menu = new Menu(this.player())\r\n    this.menu.addClass('vjs-main-menu')\r\n    const entries = this.settingsButtonOptions.entries\r\n\r\n    if (entries.length === 0) {\r\n      this.addClass('vjs-hidden')\r\n      this.panelChild.addChild(this.menu)\r\n      return\r\n    }\r\n\r\n    for (const entry of entries) {\r\n      this.addMenuItem(entry, this.settingsButtonOptions)\r\n    }\r\n\r\n    this.panelChild.addChild(this.menu)\r\n  }\r\n\r\n  addMenuItem (entry: any, options: any) {\r\n    const openSubMenu = function (this: any) {\r\n      if (videojs.dom.hasClass(this.el_, 'open')) {\r\n        videojs.dom.removeClass(this.el_, 'open')\r\n      } else {\r\n        videojs.dom.addClass(this.el_, 'open')\r\n      }\r\n    }\r\n\r\n    options.name = toTitleCase(entry)\r\n\r\n    const newOptions = Object.assign({}, options, { entry, menuButton: this })\r\n    const settingsMenuItem = new SettingsMenuItem(this.player(), newOptions)\r\n\r\n    this.menu.addChild(settingsMenuItem)\r\n\r\n    // Hide children to avoid sub menus stacking on top of each other\r\n    // or having multiple menus open\r\n    settingsMenuItem.on('click', videojs.bind(this, this.hideChildren))\r\n\r\n    // Whether to add or remove selected class on the settings sub menu element\r\n    settingsMenuItem.on('click', openSubMenu)\r\n  }\r\n\r\n  resetChildren () {\r\n    for (const menuChild of this.menu.children()) {\r\n      (menuChild as SettingsMenuItem).reset()\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Hide all the sub menus\r\n   */\r\n  hideChildren () {\r\n    for (const menuChild of this.menu.children()) {\r\n      (menuChild as SettingsMenuItem).hideSubMenu()\r\n    }\r\n  }\r\n\r\n  isInIframe () {\r\n    return window.self !== window.top\r\n  }\r\n\r\n}\r\n\r\nComponent.registerComponent('SettingsButton', SettingsButton)\r\n\r\nexport { SettingsButton }\r\n","import videojs from 'video.js'\r\n\r\nconst Component = videojs.getComponent('Component')\r\n\r\nclass SettingsPanel extends Component {\r\n\r\n  createEl () {\r\n    return super.createEl('div', {\r\n      className: 'vjs-settings-panel',\r\n      innerHTML: '',\r\n      tabIndex: -1\r\n    })\r\n  }\r\n}\r\n\r\nComponent.registerComponent('SettingsPanel', SettingsPanel)\r\n\r\nexport { SettingsPanel }\r\n","import videojs from 'video.js'\r\n\r\nconst Component = videojs.getComponent('Component')\r\n\r\nclass SettingsPanelChild extends Component {\r\n\r\n  createEl () {\r\n    return super.createEl('div', {\r\n      className: 'vjs-settings-panel-child',\r\n      innerHTML: '',\r\n      tabIndex: -1\r\n    })\r\n  }\r\n}\r\n\r\nComponent.registerComponent('SettingsPanelChild', SettingsPanelChild)\r\n\r\nexport { SettingsPanelChild }\r\n","import videojs from 'video.js'\r\nimport { PlaylistPluginOptions } from '../../types'\r\nimport { PlaylistMenu } from './playlist-menu'\r\n\r\nconst ClickableComponent = videojs.getComponent('ClickableComponent')\r\n\r\nclass PlaylistButton extends ClickableComponent {\r\n  private playlistInfoElement: HTMLElement\r\n  private wrapper: HTMLElement\r\n\r\n  constructor (player: videojs.Player, options?: PlaylistPluginOptions & { playlistMenu: PlaylistMenu }) {\r\n    super(player, options as any)\r\n  }\r\n\r\n  createEl () {\r\n    this.wrapper = super.createEl('div', {\r\n      className: 'vjs-playlist-button',\r\n      innerHTML: '',\r\n      tabIndex: -1\r\n    }) as HTMLElement\r\n\r\n    const icon = super.createEl('div', {\r\n      className: 'vjs-playlist-icon',\r\n      innerHTML: '',\r\n      tabIndex: -1\r\n    })\r\n\r\n    this.playlistInfoElement = super.createEl('div', {\r\n      className: 'vjs-playlist-info',\r\n      innerHTML: '',\r\n      tabIndex: -1\r\n    }) as HTMLElement\r\n\r\n    this.wrapper.appendChild(icon)\r\n    this.wrapper.appendChild(this.playlistInfoElement)\r\n\r\n    this.update()\r\n\r\n    return this.wrapper\r\n  }\r\n\r\n  update () {\r\n    const options = this.options_ as PlaylistPluginOptions\r\n\r\n    this.playlistInfoElement.innerHTML = options.getCurrentPosition() + '/' + options.playlist.videosLength\r\n    this.wrapper.title = this.player().localize('Playlist: {1}', [ options.playlist.displayName ])\r\n  }\r\n\r\n  handleClick () {\r\n    const playlistMenu = this.getPlaylistMenu()\r\n    playlistMenu.open()\r\n  }\r\n\r\n  private getPlaylistMenu () {\r\n    return (this.options_ as any).playlistMenu as PlaylistMenu\r\n  }\r\n}\r\n\r\nvideojs.registerComponent('PlaylistButton', PlaylistButton)\r\n\r\nexport { PlaylistButton }\r\n","import videojs from 'video.js'\r\nimport { secondsToTime } from '@shared/core-utils'\r\nimport { VideoPlaylistElement } from '@shared/models'\r\nimport { PlaylistItemOptions } from '../../types'\r\n\r\nconst Component = videojs.getComponent('Component')\r\n\r\nclass PlaylistMenuItem extends Component {\r\n  private element: VideoPlaylistElement\r\n\r\n  constructor (player: videojs.Player, options?: PlaylistItemOptions) {\r\n    super(player, options as any)\r\n\r\n    this.emitTapEvents()\r\n\r\n    this.element = options.element\r\n\r\n    this.on([ 'click', 'tap' ], () => this.switchPlaylistItem())\r\n    this.on('keydown', event => this.handleKeyDown(event))\r\n  }\r\n\r\n  createEl () {\r\n    const options = this.options_ as PlaylistItemOptions\r\n\r\n    const li = super.createEl('li', {\r\n      className: 'vjs-playlist-menu-item',\r\n      innerHTML: ''\r\n    }) as HTMLElement\r\n\r\n    if (!options.element.video) {\r\n      li.classList.add('vjs-disabled')\r\n    }\r\n\r\n    const positionBlock = super.createEl('div', {\r\n      className: 'item-position-block'\r\n    }) as HTMLElement\r\n\r\n    const position = super.createEl('div', {\r\n      className: 'item-position',\r\n      innerHTML: options.element.position\r\n    })\r\n\r\n    positionBlock.appendChild(position)\r\n    li.appendChild(positionBlock)\r\n\r\n    if (options.element.video) {\r\n      this.buildAvailableVideo(li, positionBlock, options)\r\n    } else {\r\n      this.buildUnavailableVideo(li)\r\n    }\r\n\r\n    return li\r\n  }\r\n\r\n  setSelected (selected: boolean) {\r\n    if (selected) this.addClass('vjs-selected')\r\n    else this.removeClass('vjs-selected')\r\n  }\r\n\r\n  getElement () {\r\n    return this.element\r\n  }\r\n\r\n  private buildAvailableVideo (li: HTMLElement, positionBlock: HTMLElement, options: PlaylistItemOptions) {\r\n    const videoElement = options.element\r\n\r\n    const player = super.createEl('div', {\r\n      className: 'item-player'\r\n    })\r\n\r\n    positionBlock.appendChild(player)\r\n\r\n    const thumbnail = super.createEl('img', {\r\n      src: window.location.origin + videoElement.video.thumbnailPath\r\n    })\r\n\r\n    const infoBlock = super.createEl('div', {\r\n      className: 'info-block'\r\n    })\r\n\r\n    const title = super.createEl('div', {\r\n      innerHTML: videoElement.video.name,\r\n      className: 'title'\r\n    })\r\n\r\n    const channel = super.createEl('div', {\r\n      innerHTML: videoElement.video.channel.displayName,\r\n      className: 'channel'\r\n    })\r\n\r\n    infoBlock.appendChild(title)\r\n    infoBlock.appendChild(channel)\r\n\r\n    if (videoElement.startTimestamp || videoElement.stopTimestamp) {\r\n      let html = ''\r\n\r\n      if (videoElement.startTimestamp) html += secondsToTime(videoElement.startTimestamp)\r\n      if (videoElement.stopTimestamp) html += ' - ' + secondsToTime(videoElement.stopTimestamp)\r\n\r\n      const timestamps = super.createEl('div', {\r\n        innerHTML: html,\r\n        className: 'timestamps'\r\n      })\r\n\r\n      infoBlock.append(timestamps)\r\n    }\r\n\r\n    li.append(thumbnail)\r\n    li.append(infoBlock)\r\n  }\r\n\r\n  private buildUnavailableVideo (li: HTMLElement) {\r\n    const block = super.createEl('div', {\r\n      className: 'item-unavailable',\r\n      innerHTML: this.player().localize('Unavailable video')\r\n    })\r\n\r\n    li.appendChild(block)\r\n  }\r\n\r\n  private handleKeyDown (event: KeyboardEvent) {\r\n    if (event.code === 'Space' || event.code === 'Enter') {\r\n      this.switchPlaylistItem()\r\n    }\r\n  }\r\n\r\n  private switchPlaylistItem () {\r\n    const options = this.options_ as PlaylistItemOptions\r\n\r\n    options.onClicked()\r\n  }\r\n}\r\n\r\nComponent.registerComponent('PlaylistMenuItem', PlaylistMenuItem)\r\n\r\nexport { PlaylistMenuItem }\r\n","import videojs from 'video.js'\r\nimport { VideoPlaylistElement } from '@shared/models'\r\nimport { PlaylistPluginOptions } from '../../types'\r\nimport { PlaylistMenuItem } from './playlist-menu-item'\r\n\r\nconst Component = videojs.getComponent('Component')\r\n\r\nclass PlaylistMenu extends Component {\r\n  private menuItems: PlaylistMenuItem[]\r\n\r\n  constructor (player: videojs.Player, options?: PlaylistPluginOptions) {\r\n    super(player, options as any)\r\n\r\n    const self = this\r\n\r\n    function userInactiveHandler () {\r\n      self.close()\r\n    }\r\n\r\n    this.el().addEventListener('mouseenter', () => {\r\n      this.player().off('userinactive', userInactiveHandler)\r\n    })\r\n\r\n    this.el().addEventListener('mouseleave', () => {\r\n      this.player().one('userinactive', userInactiveHandler)\r\n    })\r\n\r\n    this.player().on('click', event => {\r\n      let current = event.target as HTMLElement\r\n\r\n      do {\r\n        if (\r\n          current.classList.contains('vjs-playlist-menu') ||\r\n          current.classList.contains('vjs-playlist-button')\r\n        ) {\r\n          return\r\n        }\r\n\r\n        current = current.parentElement\r\n      } while (current)\r\n\r\n      this.close()\r\n    })\r\n  }\r\n\r\n  createEl () {\r\n    this.menuItems = []\r\n\r\n    const options = this.getOptions()\r\n\r\n    const menu = super.createEl('div', {\r\n      className: 'vjs-playlist-menu',\r\n      innerHTML: '',\r\n      tabIndex: -1\r\n    })\r\n\r\n    const header = super.createEl('div', {\r\n      className: 'header'\r\n    })\r\n\r\n    const headerLeft = super.createEl('div')\r\n\r\n    const leftTitle = super.createEl('div', {\r\n      innerHTML: options.playlist.displayName,\r\n      className: 'title'\r\n    })\r\n\r\n    const playlistChannel = options.playlist.videoChannel\r\n    const leftSubtitle = super.createEl('div', {\r\n      innerHTML: playlistChannel\r\n        ? this.player().localize('By {1}', [ playlistChannel.displayName ])\r\n        : '',\r\n      className: 'channel'\r\n    })\r\n\r\n    headerLeft.appendChild(leftTitle)\r\n    headerLeft.appendChild(leftSubtitle)\r\n\r\n    const tick = super.createEl('div', {\r\n      className: 'cross'\r\n    })\r\n    tick.addEventListener('click', () => this.close())\r\n\r\n    header.appendChild(headerLeft)\r\n    header.appendChild(tick)\r\n\r\n    const list = super.createEl('ol')\r\n\r\n    for (const playlistElement of options.elements) {\r\n      const item = new PlaylistMenuItem(this.player(), {\r\n        element: playlistElement,\r\n        onClicked: () => this.onItemClicked(playlistElement)\r\n      })\r\n\r\n      list.appendChild(item.el())\r\n\r\n      this.menuItems.push(item)\r\n    }\r\n\r\n    menu.appendChild(header)\r\n    menu.appendChild(list)\r\n\r\n    return menu\r\n  }\r\n\r\n  update () {\r\n    const options = this.getOptions()\r\n\r\n    this.updateSelected(options.getCurrentPosition())\r\n  }\r\n\r\n  open () {\r\n    this.player().addClass('playlist-menu-displayed')\r\n  }\r\n\r\n  close () {\r\n    this.player().removeClass('playlist-menu-displayed')\r\n  }\r\n\r\n  updateSelected (newPosition: number) {\r\n    for (const item of this.menuItems) {\r\n      item.setSelected(item.getElement().position === newPosition)\r\n    }\r\n  }\r\n\r\n  private getOptions () {\r\n    return this.options_ as PlaylistPluginOptions\r\n  }\r\n\r\n  private onItemClicked (element: VideoPlaylistElement) {\r\n    this.getOptions().onItemClicked(element)\r\n  }\r\n}\r\n\r\nComponent.registerComponent('PlaylistMenu', PlaylistMenu)\r\n\r\nexport { PlaylistMenu }\r\n","import videojs from 'video.js'\r\nimport { PlaylistPluginOptions } from '../../types'\r\nimport { PlaylistButton } from './playlist-button'\r\nimport { PlaylistMenu } from './playlist-menu'\r\n\r\nconst Plugin = videojs.getPlugin('plugin')\r\n\r\nclass PlaylistPlugin extends Plugin {\r\n  private playlistMenu: PlaylistMenu\r\n  private playlistButton: PlaylistButton\r\n  private options: PlaylistPluginOptions\r\n\r\n  constructor (player: videojs.Player, options?: PlaylistPluginOptions) {\r\n    super(player, options)\r\n\r\n    this.options = options\r\n\r\n    this.player.ready(() => {\r\n      player.addClass('vjs-playlist')\r\n    })\r\n\r\n    this.playlistMenu = new PlaylistMenu(player, options)\r\n    this.playlistButton = new PlaylistButton(player, { ...options, playlistMenu: this.playlistMenu })\r\n\r\n    player.addChild(this.playlistMenu, options)\r\n    player.addChild(this.playlistButton, options)\r\n  }\r\n\r\n  updateSelected () {\r\n    this.playlistMenu.updateSelected(this.options.getCurrentPosition())\r\n  }\r\n}\r\n\r\nvideojs.registerPlugin('playlist', PlaylistPlugin)\r\nexport { PlaylistPlugin }\r\n","import debug from 'debug'\r\nimport videojs from 'video.js'\r\nimport { logger } from '@root-helpers/logger'\r\nimport { PeerTubeMobileButtons } from './peertube-mobile-buttons'\r\n\r\nconst debugLogger = debug('peertube:player:mobile')\r\n\r\nconst Plugin = videojs.getPlugin('plugin')\r\n\r\nclass PeerTubeMobilePlugin extends Plugin {\r\n  private static readonly DOUBLE_TAP_DELAY_MS = 250\r\n  private static readonly SET_CURRENT_TIME_DELAY = 1000\r\n\r\n  private peerTubeMobileButtons: PeerTubeMobileButtons\r\n\r\n  private seekAmount = 0\r\n\r\n  private lastTapEvent: TouchEvent\r\n  private tapTimeout: ReturnType<typeof setTimeout>\r\n  private newActiveState: boolean\r\n\r\n  private setCurrentTimeTimeout: ReturnType<typeof setTimeout>\r\n\r\n  constructor (player: videojs.Player, options: videojs.PlayerOptions) {\r\n    super(player, options)\r\n\r\n    this.peerTubeMobileButtons = player.addChild('PeerTubeMobileButtons', { reportTouchActivity: false }) as PeerTubeMobileButtons\r\n\r\n    if (videojs.browser.IS_ANDROID && screen.orientation) {\r\n      this.handleFullscreenRotation()\r\n    }\r\n\r\n    if (!this.player.options_.userActions) this.player.options_.userActions = {};\r\n\r\n    // FIXME: typings\r\n    (this.player.options_.userActions as any).click = false\r\n    this.player.options_.userActions.doubleClick = false\r\n\r\n    this.player.one('play', () => {\r\n      this.initTouchStartEvents()\r\n    })\r\n  }\r\n\r\n  private handleFullscreenRotation () {\r\n    this.player.on('fullscreenchange', () => {\r\n      if (!this.player.isFullscreen() || this.isPortraitVideo()) return\r\n\r\n      screen.orientation.lock('landscape')\r\n        .catch(err => logger.error('Cannot lock screen to landscape.', err))\r\n    })\r\n  }\r\n\r\n  private isPortraitVideo () {\r\n    return this.player.videoWidth() < this.player.videoHeight()\r\n  }\r\n\r\n  private initTouchStartEvents () {\r\n    const handleTouchStart = (event: TouchEvent) => {\r\n      if (this.tapTimeout) {\r\n        clearTimeout(this.tapTimeout)\r\n        this.tapTimeout = undefined\r\n      }\r\n\r\n      if (this.lastTapEvent && event.timeStamp - this.lastTapEvent.timeStamp < PeerTubeMobilePlugin.DOUBLE_TAP_DELAY_MS) {\r\n        debugLogger('Detected double tap')\r\n\r\n        this.lastTapEvent = undefined\r\n        this.onDoubleTap(event)\r\n        return\r\n      }\r\n\r\n      this.newActiveState = !this.player.userActive()\r\n\r\n      this.tapTimeout = setTimeout(() => {\r\n        debugLogger('No double tap detected, set user active state to %s.', this.newActiveState)\r\n\r\n        this.player.userActive(this.newActiveState)\r\n      }, PeerTubeMobilePlugin.DOUBLE_TAP_DELAY_MS)\r\n\r\n      this.lastTapEvent = event\r\n    }\r\n\r\n    this.player.on('touchstart', (event: TouchEvent) => {\r\n      // Only enable user active on player touch, we listen event on peertube mobile buttons to disable it\r\n      if (this.player.userActive()) return\r\n\r\n      handleTouchStart(event)\r\n    })\r\n\r\n    this.peerTubeMobileButtons.el().addEventListener('touchstart', (event: TouchEvent) => {\r\n      // Prevent mousemove/click events firing on the player, that conflict with our user active logic\r\n      event.preventDefault()\r\n\r\n      handleTouchStart(event)\r\n    }, { passive: false })\r\n  }\r\n\r\n  private onDoubleTap (event: TouchEvent) {\r\n    const playerWidth = this.player.currentWidth()\r\n\r\n    const rect = this.findPlayerTarget((event.target as HTMLElement)).getBoundingClientRect()\r\n    const offsetX = event.targetTouches[0].pageX - rect.left\r\n\r\n    debugLogger('Calculating double tap zone (player width: %d, offset X: %d)', playerWidth, offsetX)\r\n\r\n    if (offsetX > 0.66 * playerWidth) {\r\n      if (this.seekAmount < 0) this.seekAmount = 0\r\n\r\n      this.seekAmount += 10\r\n\r\n      debugLogger('Will forward %d seconds', this.seekAmount)\r\n    } else if (offsetX < 0.33 * playerWidth) {\r\n      if (this.seekAmount > 0) this.seekAmount = 0\r\n\r\n      this.seekAmount -= 10\r\n      debugLogger('Will rewind %d seconds', this.seekAmount)\r\n    }\r\n\r\n    this.peerTubeMobileButtons.displayFastSeek(this.seekAmount)\r\n\r\n    this.scheduleSetCurrentTime()\r\n  }\r\n\r\n  private findPlayerTarget (target: HTMLElement): HTMLElement {\r\n    if (target.classList.contains('video-js')) return target\r\n\r\n    return this.findPlayerTarget(target.parentElement)\r\n  }\r\n\r\n  private scheduleSetCurrentTime () {\r\n    this.player.pause()\r\n    this.player.addClass('vjs-fast-seeking')\r\n\r\n    if (this.setCurrentTimeTimeout) clearTimeout(this.setCurrentTimeTimeout)\r\n\r\n    this.setCurrentTimeTimeout = setTimeout(() => {\r\n      let newTime = this.player.currentTime() + this.seekAmount\r\n      this.seekAmount = 0\r\n\r\n      newTime = Math.max(0, newTime)\r\n      newTime = Math.min(this.player.duration(), newTime)\r\n\r\n      this.player.currentTime(newTime)\r\n      this.seekAmount = 0\r\n      this.peerTubeMobileButtons.displayFastSeek(0)\r\n\r\n      this.player.removeClass('vjs-fast-seeking')\r\n      this.player.userActive(false)\r\n\r\n      this.player.play()\r\n    }, PeerTubeMobilePlugin.SET_CURRENT_TIME_DELAY)\r\n  }\r\n}\r\n\r\nvideojs.registerPlugin('peertubeMobile', PeerTubeMobilePlugin)\r\nexport { PeerTubeMobilePlugin }\r\n","import videojs from 'video.js'\r\n\r\nconst Component = videojs.getComponent('Component')\r\nclass PeerTubeMobileButtons extends Component {\r\n\r\n  private rewind: Element\r\n  private forward: Element\r\n  private rewindText: Element\r\n  private forwardText: Element\r\n\r\n  createEl () {\r\n    const container = super.createEl('div', {\r\n      className: 'vjs-mobile-buttons-overlay'\r\n    }) as HTMLDivElement\r\n\r\n    const mainButton = super.createEl('div', {\r\n      className: 'main-button'\r\n    }) as HTMLDivElement\r\n\r\n    mainButton.addEventListener('touchstart', e => {\r\n      e.stopPropagation()\r\n\r\n      if (this.player_.paused() || this.player_.ended()) {\r\n        this.player_.play()\r\n        return\r\n      }\r\n\r\n      this.player_.pause()\r\n    })\r\n\r\n    this.rewind = super.createEl('div', { className: 'rewind-button vjs-hidden' })\r\n    this.forward = super.createEl('div', { className: 'forward-button vjs-hidden' })\r\n\r\n    for (let i = 0; i < 3; i++) {\r\n      this.rewind.appendChild(super.createEl('span', { className: 'icon' }))\r\n      this.forward.appendChild(super.createEl('span', { className: 'icon' }))\r\n    }\r\n\r\n    this.rewindText = this.rewind.appendChild(super.createEl('div', { className: 'text' }))\r\n    this.forwardText = this.forward.appendChild(super.createEl('div', { className: 'text' }))\r\n\r\n    container.appendChild(this.rewind)\r\n    container.appendChild(mainButton)\r\n    container.appendChild(this.forward)\r\n\r\n    return container\r\n  }\r\n\r\n  displayFastSeek (amount: number) {\r\n    if (amount === 0) {\r\n      this.hideRewind()\r\n      this.hideForward()\r\n      return\r\n    }\r\n\r\n    if (amount > 0) {\r\n      this.hideRewind()\r\n      this.displayForward(amount)\r\n      return\r\n    }\r\n\r\n    if (amount < 0) {\r\n      this.hideForward()\r\n      this.displayRewind(amount)\r\n      return\r\n    }\r\n  }\r\n\r\n  private hideRewind () {\r\n    this.rewind.classList.add('vjs-hidden')\r\n    this.rewindText.textContent = ''\r\n  }\r\n\r\n  private displayRewind (amount: number) {\r\n    this.rewind.classList.remove('vjs-hidden')\r\n    this.rewindText.textContent = this.player().localize('{1} seconds', [ amount + '' ])\r\n  }\r\n\r\n  private hideForward () {\r\n    this.forward.classList.add('vjs-hidden')\r\n    this.forwardText.textContent = ''\r\n  }\r\n\r\n  private displayForward (amount: number) {\r\n    this.forward.classList.remove('vjs-hidden')\r\n    this.forwardText.textContent = this.player().localize('{1} seconds', [ amount + '' ])\r\n  }\r\n}\r\n\r\nvideojs.registerComponent('PeerTubeMobileButtons', PeerTubeMobileButtons)\r\n\r\nexport {\r\n  PeerTubeMobileButtons\r\n}\r\n","import videojs from 'video.js'\r\n\r\ntype KeyHandler = { accept: (event: KeyboardEvent) => boolean, cb: (e: KeyboardEvent) => void }\r\n\r\nconst Plugin = videojs.getPlugin('plugin')\r\n\r\nclass PeerTubeHotkeysPlugin extends Plugin {\r\n  private static readonly VOLUME_STEP = 0.1\r\n  private static readonly SEEK_STEP = 5\r\n\r\n  private readonly handleKeyFunction: (event: KeyboardEvent) => void\r\n\r\n  private readonly handlers: KeyHandler[]\r\n\r\n  constructor (player: videojs.Player, options: videojs.PlayerOptions) {\r\n    super(player, options)\r\n\r\n    this.handlers = this.buildHandlers()\r\n\r\n    this.handleKeyFunction = (event: KeyboardEvent) => this.onKeyDown(event)\r\n    document.addEventListener('keydown', this.handleKeyFunction)\r\n  }\r\n\r\n  dispose () {\r\n    document.removeEventListener('keydown', this.handleKeyFunction)\r\n  }\r\n\r\n  private onKeyDown (event: KeyboardEvent) {\r\n    if (!this.isValidKeyTarget(event.target as HTMLElement)) return\r\n\r\n    for (const handler of this.handlers) {\r\n      if (handler.accept(event)) {\r\n        handler.cb(event)\r\n        return\r\n      }\r\n    }\r\n  }\r\n\r\n  private buildHandlers () {\r\n    const handlers: KeyHandler[] = [\r\n      // Play\r\n      {\r\n        accept: e => (e.key === ' ' || e.key === 'MediaPlayPause'),\r\n        cb: e => {\r\n          e.preventDefault()\r\n          e.stopPropagation()\r\n\r\n          if (this.player.paused()) this.player.play()\r\n          else this.player.pause()\r\n        }\r\n      },\r\n\r\n      // Increase volume\r\n      {\r\n        accept: e => this.isNaked(e, 'ArrowUp'),\r\n        cb: e => {\r\n          e.preventDefault()\r\n          this.player.volume(this.player.volume() + PeerTubeHotkeysPlugin.VOLUME_STEP)\r\n        }\r\n      },\r\n\r\n      // Decrease volume\r\n      {\r\n        accept: e => this.isNaked(e, 'ArrowDown'),\r\n        cb: e => {\r\n          e.preventDefault()\r\n          this.player.volume(this.player.volume() - PeerTubeHotkeysPlugin.VOLUME_STEP)\r\n        }\r\n      },\r\n\r\n      // Rewind\r\n      {\r\n        accept: e => this.isNaked(e, 'ArrowLeft') || this.isNaked(e, 'MediaRewind'),\r\n        cb: e => {\r\n          e.preventDefault()\r\n\r\n          const target = Math.max(0, this.player.currentTime() - PeerTubeHotkeysPlugin.SEEK_STEP)\r\n          this.player.currentTime(target)\r\n        }\r\n      },\r\n\r\n      // Forward\r\n      {\r\n        accept: e => this.isNaked(e, 'ArrowRight') || this.isNaked(e, 'MediaForward'),\r\n        cb: e => {\r\n          e.preventDefault()\r\n\r\n          const target = Math.min(this.player.duration(), this.player.currentTime() + PeerTubeHotkeysPlugin.SEEK_STEP)\r\n          this.player.currentTime(target)\r\n        }\r\n      },\r\n\r\n      // Fullscreen\r\n      {\r\n        // f key or Ctrl + Enter\r\n        accept: e => this.isNaked(e, 'f') || (!e.altKey && e.ctrlKey && e.key === 'Enter'),\r\n        cb: e => {\r\n          e.preventDefault()\r\n\r\n          if (this.player.isFullscreen()) this.player.exitFullscreen()\r\n          else this.player.requestFullscreen()\r\n        }\r\n      },\r\n\r\n      // Mute\r\n      {\r\n        accept: e => this.isNaked(e, 'm'),\r\n        cb: e => {\r\n          e.preventDefault()\r\n\r\n          this.player.muted(!this.player.muted())\r\n        }\r\n      },\r\n\r\n      // Increase playback rate\r\n      {\r\n        accept: e => e.key === '>',\r\n        cb: () => {\r\n          const target = Math.min(this.player.playbackRate() + 0.1, 5)\r\n\r\n          this.player.playbackRate(parseFloat(target.toFixed(2)))\r\n        }\r\n      },\r\n\r\n      // Decrease playback rate\r\n      {\r\n        accept: e => e.key === '<',\r\n        cb: () => {\r\n          const target = Math.max(this.player.playbackRate() - 0.1, 0.10)\r\n\r\n          this.player.playbackRate(parseFloat(target.toFixed(2)))\r\n        }\r\n      },\r\n\r\n      // Previous frame\r\n      {\r\n        accept: e => e.key === ',',\r\n        cb: () => {\r\n          this.player.pause()\r\n\r\n          // Calculate movement distance (assuming 30 fps)\r\n          const dist = 1 / 30\r\n          this.player.currentTime(this.player.currentTime() - dist)\r\n        }\r\n      },\r\n\r\n      // Next frame\r\n      {\r\n        accept: e => e.key === '.',\r\n        cb: () => {\r\n          this.player.pause()\r\n\r\n          // Calculate movement distance (assuming 30 fps)\r\n          const dist = 1 / 30\r\n          this.player.currentTime(this.player.currentTime() + dist)\r\n        }\r\n      }\r\n    ]\r\n\r\n    // 0-9 key handlers\r\n    for (let i = 0; i < 10; i++) {\r\n      handlers.push({\r\n        accept: e => e.key === i + '' && !e.ctrlKey, // If using ctrl key, it's a web browser hotkey\r\n        cb: e => {\r\n          e.preventDefault()\r\n\r\n          this.player.currentTime(this.player.duration() * i * 0.1)\r\n        }\r\n      })\r\n    }\r\n\r\n    return handlers\r\n  }\r\n\r\n  private isValidKeyTarget (eventEl: HTMLElement) {\r\n    const playerEl = this.player.el()\r\n    const activeEl = document.activeElement\r\n    const currentElTagName = eventEl.tagName.toLowerCase()\r\n\r\n    return (\r\n      activeEl === playerEl ||\r\n      activeEl === playerEl.querySelector('.vjs-tech') ||\r\n      activeEl === playerEl.querySelector('.vjs-control-bar') ||\r\n      eventEl.id === 'content' ||\r\n      currentElTagName === 'body' ||\r\n      currentElTagName === 'video'\r\n    )\r\n  }\r\n\r\n  private isNaked (event: KeyboardEvent, key: string) {\r\n    return (!event.ctrlKey && !event.altKey && !event.metaKey && !event.shiftKey && event.key === key)\r\n  }\r\n}\r\n\r\nvideojs.registerPlugin('peerTubeHotkeysPlugin', PeerTubeHotkeysPlugin)\r\nexport { PeerTubeHotkeysPlugin }\r\n","function copyToClipboard (text: string) {\r\n  const el = document.createElement('textarea')\r\n  el.value = text\r\n  el.setAttribute('readonly', '')\r\n  el.style.position = 'absolute'\r\n  el.style.left = '-9999px'\r\n  document.body.appendChild(el)\r\n  el.select()\r\n  document.execCommand('copy')\r\n  document.body.removeChild(el)\r\n}\r\n\r\nfunction wait (ms: number) {\r\n  return new Promise<void>(res => {\r\n    setTimeout(() => res(), ms)\r\n  })\r\n}\r\n\r\nexport {\r\n  copyToClipboard,\r\n  wait\r\n}\r\n","import {\r\n  CommonOptions,\r\n  NextPreviousVideoButtonOptions,\r\n  PeerTubeLinkButtonOptions,\r\n  PeertubePlayerManagerOptions,\r\n  PlayerMode\r\n} from '../../types'\r\n\r\nexport class ControlBarOptionsBuilder {\r\n  private options: CommonOptions\r\n\r\n  constructor (\r\n    globalOptions: PeertubePlayerManagerOptions,\r\n    private mode: PlayerMode\r\n  ) {\r\n    this.options = globalOptions.common\r\n  }\r\n\r\n  getChildrenOptions () {\r\n    const children = {}\r\n\r\n    if (this.options.previousVideo) {\r\n      Object.assign(children, this.getPreviousVideo())\r\n    }\r\n\r\n    Object.assign(children, { playToggle: {} })\r\n\r\n    if (this.options.nextVideo) {\r\n      Object.assign(children, this.getNextVideo())\r\n    }\r\n\r\n    Object.assign(children, {\r\n      currentTimeDisplay: {},\r\n      timeDivider: {},\r\n      durationDisplay: {},\r\n      liveDisplay: {},\r\n\r\n      flexibleWidthSpacer: {},\r\n\r\n      ...this.getProgressControl(),\r\n\r\n      p2PInfoButton: {\r\n        p2pEnabled: this.options.p2pEnabled\r\n      },\r\n\r\n      muteToggle: {},\r\n      volumeControl: {},\r\n\r\n      ...this.getSettingsButton()\r\n    })\r\n\r\n    /*if (this.options.peertubeLink === true) {\r\n      Object.assign(children, {\r\n        peerTubeLinkButton: {\r\n          shortUUID: this.options.videoShortUUID,\r\n          //instanceName: this.options.instanceName\r\n        } as PeerTubeLinkButtonOptions\r\n      })\r\n    }*/\r\n\r\n    Object.assign(children, {\r\n      PictureInPictureBastyon: {}\r\n    })\r\n\r\n    if (this.options.theaterButton === true) {\r\n      Object.assign(children, {\r\n        theaterButton: {}\r\n      })\r\n    }\r\n\r\n    Object.assign(children, {\r\n      fullscreenToggle: {}\r\n    })\r\n\r\n    return children\r\n  }\r\n\r\n  private getSettingsButton () {\r\n    const settingEntries: string[] = []\r\n\r\n    settingEntries.push('playbackRateMenuButton')\r\n\r\n    //if (this.options.captions === true) settingEntries.push('captionsButton')\r\n\r\n    settingEntries.push('resolutionMenuButton')\r\n\r\n    return {\r\n      settingsButton: {\r\n        setup: {\r\n          maxHeightOffset: 40\r\n        },\r\n        entries: settingEntries\r\n      }\r\n    }\r\n  }\r\n\r\n  private getProgressControl () {\r\n    const loadProgressBar = this.mode === 'webtorrent'\r\n      ? 'peerTubeLoadProgressBar'\r\n      : 'loadProgressBar'\r\n\r\n    return {\r\n      progressControl: {\r\n        children: {\r\n          seekBar: {\r\n            children: {\r\n              [loadProgressBar]: {},\r\n              mouseTimeDisplay: {},\r\n              playProgressBar: {}\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private getPreviousVideo () {\r\n    const buttonOptions: NextPreviousVideoButtonOptions = {\r\n      type: 'previous',\r\n      handler: this.options.previousVideo,\r\n      isDisabled: () => {\r\n        if (!this.options.hasPreviousVideo) return false\r\n\r\n        return !this.options.hasPreviousVideo()\r\n      }\r\n    }\r\n\r\n    return { previousVideoButton: buttonOptions }\r\n  }\r\n\r\n  private getNextVideo () {\r\n    const buttonOptions: NextPreviousVideoButtonOptions = {\r\n      type: 'next',\r\n      handler: this.options.nextVideo,\r\n      isDisabled: () => {\r\n        if (!this.options.hasNextVideo) return false\r\n\r\n        return !this.options.hasNextVideo()\r\n      }\r\n    }\r\n\r\n    return { nextVideoButton: buttonOptions }\r\n  }\r\n}\r\n","import { basename, dirname } from 'path'\r\nimport { logger } from '@root-helpers/logger'\r\n\r\nclass RedundancyUrlManager {\r\n\r\n  constructor (private baseUrls: string[] = []) {\r\n    // empty\r\n  }\r\n\r\n  removeBySegmentUrl (segmentUrl: string) {\r\n    logger.info(`Removing redundancy of segment URL ${segmentUrl}.`)\r\n\r\n    const baseUrl = dirname(segmentUrl)\r\n\r\n    this.baseUrls = this.baseUrls.filter(u => u !== baseUrl && u !== baseUrl + '/')\r\n  }\r\n\r\n  buildUrl (url: string) {\r\n    const max = this.baseUrls.length + 1\r\n    const i = this.getRandomInt(max)\r\n\r\n    if (i === max - 1) return url\r\n\r\n    const newBaseUrl = this.baseUrls[i]\r\n    const slashPart = newBaseUrl.endsWith('/') ? '' : '/'\r\n\r\n    return newBaseUrl + slashPart + basename(url)\r\n  }\r\n\r\n  countBaseUrls () {\r\n    return this.baseUrls.length\r\n  }\r\n\r\n  private getRandomInt (max: number) {\r\n    return Math.floor(Math.random() * Math.floor(max))\r\n  }\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n\r\nexport {\r\n  RedundancyUrlManager\r\n}\r\n","import { Segment } from 'p2p-media-loader-core-basyton'\r\nimport { RedundancyUrlManager } from './redundancy-url-manager'\r\n\r\nfunction segmentUrlBuilderFactory (redundancyUrlManager: RedundancyUrlManager) {\r\n  return function segmentBuilder (segment: Segment) {\r\n    return redundancyUrlManager.buildUrl(segment.url)\r\n  }\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n\r\nexport {\r\n  segmentUrlBuilderFactory\r\n}\r\n","import { basename } from 'path'\r\nimport { Segment } from 'p2p-media-loader-core-basyton'\r\nimport { logger } from '@root-helpers/logger'\r\nimport { wait } from '@root-helpers/utils'\r\n\r\ntype SegmentsJSON = { [filename: string]: string | { [byterange: string]: string } }\r\n\r\nconst maxRetries = 3\r\n\r\nfunction segmentValidatorFactory (segmentsSha256Url: string, isLive: boolean) {\r\n  let segmentsJSON = fetchSha256Segments(segmentsSha256Url)\r\n  const regex = /bytes=(\\d+)-(\\d+)/\r\n\r\n  return async function segmentValidator (segment: Segment, _method: string, _peerId: string, retry = 1) {\r\n    // Wait for hash generation from the server\r\n    if (isLive) await wait(1000)\r\n\r\n    const filename = basename(segment.url)\r\n\r\n    const segmentValue = (await segmentsJSON)[filename]\r\n\r\n    if (!segmentValue && retry > maxRetries) {\r\n      throw new Error(`Unknown segment name ${filename} in segment validator`)\r\n    }\r\n\r\n    if (!segmentValue) {\r\n      logger.info(`Refetching sha segments for ${filename}`)\r\n\r\n      await wait(1000)\r\n\r\n      segmentsJSON = fetchSha256Segments(segmentsSha256Url)\r\n      await segmentValidator(segment, _method, _peerId, retry + 1)\r\n\r\n      return\r\n    }\r\n\r\n    let hashShouldBe: string\r\n    let range = ''\r\n\r\n    if (typeof segmentValue === 'string') {\r\n      hashShouldBe = segmentValue\r\n    } else {\r\n      const captured = regex.exec(segment.range)\r\n      range = captured[1] + '-' + captured[2]\r\n\r\n      hashShouldBe = segmentValue[range]\r\n    }\r\n\r\n    if (hashShouldBe === undefined) {\r\n      throw new Error(`Unknown segment name ${filename}/${range} in segment validator`)\r\n    }\r\n\r\n    const calculatedSha = await sha256Hex(segment.data)\r\n    if (calculatedSha !== hashShouldBe) {\r\n      throw new Error(\r\n        `Hashes does not correspond for segment ${filename}/${range}` +\r\n        `(expected: ${hashShouldBe} instead of ${calculatedSha})`\r\n      )\r\n    }\r\n  }\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n\r\nexport {\r\n  segmentValidatorFactory\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n\r\nfunction fetchSha256Segments (url: string) {\r\n  return fetch(url)\r\n    .then(res => res.json() as Promise<SegmentsJSON>)\r\n    .catch(err => {\r\n      logger.error('Cannot get sha256 segments', err)\r\n      return {}\r\n    })\r\n}\r\n\r\nasync function sha256Hex (data?: ArrayBuffer) {\r\n  if (!data) return undefined\r\n\r\n  if (window.crypto.subtle) {\r\n    return window.crypto.subtle.digest('SHA-256', data)\r\n      .then(data => bufferToHex(data))\r\n  }\r\n\r\n  // Fallback for non HTTPS context\r\n  const shaModule = (await import('sha.js') as any).default\r\n  // eslint-disable-next-line new-cap\r\n  return new shaModule.sha256().update(Buffer.from(data)).digest('hex')\r\n}\r\n\r\n// Thanks: https://stackoverflow.com/a/53307879\r\nfunction bufferToHex (buffer?: ArrayBuffer) {\r\n  if (!buffer) return ''\r\n\r\n  let s = ''\r\n  const h = '0123456789abcdef'\r\n  const o = new Uint8Array(buffer)\r\n\r\n  o.forEach((v: any) => {\r\n    s += h[v >> 4] + h[v & 15]\r\n  })\r\n\r\n  return s\r\n}\r\n","import { HybridLoaderSettings } from 'p2p-media-loader-core-basyton'\r\nimport { HlsJsEngineSettings } from 'p2p-media-loader-hlsjs-basyton'\r\nimport { logger } from '@root-helpers/logger'\r\nimport { LiveVideoLatencyMode } from '@shared/models'\r\nimport { getAverageBandwidthInStore } from '../../peertube-player-local-storage'\r\nimport { P2PMediaLoader, P2PMediaLoaderPluginOptions } from '../../types'\r\nimport { PeertubePlayerManagerOptions } from '../../types/manager-options'\r\nimport { getRtcConfig } from '../common'\r\nimport { RedundancyUrlManager } from '../p2p-media-loader/redundancy-url-manager'\r\nimport { segmentUrlBuilderFactory } from '../p2p-media-loader/segment-url-builder'\r\nimport { segmentValidatorFactory } from '../p2p-media-loader/segment-validator'\r\n//import CapLevelController from './peertube-cap-level-controller'\r\n\r\nexport class HLSOptionsBuilder {\r\n\r\n  constructor (\r\n    private options: PeertubePlayerManagerOptions,\r\n    private p2pMediaLoaderModule?: any\r\n  ) {\r\n\r\n  }\r\n\r\n  getPluginOptions () {\r\n    const commonOptions = this.options.common\r\n\r\n    const redundancyUrlManager = new RedundancyUrlManager(this.options.p2pMediaLoader.redundancyBaseUrls)\r\n\r\n    const p2pMediaLoaderConfig = this.getP2PMediaLoaderOptions(redundancyUrlManager)\r\n    const loader = new this.p2pMediaLoaderModule.Engine(p2pMediaLoaderConfig).createLoaderClass() as P2PMediaLoader\r\n\r\n    console.log('p2pMediaLoaderConfig', p2pMediaLoaderConfig)\r\n\r\n    const p2pMediaLoader: P2PMediaLoaderPluginOptions = {\r\n      redundancyUrlManager,\r\n      type: 'application/x-mpegURL',\r\n      startTime: commonOptions.startTime,\r\n      src: this.options.p2pMediaLoader.playlistUrl,\r\n      loader\r\n    }\r\n\r\n    const hlsjs = {\r\n      levelLabelHandler: (level: { height: number, width: number }) => {\r\n        const resolution = Math.min(level.height || 0, level.width || 0)\r\n\r\n        const file = this.options.p2pMediaLoader.videoFiles.find(f => f.resolution.id === resolution)\r\n        // We don't have files for live videos\r\n        if (!file) return level.height\r\n\r\n        let label = file.resolution.label\r\n        if (file.fps >= 50) label += file.fps\r\n\r\n        return label\r\n      }\r\n    }\r\n\r\n    const html5 = {\r\n      hlsjsConfig: this.getHLSJSOptions(loader)\r\n    }\r\n\r\n    return { p2pMediaLoader, hlsjs, html5 }\r\n  }\r\n\r\n  // ---------------------------------------------------------------------------\r\n\r\n  private getP2PMediaLoaderOptions (redundancyUrlManager: RedundancyUrlManager): HlsJsEngineSettings {\r\n    let consumeOnly = false\r\n    if ((navigator as any)?.connection?.type === 'cellular') {\r\n      logger.info('We are on a cellular connection: disabling seeding.')\r\n      consumeOnly = true\r\n    }\r\n\r\n    const trackerAnnounce = this.options.p2pMediaLoader.trackerAnnounce\r\n                                                 .filter(t => t.startsWith('ws'))\r\n\r\n    const specificLiveOrVODOptions = this.options.common.isLive\r\n      ? this.getP2PMediaLoaderLiveOptions()\r\n      : this.getP2PMediaLoaderVODOptions()\r\n\r\n    return {\r\n      loader: {\r\n        trackerAnnounce,\r\n        rtcConfig: getRtcConfig(),\r\n\r\n        simultaneousHttpDownloads: 1,\r\n        httpFailedSegmentTimeout: 1000,\r\n\r\n        segmentValidator:  !this.options.common.localTransport ? segmentValidatorFactory(this.options.p2pMediaLoader.segmentsSha256Url, this.options.common.isLive) : undefined,\r\n        segmentUrlBuilder: segmentUrlBuilderFactory(redundancyUrlManager),\r\n\r\n        useP2P: this.options.common.p2pEnabled,\r\n        consumeOnly,\r\n        segmentsStorage : this.options.segmentsStorage,\r\n\r\n        localTransport : this.options.common.localTransport,\r\n\r\n        ...specificLiveOrVODOptions\r\n      },\r\n      segments: {\r\n        assetsStorage : this.options.assetsStorage,\r\n        swarmId: this.options.p2pMediaLoader.playlistUrl,\r\n        forwardSegmentCount: specificLiveOrVODOptions.p2pDownloadMaxPriority ?? 20\r\n      }\r\n    }\r\n  }\r\n\r\n  private getP2PMediaLoaderLiveOptions (): Partial<HybridLoaderSettings> {\r\n    const base = {\r\n      requiredSegmentsPriority: 1\r\n    }\r\n\r\n    const latencyMode = this.options.common.liveOptions.latencyMode\r\n\r\n    switch (latencyMode) {\r\n      case LiveVideoLatencyMode.SMALL_LATENCY:\r\n        return {\r\n          ...base,\r\n\r\n          useP2P: false,\r\n          httpDownloadProbability: 1\r\n        }\r\n\r\n      case LiveVideoLatencyMode.HIGH_LATENCY:\r\n        return base\r\n\r\n      default:\r\n        return base\r\n    }\r\n  }\r\n\r\n  private getP2PMediaLoaderVODOptions (): Partial<HybridLoaderSettings> {\r\n    return {\r\n      requiredSegmentsPriority: 3,\r\n      skipSegmentBuilderPriority: 1,\r\n\r\n      cachedSegmentExpiration: 86400000,\r\n      cachedSegmentsCount: 100,\r\n\r\n      httpDownloadMaxPriority: 9,\r\n      httpDownloadProbability: 0.06,\r\n      httpDownloadProbabilitySkipIfNoPeers: true,\r\n\r\n      p2pDownloadMaxPriority: 50\r\n    }\r\n  }\r\n\r\n  // ---------------------------------------------------------------------------\r\n\r\n  private getHLSJSOptions (loader: P2PMediaLoader) {\r\n    const specificLiveOrVODOptions = this.options.common.isLive\r\n      ? this.getHLSLiveOptions()\r\n      : this.getHLSVODOptions()\r\n\r\n    const base = {\r\n      capLevelToPlayerSize: true,\r\n      autoStartLoad: false,\r\n\r\n      loader,\r\n\r\n      ...specificLiveOrVODOptions\r\n    }\r\n\r\n    const averageBandwidth = getAverageBandwidthInStore()\r\n    if (!averageBandwidth) return base\r\n\r\n    return {\r\n      ...base,\r\n\r\n      abrEwmaDefaultEstimate: averageBandwidth * 8, // We want bit/s\r\n      backBufferLength: 90,\r\n      startLevel: -1,\r\n      testBandwidth: false,\r\n      debug: false,\r\n\r\n     // capLevelController : CapLevelController\r\n    }\r\n  }\r\n\r\n  private getHLSLiveOptions () {\r\n    const latencyMode = this.options.common.liveOptions.latencyMode\r\n\r\n    switch (latencyMode) {\r\n      case LiveVideoLatencyMode.SMALL_LATENCY:\r\n        return {\r\n          liveSyncDurationCount: 2\r\n        }\r\n\r\n      case LiveVideoLatencyMode.HIGH_LATENCY:\r\n        return {\r\n          liveSyncDurationCount: 10\r\n        }\r\n\r\n      default:\r\n        return {\r\n          liveSyncDurationCount: 5\r\n        }\r\n    }\r\n  }\r\n\r\n  private getHLSVODOptions () {\r\n    return {\r\n      liveSyncDurationCount: 5\r\n    }\r\n  }\r\n}\r\n","import { PeertubePlayerManagerOptions } from '../../types'\r\n\r\nexport class WebTorrentOptionsBuilder {\r\n\r\n  constructor (\r\n    private options: PeertubePlayerManagerOptions,\r\n    private autoPlayValue: any\r\n  ) {\r\n\r\n  }\r\n\r\n  getPluginOptions () {\r\n    const commonOptions = this.options.common\r\n    const webtorrentOptions = this.options.webtorrent\r\n    const p2pMediaLoaderOptions = this.options.p2pMediaLoader\r\n\r\n    const autoplay = this.autoPlayValue === 'play'\r\n\r\n    const webtorrent = {\r\n      autoplay,\r\n\r\n      playerRefusedP2P: commonOptions.p2pEnabled === false,\r\n      videoDuration: commonOptions.videoDuration,\r\n      playerElement: commonOptions.playerElement,\r\n\r\n      videoFiles: webtorrentOptions.videoFiles.length !== 0\r\n        ? webtorrentOptions.videoFiles\r\n        // The WebTorrent plugin won't be able to play these files, but it will fallback to HTTP mode\r\n        : p2pMediaLoaderOptions?.videoFiles || [],\r\n\r\n      startTime: commonOptions.startTime\r\n    }\r\n\r\n    return { webtorrent }\r\n  }\r\n}\r\n","import videojs from 'video.js'\r\nimport { copyToClipboard } from '@root-helpers/utils'\r\nimport { isIOS, isSafari } from '@root-helpers/web-browser'\r\nimport { buildVideoLink, decorateVideoLink, pick } from '@shared/core-utils'\r\nimport { isDefaultLocale } from '@shared/core-utils/i18n'\r\nimport { VideoJSPluginOptions } from '../../types'\r\nimport { CommonOptions, PeertubePlayerManagerOptions, PlayerMode } from '../../types/manager-options'\r\nimport { ControlBarOptionsBuilder } from './control-bar-options-builder'\r\nimport { HLSOptionsBuilder } from './hls-options-builder'\r\nimport { WebTorrentOptionsBuilder } from './webtorrent-options-builder'\r\n\r\nexport class ManagerOptionsBuilder {\r\n\r\n  constructor (\r\n    private mode: PlayerMode,\r\n    private options: PeertubePlayerManagerOptions,\r\n    private p2pMediaLoaderModule?: any\r\n  ) {\r\n\r\n  }\r\n\r\n  getVideojsOptions (alreadyPlayed: boolean): videojs.PlayerOptions {\r\n    const commonOptions = this.options.common\r\n\r\n    let autoplay = this.getAutoPlayValue(commonOptions.autoplay, alreadyPlayed)\r\n    const html5 = {\r\n      preloadTextTracks: false\r\n    }\r\n\r\n    const plugins: VideoJSPluginOptions = {\r\n      peertube: {\r\n        mode: this.mode,\r\n        autoplay, // Use peertube plugin autoplay because we could get the file by webtorrent\r\n\r\n        ...pick(commonOptions, [\r\n          'videoViewUrl',\r\n          'authorizationHeader',\r\n          'startTime',\r\n          'videoDuration',\r\n          'subtitle',\r\n        //  'videoCaptions',\r\n          'stopTime',\r\n          'isLive',\r\n          'videoUUID',\r\n        ])\r\n      }\r\n    }\r\n\r\n    /*if (commonOptions.playlist) {\r\n      plugins.playlist = commonOptions.playlist\r\n    }*/\r\n\r\n\r\n\r\n    if (this.mode === 'p2p-media-loader') {\r\n      const hlsOptionsBuilder = new HLSOptionsBuilder(this.options, this.p2pMediaLoaderModule)\r\n      const options = hlsOptionsBuilder.getPluginOptions()\r\n\r\n      Object.assign(plugins, pick(options, [ 'hlsjs', 'p2pMediaLoader' ]))\r\n      Object.assign(html5, options.html5)\r\n    } else if (this.mode === 'webtorrent') {\r\n      const webtorrentOptionsBuilder = new WebTorrentOptionsBuilder(this.options, this.getAutoPlayValue(autoplay, alreadyPlayed))\r\n\r\n      Object.assign(plugins, webtorrentOptionsBuilder.getPluginOptions())\r\n\r\n      // WebTorrent plugin handles autoplay, because we do some hackish stuff in there\r\n      autoplay = false\r\n    }\r\n\r\n    Object.assign(plugins, {\r\n      hotkeys : {}\r\n    })\r\n\r\n    const controlBarOptionsBuilder = new ControlBarOptionsBuilder(this.options, this.mode)\r\n\r\n    const videojsOptions = {\r\n      html5,\r\n\r\n      // We don't use text track settings for now\r\n      textTrackSettings: false as any, // FIXME: typings\r\n      controls: commonOptions.controls !== undefined ? commonOptions.controls : true,\r\n      loop: commonOptions.loop !== undefined ? commonOptions.loop : false,\r\n\r\n      muted: commonOptions.muted !== undefined\r\n        ? commonOptions.muted\r\n        : undefined, // Undefined so the player knows it has to check the local storage\r\n\r\n      autoplay: this.getAutoPlayValue(autoplay, alreadyPlayed),\r\n\r\n      poster: commonOptions.poster,\r\n      inactivityTimeout: commonOptions.inactivityTimeout,\r\n      playbackRates: [ 0.5, 0.75, 1, 1.25, 1.5, 1.75, 2 ],\r\n\r\n      plugins,\r\n\r\n      sources : commonOptions.sources,\r\n\r\n      controlBar: {\r\n        children: controlBarOptionsBuilder.getChildrenOptions() as any // FIXME: typings\r\n      },\r\n\r\n      \r\n    }\r\n\r\n    if (commonOptions.language && !isDefaultLocale(commonOptions.language)) {\r\n      Object.assign(videojsOptions, { language: commonOptions.language })\r\n    }\r\n\r\n    return videojsOptions\r\n  }\r\n\r\n  private getAutoPlayValue (autoplay: any, alreadyPlayed: boolean) {\r\n    if (autoplay !== true) return autoplay\r\n\r\n    // On first play, disable autoplay to avoid issues\r\n    // But if the player already played videos, we can safely autoplay next ones\r\n    if (isIOS() || isSafari()) {\r\n      return alreadyPlayed ? 'play' : false\r\n    }\r\n\r\n    return 'play'\r\n  }\r\n\r\n  getContextMenuOptions (player: videojs.Player, commonOptions: CommonOptions) {\r\n    const content = () => {\r\n      const isLoopEnabled = player.options_['loop']\r\n\r\n      const items = [\r\n        {\r\n          icon: 'repeat',\r\n          label: player.localize('Play in loop') + (isLoopEnabled ? '<span class=\"vjs-icon-tick-white\"></span>' : ''),\r\n          listener: function () {\r\n            player.options_['loop'] = !isLoopEnabled\r\n          }\r\n        },\r\n        {\r\n          label: player.localize('Copy the video URL'),\r\n          listener: function () {\r\n            copyToClipboard(buildVideoLink({ shortUUID: commonOptions.videoShortUUID }))\r\n          }\r\n        },\r\n        {\r\n          label: player.localize('Copy the video URL at the current time'),\r\n          listener: function (this: videojs.Player) {\r\n            const url = buildVideoLink({ shortUUID: commonOptions.videoShortUUID })\r\n\r\n            copyToClipboard(decorateVideoLink({ url, startTime: this.currentTime() }))\r\n          }\r\n        },\r\n        /*{\r\n          icon: 'code',\r\n          label: player.localize('Copy embed code'),\r\n          listener: () => {\r\n            copyToClipboard(buildVideoOrPlaylistEmbed(commonOptions.embedUrl, commonOptions.embedTitle))\r\n          }\r\n        }*/\r\n      ]\r\n\r\n      if (this.mode === 'webtorrent') {\r\n        items.push({\r\n          label: player.localize('Copy magnet URI'),\r\n          listener: function (this: videojs.Player) {\r\n            copyToClipboard(this.webtorrent().getCurrentVideoFile().magnetUri)\r\n          }\r\n        })\r\n      }\r\n\r\n      items.push({\r\n        icon: 'info',\r\n        label: player.localize('Stats for nerds'),\r\n        listener: () => {\r\n          player.stats().show()\r\n        }\r\n      })\r\n\r\n      return items.map(i => ({\r\n        ...i,\r\n        label: `<span class=\"vjs-icon-${i.icon || 'link-2'}\"></span>` + i.label\r\n      }))\r\n    }\r\n\r\n    return { content }\r\n  }\r\n}\r\n","import '@peertube/videojs-contextmenu'\r\nimport './shared/upnext/end-card'\r\nimport './shared/upnext/upnext-plugin'\r\nimport './shared/stats/stats-card'\r\nimport './shared/stats/stats-plugin'\r\nimport './shared/bezels/bezels-plugin'\r\nimport './shared/peertube/peertube-plugin'\r\nimport './shared/resolutions/peertube-resolutions-plugin'\r\nimport './shared/control-bar/next-previous-video-button'\r\nimport './shared/control-bar/p2p-info-button'\r\n//import './shared/control-bar/peertube-link-button'\r\nimport './shared/control-bar/picture-in-picture-bastyon'\r\nimport './shared/control-bar/peertube-load-progress-bar'\r\nimport './shared/control-bar/theater-button'\r\nimport './shared/settings/resolution-menu-button'\r\nimport './shared/settings/resolution-menu-item'\r\nimport './shared/settings/settings-dialog'\r\nimport './shared/settings/settings-menu-button'\r\nimport './shared/settings/settings-menu-item'\r\nimport './shared/settings/settings-panel'\r\nimport './shared/settings/settings-panel-child'\r\nimport './shared/playlist/playlist-plugin'\r\nimport './shared/mobile/peertube-mobile-plugin'\r\nimport './shared/mobile/peertube-mobile-buttons'\r\nimport './shared/hotkeys/peertube-hotkeys-plugin'\r\nimport \"./shared/videojs-helpers/hotkeys.js\";\r\n\r\nimport videojs from 'video.js'\r\nimport { logger } from '@root-helpers/logger'\r\nimport { isMobile } from '@root-helpers/web-browser'\r\nimport { saveAverageBandwidth } from './peertube-player-local-storage'\r\nimport { ManagerOptionsBuilder } from './shared/manager-options'\r\nimport { TranslationsManager } from './translations-manager'\r\nimport { CommonOptions, PeertubePlayerManagerOptions, PlayerMode, PlayerNetworkInfo } from './types'\r\n\r\n\r\nconst Fn: any = require('./shared/videojs-helpers/fn.js');\r\n\r\n\r\nconst Slider = videojs.getComponent('Slider') as any\r\nconst SeekBar = videojs.getComponent('SeekBar') as any\r\n\r\nSlider.prototype.update = function(){\r\n\r\n    // In VolumeBar init we have a setTimeout for update that pops and update\r\n    // to the end of the execution stack. The player is destroyed before then\r\n    // update will cause an error\r\n    // If there's no bar...\r\n    if (!this.el_ || !this.bar) {\r\n      return;\r\n    }\r\n\r\n    // clamp progress between 0 and 1\r\n    // and only round to four decimal places, as we round to two below\r\n    const progress = this.getProgress();\r\n\r\n    if (progress === this.progress_) {\r\n      return progress;\r\n    }\r\n\r\n    this.progress_ = progress;\r\n\r\n    // Set the new bar width or height\r\n    var el = this.bar.el()\r\n\r\n    if(!this.vertical()){\r\n      //el.style['transform-origin'] = 'left'\r\n      el.style['transform'] = 'scaleX('+(progress).toFixed(2)+')'\r\n    }\r\n    else{\r\n      el.style['transform-origin'] = 'bottom'\r\n      el.style['transform'] = 'scaleY('+(progress).toFixed(2)+')'\r\n    }\r\n\r\n    return progress;\r\n}\r\n\r\nSeekBar.prototype.getPercent = function getPercent () {\r\n  const time = this.player_.currentTime()\r\n  const percent = time / this.player_.duration()\r\n  return percent >= 1 ? 1 : percent\r\n}\r\n\r\nSeekBar.prototype.setEventHandlers_ = function () {\r\n\r\n  this.update_ = Fn.bind(this, this.update);\r\n  this.update = Fn.throttle(this.update_, Fn.UPDATE_REFRESH_INTERVAL);\r\n\r\n  this.on(this.player_, ['ended', 'durationchange', 'timeupdate'], this.update);\r\n  if (this.player_.liveTracker) {\r\n    this.on(this.player_.liveTracker, 'liveedgechange', this.update);\r\n  }\r\n\r\n  // when playing, let's ensure we smoothly update the play progress bar\r\n  // via an interval\r\n  this.updateInterval = null;\r\n\r\n  this.enableIntervalHandler_ = (e :any) => this.enableInterval_(e);\r\n  this.disableIntervalHandler_ = (e :any) => this.disableInterval_(e);\r\n\r\n  this.on(this.player_, ['playing'], this.enableIntervalHandler_);\r\n\r\n  this.on(this.player_, ['ended', 'pause', 'waiting'], this.disableIntervalHandler_);\r\n\r\n  // we don't need to update the play progress if the document is hidden,\r\n  // also, this causes the CPU to spike and eventually crash the page on IE11.\r\n  if ('hidden' in document && 'visibilityState' in document) {\r\n    this.on(document, 'visibilitychange', this.toggleVisibility_);\r\n  }\r\n}\r\n\r\nSeekBar.prototype.enableInterval_ = function() {\r\n  if (this.updateInterval) {\r\n    return;\r\n\r\n  }\r\n  this.updateInterval = this.setInterval(this.update, Fn.UPDATE_REFRESH_INTERVAL);\r\n}\r\n\r\nSeekBar.prototype.update = function (event : any) {\r\n\r\n  // ignore updates while the tab is hidden\r\n  if (document.visibilityState === 'hidden') {\r\n    return;\r\n  }\r\n\r\n  const percent = this.getPercent();\r\n\r\n    \r\n    /*const currentTime = this.player_.ended() ?\r\n    \r\n    this.player_.duration() : this.getCurrentTime_();\r\n\r\n    const liveTracker = this.player_.liveTracker;\r\n\r\n    let duration = this.player_.duration();\r\n\r\n    if (liveTracker && liveTracker.isLive()) {\r\n      duration = this.player_.liveTracker.liveCurrentTime();\r\n    }\r\n\r\n    if (this.percent_ !== percent) {\r\n      // machine readable value of progress bar (percentage complete)\r\n      //this.el_.setAttribute('aria-valuenow', (percent * 100).toFixed(2));\r\n      this.percent_ = percent;\r\n    }\r\n\r\n    if (this.currentTime_ !== currentTime || this.duration_ !== duration) {\r\n      // human readable value of progress bar (time complete)\r\n\r\n      this.currentTime_ = currentTime;\r\n      this.duration_ = duration;\r\n    }*/\r\n\r\n    var el = this.bar.el()\r\n\r\n    el.style['transform-origin'] = 'left'\r\n    el.style['transform'] = 'scaleX('+(percent).toFixed(2)+')'\r\n\r\n\r\n  return percent;\r\n  \r\n}\r\n\r\nSeekBar.prototype.handleMouseMove = function handleMouseMove (event: any) {\r\n\r\n  let newTime = this.calculateDistance(event) * this.player_.duration()\r\n  if (newTime === this.player_.duration()) {\r\n    newTime = newTime - 0.1\r\n  }\r\n\r\n  this.player_.currentTime(newTime)\r\n  this.update()\r\n}\r\n\r\n// Change 'Playback Rate' to 'Speed' (smaller for our settings menu)\r\n//(videojs.getComponent('PlaybackRateMenuButton') as any).prototype.controlText_ = 'Speed'\r\n\r\nconst CaptionsButton = videojs.getComponent('CaptionsButton') as any\r\n// Change Captions to Subtitles/CC\r\nCaptionsButton.prototype.controlText_ = 'Subtitles/CC'\r\n// We just want to display 'Off' instead of 'captions off', keep a space so the variable == true (hacky I know)\r\nCaptionsButton.prototype.label_ = ' '\r\n\r\nexport class PeertubePlayerManager {\r\n  private static playerElementClassName: string\r\n  private static onPlayerChange: (player: videojs.Player) => void\r\n  private static alreadyPlayed = false\r\n  //private static pluginsManager: PluginsManager\r\n\r\n  private static videojsDecodeErrors = 0\r\n\r\n\r\n  private static p2pMediaLoaderModule: any\r\n\r\n  static initState () {\r\n    this.alreadyPlayed = false\r\n  }\r\n\r\n  static async initialize (mode: PlayerMode, options: PeertubePlayerManagerOptions, onPlayerChange: (player: videojs.Player) => void) {\r\n    //this.pluginsManager = options.pluginsManager\r\n\r\n    this.onPlayerChange = onPlayerChange\r\n    this.playerElementClassName = options.common.playerElement.className\r\n\r\n    if (mode === 'webtorrent') await import('./shared/webtorrent/webtorrent-plugin')\r\n    if (mode === 'p2p-media-loader') {\r\n      const [ p2pMediaLoaderModule ] = await Promise.all([\r\n        import('p2p-media-loader-hlsjs-basyton'),\r\n        import('./shared/p2p-media-loader/p2p-media-loader-plugin')\r\n      ])\r\n\r\n      this.p2pMediaLoaderModule = p2pMediaLoaderModule\r\n    }\r\n\r\n    //await TranslationsManager.loadLocaleInVideoJS(options.common.serverUrl, options.common.language, videojs)\r\n\r\n\r\n    return this.buildPlayer(mode, options)\r\n  }\r\n\r\n  private static async buildPlayer (mode: PlayerMode, options: PeertubePlayerManagerOptions): Promise<videojs.Player> {\r\n    const videojsOptionsBuilder = new ManagerOptionsBuilder(mode, options, this.p2pMediaLoaderModule)\r\n    const videojsOptions = videojsOptionsBuilder.getVideojsOptions(this.alreadyPlayed)\r\n\r\n    /*const videojsOptions = await this.pluginsManager.runHook(\r\n      'filter:internal.player.videojs.options.result',\r\n      videojsOptionsBuilder.getVideojsOptions(this.alreadyPlayed)\r\n    )*/\r\n\r\n    const self = this\r\n    return new Promise(res => {\r\n      videojs(options.common.playerElement, videojsOptions, function (this: videojs.Player) {\r\n        const player = this\r\n\r\n        let alreadyFallback = false\r\n\r\n        const handleError = () => {\r\n          if (alreadyFallback) return\r\n          alreadyFallback = true\r\n\r\n          if (mode === 'p2p-media-loader') {\r\n            self.tryToRecoverHLSError(player.error(), player, options)\r\n          } else {\r\n            /// remove torrent /// self.maybeFallbackToWebTorrent(mode, player, options)\r\n          }\r\n        }\r\n\r\n        player.one('error', () => handleError())\r\n\r\n        player.one('play', () => {\r\n          self.alreadyPlayed = true\r\n        })\r\n\r\n        self.addContextMenu(videojsOptionsBuilder, player, options.common)\r\n\r\n        if (isMobile() || options.mobile) player.peertubeMobile()\r\n        //if (options.common.enableHotkeys === true) player.peerTubeHotkeysPlugin()\r\n        if (options.common.controlBar === false) player.controlBar.addClass('control-bar-hidden')\r\n\r\n        player.bezels()\r\n\r\n        player.stats({\r\n          videoUUID: options.common.videoUUID,\r\n          videoIsLive: options.common.isLive,\r\n          mode,\r\n          p2pEnabled: options.common.p2pEnabled\r\n        })\r\n\r\n        player.on('p2pInfo', (_, data: PlayerNetworkInfo) => {\r\n          if (data.source !== 'p2p-media-loader' || isNaN(data.bandwidthEstimate)) return\r\n\r\n          saveAverageBandwidth(data.bandwidthEstimate)\r\n        })\r\n\r\n        return res(player)\r\n      })\r\n    })\r\n  }\r\n\r\n  private static async tryToRecoverHLSError (err: any, currentPlayer: videojs.Player, options: PeertubePlayerManagerOptions) {\r\n    if (err.code === 3) { // Decode error\r\n\r\n      // Display a notification to user\r\n      if (this.videojsDecodeErrors === 0) {\r\n        options.common.errorNotifier(currentPlayer.localize('The video failed to play, will try to fast forward.'))\r\n      }\r\n\r\n      if (this.videojsDecodeErrors === 20) {\r\n        this.maybeFallbackToWebTorrent('p2p-media-loader', currentPlayer, options)\r\n        return\r\n      }\r\n\r\n      logger.info('Fast forwarding HLS to recover from an error.')\r\n\r\n      this.videojsDecodeErrors++\r\n\r\n      options.common.startTime = currentPlayer.currentTime() + 2\r\n      options.common.autoplay = true\r\n      this.rebuildAndUpdateVideoElement(currentPlayer, options.common)\r\n\r\n      const newPlayer = await this.buildPlayer('p2p-media-loader', options)\r\n      this.onPlayerChange(newPlayer)\r\n    } else {\r\n      this.maybeFallbackToWebTorrent('p2p-media-loader', currentPlayer, options)\r\n    }\r\n  }\r\n\r\n  private static async maybeFallbackToWebTorrent (\r\n    currentMode: PlayerMode,\r\n    currentPlayer: videojs.Player,\r\n    options: PeertubePlayerManagerOptions\r\n  ) {\r\n    if (options.webtorrent.videoFiles.length === 0 || currentMode === 'webtorrent') {\r\n      currentPlayer.peertube().displayFatalError()\r\n      return\r\n    }\r\n\r\n    logger.info('Fallback to webtorrent.')\r\n\r\n    this.rebuildAndUpdateVideoElement(currentPlayer, options.common)\r\n\r\n    await import('./shared/webtorrent/webtorrent-plugin')\r\n\r\n    const newPlayer = await this.buildPlayer('webtorrent', options)\r\n    this.onPlayerChange(newPlayer)\r\n  }\r\n\r\n  private static rebuildAndUpdateVideoElement (player: videojs.Player, commonOptions: CommonOptions) {\r\n    const newVideoElement = document.createElement('video')\r\n    newVideoElement.className = this.playerElementClassName\r\n\r\n    // VideoJS wraps our video element inside a div\r\n    let currentParentPlayerElement = commonOptions.playerElement.parentNode\r\n    // Fix on IOS, don't ask me why\r\n    if (!currentParentPlayerElement) currentParentPlayerElement = document.getElementById(commonOptions.playerElement.id).parentNode\r\n\r\n    currentParentPlayerElement.parentNode.insertBefore(newVideoElement, currentParentPlayerElement)\r\n\r\n    commonOptions.playerElement = newVideoElement\r\n    commonOptions.onPlayerElementChange(newVideoElement)\r\n\r\n    player.dispose()\r\n\r\n    return newVideoElement\r\n  }\r\n\r\n  private static addContextMenu (optionsBuilder: ManagerOptionsBuilder, player: videojs.Player, commonOptions: CommonOptions) {\r\n    const options = optionsBuilder.getContextMenuOptions(player, commonOptions)\r\n\r\n    player.contextmenuUI(options)\r\n  }\r\n}\r\n\r\n// ############################################################################\r\n\r\nexport {\r\n  videojs\r\n}\r\n","import { VideoFile } from '@shared/models'\r\n\r\nfunction toTitleCase (str: string) {\r\n  return str.charAt(0).toUpperCase() + str.slice(1)\r\n}\r\n\r\nconst dictionaryBytes = [\r\n  { max: 1024, type: 'B', decimals: 0 },\r\n  { max: 1048576, type: 'KB', decimals: 0 },\r\n  { max: 1073741824, type: 'MB', decimals: 0 },\r\n  { max: 1.0995116e12, type: 'GB', decimals: 1 }\r\n]\r\nfunction bytes (value: number) {\r\n  const format = dictionaryBytes.find(d => value < d.max) || dictionaryBytes[dictionaryBytes.length - 1]\r\n  const calc = (value / (format.max / 1024)).toFixed(format.decimals)\r\n\r\n  return [ calc, format.type ]\r\n}\r\n\r\nfunction videoFileMaxByResolution (files: VideoFile[]) {\r\n  let max = files[0]\r\n\r\n  for (let i = 1; i < files.length; i++) {\r\n    const file = files[i]\r\n    if (max.resolution.id < file.resolution.id) max = file\r\n  }\r\n\r\n  return max\r\n}\r\n\r\nfunction videoFileMinByResolution (files: VideoFile[]) {\r\n  let min = files[0]\r\n\r\n  for (let i = 1; i < files.length; i++) {\r\n    const file = files[i]\r\n    if (min.resolution.id > file.resolution.id) min = file\r\n  }\r\n\r\n  return min\r\n}\r\n\r\nfunction getRtcConfig () {\r\n  return {\r\n    iceServers: [\r\n      {\r\n        urls: 'stun:stun.stunprotocol.org'\r\n      },\r\n      {\r\n        urls: 'stun:stun.framasoft.org'\r\n      }\r\n    ]\r\n  }\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n\r\nexport {\r\n  getRtcConfig,\r\n  toTitleCase,\r\n\r\n  videoFileMaxByResolution,\r\n  videoFileMinByResolution,\r\n  bytes\r\n}\r\n","function isIOS () {\r\n  if (/iPad|iPhone|iPod/.test(navigator.platform)) {\r\n    return true\r\n  }\r\n\r\n  // Detect iPad Desktop mode\r\n  return !!(navigator.maxTouchPoints &&\r\n      navigator.maxTouchPoints > 2 &&\r\n      navigator.platform.includes('MacIntel'))\r\n}\r\n\r\nfunction isSafari () {\r\n  return /^((?!chrome|android).)*safari/i.test(navigator.userAgent)\r\n}\r\n\r\nfunction isMobile () {\r\n  return /iPhone|iPad|iPod|Android/i.test(navigator.userAgent)\r\n}\r\n\r\nexport {\r\n  isIOS,\r\n  isSafari,\r\n  isMobile\r\n}\r\n","module.exports = require('path-browserify')\r\n","export const LOCALE_FILES = [ 'player', 'server' ]\r\n\r\nexport const I18N_LOCALES = {\r\n  // Always first to avoid issues when using express acceptLanguages function when no accept language header is set\r\n  'en-US': 'English',\r\n\r\n  'ar': 'العربية',\r\n  'ca-ES': 'Català',\r\n  'cs-CZ': 'Čeština',\r\n  'de-DE': 'Deutsch',\r\n  'el-GR': 'ελληνικά',\r\n  'eo': 'Esperanto',\r\n  'es-ES': 'Español',\r\n  'eu-ES': 'Euskara',\r\n  'fi-FI': 'suomi',\r\n  'fr-FR': 'Français',\r\n  'gd': 'Gàidhlig',\r\n  'gl-ES': 'galego',\r\n  'hr': 'hrvatski',\r\n  'hu-HU': 'magyar',\r\n  'fa-IR': 'فارسی',\r\n  'it-IT': 'Italiano',\r\n  'ja-JP': '日本語',\r\n  'kab': 'Taqbaylit',\r\n  'nl-NL': 'Nederlands',\r\n  'oc': 'Occitan',\r\n  'pl-PL': 'Polski',\r\n  'pt-BR': 'Português (Brasil)',\r\n  'pt-PT': 'Português (Portugal)',\r\n  'ru-RU': 'русский',\r\n  'sq': 'Shqip',\r\n  'sv-SE': 'Svenska',\r\n  'nn': 'norsk nynorsk',\r\n  'nb-NO': 'norsk bokmål',\r\n  'th-TH': 'ไทย',\r\n  'vi-VN': 'Tiếng Việt',\r\n  'tok': 'Toki Pona',\r\n  'zh-Hans-CN': '简体中文（中国）',\r\n  'zh-Hant-TW': '繁體中文（台灣）'\r\n}\r\n\r\nconst I18N_LOCALE_ALIAS = {\r\n  'ar-001': 'ar',\r\n  'ca': 'ca-ES',\r\n  'cs': 'cs-CZ',\r\n  'de': 'de-DE',\r\n  'el': 'el-GR',\r\n  'en': 'en-US',\r\n  'es': 'es-ES',\r\n  'eu': 'eu-ES',\r\n  'fi': 'fi-FI',\r\n  'gl': 'gl-ES',\r\n  'fa': 'fa-IR',\r\n  'fr': 'fr-FR',\r\n  'hu': 'hu-HU',\r\n  'it': 'it-IT',\r\n  'ja': 'ja-JP',\r\n  'nl': 'nl-NL',\r\n  'pl': 'pl-PL',\r\n  'pt': 'pt-BR',\r\n  'nb': 'nb-NO',\r\n  'ru': 'ru-RU',\r\n  'sv': 'sv-SE',\r\n  'th': 'th-TH',\r\n  'vi': 'vi-VN',\r\n  'zh-CN': 'zh-Hans-CN',\r\n  'zh-Hans': 'zh-Hans-CN',\r\n  'zh-Hant': 'zh-Hant-TW',\r\n  'zh-TW': 'zh-Hant-TW',\r\n  'zh': 'zh-Hans-CN'\r\n}\r\n\r\nexport const POSSIBLE_LOCALES = Object.keys(I18N_LOCALES)\r\n                                      .concat(Object.keys(I18N_LOCALE_ALIAS))\r\n\r\nexport function getDefaultLocale () {\r\n  return 'en-US'\r\n}\r\n\r\nexport function isDefaultLocale (locale: string) {\r\n  return getCompleteLocale(locale) === getCompleteLocale(getDefaultLocale())\r\n}\r\n\r\nexport function peertubeTranslate (str: string, translations?: { [ id: string ]: string }) {\r\n  if (!translations || !translations[str]) return str\r\n\r\n  return translations[str]\r\n}\r\n\r\nconst possiblePaths = POSSIBLE_LOCALES.map(l => '/' + l)\r\nexport function is18nPath (path: string) {\r\n  return possiblePaths.includes(path)\r\n}\r\n\r\nexport function is18nLocale (locale: string) {\r\n  return POSSIBLE_LOCALES.includes(locale)\r\n}\r\n\r\nexport function getCompleteLocale (locale: string) {\r\n  if (!locale) return locale\r\n\r\n  if (I18N_LOCALE_ALIAS[locale]) return I18N_LOCALE_ALIAS[locale]\r\n\r\n  return locale\r\n}\r\n\r\nexport function getShortLocale (locale: string) {\r\n  if (locale.includes('-') === false) return locale\r\n\r\n  return locale.split('-')[0]\r\n}\r\n\r\nexport function buildFileLocale (locale: string) {\r\n  return getCompleteLocale(locale)\r\n}\r\n","function isToday (d: Date) {\r\n  const today = new Date()\r\n\r\n  return areDatesEqual(d, today)\r\n}\r\n\r\nfunction isYesterday (d: Date) {\r\n  const yesterday = new Date()\r\n  yesterday.setDate(yesterday.getDate() - 1)\r\n\r\n  return areDatesEqual(d, yesterday)\r\n}\r\n\r\nfunction isThisWeek (d: Date) {\r\n  const minDateOfThisWeek = new Date()\r\n  minDateOfThisWeek.setHours(0, 0, 0)\r\n\r\n  // getDay() -> Sunday - Saturday : 0 - 6\r\n  // We want to start our week on Monday\r\n  let dayOfWeek = minDateOfThisWeek.getDay() - 1\r\n  if (dayOfWeek < 0) dayOfWeek = 6 // Sunday\r\n\r\n  minDateOfThisWeek.setDate(minDateOfThisWeek.getDate() - dayOfWeek)\r\n\r\n  return d >= minDateOfThisWeek\r\n}\r\n\r\nfunction isThisMonth (d: Date) {\r\n  const thisMonth = new Date().getMonth()\r\n\r\n  return d.getMonth() === thisMonth\r\n}\r\n\r\nfunction isLastMonth (d: Date) {\r\n  const now = new Date()\r\n\r\n  return getDaysDifferences(now, d) <= 30\r\n}\r\n\r\nfunction isLastWeek (d: Date) {\r\n  const now = new Date()\r\n\r\n  return getDaysDifferences(now, d) <= 7\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n\r\nfunction timeToInt (time: number | string) {\r\n  if (!time) return 0\r\n  if (typeof time === 'number') return time\r\n\r\n  const reg = /^((\\d+)[h:])?((\\d+)[m:])?((\\d+)s?)?$/\r\n  const matches = time.match(reg)\r\n\r\n  if (!matches) return 0\r\n\r\n  const hours = parseInt(matches[2] || '0', 10)\r\n  const minutes = parseInt(matches[4] || '0', 10)\r\n  const seconds = parseInt(matches[6] || '0', 10)\r\n\r\n  return hours * 3600 + minutes * 60 + seconds\r\n}\r\n\r\nfunction secondsToTime (seconds: number, full = false, symbol?: string) {\r\n  let time = ''\r\n\r\n  if (seconds === 0 && !full) return '0s'\r\n\r\n  const hourSymbol = (symbol || 'h')\r\n  const minuteSymbol = (symbol || 'm')\r\n  const secondsSymbol = full ? '' : 's'\r\n\r\n  const hours = Math.floor(seconds / 3600)\r\n  if (hours >= 1) time = hours + hourSymbol\r\n  else if (full) time = '0' + hourSymbol\r\n\r\n  seconds %= 3600\r\n  const minutes = Math.floor(seconds / 60)\r\n  if (minutes >= 1 && minutes < 10 && full) time += '0' + minutes + minuteSymbol\r\n  else if (minutes >= 1) time += minutes + minuteSymbol\r\n  else if (full) time += '00' + minuteSymbol\r\n\r\n  seconds %= 60\r\n  if (seconds >= 1 && seconds < 10 && full) time += '0' + seconds + secondsSymbol\r\n  else if (seconds >= 1) time += seconds + secondsSymbol\r\n  else if (full) time += '00'\r\n\r\n  return time\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n\r\nexport {\r\n  isYesterday,\r\n  isThisWeek,\r\n  isThisMonth,\r\n  isToday,\r\n  isLastMonth,\r\n  isLastWeek,\r\n  timeToInt,\r\n  secondsToTime\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n\r\nfunction areDatesEqual (d1: Date, d2: Date) {\r\n  return d1.getFullYear() === d2.getFullYear() &&\r\n    d1.getMonth() === d2.getMonth() &&\r\n    d1.getDate() === d2.getDate()\r\n}\r\n\r\nfunction getDaysDifferences (d1: Date, d2: Date) {\r\n  return (d1.getTime() - d2.getTime()) / (86400000)\r\n}\r\n","function pick <O extends object, K extends keyof O> (object: O, keys: K[]): Pick<O, K> {\r\n  const result: any = {}\r\n\r\n  for (const key of keys) {\r\n    if (Object.prototype.hasOwnProperty.call(object, key)) {\r\n      result[key] = object[key]\r\n    }\r\n  }\r\n\r\n  return result\r\n}\r\n\r\nfunction getKeys <O extends object, K extends keyof O> (object: O, keys: K[]): K[] {\r\n  return (Object.keys(object) as K[]).filter(k => keys.includes(k))\r\n}\r\n\r\nfunction sortObjectComparator (key: string, order: 'asc' | 'desc') {\r\n  return (a: any, b: any) => {\r\n    if (a[key] < b[key]) {\r\n      return order === 'asc' ? -1 : 1\r\n    }\r\n\r\n    if (a[key] > b[key]) {\r\n      return order === 'asc' ? 1 : -1\r\n    }\r\n\r\n    return 0\r\n  }\r\n}\r\n\r\nexport {\r\n  pick,\r\n  getKeys,\r\n  sortObjectComparator\r\n}\r\n","import { Video, VideoPlaylist } from '../../models'\r\nimport { secondsToTime } from './date'\r\n\r\nfunction buildPlaylistLink (playlist: Pick<VideoPlaylist, 'shortUUID'>, base?: string) {\r\n  return (base ?? window.location.origin) + buildPlaylistWatchPath(playlist)\r\n}\r\n\r\nfunction buildPlaylistWatchPath (playlist: Pick<VideoPlaylist, 'shortUUID'>) {\r\n  return '/w/p/' + playlist.shortUUID\r\n}\r\n\r\nfunction buildVideoWatchPath (video: Pick<Video, 'shortUUID'>) {\r\n  return '/w/' + video.shortUUID\r\n}\r\n\r\nfunction buildVideoLink (video: Pick<Video, 'shortUUID'>, base?: string) {\r\n  return (base ?? window.location.origin) + buildVideoWatchPath(video)\r\n}\r\n\r\nfunction buildPlaylistEmbedPath (playlist: Pick<VideoPlaylist, 'uuid'>) {\r\n  return '/video-playlists/embed/' + playlist.uuid\r\n}\r\n\r\nfunction buildPlaylistEmbedLink (playlist: Pick<VideoPlaylist, 'uuid'>, base?: string) {\r\n  return (base ?? window.location.origin) + buildPlaylistEmbedPath(playlist)\r\n}\r\n\r\nfunction buildVideoEmbedPath (video: Pick<Video, 'uuid'>) {\r\n  return '/videos/embed/' + video.uuid\r\n}\r\n\r\nfunction buildVideoEmbedLink (video: Pick<Video, 'uuid'>, base?: string) {\r\n  return (base ?? window.location.origin) + buildVideoEmbedPath(video)\r\n}\r\n\r\nfunction decorateVideoLink (options: {\r\n  url: string\r\n\r\n  startTime?: number\r\n  stopTime?: number\r\n\r\n  subtitle?: string\r\n\r\n  loop?: boolean\r\n  autoplay?: boolean\r\n  muted?: boolean\r\n\r\n  // Embed options\r\n  title?: boolean\r\n  warningTitle?: boolean\r\n\r\n  controls?: boolean\r\n  controlBar?: boolean\r\n\r\n  peertubeLink?: boolean\r\n  p2p?: boolean\r\n}) {\r\n  const { url } = options\r\n\r\n  const params = new URLSearchParams()\r\n\r\n  if (options.startTime !== undefined && options.startTime !== null) {\r\n    const startTimeInt = Math.floor(options.startTime)\r\n    params.set('start', secondsToTime(startTimeInt))\r\n  }\r\n\r\n  if (options.stopTime) {\r\n    const stopTimeInt = Math.floor(options.stopTime)\r\n    params.set('stop', secondsToTime(stopTimeInt))\r\n  }\r\n\r\n  if (options.subtitle) params.set('subtitle', options.subtitle)\r\n\r\n  if (options.loop === true) params.set('loop', '1')\r\n  if (options.autoplay === true) params.set('autoplay', '1')\r\n  if (options.muted === true) params.set('muted', '1')\r\n  if (options.title === false) params.set('title', '0')\r\n  if (options.warningTitle === false) params.set('warningTitle', '0')\r\n\r\n  if (options.controls === false) params.set('controls', '0')\r\n  if (options.controlBar === false) params.set('controlBar', '0')\r\n\r\n  if (options.peertubeLink === false) params.set('peertubeLink', '0')\r\n  if (options.p2p !== undefined) params.set('p2p', options.p2p ? '1' : '0')\r\n\r\n  return buildUrl(url, params)\r\n}\r\n\r\nfunction decoratePlaylistLink (options: {\r\n  url: string\r\n\r\n  playlistPosition?: number\r\n}) {\r\n  const { url } = options\r\n\r\n  const params = new URLSearchParams()\r\n\r\n  if (options.playlistPosition) params.set('playlistPosition', '' + options.playlistPosition)\r\n\r\n  return buildUrl(url, params)\r\n}\r\n\r\n// ---------------------------------------------------------------------------\r\n\r\nexport {\r\n  buildPlaylistLink,\r\n  buildVideoLink,\r\n\r\n  buildVideoWatchPath,\r\n  buildPlaylistWatchPath,\r\n\r\n  buildPlaylistEmbedPath,\r\n  buildVideoEmbedPath,\r\n\r\n  buildPlaylistEmbedLink,\r\n  buildVideoEmbedLink,\r\n\r\n  decorateVideoLink,\r\n  decoratePlaylistLink\r\n}\r\n\r\nfunction buildUrl (url: string, params: URLSearchParams) {\r\n  let hasParams = false\r\n  params.forEach(() => { hasParams = true })\r\n\r\n  if (hasParams) return url + '?' + params.toString()\r\n\r\n  return url\r\n}\r\n","export const TEXT_RULES = [\r\n  'linkify',\r\n  'autolink',\r\n  'emphasis',\r\n  'link',\r\n  'newline',\r\n  'entity',\r\n  'list'\r\n]\r\n\r\nexport const TEXT_WITH_HTML_RULES = TEXT_RULES.concat([\r\n  'html_inline',\r\n  'html_block'\r\n])\r\n\r\nexport const ENHANCED_RULES = TEXT_RULES.concat([ 'image' ])\r\nexport const ENHANCED_WITH_HTML_RULES = TEXT_WITH_HTML_RULES.concat([ 'image' ])\r\n\r\nexport const COMPLETE_RULES = ENHANCED_WITH_HTML_RULES.concat([\r\n  'block',\r\n  'inline',\r\n  'heading',\r\n  'paragraph'\r\n])\r\n"],"names":["_guid","UPDATE_REFRESH_INTERVAL","bind","context","fn","uid","guid","bound","throttle","wait","last","window","now","debounce","func","immediate","timeout","cancel","clearTimeout","debounced","self","this","args","arguments","later","apply","setTimeout","factory","videojs","version","registerPlugin","plugin","options","player","pEl","el","doc","document","volumeStep","mergeOptions","util","seekStep","enableMute","enableVolumeScroll","enableHoverScroll","enableFullscreen","enableNumbers","enableJogStyle","alwaysCaptureHotkeys","captureDocumentHotkeys","documentHotkeysFocusElementFilter","enableModifiersForNumbers","enableInactiveFocus","skipInitialFocus","playPauseKey","e","which","rewindKey","forwardKey","volumeUpKey","volumeDownKey","muteKey","fullscreenKey","customKeys","enableFull","videojsVer","VERSION","hasAttribute","setAttribute","style","outline","autoplay","one","focus","on","cancelFocusingPlayer","focusingPlayerTimeout","off","activeElement","controlBar","querySelector","parentElement","ifblocker","display","bottom","keyDown","event","wasPlaying","seekTime","value","ewhich","ePreventDefault","preventDefault","duration","controls","activeEl","checkKeys","stopPropagation","paused","play","then","console","log","pause","currentTime","seekStepD","volume","muted","isFullscreen","exitFullscreen","requestFullscreen","metaKey","ctrlKey","altKey","sub","number","customKey","customHotkey","key","handler","doubleClick","relatedTarget","toElement","volumeHover","volumeSelector","onmouseover","onmouseout","mouseScroll","delta","Math","max","min","wheelDelta","detail","active","addEventListener","removeEventListener","define","module","default","getStoredVolume","getLocalStorage","valueNumber","parseFloat","isNaN","getStoredMute","getStoredTheater","saveVolumeInStore","setLocalStorage","toString","saveMuteInStore","saveTheaterInStore","enabled","saveAverageBandwidth","getAverageBandwidthInStore","parseInt","saveLastSubtitle","language","getStoredLastSubtitle","saveVideoWatchHistory","videoUUID","JSON","stringify","data","parse","error","getStoredVideoWatchHistory","date","Date","toISOString","KEY_PREFIX","localStorage","getItem","setItem","Component","constructor","super","dashOffsetTotal","dashOffsetStart","interval","upNextEvents","ticks","totalTicks","options_","_","condition","addClass","showCard","canceled","removeClass","container","next","trigger","createEl","className","innerHTML","headText","cancelText","suspendedText","autoplayRing","getElementsByClassName","title","cancelButton","suspendedMessage","nextButton","onclick","cb","getTitle","goToPercent","percent","newOffset","tick","update","suspended","innerText","Plugin","settings","ready","addChild","StatsCard","metadataStore","intervalMs","playerNetworkInfo","containerEl","infoListEl","closeButton","tabindex","hide","appendChild","populateInfoBlocks","player_","mode","source","p2pStats","p2p","httpStats","http","downloadSpeed","join","uploadSpeed","totalDownloaded","downloaded","totalUploaded","uploaded","numPeers","averageBandwidth","bandwidthEstimate","downloadedFromServer","downloadedFromPeers","toggle","updateInterval","show","setInterval","buildHLSOptions","populateInfoValues","err","logger","clearInterval","p2pMediaLoader","level","getCurrentLevel","codecs","videoCodec","audioCodec","undefined","resolution","height","attrs","buffer","timeRangesToString","buffered","progress","latency","videoIsLive","getLiveLatency","bufferedPercent","async","videoFile","webtorrent","getCurrentVideoFile","fileUrl","fetch","metadataUrl","res","json","metadata","colorSpace","streams","stream","label","fps","getTorrent","playerMode","buildInfoRow","localize","uuid","viewport","color","connection","network","transferred","download","bufferProgress","bufferState","liveLatency","root","videoQuality","getVideoPlaybackQuality","frames","documentElement","clientWidth","innerWidth","clientHeight","innerHeight","devicePixelRatio","toFixed","droppedVideoFrames","totalVideoFrames","round","networkActivity","totalTransferred","downloadBreakdown","setInfoValue","p2pEnabled","labelText","valueHTML","r","result","i","length","start","floor","end","statsCard","seeking","ended","showBezel","debugLogger","CONSTANTS","USER_VIEW_VIDEO_INTERVAL","menuOpened","mouseInControlBar","mouseInSettings","videoViewUrl","authorizationHeader","startTime","initialInactivityTimeout","inactivityTimeout","playerOptions","defaultSubtitle","subtitle","stopTime","onTimeUpdate","textTracks","showing","tracks_","find","t","kind","videoDuration","initializePlayer","runUserViewing","dispose","videoViewInterval","onMenuOpened","alterInactivity","onMenuClosed","displayFatalError","hideFatalError","initSmoothProgressBar","listenControlBarMouse","listenFullScreenChange","lastViewEvent","lastCurrentTime","notifyUserIsWatching","abs","catch","viewEvent","Promise","resolve","body","headers","Headers","set","method","settingsButton","dialog","setInactivityTimeout","reportUserActivity","cache_","SeekBar","prototype","getPercent","handleMouseMove","newTime","calculateDistance","resolutions","autoResolutionEnabled","add","push","currentSelection","getSelected","sort","getResolutions","selected","getAutoResolutionChosen","id","autoResolutionChosenId","select","byEngine","selectCallback","disableAutoResolution","enabledAutoResolution","isAutoResolutionEnabeld","a","b","Button","NextPreviousVideoButton","nextPreviousVideoButtonOptions","type","button","nextIcon","handleClick","isDisabled","div","subDivWebtorrent","downloadIcon","downloadSpeedText","downloadSpeedNumber","downloadSpeedUnit","uploadIcon","uploadSpeedText","uploadSpeedNumber","uploadSpeedUnit","peersText","peersNumber","subDivHttp","subDivHttpText","textContent","MenuButton","controlText","buildElement","classList","registerComponent","torrent","TheaterButton","THEATER_MODE_CLASS","handleTheaterChange","theaterEnabled","buildCSSClass","isTheaterEnabled","toggleClass","hasClass","MenuItem","ResolutionMenuItem","selectable","autoResolutionChosen","resolutionId","peertubeResolutions","updateSelection","updateAutoResolution","selectedResolution","getLabel","Menu","buildQualities","labelEl_","updateARIAAttributes","createMenu","buildWrapperCSSClass","addClickListener","component","children","menu","child","d","m","uniqueId","tabIndex","role","SettingsMenuItem","menuButton","mainMenu","panel","getChild","panelChild","panelChildEl","size","menuToLoad","subMenuName","entry","SubMenuComponent","Error","newOptions","Object","assign","subMenu","subMenuClass","split","settingsSubMenuEl_","eventHandlers","build","submenuClickHandler","bindClickEvents","reset","onSubmenuClick","transitionEndHandler","onTransitionEnd","target","currentTarget","contains","loadMainMenu","settingsSubMenuTitleEl_","settingsSubMenuValueEl_","opacity","marginRight","setDialogSize","firstChild","createBackButton","PrefixedEvent","element","callback","action","prefix","p","toLowerCase","propertyName","setMargin","mainMenuEl","mainMenuAny","width","setSize","name","html","subMenuItem","children_","subMenuItemUntyped","hideDialog","item","getComponentSize","hideSubMenu","contentElType","settingsButtonOptions","dialogEl","addSettingsItemHandler","onAddSettingsItem","disposeSettingsItemHandler","onDisposeSettingsItem","documentClickHandler","onDocumentClick","userInactiveHandler","onUserInactive","buildMenu","bindEvents","removeChild","entries","isInIframe","addMenuItem","showDialog","peertube","resetChildren","offsetWidth","offsetHeight","offset","setup","maxHeightOffset","maxHeight","panelEl","settingsMenuItem","hideChildren","el_","menuChild","top","ClickableComponent","PlaylistButton","wrapper","icon","playlistInfoElement","getCurrentPosition","playlist","videosLength","displayName","getPlaylistMenu","open","playlistMenu","PlaylistMenuItem","emitTapEvents","switchPlaylistItem","handleKeyDown","li","video","positionBlock","position","buildAvailableVideo","buildUnavailableVideo","setSelected","getElement","videoElement","thumbnail","src","location","origin","thumbnailPath","infoBlock","channel","startTimestamp","stopTimestamp","timestamps","append","block","code","onClicked","PlaylistMenu","close","current","menuItems","getOptions","header","headerLeft","leftTitle","playlistChannel","videoChannel","leftSubtitle","list","playlistElement","elements","onItemClicked","updateSelected","newPosition","playlistButton","PeerTubeMobilePlugin","seekAmount","peerTubeMobileButtons","reportTouchActivity","screen","orientation","handleFullscreenRotation","userActions","click","initTouchStartEvents","isPortraitVideo","lock","videoWidth","videoHeight","handleTouchStart","tapTimeout","lastTapEvent","timeStamp","DOUBLE_TAP_DELAY_MS","onDoubleTap","newActiveState","userActive","passive","playerWidth","currentWidth","rect","findPlayerTarget","getBoundingClientRect","offsetX","targetTouches","pageX","left","displayFastSeek","scheduleSetCurrentTime","setCurrentTimeTimeout","SET_CURRENT_TIME_DELAY","mainButton","rewind","forward","rewindText","forwardText","amount","hideRewind","hideForward","displayForward","displayRewind","remove","PeerTubeHotkeysPlugin","handlers","buildHandlers","handleKeyFunction","onKeyDown","isValidKeyTarget","accept","isNaked","VOLUME_STEP","SEEK_STEP","playbackRate","eventEl","playerEl","currentElTagName","tagName","shiftKey","copyToClipboard","text","createElement","execCommand","ms","ControlBarOptionsBuilder","globalOptions","common","getChildrenOptions","previousVideo","getPreviousVideo","playToggle","nextVideo","getNextVideo","currentTimeDisplay","timeDivider","durationDisplay","liveDisplay","flexibleWidthSpacer","getProgressControl","p2PInfoButton","muteToggle","volumeControl","getSettingsButton","PictureInPictureBastyon","theaterButton","fullscreenToggle","settingEntries","progressControl","seekBar","mouseTimeDisplay","playProgressBar","previousVideoButton","hasPreviousVideo","nextVideoButton","hasNextVideo","RedundancyUrlManager","baseUrls","removeBySegmentUrl","segmentUrl","baseUrl","dirname","filter","u","buildUrl","url","getRandomInt","newBaseUrl","slashPart","endsWith","basename","countBaseUrls","random","segmentUrlBuilderFactory","redundancyUrlManager","segment","segmentValidatorFactory","segmentsSha256Url","isLive","segmentsJSON","fetchSha256Segments","regex","segmentValidator","_method","_peerId","retry","filename","segmentValue","hashShouldBe","range","captured","exec","calculatedSha","crypto","subtle","digest","s","h","Uint8Array","forEach","v","bufferToHex","sha256","Buffer","from","sha256Hex","HLSOptionsBuilder","p2pMediaLoaderModule","getPluginOptions","commonOptions","redundancyBaseUrls","p2pMediaLoaderConfig","getP2PMediaLoaderOptions","loader","Engine","createLoaderClass","playlistUrl","hlsjs","levelLabelHandler","file","videoFiles","f","html5","hlsjsConfig","getHLSJSOptions","consumeOnly","navigator","trackerAnnounce","startsWith","specificLiveOrVODOptions","getP2PMediaLoaderLiveOptions","getP2PMediaLoaderVODOptions","rtcConfig","simultaneousHttpDownloads","httpFailedSegmentTimeout","localTransport","segmentUrlBuilder","useP2P","segmentsStorage","segments","assetsStorage","swarmId","forwardSegmentCount","p2pDownloadMaxPriority","base","requiredSegmentsPriority","liveOptions","latencyMode","httpDownloadProbability","skipSegmentBuilderPriority","cachedSegmentExpiration","cachedSegmentsCount","httpDownloadMaxPriority","httpDownloadProbabilitySkipIfNoPeers","getHLSLiveOptions","getHLSVODOptions","capLevelToPlayerSize","autoStartLoad","abrEwmaDefaultEstimate","backBufferLength","startLevel","testBandwidth","debug","liveSyncDurationCount","WebTorrentOptionsBuilder","autoPlayValue","webtorrentOptions","p2pMediaLoaderOptions","playerRefusedP2P","playerElement","ManagerOptionsBuilder","getVideojsOptions","alreadyPlayed","getAutoPlayValue","preloadTextTracks","plugins","webtorrentOptionsBuilder","hotkeys","controlBarOptionsBuilder","videojsOptions","textTrackSettings","loop","poster","playbackRates","sources","getContextMenuOptions","content","isLoopEnabled","items","listener","shortUUID","videoShortUUID","magnetUri","stats","map","Fn","Slider","bar","getProgress","progress_","vertical","setEventHandlers_","update_","liveTracker","enableIntervalHandler_","enableInterval_","disableIntervalHandler_","disableInterval_","toggleVisibility_","visibilityState","CaptionsButton","controlText_","label_","PeertubePlayerManager","static","onPlayerChange","playerElementClassName","all","buildPlayer","videojsOptionsBuilder","alreadyFallback","tryToRecoverHLSError","addContextMenu","mobile","peertubeMobile","bezels","currentPlayer","videojsDecodeErrors","errorNotifier","maybeFallbackToWebTorrent","rebuildAndUpdateVideoElement","newPlayer","currentMode","newVideoElement","currentParentPlayerElement","parentNode","getElementById","insertBefore","onPlayerElementChange","optionsBuilder","contextmenuUI","toTitleCase","str","charAt","toUpperCase","slice","dictionaryBytes","decimals","bytes","format","videoFileMaxByResolution","files","videoFileMinByResolution","getRtcConfig","iceServers","urls","isIOS","test","platform","maxTouchPoints","includes","isSafari","userAgent","isMobile","exports","I18N_LOCALE_ALIAS","isDefaultLocale","locale","getCompleteLocale","keys","concat","l","timeToInt","time","matches","match","secondsToTime","seconds","full","symbol","hourSymbol","minuteSymbol","secondsSymbol","hours","minutes","pick","object","hasOwnProperty","call","buildVideoLink","buildVideoWatchPath","decorateVideoLink","params","URLSearchParams","startTimeInt","stopTimeInt","warningTitle","peertubeLink","hasParams","TEXT_RULES","TEXT_WITH_HTML_RULES"],"sourceRoot":""}